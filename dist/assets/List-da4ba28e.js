import{b as D,d as J,U as P,B as S,H as U,x as e,M as oe,I as se,bu as ce,J as ue,K as ge,ai as q,bR as de,bE as he,bG as be,bH as me,ao as fe,S as w,bI as we,W as M,d$ as F,e0 as H,e1 as xe,am as f,bL as $e,bN as Ce,av as d,bb as Se,bO as je,O as ye,Q as B,aO as V,e9 as X,R as ke,ea as Q,br as pe,n as K,dD as ve,q as Oe,aN as k,r as Le,$ as R,eb as A,E as Y,a$ as Z,aC as T,ah as b,aX as _e,cI as Ae,ax as Ie,ay as N,aB as Me,cJ as ee,cX as ze,au as Be,A as Pe,o as Te,j as De,e as Ee,ec as We,ed as Fe,b1 as He,V as I,ee as Ke,ad as Re}from"./index-bcc8ecfe.js";import{b as Ne}from"./style-f7e8752b.js";import{x as Ge}from"./index-25ad48d0.js";import{g as Je,O as G}from"./icon-d37a8515.js";import{I as te,u as ne}from"./helper-2e6439f6.js";import{g as Ue,A as qe,u as Ve}from"./label-bea42e0d.js";const Xe=t=>{const i=D(),{to:u}=J(),{refresh:h}=P(),[a,s]=S([]),[g,c]=S(!1),x=()=>{var r;t.isOpen&&((r=t.obj.label_list)!=null&&r.length)?s(t.obj.label_list.map(o=>o.id.toString())):s([])};U(()=>{t.isOpen&&x()});const p=async()=>{try{c(!0);const r=a().join(","),o=await Q(r,t.obj);pe(o,()=>{K.success(i("home.tag.bind_success")),t.onSubmit(a()),t.onClose(),h()})}catch(r){K.error(r.message||i("home.tag.bind_failed"))}finally{c(!1)}},v=()=>{t.onClose(),u("/@manage/settings/tag")},j=r=>{const o=a();o.includes(r)?s(o.filter($=>$!==r)):s([...o,r])},O=r=>{s(a().filter(o=>o!==r))},L=r=>{var o;return((o=t.labels.find($=>$.id.toString()===r))==null?void 0:o.name)||""};return e(ke,{get opened(){return t.isOpen},get onClose(){return t.onClose},get children(){return[e(oe,{}),e(se,{get children(){return[e(ce,{}),e(ue,{get children(){return i("home.tag.tag")}}),e(ge,{get children(){return e(q,{spacing:"$3",get children(){return e(de,{required:!0,get children(){return[e(he,{color:"$neutral11",get children(){return i("home.tag.select")}}),e(be,{multiple:!0,get value(){return a()},onChange:s,get children(){return[e(me,{get children(){return e(fe,{display:"flex",flexWrap:"wrap",gap:"$2",p:"$2",minH:"40px",alignItems:"center",get children(){return e(w,{get when(){return a().length>0},get fallback(){return e(we,{get children(){return i("home.tag.select")}})},get children(){return[e(M,{get each(){return a()},children:r=>e(F,{size:"lg",variant:"subtle",bgColor:"$neutral2",rounded:"$sm",px:"$3",py:"$1",get children(){return[e(H,{get children(){return L(r)}}),e(xe,{onClick:o=>{o.stopPropagation(),O(r)}})]}})}),e(w,{get when(){return a().length>=3},get children(){return e(F,{size:"lg",variant:"subtle",bgColor:"$neutral2",rounded:"$sm",px:"$3",py:"$1",get children(){return e(H,{get children(){return["+",f(()=>a().length-3)]}})}})}})]}})}})}}),e($e,{get children(){return e(M,{get each(){return t.labels},children:r=>e(Ce,{get value(){return r.id.toString()},onClick:()=>j(r.id.toString()),get children(){return e(d,{spacing:"$2",w:"$full",pl:"$4",fontSize:"$lg",get children(){return[e(Se,{get checked(){return a().includes(r.id.toString())},readOnly:!0}),e(je,{get children(){return r.name}})]}})}})})}})]}})]}})}})}}),e(ye,{get children(){return e(d,{spacing:"$2",justifyContent:"space-between",w:"$full",get children(){return[e(B,{onClick:v,get leftIcon(){return e(V,{as:X,boxSize:"$5"})},get children(){return i("home.tag.new")}}),e(d,{spacing:"$2",get children(){return[e(B,{colorScheme:"primary",get onClick(){return t.onClose},get children(){return i("global.cancel")}}),e(B,{onClick:p,get loading(){return g()},get children(){return i("global.confirm")}})]}})]}})}})]}})]}})},l=[{name:"name",textAlign:"left",w:{"@initial":"30%","@md":"30%"}},{name:"tag",textAlign:"right",w:{"@initial":"46%","@md":"25%"}},{name:"size",textAlign:"right",w:{"@initial":"24%","@md":"15%"}},{name:"modified",textAlign:"right",w:{"@initial":0,"@md":"30%"}}],Qe=()=>{const t=Ee,i=Pe(()=>t().reduce((h,a)=>h+(a.size||0),0)),u=D();return e(w,{get when(){return t().length>0},get children(){return e(d,{spacing:"$2",position:"fixed",top:"$4",right:"$4",transform:"none",get bgColor(){return T()},color:"white",p:"$2",rounded:"$lg",zIndex:"$banner",shadow:"$md",get children(){return[e(b,{get children(){return[f(()=>u("home.selected"))," ",f(()=>t().length)," ",f(()=>u("home.selected_count"))]}}),e(b,{get children(){return[f(()=>u("home.total_size"))," ",f(()=>ee(i()))]}})]}})}})},Ye=t=>{const{isHide:i}=ve(),{refresh:u}=P();if(i(t.obj))return null;const{setPathAs:h}=P(),{show:a}=Ne({id:1}),{pushHref:s,to:g,pathname:c}=J(),{openWithDoubleClick:x,toggleWithClick:p,restoreSelectionCache:v}=ne(),j=()=>Te.list_item_filename_overflow,O=()=>(N().permissions,De(c(),t.obj.name)),{labels:L,refetch:r}=Ve(),[o,$]=S(!1),[ae,E]=S(!1);Oe(()=>{const n=()=>{r()};k.on("refresh_labels",n),Le(()=>{k.off("refresh_labels",n)})});const le=async(n,m,_)=>{var y;try{const C=await r();if((y=C==null?void 0:C.data)!=null&&y.content){const W=C.data.content.find(z=>z.name===n&&z.description===m&&z.bg_color===_);W&&(await Q(W.id.toString(),t.obj),await u(!1,!0))}}catch(C){console.error("Failed to bind label to file:",C)}},ie=n=>{k.emit("refresh")};return[e(Be.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return e(d,{get classList(){return{selected:!!t.obj.selected}},class:"list-item viselect-item",get"data-index"(){return t.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",backgroundColor:R()}},get bgColor(){return f(()=>!!t.obj.selected,!0)()?R():void 0},get children(){return[e(d,{class:"name-box",spacing:"$1",get w(){return l[0].w},as:Ge,get href(){return t.obj.name},get cursor(){return x()||p()?"default":"pointer"},"on:dblclick":()=>{x()&&(A(t.index,!0,!0),g(O()))},"on:click":n=>{if(n.preventDefault(),!x()&&!(n.ctrlKey||n.metaKey||n.shiftKey)&&v()){if(p())return A(t.index,!t.obj.selected);g(O())}},onMouseEnter:()=>{h(t.obj.name,t.obj.is_dir,!0)},onContextMenu:n=>{Y(()=>{A(t.index,!0,!0)}),a(n,{props:t.obj})},get children(){return[e(w,{get when(){return Z()},get children(){return e(te,{"on:mousedown":n=>{n.stopPropagation()},"on:click":n=>{n.stopPropagation()},get checked(){return t.obj.selected},onChange:n=>{A(t.index,n.target.checked)}})}}),e(V,{class:"icon",boxSize:"$6",get color(){return T()},get as(){return Je(t.obj)},mr:"$1",get cursor(){return t.obj.type!==G.IMAGE?"inherit":"pointer"},"on:click":n=>{t.obj.type===G.IMAGE&&(n.ctrlKey||n.metaKey||n.shiftKey||v()&&(k.emit("gallery",t.obj.name),n.preventDefault(),n.stopPropagation()))}}),e(b,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:j()==="multi_line"?"unset":"nowrap","overflow-x":j()==="scrollable"?"auto":"hidden",textOverflow:j()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return t.obj.name},get children(){return t.obj.name}})]}}),e(d,{spacing:"$1",get w(){return l[1].w},get textAlign(){return l[1].textAlign},onClick:n=>{n.preventDefault(),n.stopPropagation()},justifyContent:"space-between",get children(){return[e(d,{spacing:"$1",flex:1,overflow:"hidden",get children(){return e(w,{get when(){var n;return(n=t.obj.label_list)==null?void 0:n.length},get children(){return e(M,{get each(){return t.obj.label_list||[]},children:n=>e(_e,{get label(){return n.name},placement:"top",get children(){return e(Ae,{colorScheme:"primary",get bgColor(){return Ue(n.bg_color)},get color(){return n.bg_color},variant:"solid",mr:"$1",textTransform:"none",maxW:"100px",overflow:"hidden",css:{textOverflow:"ellipsis",whiteSpace:"nowrap"},get children(){return n.name}})}})})}})}}),e(w,{get when(){return Ie.is_admin(N())&&!t.obj.is_dir},get children(){return e(Me,{size:"xs",variant:"ghost",get color(){return T()},get icon(){return e(X,{size:20})},"aria-label":"添加标签",onClick:n=>{var _,y;n.preventDefault(),n.stopPropagation();const m=L();(y=(_=m==null?void 0:m.data)==null?void 0:_.content)!=null&&y.length?E(!0):$(!0)},flexShrink:0})}}),e(qe,{get isOpen(){return o()},onClose:()=>$(!1),onSubmit:le}),e(Xe,{get isOpen(){return ae()},onClose:()=>E(!1),onSubmit:ie,get labels(){var n,m;return((m=(n=L())==null?void 0:n.data)==null?void 0:m.content)||[]},get obj(){return t.obj}})]}}),e(b,{class:"size",get w(){return l[2].w},get textAlign(){return l[2].textAlign},get children(){return ee(t.obj.size)}}),e(b,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return l[3].w},get textAlign(){return l[3].textAlign},get children(){return ze(t.obj.modified)}})]}})}}),e(Qe,{})]},re=t=>{const i=D(),[u,h]=S(),[a,s]=S(!1);U(()=>{u()&&t.sortCallback(u(),a())});const g=c=>({fontWeight:"bold",fontSize:"$sm",color:"$neutral11",textAlign:c.textAlign,cursor:"pointer",onClick:()=>{c.name===u()?s(!a()):Y(()=>{h(c.name),s(!1)})}});return e(d,{class:"title",w:"$full",p:"$2",get children(){return[e(d,{get w(){return l[0].w},spacing:"$1",get children(){return[e(w,{get when(){return f(()=>!t.disableCheckbox,!0)()&&Z()},get children(){return e(te,{get checked(){return We()},get indeterminate(){return Fe()},onChange:c=>{He(c.target.checked)}})}}),e(b,I(()=>g(l[0]),{get children(){return i(`home.obj.${l[0].name}`)}}))]}}),e(b,I({get w(){return l[1].w}},()=>g(l[1]),{get children(){return i(`home.obj.${l[1].name}`)}})),e(b,I({get w(){return l[2].w}},()=>g(l[2]),{get children(){return i(`home.obj.${l[2].name}`)}})),e(b,I({get w(){return l[3].w}},()=>g(l[3]),{display:{"@initial":"none","@md":"inline"},get children(){return i(`home.obj.${l[3].name}`)}}))]}})},Ze=()=>{const t=a=>{var g;const s=Array.from(((g=a.dataTransfer)==null?void 0:g.items)??[]);for(let c=0;c<s.length;c++)if(s[c].kind==="file"){k.emit("tool","upload"),a.preventDefault();break}},{isMouseSupported:i,registerSelectContainer:u,captureContentMenu:h}=ne();return u(),e(q,{onDragOver:t,"oncapture:contextmenu":h,class:"list viselect-container",w:"$full",spacing:"$1",get children(){return[e(re,{sortCallback:Ke}),e(M,{get each(){return Re.objs},children:(a,s)=>e(Ye,{obj:a,get index(){return s()}})})]}})},it=Object.freeze(Object.defineProperty({__proto__:null,ListTitle:re,default:Ze},Symbol.toStringTag,{value:"Module"}));export{re as L,it as a,l as c};
