import{b as q,d as D,B as H,cH as O,b9 as d,dH as _,bq as h,x as e,bW as B,ap as F,ai as b,S as f,bR as o,bE as u,L as m,bG as z,bH as W,ao as E,bI as M,W as w,d$ as P,e0 as U,e1 as A,bL as G,bM as N,bN as Q,av as V,bb as $,bO as j,Q as J,n as c,br as g}from"./index-e0a86cdb.js";const Y=()=>{const n=q(),{params:x,back:y}=D(),{id:l}=x,[p,S]=H([]),[t,a]=O({id:0,username:"",password:"",base_path:"",role:[],permission:0,disabled:!1,sso_id:"",role_info:[],permissions:[]}),[k,C]=d(()=>_()),[v,L]=d(()=>h.get(`/admin/user/get?id=${l}`));(async()=>{const r=await C();if(g(r,s=>{S(s.content)}),l){const s=await L();g(s,a)}})();const[I,T]=d(()=>h.post(`/admin/user/${l?"update":"create"}`,t));return e(b,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[e(B,{get children(){return n(l?"global.edit":"global.add")}}),e(F,{get loading(){return v()||k()},get children(){return e(b,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[e(f,{get when(){return!l||!(t.role_info||[]).includes(1)},get children(){return[e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(u,{for:"username",display:"flex",alignItems:"center",get children(){return n("users.username")}}),e(m,{id:"username",get value(){return t.username},onInput:r=>a("username",r.currentTarget.value)})]}}),e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(u,{for:"password",display:"flex",alignItems:"center",get children(){return n("users.password")}}),e(m,{id:"password",type:"password",placeholder:"********",get value(){return t.password},onInput:r=>a("password",r.currentTarget.value)})]}})]}}),e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(u,{display:"flex",alignItems:"center",get children(){return n("users.role")}}),e(z,{get value(){return t.role},onChange:r=>a("role",r),get children(){return[e(W,{get children(){return e(E,{display:"flex",flexWrap:"wrap",gap:"$2",pr:"$6",py:"$2",minH:"40px",alignItems:"center",get children(){return e(f,{get when(){return t.role.length>0},get fallback(){return e(M,{get children(){return n("home.selected")}})},get children(){return e(w,{get each(){return t.role},children:r=>{const s=p().find(i=>i.id===r);return e(P,{size:"lg",variant:"subtle",bgColor:"$neutral2",rounded:"$sm",px:"$3",py:"$1",get children(){return[e(U,{get children(){return(s==null?void 0:s.name)||`ID: ${r}`}}),e(A,{onClick:i=>{i.stopPropagation(),a("role",t.role.filter(R=>R!==r))}})]}})}})}})}})}}),e(G,{get children(){return e(N,{get children(){return e(w,{get each(){return p()},children:r=>e(Q,{get value(){return r.id},onClick:()=>{const s=t.role.includes(r.id)?t.role.filter(i=>i!==r.id):[r.id];a("role",s)},get children(){return e(V,{spacing:"$2",w:"$full",pl:"$4",fontSize:"$lg",get children(){return[e($,{get checked(){return t.role.includes(r.id)},readOnly:!0}),e(j,{get children(){return r.name}})]}})}})})}})}})]}})]}}),e(o,{w:"fit-content",display:"flex",get children(){return e($,{css:{whiteSpace:"nowrap"},id:"disabled",onChange:r=>a("disabled",r.currentTarget.checked),color:"$neutral10",fontSize:"$sm",get checked(){return t.disabled},get children(){return n("users.disabled")}})}}),e(J,{get loading(){return I()},onClick:async()=>{if(!t.password.trim()){c.error(n("users.password")+" "+n("global.required"));return}if(!t.role||t.role.length===0){c.error(n("users.role")+" "+n("global.required"));return}const r=await T();g(r,()=>{c.success(n("global.save_success")),y()})},get children(){return n("global.save")}})]}})}})]}})};export{Y as default};
