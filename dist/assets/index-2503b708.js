import{ck as ze,V as ue,c4 as ge,c5 as N,az as de,a7 as pe,x as e,am as K,S as g,ao as O,an as T,a4 as _,d as he,cg as v,cl as k,r as fe,aO as w,bq as L,c2 as Fe,cm as Re,cn as Pe,co as Ae,cp as Be,b as Ge,A as Ne,B as b,cq as ee,b9 as V,q as Te,ai as B,av as S,aL as te,bX as I,bW as re,L as x,bb as ne,ah as j,Q as G,bB as oe,bC as se,c8 as ae,cr as ie,cs as Ue,ct as De,cu as Me,aB as Oe,cv as Ve,cw as je,aS as Ke,n as E,br as We,cx as le}from"./index-e0a86cdb.js";import{a as qe}from"./useTitle-4eb2e689.js";import{s as He,g as Je,a as Ze}from"./webauthn-json.browser-ponyfill-f2f06d6e.js";const Qe="https://github.com/alist-org/alist";function Xe(t){return ze(`${t}-${Qe}`)}const Ye=de('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="896" width="967.8852157128662"><defs><path id="path-2" opacity="1" fill-rule="evenodd" d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id="linearGradient-3" x1="0.5" y1="0" x2="0.5" y2="1"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-2" fill="url(#linearGradient-3)" fill-opacity="1"></use></g></svg>'),et=t=>{const u=ue({startColor:"#28aff0",endColor:"#120fc4"},t);return(()=>{const d=Ye.cloneNode(!0),o=d.firstChild,p=o.firstChild,s=p.nextSibling,i=s.firstChild,l=i.nextSibling;return ge(n=>{const a=u.startColor,f=u.endColor;return a!==n._v$&&N(i,"stop-color",n._v$=a),f!==n._v$2&&N(l,"stop-color",n._v$2=f),n},{_v$:void 0,_v$2:void 0}),d})()},tt=de('<svg height="1337" width="1337"><defs><path id="path-1" opacity="1" fill-rule="evenodd" d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id="linearGradient-2" x1="0.79" y1="0.62" x2="0.21" y2="0.86"><stop offset="0" stop-opacity="1"></stop><stop offset="1" stop-opacity="1"></stop></linearGradient></defs><g opacity="1"><use xlink:href="#path-1" fill="url(#linearGradient-2)" fill-opacity="1"></use></g></svg>'),rt=t=>{const u=ue({startColor:"#28aff0",endColor:"#120fc4"},t);return(()=>{const d=tt.cloneNode(!0),o=d.firstChild,p=o.firstChild,s=p.nextSibling,i=s.firstChild,l=i.nextSibling;return ge(n=>{const a=u.startColor,f=u.endColor;return a!==n._v$&&N(i,"stop-color",n._v$=a),f!==n._v$2&&N(l,"stop-color",n._v$2=f),n},{_v$:void 0,_v$2:void 0}),d})()},nt=t=>{const u=pe("#a9c6ff","#062b74");return e(O,{get bgColor(){return K(()=>!!t.useNewVersion,!0)()?void 0:u()},get style(){return t.useNewVersion?{"background-image":"url(/images/new_bg.png)","background-size":"cover","background-position":"center"}:void 0},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return e(g,{get when(){return!t.useNewVersion},get children(){return[e(O,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(rt,{})}}),e(O,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(et,{})}})]}})}})},ce=()=>{const t=T("sso_login_enabled"),u=_("sso_login_platform"),d=T("sso_compatibility_mode"),{searchParams:o,to:p}=he(),s=o.token;s!=null&&s!=""&&(v(s),p(decodeURIComponent(o.redirect||k||"/"),!0));function i(l){const n=l.data;n.token&&(v(n.token),p(decodeURIComponent(o.redirect||k||"/"),!0))}if(window.addEventListener("message",i),fe(()=>{window.removeEventListener("message",i)}),t){const l=()=>{const a=L.getUri()+"/auth/sso?method=sso_get_token";if(d){window.location.href=a;return}window.open(a,"authPopup","width=500,height=600")};let n;switch(u){case"Github":n=Be;break;case"Microsoft":n=Ae;break;case"Google":n=Pe;break;case"Dingtalk":n=Re;break;default:n=Fe}return e(w,{cursor:"pointer",boxSize:"$8",as:n,p:"$0_5",onclick:l})}},it=()=>{const t=Ge(),u=Ne(()=>`${t("login.login_to")} ${_("site_title")}`);qe(u);const d=pe("white","$neutral1"),[o,p]=b(localStorage.getItem("username")||""),[s,i]=b(localStorage.getItem("password")||""),[l,n]=b(!1),[a,f]=b(""),[y,me]=b(!1),[z,be]=ee("remember-pwd","false"),[U,W]=b(!1),[F,we]=ee("login-version","true"),[q,$e]=V(async()=>U()?L.post("/auth/login/ldap",{username:o(),password:s(),otp_code:a()}):L.post("/auth/login/hash",{username:o(),password:Xe(s()),otp_code:a()})),[,Ce]=V((r,c,C,M)=>L.post("/authn/webauthn_finish_login?username="+C,JSON.stringify(c),{headers:{session:r},signal:M})),[,xe]=V((r,c)=>L.get("/authn/webauthn_begin_login?username="+r,{signal:c})),{searchParams:R,to:P}=he(),_e=async()=>PublicKeyCredential&&"isConditionalMediationAvailable"in PublicKeyCredential?await PublicKeyCredential.isConditionalMediationAvailable():!1,D=T("webauthn_login_enabled"),H=async()=>{me(!y())};let h=null;const J=async r=>{if(!He()){r||E.error(t("users.webauthn_not_supported"));return}if(r&&!await _e())return;h==null||h.abort();const c=new AbortController;h=c;const C=r?"":o();!r&&z()==="true"?localStorage.setItem("username",o()):localStorage.removeItem("username");const M=await xe(C,c.signal);We(M,async Y=>{try{const m=Je(Y.options);m.signal=c.signal,r&&(m.mediation="conditional");const Ie=await Ze(m),Ee=await Ce(Y.session,Ie,C,c.signal);le(Ee,Le=>{E.success(t("login.success")),v(Le.token),P(decodeURIComponent(R.redirect||k||"/"),!0)})}catch(m){m instanceof Error&&m.name!="AbortError"&&E.error(m.message)}})},Z=()=>h==null?void 0:h.abort();Te(()=>{D&&(window.addEventListener("beforeunload",Z),J(!0))}),fe(()=>{h==null||h.abort(),window.removeEventListener("beforeunload",Z)});const $=async()=>{if(y())await J();else{z()==="true"?(localStorage.setItem("username",o()),localStorage.setItem("password",s())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const r=await $e();le(r,c=>{E.success(t("login.success")),v(c.token),P(decodeURIComponent(R.redirect||k||"/"),!0)},(c,C)=>{!A()&&C===402?ve(!0):E.error(c)})}},[A,ve]=b(!1),Q=T("ldap_login_enabled"),ke=_("ldap_login_tips");Q&&W(!0);const X=()=>{we(F()==="true"?"false":"true")},ye=()=>t("login.password_login"),Se=()=>_("logo").split(`
`)[0];return e(Ke,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(B,{spacing:"$6",alignItems:"center",get children(){return[e(g,{get when(){return F()==="true"},get children(){return e(S,{alignItems:"center",spacing:"$2",get children(){return e(te,{w:"151px",h:"48px",get src(){return K(()=>_("logo").split(`
`)[0]==="https://cdn.jsdelivr.net/gh/alist-org/logo@main/logo.svg",!0)()?"/images/new_icon.png":_("logo").split(`
`)[0]},alt:"AList Logo"})}})}}),e(g,{get when(){return F()==="true"},get fallback(){return e(B,{get bgColor(){return d()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(I,{alignItems:"center",justifyContent:"space-around",get children(){return[e(te,{mr:"$2",boxSize:"$12",get src(){return Se()}}),e(re,{color:"$info9",fontSize:"$2xl",get children(){return ye()}})]}}),e(g,{get when(){return!A()},get fallback(){return e(x,{id:"totp",name:"otp",get placeholder(){return t("login.otp-tips")},get value(){return a()},onInput:r=>f(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&$()}})},get children(){return[e(x,{name:"username",get placeholder(){return t("login.username-tips")},get value(){return o()},onInput:r=>p(r.currentTarget.value)}),e(g,{get when(){return!y()},get children(){return e(x,{name:"password",get placeholder(){return t("login.password-tips")},type:"password",get value(){return s()},onInput:r=>i(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&$()}})}}),e(I,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(ne,{get checked(){return z()==="true"},onChange:()=>be(z()==="true"?"false":"true"),get children(){return t("login.remember")}}),e(j,{as:"a",target:"_blank",get href(){return t("login.forget_url")},get children(){return t("login.forget")}})]}})]}}),e(S,{w:"$full",spacing:"$2",get children(){return[e(g,{get when(){return!y()},get children(){return e(G,{colorScheme:"primary",w:"$full",onClick:()=>{A()?f(""):(p(""),i(""))},get children(){return t("login.clear")}})}}),e(G,{w:"$full",get loading(){return q()},onClick:$,get children(){return t("login.login")}})]}}),e(g,{when:Q,get children(){return e(ne,{w:"$full",get checked(){return U()===!0},onChange:()=>W(!U()),children:ke})}}),e(G,{w:"$full",colorScheme:"accent",onClick:()=>{v(),P(decodeURIComponent(R.redirect||k||"/"),!0)},get children(){return t("login.use_guest")}}),e(I,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(oe,{}),e(se,{}),e(ce,{}),e(w,{cursor:"pointer",boxSize:"$7",as:ae,p:"$0_5",onClick:X}),e(g,{when:D,get children(){return e(w,{cursor:"pointer",boxSize:"$8",as:ie,p:"$0_5",onclick:H})}})]}})]}})},get children(){return e(B,{get bgColor(){return d()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"420px"},spacing:"$4",get children(){return[e(I,{alignItems:"center",justifyContent:"center",get children(){return e(re,{color:"#3573FF",fontSize:"18px",get children(){return t("login.password_login")}})}}),e(Ue,{borderColor:"#E9E9E9"}),e(g,{get when(){return!A()},get fallback(){return e(x,{id:"totp",name:"otp",get placeholder(){return t("login.otp-tips")},get value(){return a()},onInput:r=>f(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&$()}})},get children(){return[e(S,{w:"$full",border:"1px solid",borderColor:"$neutral6",borderRadius:"12px",px:"$3",spacing:"$2",alignItems:"center",_focusWithin:{borderColor:"$primary6",boxShadow:"0 0 0 1px $colors$primary6"},get children(){return[e(w,{as:De,color:"$neutral8",boxSize:"$5"}),e(x,{name:"username",placeholder:"请输入账号",get value(){return o()},onInput:r=>p(r.currentTarget.value),border:"none",backgroundColor:"transparent",_focus:{border:"none",boxShadow:"none",backgroundColor:"transparent"},_hover:{border:"none",boxShadow:"none",backgroundColor:"transparent"},flex:1})]}}),e(g,{get when(){return!y()},get children(){return e(S,{w:"$full",border:"1px solid",borderColor:"$neutral6",borderRadius:"12px",px:"$3",spacing:"$2",alignItems:"center",_focusWithin:{borderColor:"$primary6",boxShadow:"0 0 0 1px $colors$primary6"},get children(){return[e(w,{as:Me,color:"$neutral8",boxSize:"$5"}),e(x,{name:"password",placeholder:"请输入密码",get type(){return l()?"text":"password"},get value(){return s()},onInput:r=>i(r.currentTarget.value),onKeyDown:r=>{r.key==="Enter"&&$()},border:"none",backgroundColor:"transparent",_focus:{border:"none",boxShadow:"none",backgroundColor:"transparent"},_hover:{border:"none",boxShadow:"none",backgroundColor:"transparent"},flex:1}),e(Oe,{size:"md",variant:"ghost",get icon(){return K(()=>!!l(),!0)()?e(Ve,{}):e(je,{})},onClick:()=>n(!l()),color:"$neutral8",get"aria-label"(){return l()?"隐藏密码":"显示密码"},_hover:{backgroundColor:"$neutral3"}})]}})}})]}}),e(B,{w:"$full",spacing:"$4",get children(){return[e(G,{w:"$full",get loading(){return q()},onClick:$,bgColor:"#3573FF",color:"white",_hover:{backgroundColor:"#2B5CD9"},_active:{backgroundColor:"#1E40AF"},h:"45px",fontSize:"16px",fontWeight:"bold",borderRadius:"12px",mt:"$5",get children(){return t("login.login")}}),e(S,{w:"$full",justifyContent:"space-between",alignItems:"center",get children(){return[e(j,{as:"a",target:"_blank",get href(){return t("login.forget_url")},color:"#3573FF",fontSize:"14px",cursor:"pointer",_hover:{textDecoration:"underline"},get children(){return t("login.forget")}}),e(j,{as:"a",onClick:()=>{v(),P(decodeURIComponent(R.redirect||k||"/"),!0)},color:"#3573FF",fontSize:"14px",cursor:"pointer",_hover:{textDecoration:"underline"},get children(){return t("login.use_guest")}})]}})]}}),e(I,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(oe,{}),e(se,{}),e(ce,{}),e(w,{cursor:"pointer",boxSize:"$7",as:ae,p:"$0_5",onClick:X}),e(g,{when:D,get children(){return e(w,{cursor:"pointer",boxSize:"$8",as:ie,p:"$0_5",onclick:H})}})]}})]}})}})]}}),e(nt,{get useNewVersion(){return F()==="true"}})]}})};export{it as default};
