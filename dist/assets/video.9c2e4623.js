import{cp as ke,cq as Be,u as qe,o as Te,al as et,bI as je,cr as Ke,ar as tt,an as rt,f as Oe,Y as it,bK as nt,bg as at,w as st,a1 as ot,bF as lt,a5 as ut,W as ft}from"./index.33d2aa70.js";import{a as dt}from"./useUtil.c55c396d.js";import{O as ct}from"./obj.fca5b341.js";import"./api.e0893224.js";import"./useT.2ec8a2b0.js";function We(xe){throw new Error('Could not dynamically require "'+xe+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ge={exports:{}};/*!
 * artplayer.js v4.5.4
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2022 Harvey Zack
 * Released under the MIT License.
 */(function(xe,Pe){(function(M,P,E,b,u){var m=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof Be<"u"?Be:{},D=typeof m.parcelRequireb749=="function"&&m.parcelRequireb749,S=D.cache||{},g=typeof We=="function"&&We.bind(xe);function d(o,v){if(!S[o]){if(!M[o]){var c=typeof m.parcelRequireb749=="function"&&m.parcelRequireb749;if(!v&&c)return c(o,!0);if(D)return D(o,!0);if(g&&typeof o=="string")return g(o);var h=new Error("Cannot find module '"+o+"'");throw h.code="MODULE_NOT_FOUND",h}e.resolve=function(n){var r=M[o][1][n];return r!=null?r:n},e.cache={};var t=S[o]=new d.Module(o);M[o][0].call(t.exports,e,t,t.exports,this)}return S[o].exports;function e(n){var r=e.resolve(n);return r===!1?{}:d(r)}}d.isParcelRequire=!0,d.Module=function(o){this.id=o,this.bundle=d,this.exports={}},d.modules=M,d.cache=S,d.parent=D,d.register=function(o,v){M[o]=[function(c,h){h.exports=v},{}]},Object.defineProperty(d,"root",{get:function(){return m.parcelRequireb749}}),m.parcelRequireb749=d;for(var i=0;i<P.length;i++)d(P[i]);var f=d(E);xe.exports=f})({E13ST:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("bundle-text:./style/index.less"),m=b.interopDefault(u),D=M("option-validator"),S=b.interopDefault(D),g=M("./utils/emitter"),d=b.interopDefault(g),i=M("./utils"),f=M("./scheme"),o=b.interopDefault(f),v=M("./config"),c=b.interopDefault(v),h=M("./whitelist"),t=b.interopDefault(h),e=M("./template"),n=b.interopDefault(e),r=M("./i18n"),l=b.interopDefault(r),s=M("./player"),a=b.interopDefault(s),p=M("./control"),A=b.interopDefault(p),_=M("./contextmenu"),y=b.interopDefault(_),L=M("./info"),x=b.interopDefault(L),T=M("./subtitle"),O=b.interopDefault(T),R=M("./events"),I=b.interopDefault(R),C=M("./hotkey"),w=b.interopDefault(C),F=M("./layer"),B=b.interopDefault(F),k=M("./loading"),U=b.interopDefault(k),N=M("./notice"),j=b.interopDefault(N),K=M("./mask"),H=b.interopDefault(K),V=M("./icons"),G=b.interopDefault(V),ee=M("./setting"),q=b.interopDefault(ee),z=M("./storage"),X=b.interopDefault(z),J=M("./plugins"),ie=b.interopDefault(J),ae=M("./mobile"),se=b.interopDefault(ae);let le=0;const ue=[];class Z extends d.default{constructor(de,ce){super(),this.id=++le;const ve=i.mergeDeep(Z.option,de);this.option=(0,S.default)(ve,o.default),this.isLock=!1,this.isReady=!1,this.isFocus=!1,this.isInput=!1,this.isDestroy=!1,this.whitelist=new t.default(this),this.template=new n.default(this),this.events=new I.default(this),this.whitelist.state?(this.storage=new X.default(this),this.icons=new G.default(this),this.i18n=new l.default(this),this.notice=new j.default(this),this.player=new a.default(this),this.layers=new B.default(this),this.controls=new A.default(this),this.contextmenu=new y.default(this),this.subtitle=new O.default(this),this.info=new x.default(this),this.loading=new U.default(this),this.hotkey=new w.default(this),this.mask=new H.default(this),this.setting=new q.default(this),this.plugins=new ie.default(this)):this.mobile=new se.default(this),typeof ce=="function"&&this.on("ready",()=>ce.call(this)),ue.push(this)}static get instances(){return ue}static get version(){return"4.5.4"}static get env(){return"production"}static get build(){return"1659362361789"}static get config(){return c.default}static get utils(){return i}static get scheme(){return o.default}static get Emitter(){return d.default}static get validator(){return S.default}static get kindOf(){return S.default.kindOf}static get html(){return n.default.html}static get option(){return{id:"",container:"#artplayer",url:"",poster:"",title:"",type:"",theme:"#f00",volume:.7,isLive:!1,muted:!1,autoplay:!1,autoSize:!1,autoMini:!1,loop:!1,flip:!1,playbackRate:!1,aspectRatio:!1,screenshot:!1,setting:!1,hotkey:!0,pip:!1,mutex:!0,backdrop:!0,fullscreen:!1,fullscreenWeb:!1,subtitleOffset:!1,miniProgressBar:!1,useSSR:!1,playsInline:!0,lock:!1,fastForward:!1,autoPlayback:!1,autoOrientation:!1,airplay:!1,layers:[],contextmenu:[],controls:[],settings:[],quality:[],highlight:[],plugins:[],whitelist:[],thumbnails:{url:"",number:60,column:10,width:0,height:0},subtitle:{url:"",type:"",style:{},encoding:"utf-8"},moreVideoAttr:{controls:!1,preload:i.isSafari?"auto":"metadata"},icons:{},customType:{},lang:navigator.language.toLowerCase()}}get proxy(){return this.events.proxy}get query(){return this.template.query}destroy(de=!0){this.events.destroy(),this.template.destroy(de),ue.splice(ue.indexOf(this),1),this.isDestroy=!0,this.emit("destroy")}}if(E.default=Z,Z.NOTICE_TIME=2e3,Z.SETTING_WIDTH=250,Z.SETTING_ITEM_WIDTH=200,Z.SETTING_ITEM_HEIGHT=35,Z.INDICATOR_SIZE=14,Z.INDICATOR_SIZE_ICON=16,Z.INDICATOR_SIZE_MOBILE=18,Z.INDICATOR_SIZE_MOBILE_ICON=20,Z.VOLUME_PANEL_WIDTH=60,Z.VOLUME_HANDLE_WIDTH=12,Z.RESIZE_TIME=500,Z.SCROLL_TIME=200,Z.SCROLL_GAP=50,Z.AUTO_PLAYBACK_MAX=10,Z.AUTO_PLAYBACK_MIN=5,Z.AUTO_PLAYBACK_TIMEOUT=3e3,Z.RECONNECT_TIME_MAX=5,Z.RECONNECT_SLEEP_TIME=1e3,Z.CONTROL_HIDE_TIME=3e3,Z.DB_CLICE_TIME=300,Z.MOBILE_AUTO_PLAYBACKRATE=3,Z.MOBILE_AUTO_PLAYBACKRATE_TIME=1e3,Z.MOBILE_AUTO_ORIENTATION_TIME=200,Z.INFO_LOOP_TIME=1e3,Z.FAST_FORWARD_VALUE=3,Z.FAST_FORWARD_TIME=1e3,Z.TOUCH_MOVE_RATIO=.5,typeof document<"u"&&!document.getElementById("artplayer-style")){const oe=document.createElement("style");oe.id="artplayer-style",oe.textContent=m.default,document.head.appendChild(oe)}typeof window<"u"&&(window.Artplayer=Z),console.log(`%c ArtPlayer %c ${Z.version} %c https://artplayer.org`,"color: #fff; background: #5f5f5f","color: #fff; background: #4bc729","")},{"bundle-text:./style/index.less":"6U764","option-validator":"eaJBf","./utils/emitter":"1SgiG","./utils":"5yYFo","./scheme":"3izFE","./config":"ej4fZ","./whitelist":"7CkCt","./template":"8iGAh","./i18n":"3mM4M","./player":"bCaa0","./control":"3qXcr","./contextmenu":"hTnNz","./info":"bfwuE","./subtitle":"bWZ2U","./events":"9oLaG","./hotkey":"cKO4X","./layer":"kZD92","./loading":"c9b9e","./notice":"SxQeL","./mask":"aJ0dF","./icons":"jx1Wu","./setting":"hdF39","./storage":"bCcu0","./plugins":"1v13t","./mobile":"eD5Ch","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"6U764":[function(M,P,E){P.exports='.art-video-player{z-index:20;width:100%;height:100%;zoom:1;color:#eee;text-align:left;direction:ltr;user-select:none;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#000;outline:0;margin:0 auto;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:14px;line-height:1.3;display:flex;position:relative}.art-video-player *,.art-video-player :before,.art-video-player :after{box-sizing:border-box;margin:0;padding:0}.art-video-player ::-webkit-scrollbar{width:5px;height:5px}.art-video-player ::-webkit-scrollbar-thumb{background-color:#666}.art-video-player ::-webkit-scrollbar-thumb:hover{background-color:#ccc}.art-video-player .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-video-player .art-icon svg{fill:#fff}.art-video-player img{max-width:100%;vertical-align:top}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-video-player .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-video-player .art-video{z-index:10;width:100%;height:100%;cursor:pointer;background-color:#000;position:absolute;inset:0}.art-video-player .art-poster{z-index:11;width:100%;height:100%;user-select:none;pointer-events:none;background-position:50%;background-repeat:no-repeat;background-size:cover;position:absolute;inset:0}.art-video-player .art-subtitle{z-index:20;width:100%;text-align:center;color:#fff;pointer-events:none;text-shadow:1px 0 1px #000,0 1px 1px #000,-1px 0 1px #000,0 -1px 1px #000,1px 1px 1px #000,-1px -1px 1px #000,1px -1px 1px #000,-1px 1px 1px #000;padding:0 20px;font-size:20px;display:none;position:absolute;bottom:10px}.art-video-player .art-subtitle p{word-break:break-all;height:fit-content;margin:5px 0 0;line-height:1.2}.art-video-player.art-subtitle-show .art-subtitle{display:block}.art-video-player.art-control-show .art-subtitle{bottom:50px}.art-video-player .art-danmuku{z-index:30;width:100%;height:100%;pointer-events:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers{z-index:40;width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-layers .art-layer{pointer-events:auto}.art-video-player.art-layer-show .art-layers{display:block}.art-video-player .art-mask{z-index:50;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0;overflow:hidden}.art-video-player .art-mask .art-state{width:60px;height:60px;opacity:.85;cursor:pointer;pointer-events:all;justify-content:center;align-items:center;display:flex;position:absolute;bottom:65px;right:30px}.art-video-player.art-mask-show .art-mask{display:flex}.art-video-player.art-mobile .art-state{position:static}.art-video-player .art-loading{z-index:70;width:100%;height:100%;pointer-events:none;justify-content:center;align-items:center;display:none;position:absolute;inset:0}.art-video-player.art-loading-show .art-loading{display:flex}.art-video-player .art-bottom{z-index:60;height:100px;opacity:0;visibility:hidden;pointer-events:none;background-image:linear-gradient(#0000,#0006,#000);background-position:bottom;background-repeat:repeat-x;flex-direction:column;justify-content:space-between;padding:50px 10px 0;transition:all .2s ease-in-out;display:flex;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-bottom .art-progress{z-index:0;pointer-events:auto;flex:1;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress{height:4px;cursor:pointer;flex-direction:row;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner{height:50%;width:100%;background:#fff3;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-loaded{z-index:10;height:100%;width:0;background:#fff6;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-played{z-index:20;height:100%;width:0;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight{z-index:30;height:100%;pointer-events:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-highlight span{width:7px;height:100%;pointer-events:auto;background:#fff;display:inline-block;position:absolute;top:0;left:0}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:hidden;z-index:40;border-radius:50%;justify-content:center;align-items:center;transition:transform .1s ease-in-out;position:absolute;transform:scale(.1)}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator .art-icon{width:100%;height:100%;pointer-events:none;user-select:none}.art-video-player .art-bottom .art-progress .art-control-progress .art-control-progress-inner .art-progress-tip{z-index:50;height:20px;color:#fff;text-align:center;white-space:nowrap;background:#000000b3;border-radius:3px;padding:0 5px;font-size:12px;font-weight:700;line-height:20px;display:none;position:absolute;top:-25px;left:0}.art-video-player .art-bottom .art-progress .art-control-thumbnails{pointer-events:none;background-color:#000000b3;display:none;position:absolute;bottom:8px;left:0}.art-video-player .art-bottom .art-progress .art-control-loop{width:100%;height:100%;pointer-events:none;display:none;position:absolute;inset:0}.art-video-player .art-bottom .art-progress .art-control-loop .art-loop-point{width:2px;height:8px;background:#ffffffbf;position:absolute;top:-2px;left:0}.art-video-player .art-bottom .art-controls{z-index:1;pointer-events:auto;height:45px;justify-content:space-between;align-items:center;display:flex;position:relative}.art-video-player .art-bottom .art-controls .art-controls-left,.art-video-player .art-bottom .art-controls .art-controls-right{display:flex}.art-video-player .art-bottom .art-controls .art-controls-center{height:100%;flex:1;justify-content:center;align-items:center;padding:0 10px;display:flex}.art-video-player .art-bottom .art-controls .art-controls-right{justify-content:flex-end}.art-video-player .art-bottom .art-controls .art-control{opacity:.9;min-height:36px;min-width:36px;text-align:center;cursor:pointer;white-space:nowrap;justify-content:center;align-items:center;font-size:12px;line-height:1;display:flex}.art-video-player .art-bottom .art-controls .art-control .art-icon{float:left;height:36px;width:36px;justify-content:center;align-items:center;display:flex}.art-video-player .art-bottom .art-controls .art-control:hover{opacity:1}.art-video-player .art-bottom .art-controls .art-control-onlyText{padding:0 10px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel{float:left;width:0;height:100%;transition:margin .2s cubic-bezier(.4,0,1,1),width .2s cubic-bezier(.4,0,1,1);position:relative;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle{width:12px;height:12px;background:#fff;border-radius:12px;margin-top:-6px;position:absolute;top:50%;left:0}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before{background:#fff;left:-54px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{background:#fff3;left:6px}.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:before,.art-video-player .art-bottom .art-controls .art-control-volume .art-volume-panel .art-volume-slider-handle:after{content:"";height:3px;width:60px;margin-top:-2px;display:block;position:absolute;top:50%}.art-video-player .art-bottom .art-controls .art-control-volume:hover .art-volume-panel{width:60px}.art-video-player .art-bottom .art-controls .art-control-quality{z-index:30;position:relative}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys{width:100px;text-align:center;color:#fff;background:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;line-height:30px;overflow:hidden}.art-video-player .art-bottom .art-controls .art-control-quality .art-qualitys .art-quality-item:hover{background-color:#ffffff1a}.art-video-player .art-bottom .art-controls .art-control-quality:hover .art-qualitys{display:block}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner{height:100%}.art-video-player .art-bottom:hover .art-progress .art-control-progress .art-control-progress-inner .art-progress-indicator{visibility:visible;transform:scale(1)}.art-video-player.art-control-show .art-bottom,.art-video-player.art-hover .art-bottom{opacity:1;visibility:visible}.art-video-player.art-error .art-progress-indicator,.art-video-player.art-destroy .art-progress-indicator,.art-video-player.art-error .art-progress-tip,.art-video-player.art-destroy .art-progress-tip{display:none!important}.art-video-player.art-mobile .art-bottom{padding:50px 7px 0}.art-video-player.art-mobile .art-bottom .art-controls{height:40px}.art-video-player.art-mobile .art-bottom .art-progress-indicator{visibility:visible!important;transform:scale(1)!important}.art-video-player .art-notice{z-index:80;width:100%;pointer-events:none;padding:10px;font-size:14px;display:none;position:absolute;top:0;left:0}.art-video-player .art-notice .art-notice-inner{color:#fff;background-color:#0009;border-radius:3px;padding:5px 10px;display:inline-block}.art-video-player.art-notice-show .art-notice{display:flex}.art-video-player .art-contextmenus{z-index:120;min-width:200px;background-color:#000000e6;border-radius:3px;flex-direction:column;padding:5px 0;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-contextmenus .art-contextmenu{cursor:pointer;color:#fff;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;border-bottom:1px solid #ffffff1a;padding:10px 15px;font-size:12px;display:block;overflow:hidden}.art-video-player .art-contextmenus .art-contextmenu a{color:#fff;text-decoration:none}.art-video-player .art-contextmenus .art-contextmenu span{padding:0 7px;display:inline-block}.art-video-player .art-contextmenus .art-contextmenu span:hover,.art-video-player .art-contextmenus .art-contextmenu span.art-current{color:#00c9ff}.art-video-player .art-contextmenus .art-contextmenu:hover{background-color:#ffffff1a}.art-video-player .art-contextmenus .art-contextmenu:last-child{border-bottom:none}.art-video-player.art-contextmenu-show .art-contextmenus{display:flex}.art-video-player .art-settings{z-index:90;height:auto;max-height:300px;background-color:#000000e6;border-radius:3px;font-size:13px;transition:all .2s;display:none;position:absolute;bottom:50px;right:10px;overflow:auto}.art-video-player .art-settings .art-setting-panel{display:none}.art-video-player .art-settings .art-setting-panel.art-current{display:block}.art-video-player .art-settings .art-setting-panel .art-setting-item{height:35px;cursor:pointer;color:#fffc;justify-content:space-between;align-items:center;padding:0 5px;line-height:1;display:flex;overflow:hidden}.art-video-player .art-settings .art-setting-panel .art-setting-item:hover,.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current{color:#fff;background-color:#ffffff1a}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon{width:30px;height:30px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-icon-check{visibility:hidden;height:15px}.art-video-player .art-settings .art-setting-panel .art-setting-item.art-current .art-icon-check{visibility:visible}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left{white-space:nowrap;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-left .art-setting-item-left-icon{height:24px;width:24px;justify-content:center;align-items:center;margin-right:10px;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right{align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-tooltip{white-space:nowrap;color:#ffffff80;margin-right:5px;font-size:12px}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-item-right-icon{height:24px;justify-content:center;align-items:center;display:flex}.art-video-player .art-settings .art-setting-panel .art-setting-item .art-setting-item-right .art-setting-range{height:3px;width:80px;appearance:none;background-color:#fff3;outline:none}.art-video-player .art-settings .art-setting-panel .art-setting-item-back{border-bottom:1px solid #ffffff1a}.art-video-player.art-setting-show .art-settings{display:block}.art-video-player.art-mobile .art-settings{max-height:200px}.art-video-player .art-info{z-index:100;width:350px;color:#fff;-webkit-font-smoothing:antialiased;background-color:#000000e6;flex-direction:column;padding:10px;font-family:Noto Sans CJK SC DemiLight,Roboto,Segoe UI,Tahoma,Arial,Helvetica,sans-serif;font-size:12px;display:none;position:absolute;top:10px;left:10px}.art-video-player .art-info .art-info-item{margin-bottom:5px;display:flex}.art-video-player .art-info .art-info-item .art-info-title{width:100px;text-align:right}.art-video-player .art-info .art-info-item .art-info-content{text-overflow:ellipsis;white-space:nowrap;flex:1;padding-left:5px;overflow:hidden}.art-video-player .art-info .art-info-item:last-child{margin-bottom:0}.art-video-player .art-info .art-info-close{cursor:pointer;position:absolute;top:5px;right:5px}.art-video-player.art-info-show .art-info{display:flex}.art-video-player.art-hide-cursor *{cursor:none!important}.art-video-player[data-aspect-ratio] video{box-sizing:content-box;object-fit:fill}.art-video-player.art-fullscreen-web{z-index:9999;width:100%;height:100%;position:fixed;inset:0}.art-video-player .art-mini-header{z-index:110;height:35px;color:#fff;opacity:0;visibility:hidden;background-color:#00000080;justify-content:space-between;align-items:center;line-height:35px;transition:all .2s ease-in-out;display:none;position:absolute;top:0;left:0;right:0}.art-video-player .art-mini-header .art-mini-title{text-overflow:ellipsis;white-space:nowrap;cursor:move;flex:1;padding:0 10px;overflow:hidden}.art-video-player .art-mini-header .art-mini-close{width:35px;text-align:center;cursor:pointer;font-size:22px}.art-video-player.art-is-dragging{opacity:.7}.art-video-player.art-mini{z-index:9999;width:400px;height:225px;position:fixed;box-shadow:0 2px 5px #00000029,0 3px 6px #0003}.art-video-player.art-mini .art-mini-header{user-select:none;display:flex}.art-video-player.art-mini.art-hover .art-mini-header{opacity:1;visibility:visible}.art-video-player.art-mini .art-mask .art-state{position:static}.art-video-player.art-mini .art-contextmenu,.art-video-player.art-mini .art-bottom,.art-video-player.art-mini .art-danmu,.art-video-player.art-mini .art-info,.art-video-player.art-mini .art-layers,.art-video-player.art-mini .art-notice,.art-video-player.art-mini .art-settings,.art-video-player.art-mini .art-subtitle{display:none!important}.art-auto-size{justify-content:center;align-items:center;display:flex}.art-auto-size .art-video-player{transition:all .2s}.art-video-player[data-flip=horizontal] .art-video{transform:scaleX(-1)}.art-video-player[data-flip=vertical] .art-video{transform:scaleY(-1)}.art-video-player .art-layer-miniProgressBar{height:2px;background-color:var(--theme);display:block;position:absolute;bottom:0;left:0;right:0}.art-video-player .art-layer-lock{height:34px;width:34px;color:#fff;background-color:#00000080;border-radius:50%;justify-content:center;align-items:center;display:none;position:absolute;top:calc(50% - 17px);left:15px}.art-video-player .art-layer-autoPlayback{background-color:#000c;border-radius:3px;align-items:center;padding:10px;line-height:1;display:none;position:absolute;bottom:60px;left:20px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close{cursor:pointer;align-items:center;margin-right:10px;display:flex}.art-video-player .art-layer-autoPlayback .art-autoPlayback-close svg{width:15px;height:15px;fill:#00c9ff}.art-video-player .art-layer-autoPlayback .art-autoPlayback-last{margin-right:10px}.art-video-player .art-layer-autoPlayback .art-autoPlayback-jump{color:#00c9ff;cursor:pointer}.art-video-player.art-lock .art-bottom{display:none!important}.art-video-player.art-lock .art-subtitle{bottom:10px!important}.art-video-player.art-lock .art-layer-miniProgressBar{display:block!important}.art-video-player.art-control-show .art-layer-miniProgressBar{display:none}.art-video-player.art-control-show .art-layer-lock{display:flex}.art-video-player .art-control-selector{position:relative}.art-video-player .art-control-selector .art-selector-list{min-width:100px;max-width:200px;max-height:200px;text-align:center;color:#fff;background-color:#000c;border-radius:3px;padding:5px 0;display:none;position:absolute;bottom:35px;overflow:auto}.art-video-player .art-control-selector .art-selector-list .art-selector-item{height:30px;text-overflow:ellipsis;white-space:nowrap;text-shadow:0 0 2px #00000080;padding:0 5px;line-height:30px;overflow:hidden}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover{background-color:#ffffff1a}.art-video-player .art-control-selector .art-selector-list .art-selector-item:hover,.art-video-player .art-control-selector .art-selector-list .art-selector-item.art-current{color:#00c9ff}.art-video-player .art-control-selector:hover .art-selector-list{display:block}[class*=hint--]{font-style:normal;display:inline-block;position:relative}[class*=hint--]:before,[class*=hint--]:after{visibility:hidden;opacity:0;z-index:1000000;pointer-events:none;transition:all .3s;position:absolute;transform:translate(0,0)}[class*=hint--]:hover:before,[class*=hint--]:hover:after{visibility:visible;opacity:1;transition-delay:.1s}[class*=hint--]:before{content:"";z-index:1000001;background:0 0;border:6px solid #0000;position:absolute}[class*=hint--]:after{color:#fff;white-space:nowrap;background:#000;padding:8px 10px;font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:12px;line-height:12px}[class*=hint--][aria-label]:after{content:attr(aria-label)}[class*=hint--][data-hint]:after{content:attr(data-hint)}[aria-label=""]:before,[aria-label=""]:after,[data-hint=""]:before,[data-hint=""]:after{display:none!important}.hint--top-left:before,.hint--top-right:before,.hint--top:before{border-top-color:#000}.hint--bottom-left:before,.hint--bottom-right:before,.hint--bottom:before{border-bottom-color:#000}.hint--left:before{border-left-color:#000}.hint--right:before{border-right-color:#000}.hint--top:before{margin-bottom:-11px}.hint--top:before,.hint--top:after{bottom:100%;left:50%}.hint--top:before{left:calc(50% - 6px)}.hint--top:after{transform:translate(-50%)}.hint--top:hover:before{transform:translateY(-8px)}.hint--top:hover:after{transform:translate(-50%)translateY(-8px)}.hint--bottom:before{margin-top:-11px}.hint--bottom:before,.hint--bottom:after{top:100%;left:50%}.hint--bottom:before{left:calc(50% - 6px)}.hint--bottom:after{transform:translate(-50%)}.hint--bottom:hover:before{transform:translateY(8px)}.hint--bottom:hover:after{transform:translate(-50%)translateY(8px)}.hint--right:before{margin-bottom:-6px;margin-left:-11px}.hint--right:after{margin-bottom:-14px}.hint--right:before,.hint--right:after{bottom:50%;left:100%}.hint--right:hover:before,.hint--right:hover:after{transform:translate(8px)}.hint--left:before{margin-bottom:-6px;margin-right:-11px}.hint--left:after{margin-bottom:-14px}.hint--left:before,.hint--left:after{bottom:50%;right:100%}.hint--left:hover:before,.hint--left:hover:after{transform:translate(-8px)}.hint--top-left:before{margin-bottom:-11px}.hint--top-left:before,.hint--top-left:after{bottom:100%;left:50%}.hint--top-left:before{left:calc(50% - 6px)}.hint--top-left:after{margin-left:12px;transform:translate(-100%)}.hint--top-left:hover:before{transform:translateY(-8px)}.hint--top-left:hover:after{transform:translate(-100%)translateY(-8px)}.hint--top-right:before{margin-bottom:-11px}.hint--top-right:before,.hint--top-right:after{bottom:100%;left:50%}.hint--top-right:before{left:calc(50% - 6px)}.hint--top-right:after{margin-left:-12px;transform:translate(0)}.hint--top-right:hover:before,.hint--top-right:hover:after{transform:translateY(-8px)}.hint--bottom-left:before{margin-top:-11px}.hint--bottom-left:before,.hint--bottom-left:after{top:100%;left:50%}.hint--bottom-left:before{left:calc(50% - 6px)}.hint--bottom-left:after{margin-left:12px;transform:translate(-100%)}.hint--bottom-left:hover:before{transform:translateY(8px)}.hint--bottom-left:hover:after{transform:translate(-100%)translateY(8px)}.hint--bottom-right:before{margin-top:-11px}.hint--bottom-right:before,.hint--bottom-right:after{top:100%;left:50%}.hint--bottom-right:before{left:calc(50% - 6px)}.hint--bottom-right:after{margin-left:-12px;transform:translate(0)}.hint--bottom-right:hover:before,.hint--bottom-right:hover:after{transform:translateY(8px)}.hint--small:after,.hint--medium:after,.hint--large:after{white-space:normal;word-wrap:break-word;line-height:1.4em}.hint--small:after{width:80px}.hint--medium:after{width:150px}.hint--large:after{width:300px}[class*=hint--]:after{text-shadow:0 -1px #000;box-shadow:4px 4px 8px #0000004d}.hint--error:after{text-shadow:0 -1px #592726;background-color:#b34e4d}.hint--error.hint--top-left:before,.hint--error.hint--top-right:before,.hint--error.hint--top:before{border-top-color:#b34e4d}.hint--error.hint--bottom-left:before,.hint--error.hint--bottom-right:before,.hint--error.hint--bottom:before{border-bottom-color:#b34e4d}.hint--error.hint--left:before{border-left-color:#b34e4d}.hint--error.hint--right:before{border-right-color:#b34e4d}.hint--warning:after{text-shadow:0 -1px #6c5328;background-color:#c09854}.hint--warning.hint--top-left:before,.hint--warning.hint--top-right:before,.hint--warning.hint--top:before{border-top-color:#c09854}.hint--warning.hint--bottom-left:before,.hint--warning.hint--bottom-right:before,.hint--warning.hint--bottom:before{border-bottom-color:#c09854}.hint--warning.hint--left:before{border-left-color:#c09854}.hint--warning.hint--right:before{border-right-color:#c09854}.hint--info:after{text-shadow:0 -1px #1a3c4d;background-color:#3986ac}.hint--info.hint--top-left:before,.hint--info.hint--top-right:before,.hint--info.hint--top:before{border-top-color:#3986ac}.hint--info.hint--bottom-left:before,.hint--info.hint--bottom-right:before,.hint--info.hint--bottom:before{border-bottom-color:#3986ac}.hint--info.hint--left:before{border-left-color:#3986ac}.hint--info.hint--right:before{border-right-color:#3986ac}.hint--success:after{text-shadow:0 -1px #1a321a;background-color:#458746}.hint--success.hint--top-left:before,.hint--success.hint--top-right:before,.hint--success.hint--top:before{border-top-color:#458746}.hint--success.hint--bottom-left:before,.hint--success.hint--bottom-right:before,.hint--success.hint--bottom:before{border-bottom-color:#458746}.hint--success.hint--left:before{border-left-color:#458746}.hint--success.hint--right:before{border-right-color:#458746}.hint--always:after,.hint--always:before{opacity:1;visibility:visible}.hint--always.hint--top:before{transform:translateY(-8px)}.hint--always.hint--top:after{transform:translate(-50%)translateY(-8px)}.hint--always.hint--top-left:before{transform:translateY(-8px)}.hint--always.hint--top-left:after{transform:translate(-100%)translateY(-8px)}.hint--always.hint--top-right:before,.hint--always.hint--top-right:after{transform:translateY(-8px)}.hint--always.hint--bottom:before{transform:translateY(8px)}.hint--always.hint--bottom:after{transform:translate(-50%)translateY(8px)}.hint--always.hint--bottom-left:before{transform:translateY(8px)}.hint--always.hint--bottom-left:after{transform:translate(-100%)translateY(8px)}.hint--always.hint--bottom-right:before,.hint--always.hint--bottom-right:after{transform:translateY(8px)}.hint--always.hint--left:before,.hint--always.hint--left:after{transform:translate(-8px)}.hint--always.hint--right:before,.hint--always.hint--right:after{transform:translate(8px)}.hint--rounded:after{border-radius:4px}.hint--no-animate:before,.hint--no-animate:after{transition-duration:0s}.hint--bounce:before,.hint--bounce:after{-webkit-transition:opacity .3s,visibility .3s,-webkit-transform .3s cubic-bezier(.71,1.7,.77,1.24);-moz-transition:opacity .3s,visibility .3s,-moz-transform .3s cubic-bezier(.71,1.7,.77,1.24);transition:opacity .3s,visibility .3s,transform .3s cubic-bezier(.71,1.7,.77,1.24)}.hint--no-shadow:before,.hint--no-shadow:after{text-shadow:initial;box-shadow:initial}.hint--no-arrow:before{display:none}'},{}],eaJBf:[function(M,P,E){P.exports=function(){function b(i){return(b=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f})(i)}var u=Object.prototype.toString,m=function(i){if(i===void 0)return"undefined";if(i===null)return"null";var f=b(i);if(f==="boolean")return"boolean";if(f==="string")return"string";if(f==="number")return"number";if(f==="symbol")return"symbol";if(f==="function")return function(o){return D(o)==="GeneratorFunction"}(i)?"generatorfunction":"function";if(function(o){return Array.isArray?Array.isArray(o):o instanceof Array}(i))return"array";if(function(o){return!(!o.constructor||typeof o.constructor.isBuffer!="function")&&o.constructor.isBuffer(o)}(i))return"buffer";if(function(o){try{if(typeof o.length=="number"&&typeof o.callee=="function")return!0}catch(v){if(v.message.indexOf("callee")!==-1)return!0}return!1}(i))return"arguments";if(function(o){return o instanceof Date||typeof o.toDateString=="function"&&typeof o.getDate=="function"&&typeof o.setDate=="function"}(i))return"date";if(function(o){return o instanceof Error||typeof o.message=="string"&&o.constructor&&typeof o.constructor.stackTraceLimit=="number"}(i))return"error";if(function(o){return o instanceof RegExp||typeof o.flags=="string"&&typeof o.ignoreCase=="boolean"&&typeof o.multiline=="boolean"&&typeof o.global=="boolean"}(i))return"regexp";switch(D(i)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if(function(o){return typeof o.throw=="function"&&typeof o.return=="function"&&typeof o.next=="function"}(i))return"generator";switch(f=u.call(i)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return f.slice(8,-1).toLowerCase().replace(/\s/g,"")};function D(i){return i.constructor?i.constructor.name:null}function S(i,f){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:["option"];return g(i,f,o),d(i,f,o),function(v,c,h){var t=m(c),e=m(v);if(t==="object"){if(e!=="object")throw new Error("[Type Error]: '".concat(h.join("."),"' require 'object' type, but got '").concat(e,"'"));Object.keys(c).forEach(function(n){var r=v[n],l=c[n],s=h.slice();s.push(n),g(r,l,s),d(r,l,s),S(r,l,s)})}if(t==="array"){if(e!=="array")throw new Error("[Type Error]: '".concat(h.join("."),"' require 'array' type, but got '").concat(e,"'"));v.forEach(function(n,r){var l=v[r],s=c[r]||c[0],a=h.slice();a.push(r),g(l,s,a),d(l,s,a),S(l,s,a)})}}(i,f,o),i}function g(i,f,o){if(m(f)==="string"){var v=m(i);if(f[0]==="?"&&(f=f.slice(1)+"|undefined"),!(-1<f.indexOf("|")?f.split("|").map(function(c){return c.toLowerCase().trim()}).filter(Boolean).some(function(c){return v===c}):f.toLowerCase().trim()===v))throw new Error("[Type Error]: '".concat(o.join("."),"' require '").concat(f,"' type, but got '").concat(v,"'"))}}function d(i,f,o){if(m(f)==="function"){var v=f(i,m(i),o);if(v!==!0){var c=m(v);throw c==="string"?new Error(v):c==="error"?v:new Error("[Validator Error]: The scheme for '".concat(o.join("."),"' validator require return true, but got '").concat(v,"'"))}}}return S.kindOf=m,S}()},{}],"1SgiG":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E),E.default=class{on(b,u,m){const D=this.e||(this.e={});return(D[b]||(D[b]=[])).push({fn:u,ctx:m}),this}once(b,u,m){const D=this;function S(...g){D.off(b,S),u.apply(m,g)}return S._=u,this.on(b,S,m)}emit(b,...u){const m=((this.e||(this.e={}))[b]||[]).slice();for(let D=0;D<m.length;D+=1)m[D].fn.apply(m[D].ctx,u);return this}off(b,u){const m=this.e||(this.e={}),D=m[b],S=[];if(D&&u)for(let g=0,d=D.length;g<d;g+=1)D[g].fn!==u&&D[g].fn._!==u&&S.push(D[g]);return S.length?m[b]=S:delete m[b],this}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],b7MJY:[function(M,P,E){E.interopDefault=function(b){return b&&b.__esModule?b:{default:b}},E.defineInteropFlag=function(b){Object.defineProperty(b,"__esModule",{value:!0})},E.exportAll=function(b,u){return Object.keys(b).forEach(function(m){m==="default"||m==="__esModule"||u.hasOwnProperty(m)||Object.defineProperty(u,m,{enumerable:!0,get:function(){return b[m]}})}),u},E.export=function(b,u,m){Object.defineProperty(b,u,{enumerable:!0,get:m})}},{}],"5yYFo":[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("./dom");b.exportAll(u,E);var m=M("./error");b.exportAll(m,E);var D=M("./subtitle");b.exportAll(D,E);var S=M("./file");b.exportAll(S,E);var g=M("./property");b.exportAll(g,E);var d=M("./time");b.exportAll(d,E);var i=M("./format");b.exportAll(i,E);var f=M("./compatibility");b.exportAll(f,E)},{"./dom":"fqaW9","./error":"kNZvP","./subtitle":"eZUgm","./file":"dYeSt","./property":"5ynPA","./time":"kXYeR","./format":"anS7L","./compatibility":"e9wVp","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],fqaW9:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E),b.export(E,"query",()=>m),b.export(E,"queryAll",()=>D),b.export(E,"addClass",()=>S),b.export(E,"removeClass",()=>g),b.export(E,"hasClass",()=>d),b.export(E,"append",()=>i),b.export(E,"remove",()=>f),b.export(E,"setStyle",()=>o),b.export(E,"setStyles",()=>v),b.export(E,"getStyle",()=>c),b.export(E,"sublings",()=>h),b.export(E,"inverseClass",()=>t),b.export(E,"tooltip",()=>e),b.export(E,"isInViewport",()=>n),b.export(E,"includeFromEvent",()=>r),b.export(E,"replaceElement",()=>l);var u=M("./compatibility");function m(s,a=document){return a.querySelector(s)}function D(s,a=document){return Array.from(a.querySelectorAll(s))}function S(s,a){return s.classList.add(a)}function g(s,a){return s.classList.remove(a)}function d(s,a){return s.classList.contains(a)}function i(s,a){return a instanceof Element?s.appendChild(a):s.insertAdjacentHTML("beforeend",String(a)),s.lastElementChild||s.lastChild}function f(s){return s.parentNode.removeChild(s)}function o(s,a,p){return s.style[a]=p,s}function v(s,a){return Object.keys(a).forEach(p=>{o(s,p,a[p])}),s}function c(s,a,p=!0){const A=window.getComputedStyle(s,null).getPropertyValue(a);return p?parseFloat(A):A}function h(s){return Array.from(s.parentElement.children).filter(a=>a!==s)}function t(s,a){h(s).forEach(p=>g(p,a)),S(s,a)}function e(s,a,p="top"){u.isMobile||(s.setAttribute("aria-label",a),S(s,"hint--rounded"),S(s,`hint--${p}`))}function n(s,a=0){const p=s.getBoundingClientRect(),A=window.innerHeight||document.documentElement.clientHeight,_=window.innerWidth||document.documentElement.clientWidth,y=p.top-a<=A&&p.top+p.height+a>=0,L=p.left-a<=_+a&&p.left+p.width+a>=0;return y&&L}function r(s,a){return s.composedPath&&s.composedPath().indexOf(a)>-1}function l(s,a){return a.parentNode.replaceChild(s,a),s}},{"./compatibility":"e9wVp","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],e9wVp:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E),b.export(E,"userAgent",()=>u),b.export(E,"isMobile",()=>m),b.export(E,"isSafari",()=>D),b.export(E,"isWechat",()=>S),b.export(E,"isIE",()=>g),b.export(E,"isAndroid",()=>d),b.export(E,"isIOS",()=>i);const u=typeof window<"u"?window.navigator.userAgent:"",m=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(u),D=/^((?!chrome|android).)*safari/i.test(u),S=/MicroMessenger/i.test(u),g=/MSIE|Trident/i.test(u),d=/android/i.test(u),i=/iPad|iPhone|iPod/i.test(u)&&!window.MSStream},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kNZvP:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E),b.export(E,"ArtPlayerError",()=>u),b.export(E,"errorHandle",()=>m);class u extends Error{constructor(S,g){super(S),typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,g||this.constructor),this.name="ArtPlayerError"}}function m(D,S){if(!D)throw new u(S);return D}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eZUgm:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");function u(S){return`WEBVTT \r
\r
`.concat((g=S,g.replace(/(\d\d:\d\d:\d\d)[,.](\d+)/g,(d,i,f)=>{let o=f.slice(0,3);return f.length===1&&(o=f+"00"),f.length===2&&(o=f+"0"),`${i},${o}`})).replace(/\{\\([ibu])\}/g,"</$1>").replace(/\{\\([ibu])1\}/g,"<$1>").replace(/\{([ibu])\}/g,"<$1>").replace(/\{\/([ibu])\}/g,"</$1>").replace(/(\d\d:\d\d:\d\d),(\d\d\d)/g,"$1.$2").replace(/{[\s\S]*?}/g,"").concat(`\r
\r
`));var g}function m(S){return URL.createObjectURL(new Blob([S],{type:"text/vtt"}))}function D(S){const g=new RegExp("Dialogue:\\s\\d,(\\d+:\\d\\d:\\d\\d.\\d\\d),(\\d+:\\d\\d:\\d\\d.\\d\\d),([^,]*),([^,]*),(?:[^,]*,){4}([\\s\\S]*)$","i");function d(i=""){return i.split(/[:.]/).map((f,o,v)=>{if(o===v.length-1){if(f.length===1)return`.${f}00`;if(f.length===2)return`.${f}0`}else if(f.length===1)return(o===0?"0":":0")+f;return o===0?f:o===v.length-1?`.${f}`:`:${f}`}).join("")}return`WEBVTT

${S.split(/\r?\n/).map(i=>{const f=i.match(g);return f?{start:d(f[1].trim()),end:d(f[2].trim()),text:f[5].replace(/{[\s\S]*?}/g,"").replace(/(\\N)/g,`
`).trim().split(/\r?\n/).map(o=>o.trim()).join(`
`)}:null}).filter(i=>i).map((i,f)=>i?`${f+1}
${i.start} --> ${i.end}
${i.text}`:"").filter(i=>i.trim()).join(`

`)}`}b.defineInteropFlag(E),b.export(E,"srtToVtt",()=>u),b.export(E,"vttToBlob",()=>m),b.export(E,"assToVtt",()=>D)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dYeSt:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");function u(D){return D.includes("?")?u(D.split("?")[0]):D.includes("#")?u(D.split("#")[0]):D.trim().toLowerCase().split(".").pop()}function m(D,S){const g=document.createElement("a");g.style.display="none",g.href=D,g.download=S,document.body.appendChild(g),g.click(),document.body.removeChild(g)}b.defineInteropFlag(E),b.export(E,"getExt",()=>u),b.export(E,"download",()=>m)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"5ynPA":[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E),b.export(E,"def",()=>u),b.export(E,"has",()=>D),b.export(E,"get",()=>S),b.export(E,"mergeDeep",()=>g);const u=Object.defineProperty,{hasOwnProperty:m}=Object.prototype;function D(d,i){return m.call(d,i)}function S(d,i){return Object.getOwnPropertyDescriptor(d,i)}function g(...d){const i=f=>f&&typeof f=="object"&&!Array.isArray(f);return d.reduce((f,o)=>(Object.keys(o).forEach(v=>{const c=f[v],h=o[v];Array.isArray(c)&&Array.isArray(h)?f[v]=c.concat(...h):!i(c)||!i(h)||h instanceof Element?f[v]=h:f[v]=g(c,h)}),f),{})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kXYeR:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");function u(S=0){return new Promise(g=>setTimeout(g,S))}function m(S,g,d){let i;function f(...o){clearTimeout(i),i=setTimeout(function(){i=null,S.apply(d,o)},g)}return f.clearTimeout=function(){clearTimeout(i)},f}function D(S,g){let d,i,f=!1;return function o(...v){if(f)return d=v,void(i=this);f=!0,S.apply(this,v),setTimeout(()=>{f=!1,d&&(o.apply(i,d),d=null,i=null)},g)}}b.defineInteropFlag(E),b.export(E,"sleep",()=>u),b.export(E,"debounce",()=>m),b.export(E,"throttle",()=>D)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],anS7L:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");function u(S,g,d){return Math.max(Math.min(S,Math.max(g,d)),Math.min(g,d))}function m(S){const g=Math.floor(S/3600),d=Math.floor((S-3600*g)/60),i=Math.floor(S-3600*g-60*d);return(g>0?[g,d,i]:[d,i]).map(f=>f<10?`0${f}`:String(f)).join(":")}function D(S){return S.replace(/[&<>'"]/g,g=>({"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"})[g]||g)}b.defineInteropFlag(E),b.export(E,"clamp",()=>u),b.export(E,"secondToTime",()=>m),b.export(E,"escape",()=>D)},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3izFE":[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E),b.export(E,"ComponentOption",()=>o);var u=M("../utils");const m="array",D="boolean",S="string",g="number",d="object",i="function";function f(v,c,h){return(0,u.errorHandle)(c===S||c===g||v instanceof Element,`${h.join(".")} require '${S}' or 'Element' type`)}const o={html:f,disable:`?${D}`,name:`?${S}`,index:`?${g}`,style:`?${d}`,click:`?${i}`,mounted:`?${i}`,tooltip:`?${S}|${g}`,width:`?${g}`,selector:`?${m}`,onSelect:`?${i}`,switch:`?${D}`,onSwitch:`?${i}`,range:`?${m}`,onRange:`?${i}`};E.default={id:S,container:f,url:S,poster:S,title:S,type:S,theme:S,lang:S,volume:g,isLive:D,muted:D,autoplay:D,autoSize:D,autoMini:D,loop:D,flip:D,playbackRate:D,aspectRatio:D,screenshot:D,setting:D,hotkey:D,pip:D,mutex:D,backdrop:D,fullscreen:D,fullscreenWeb:D,subtitleOffset:D,miniProgressBar:D,useSSR:D,playsInline:D,lock:D,fastForward:D,autoPlayback:D,autoOrientation:D,airplay:D,plugins:[i],whitelist:[`${S}|${i}|regexp`],layers:[o],contextmenu:[o],settings:[o],controls:[{...o,position:(v,c,h)=>{const t=["top","left","right"];return(0,u.errorHandle)(t.includes(v),`${h.join(".")} only accept ${t.toString()} as parameters`)}}],quality:[{default:`?${D}`,html:S,url:S}],highlight:[{time:g,text:S}],thumbnails:{url:S,number:g,column:g,width:g,height:g},subtitle:{url:S,type:S,style:d,encoding:S},moreVideoAttr:d,icons:d,customType:d}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ej4fZ:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E),E.default={propertys:["audioTracks","autoplay","buffered","controller","controls","crossOrigin","currentSrc","currentTime","defaultMuted","defaultPlaybackRate","duration","ended","error","loop","mediaGroup","muted","networkState","paused","playbackRate","played","preload","readyState","seekable","seeking","src","startDate","textTracks","videoTracks","volume"],methods:["addTextTrack","canPlayType","load","play","pause"],events:["abort","canplay","canplaythrough","durationchange","emptied","ended","error","loadeddata","loadedmetadata","loadstart","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"],prototypes:["width","height","videoWidth","videoHeight","poster","webkitDecodedFrameCount","webkitDroppedFrameCount","playsInline","webkitSupportsFullscreen","webkitDisplayingFullscreen","onenterpictureinpicture","onleavepictureinpicture","disablePictureInPicture","cancelVideoFrameCallback","requestVideoFrameCallback","getVideoPlaybackQuality","requestPictureInPicture","webkitEnterFullScreen","webkitEnterFullscreen","webkitExitFullScreen","webkitExitFullscreen"]}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"7CkCt":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("./utils");E.default=class{constructor(u){this.art=u}get state(){const{option:u,constructor:{kindOf:m}}=this.art;return!b.isMobile||u.whitelist.some(D=>{switch(m(D)){case"string":return D==="*"||b.userAgent.indexOf(D)>-1;case"function":return D(b.userAgent);case"regexp":return D.test(b.userAgent);default:return!1}})}}},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8iGAh":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("./utils");class u{constructor(D){this.art=D;const{option:S,constructor:g,whitelist:d}=D;S.container instanceof Element?this.$container=S.container:(this.$container=(0,b.query)(S.container),(0,b.errorHandle)(this.$container,`No container element found by ${S.container}`));const i=this.$container.tagName.toLowerCase();(0,b.errorHandle)(i==="div",`Unsupported container element type, only support 'div' but got '${i}'`),(0,b.errorHandle)(g.instances.every(f=>f.template.$container!==this.$container),"Cannot mount multiple instances on the same dom element"),this.query=this.query.bind(this),this.$container.dataset.artId=D.id,this.$original=this.$container.cloneNode(!0),d.state?this.desktop():this.mobile()}static get html(){return'<div class="art-video-player art-subtitle-show art-layer-show art-control-show art-mask-show"><video class="art-video"></video><div class="art-poster"></div><div class="art-subtitle"></div><div class="art-danmuku"></div><div class="art-layers"></div><div class="art-mask"><div class="art-state"></div></div><div class="art-bottom"><div class="art-progress"></div><div class="art-controls"><div class="art-controls-left"></div><div class="art-controls-center"></div><div class="art-controls-right"></div></div></div><div class="art-loading"></div><div class="art-notice"><div class="art-notice-inner"></div></div><div class="art-settings"></div><div class="art-info"><div class="art-info-panel"><div class="art-info-item"><div class="art-info-title">Player version:</div><div class="art-info-content">4.5.4</div></div><div class="art-info-item"><div class="art-info-title">Video url:</div><div class="art-info-content" data-video="src"></div></div><div class="art-info-item"><div class="art-info-title">Video volume:</div><div class="art-info-content" data-video="volume"></div></div><div class="art-info-item"><div class="art-info-title">Video time:</div><div class="art-info-content" data-video="currentTime"></div></div><div class="art-info-item"><div class="art-info-title">Video duration:</div><div class="art-info-content" data-video="duration"></div></div><div class="art-info-item"><div class="art-info-title">Video resolution:</div><div class="art-info-content"><span data-video="videoWidth"></span> x <span data-video="videoHeight"></span></div></div></div><div class="art-info-close">[x]</div></div><div class="art-mini-header"><div class="art-mini-title"></div><div class="art-mini-close">\xD7</div></div><div class="art-contextmenus"></div></div>'}query(D){return(0,b.query)(D,this.$container)}desktop(){const{option:D}=this.art;D.useSSR||(this.$container.innerHTML=u.html),this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video"),this.$poster=this.query(".art-poster"),this.$subtitle=this.query(".art-subtitle"),this.$danmuku=this.query(".art-danmuku"),this.$bottom=this.query(".art-bottom"),this.$progress=this.query(".art-progress"),this.$controls=this.query(".art-controls"),this.$controlsLeft=this.query(".art-controls-left"),this.$controlsCenter=this.query(".art-controls-center"),this.$controlsRight=this.query(".art-controls-right"),this.$layer=this.query(".art-layers"),this.$loading=this.query(".art-loading"),this.$notice=this.query(".art-notice"),this.$noticeInner=this.query(".art-notice-inner"),this.$mask=this.query(".art-mask"),this.$state=this.query(".art-state"),this.$setting=this.query(".art-settings"),this.$info=this.query(".art-info"),this.$infoPanel=this.query(".art-info-panel"),this.$infoClose=this.query(".art-info-close"),this.$miniHeader=this.query(".art-mini-header"),this.$miniTitle=this.query(".art-mini-title"),this.$miniClose=this.query(".art-mini-close"),this.$contextmenu=this.query(".art-contextmenus"),D.backdrop&&((0,b.addClass)(this.$setting,"art-backdrop-filter"),(0,b.addClass)(this.$contextmenu,"art-backdrop-filter"),(0,b.addClass)(this.$info,"art-backdrop-filter")),b.isMobile&&(0,b.addClass)(this.$player,"art-mobile")}mobile(){this.$container.innerHTML='<div class="art-video-player"><video class="art-video"></video></div>',this.$player=this.query(".art-video-player"),this.$video=this.query(".art-video")}destroy(D){D?(0,b.replaceElement)(this.$original,this.$container):(0,b.addClass)(this.$player,"art-destroy")}}E.default=u},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3mM4M":[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("../utils"),m=M("./zh-cn.json"),D=b.interopDefault(m),S=M("./zh-tw.json"),g=b.interopDefault(S),d=M("./pl.json"),i=b.interopDefault(d),f=M("./cs.json"),o=b.interopDefault(f);E.default=class{constructor(v){this.art=v,this.languages={"zh-cn":D.default,"zh-tw":g.default,pl:i.default,cs:o.default},this.init()}init(){const v=this.art.option.lang.toLowerCase();this.language=this.languages[v]||{}}get(v){return this.language[v]||v}update(v){this.languages=(0,u.mergeDeep)(this.languages,v),this.init()}}},{"../utils":"5yYFo","./zh-cn.json":"1f1tr","./zh-tw.json":"3hy9S","./pl.json":"aFOXc","./cs.json":"aNfUP","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1f1tr":[function(M,P,E){P.exports=JSON.parse('{"Video Info":"\u7EDF\u8BA1\u4FE1\u606F","Close":"\u5173\u95ED","Video Load Failed":"\u52A0\u8F7D\u5931\u8D25","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u6682\u505C","Rate":"\u901F\u5EA6","Mute":"\u9759\u97F3","Video Flip":"\u753B\u9762\u7FFB\u8F6C","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u8FDE\u63A5","Show Setting":"\u663E\u793A\u8BBE\u7F6E","Hide Setting":"\u9690\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u56FE","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u753B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8BA4","Normal":"\u6B63\u5E38","Open":"\u6253\u5F00","Switch Video":"\u5207\u6362","Switch Subtitle":"\u5207\u6362\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7F51\u9875\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7F51\u9875\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u5F00\u542F\u753B\u4E2D\u753B","Exit PIP Mode":"\u9000\u51FA\u753B\u4E2D\u753B","PIP Not Supported":"\u4E0D\u652F\u6301\u753B\u4E2D\u753B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F6C\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],"3hy9S":[function(M,P,E){P.exports=JSON.parse('{"Video Info":"\u7D71\u8A08\u8A0A\u606F","Close":"\u95DC\u9589","Video Load Failed":"\u8F09\u5165\u5931\u6557","Volume":"\u97F3\u91CF","Play":"\u64AD\u653E","Pause":"\u66AB\u505C","Rate":"\u901F\u5EA6","Mute":"\u975C\u97F3","Video Flip":"\u756B\u9762\u7FFB\u8F49","Horizontal":"\u6C34\u5E73","Vertical":"\u5782\u76F4","Reconnect":"\u91CD\u65B0\u9023\u63A5","Show Setting":"\u986F\u793A\u8BBE\u7F6E","Hide Setting":"\u96B1\u85CF\u8BBE\u7F6E","Screenshot":"\u622A\u5716","Play Speed":"\u64AD\u653E\u901F\u5EA6","Aspect Ratio":"\u756B\u9762\u6BD4\u4F8B","Default":"\u9ED8\u8A8D","Normal":"\u6B63\u5E38","Open":"\u6253\u958B","Switch Video":"\u5207\u63DB","Switch Subtitle":"\u5207\u63DB\u5B57\u5E55","Fullscreen":"\u5168\u5C4F","Exit Fullscreen":"\u9000\u51FA\u5168\u5C4F","Web Fullscreen":"\u7DB2\u9801\u5168\u5C4F","Exit Web Fullscreen":"\u9000\u51FA\u7DB2\u9801\u5168\u5C4F","Mini Player":"\u8FF7\u4F60\u64AD\u653E\u5668","PIP Mode":"\u958B\u555F\u756B\u4E2D\u756B","Exit PIP Mode":"\u9000\u51FA\u756B\u4E2D\u756B","PIP Not Supported":"\u4E0D\u652F\u6301\u756B\u4E2D\u756B","Fullscreen Not Supported":"\u4E0D\u652F\u6301\u5168\u5C4F","Subtitle Offset":"\u5B57\u5E55\u504F\u79FB","Last Seen":"\u4E0A\u6B21\u770B\u5230","Jump Play":"\u8DF3\u8F49\u64AD\u653E","AirPlay":"\u9694\u7A7A\u64AD\u653E","AirPlay Not Available":"\u9694\u7A7A\u64AD\u653E\u4E0D\u53EF\u7528"}')},{}],aFOXc:[function(M,P,E){P.exports=JSON.parse('{"Video Info":"Informacje o wideo","Close":"Zamknij","Video Load Failed":"B\u0142\u0105d \u0142adowania wideo","Volume":"G\u0142o\u015Bno\u015B\u0107","Play":"Odtw\xF3rz","Pause":"Wstrzymaj","Rate":"Oce\u0144","Mute":"Wycisz","Video Flip":"Rotacja wideo","Horizontal":"Pozioma","Vertical":"Pionowa","Reconnect":"Po\u0142\u0105cz ponownie","Show Setting":"Poka\u017C ustawienia","Hide Setting":"Ukryj ustawienia","Screenshot":"Zrzut ekranu","Play Speed":"Pr\u0119dko\u015B\u0107 odtwarzania","Aspect Ratio":"Wsp\xF3\u0142czynnik proporcji","Default":"Domy\u015Blny","Normal":"Normalny","Open":"Otw\xF3rz","Switch Video":"Prze\u0142\u0105cz wideo","Switch Subtitle":"Prze\u0142\u0105cz napisy","Fullscreen":"Pe\u0142ny ekran","Exit Fullscreen":"Zamknij pe\u0142ny ekran","Web Fullscreen":"Tryb pe\u0142nej strony","Exit Web Fullscreen":"Zamknij tryb pe\u0142nej strony","Mini Player":"Miniodtwarzacz","PIP Mode":"Tryb PiP","Exit PIP Mode":"Zamknij tryb PiP","PIP Not Supported":"Tryb PiP nieobs\u0142ugiwany","Fullscreen Not Supported":"Pe\u0142ny ekran nieobs\u0142ugiwany","Subtitle Offset":"Przesuni\u0119cie napis\xF3w","Last Seen":"Ostatnio widziany","Jump Play":"Skocz do gry","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nie jest dost\u0119pny"}')},{}],aNfUP:[function(M,P,E){P.exports=JSON.parse('{"Video Info":"Info o videu","Close":"Zav\u0159\xEDt","Video Load Failed":"Nahr\xE1n\xED videa selhalo","Volume":"Hlasitost","Play":"P\u0159ehr\xE1t","Pause":"Pozastavit","Rate":"Hodnocen\xED","Mute":"Ztlumit","Video Flip":"Oto\u010Dit video","Horizontal":"Horizont\xE1ln\u011B","Vertical":"Vertik\xE1ln\u011B","Reconnect":"Op\u011Btovn\xE9 p\u0159ipojen\xED","Show Setting":"Zobrazit nastaven\xED","Hide Setting":"Skr\xFDt nastaven\xED","Screenshot":"Sn\xEDmek obrazovky","Play Speed":"Rychlost p\u0159ehr\xE1v\xE1n\xED","Aspect Ratio":"Pom\u011Br stran","Default":"V\xFDchoz\xED","Normal":"Norm\xE1ln\xED","Open":"Otev\u0159\xEDt","Switch Video":"P\u0159epnout video","Switch Subtitle":"P\u0159epnout titulky","Fullscreen":"Cel\xE1 obrazovka","Exit Fullscreen":"Opustit re\u017Eim cel\xE9 obrazovky","Web Fullscreen":"Cel\xE1 str\xE1nka","Exit Web Fullscreen":"Zav\u0159\xEDt re\u017Eim cel\xE9 str\xE1nky","Mini Player":"Mini p\u0159ehr\xE1va\u010D","PIP Mode":"Re\u017Eim PIP","Exit PIP Mode":"Opustit re\u017Eim PIP","PIP Not Supported":"Re\u017Eim PIP nen\xED podporov\xE1n","Fullscreen Not Supported":"Re\u017Eim cel\xE9 obrazovky nen\xED podporov\xE1n","Subtitle Offset":"Posun titulk\u016F","Last Seen":"Naposledy vid\u011Bn","Jump Play":"Hra na skok","AirPlay":"AirPlay","AirPlay Not Available":"AirPlay nen\xED k dispozici"}')},{}],bCaa0:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("./urlMix"),m=b.interopDefault(u),D=M("./attrMix"),S=b.interopDefault(D),g=M("./playMix"),d=b.interopDefault(g),i=M("./pauseMix"),f=b.interopDefault(i),o=M("./toggleMix"),v=b.interopDefault(o),c=M("./seekMix"),h=b.interopDefault(c),t=M("./volumeMix"),e=b.interopDefault(t),n=M("./currentTimeMix"),r=b.interopDefault(n),l=M("./durationMix"),s=b.interopDefault(l),a=M("./switchMix"),p=b.interopDefault(a),A=M("./playbackRateMix"),_=b.interopDefault(A),y=M("./aspectRatioMix"),L=b.interopDefault(y),x=M("./screenshotMix"),T=b.interopDefault(x),O=M("./fullscreenMix"),R=b.interopDefault(O),I=M("./fullscreenWebMix"),C=b.interopDefault(I),w=M("./pipMix"),F=b.interopDefault(w),B=M("./loadedMix"),k=b.interopDefault(B),U=M("./playedMix"),N=b.interopDefault(U),j=M("./playingMix"),K=b.interopDefault(j),H=M("./autoSizeMix"),V=b.interopDefault(H),G=M("./rectMix"),ee=b.interopDefault(G),q=M("./flipMix"),z=b.interopDefault(q),X=M("./miniMix"),J=b.interopDefault(X),ie=M("./loopMix"),ae=b.interopDefault(ie),se=M("./posterMix"),le=b.interopDefault(se),ue=M("./autoHeightMix"),Z=b.interopDefault(ue),oe=M("./themeMix"),de=b.interopDefault(oe),ce=M("./titleMix"),ve=b.interopDefault(ce),he=M("./normalSizeMix"),ye=b.interopDefault(he),fe=M("./subtitleOffsetMix"),me=b.interopDefault(fe),W=M("./airplayMix"),Y=b.interopDefault(W),$=M("./optionInit"),Q=b.interopDefault($),re=M("./eventInit"),ne=b.interopDefault(re);E.default=class{constructor(te){(0,m.default)(te),(0,S.default)(te),(0,d.default)(te),(0,f.default)(te),(0,v.default)(te),(0,h.default)(te),(0,e.default)(te),(0,r.default)(te),(0,s.default)(te),(0,p.default)(te),(0,_.default)(te),(0,L.default)(te),(0,T.default)(te),(0,R.default)(te),(0,C.default)(te),(0,F.default)(te),(0,k.default)(te),(0,N.default)(te),(0,K.default)(te),(0,V.default)(te),(0,ee.default)(te),(0,z.default)(te),(0,J.default)(te),(0,ae.default)(te),(0,le.default)(te),(0,Z.default)(te),(0,de.default)(te),(0,ve.default)(te),(0,ye.default)(te),(0,me.default)(te),(0,Y.default)(te),(0,ne.default)(te),(0,Q.default)(te)}}},{"./urlMix":"9mMBB","./attrMix":"ghisN","./playMix":"l5N6R","./pauseMix":"fVR5i","./toggleMix":"cZiBO","./seekMix":"bsO1Q","./volumeMix":"ivSmC","./currentTimeMix":"8LbXb","./durationMix":"f7tNT","./switchMix":"ejQWi","./playbackRateMix":"kNcxE","./aspectRatioMix":"8v5yt","./screenshotMix":"eLUEv","./fullscreenMix":"ifvhR","./fullscreenWebMix":"dsFtO","./pipMix":"gYMLD","./loadedMix":"fMSRd","./playedMix":"iRHNE","./playingMix":"dQ40z","./autoSizeMix":"iF844","./rectMix":"1hAm8","./flipMix":"dhi4g","./miniMix":"eQPx9","./loopMix":"gQaVE","./posterMix":"7n9Pt","./autoHeightMix":"8Az1F","./themeMix":"kXlsI","./titleMix":"b8f4Q","./normalSizeMix":"4fP62","./subtitleOffsetMix":"gdNfa","./airplayMix":"bDxGv","./optionInit":"luxZi","./eventInit":"b25aJ","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"9mMBB":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{option:m,template:{$video:D}}=u;(0,b.def)(u,"url",{get:()=>D.currentSrc,async set(S){if(S){const g=m.type||(0,b.getExt)(S),d=m.customType[g];g&&d?(await(0,b.sleep)(),u.loading.show=!0,d.call(u,D,S,u)):(u.url&&u.url!==S&&u.once("video:canplay",()=>{u.isReady&&u.emit("restart")}),D.src=S,u.option.url=S,u.emit("url",S))}else await(0,b.sleep)(),u.loading.show=!0}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ghisN:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{template:{$video:m}}=u;(0,b.def)(u,"attr",{value(D,S){if(S===void 0)return m[D];m[D]=S}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],l5N6R:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{i18n:m,notice:D,option:S,constructor:{instances:g},template:{$video:d}}=u;(0,b.def)(u,"play",{value:async function(){const i=await d.play();if(D.show=m.get("Play"),u.emit("play"),S.mutex)for(let f=0;f<g.length;f++){const o=g[f];o!==u&&o.pause()}return i}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],fVR5i:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{template:{$video:m},i18n:D,notice:S}=u;(0,b.def)(u,"pause",{value(){const g=m.pause();return S.show=D.get("Pause"),u.emit("pause"),g}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cZiBO:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){(0,b.def)(u,"toggle",{value:()=>u.playing?u.pause():u.play()})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bsO1Q:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{notice:m}=u;(0,b.def)(u,"seek",{set(D){u.currentTime=D,u.emit("seek",u.currentTime),u.duration&&(m.show=`${(0,b.secondToTime)(u.currentTime)} / ${(0,b.secondToTime)(u.duration)}`)}}),(0,b.def)(u,"forward",{set(D){u.seek=u.currentTime+D}}),(0,b.def)(u,"backward",{set(D){u.seek=u.currentTime-D}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ivSmC:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{template:{$video:m},i18n:D,notice:S,storage:g}=u;(0,b.def)(u,"volume",{get:()=>m.volume||0,set:d=>{m.volume=(0,b.clamp)(d,0,1),S.show=`${D.get("Volume")}: ${parseInt(100*m.volume,10)}`,m.volume!==0&&g.set("volume",m.volume),u.emit("volume",m.volume)}}),(0,b.def)(u,"muted",{get:()=>m.muted,set:d=>{m.muted=d,u.emit("volume",m.volume)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8LbXb":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{$video:m}=u.template;(0,b.def)(u,"currentTime",{get:()=>m.currentTime||0,set:D=>{D=parseFloat(D),Number.isNaN(D)||(m.currentTime=(0,b.clamp)(D,0,u.duration))}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],f7tNT:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){(0,b.def)(u,"duration",{get:()=>{const{duration:m}=u.template.$video;return m===1/0?0:m||0}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ejQWi:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{i18n:m,option:D,notice:S}=u;function g(d,i,f){return new Promise(o=>{if(d===u.url)return o(d);const{playing:v}=u;u.pause(),URL.revokeObjectURL(u.url),u.url=d,u.once("video:canplay",()=>{u.playbackRate=!1,u.aspectRatio=!1,u.flip="normal",u.autoSize=D.autoSize,u.currentTime=f,u.notice.show="",v&&u.play(),i&&(S.show=`${m.get("Switch Video")}: ${i}`),u.emit("switch",d),o(d)})})}(0,b.def)(u,"switchQuality",{value:(d,i)=>g(d,i,u.currentTime)}),(0,b.def)(u,"switchUrl",{value:(d,i)=>g(d,i,0)})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kNcxE:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{template:{$video:m},i18n:D,notice:S}=u;(0,b.def)(u,"playbackRate",{get:()=>m.playbackRate,set(g){if(g){if(g===m.playbackRate)return;const d=[.25,.5,.75,1,1.25,1.5,1.75,2,3,4];(0,b.errorHandle)(d.includes(g),`'playbackRate' only accept ${d.toString()} as parameters`),m.playbackRate=g,S.show=`${D.get("Rate")}: ${g===1?D.get("Normal"):`${g}x`}`,u.emit("playbackRate",g)}else u.playbackRate=1,u.emit("playbackRate")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8v5yt":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{template:{$video:m,$player:D},i18n:S,notice:g}=u;(0,b.def)(u,"aspectRatio",{get:()=>D.dataset.aspectRatio||"default",set(d){d||(d="default");const i=["default","4:3","16:9"];if((0,b.errorHandle)(i.includes(d),`'aspectRatio' only accept ${i.toString()} as parameters`),d==="default")(0,b.setStyle)(m,"width",null),(0,b.setStyle)(m,"height",null),(0,b.setStyle)(m,"padding",null),delete D.dataset.aspectRatio;else{const f=d.split(":").map(Number),{videoWidth:o,videoHeight:v}=m,{clientWidth:c,clientHeight:h}=D,t=o/v,e=f[0]/f[1];if(t>e){const n=e*v/o;(0,b.setStyle)(m,"width",100*n+"%"),(0,b.setStyle)(m,"height","100%"),(0,b.setStyle)(m,"padding",`0 ${(c-c*n)/2}px`)}else{const n=o/e/v;(0,b.setStyle)(m,"width","100%"),(0,b.setStyle)(m,"height",100*n+"%"),(0,b.setStyle)(m,"padding",(h-h*n)/2+"px 0")}D.dataset.aspectRatio=d}g.show=`${S.get("Aspect Ratio")}: ${d==="default"?S.get("Default"):d}`,u.emit("aspectRatio",d)}}),(0,b.def)(u,"aspectRatioReset",{set(d){if(d){const{aspectRatio:i}=u;u.aspectRatio=i}}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eLUEv:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{option:m,notice:D,template:{$video:S}}=u,g=document.createElement("canvas");(0,b.def)(u,"getDataURL",{value:()=>new Promise((d,i)=>{try{g.width=S.videoWidth,g.height=S.videoHeight,g.getContext("2d").drawImage(S,0,0),d(g.toDataURL("image/png"))}catch(f){D.show=f,i(f)}})}),(0,b.def)(u,"getBlobUrl",{value:()=>new Promise((d,i)=>{try{g.width=S.videoWidth,g.height=S.videoHeight,g.getContext("2d").drawImage(S,0,0),g.toBlob(f=>{d(URL.createObjectURL(f))})}catch(f){D.show=f,i(f)}})}),(0,b.def)(u,"screenshot",{value:async()=>{const d=await u.getDataURL();return(0,b.download)(d,`${m.title||"artplayer"}_${(0,b.secondToTime)(S.currentTime)}.png`),u.emit("screenshot",d),d}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ifvhR:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("../libs/screenfull"),m=b.interopDefault(u),D=M("../utils");E.default=function(S){const{i18n:g,notice:d,template:{$video:i,$player:f}}=S;S.once("video:loadedmetadata",()=>{var o;m.default.isEnabled?(o=S,m.default.on("change",()=>o.emit("fullscreen",m.default.isFullscreen)),(0,D.def)(o,"fullscreen",{get:()=>m.default.isFullscreen,async set(v){v?(o.normalSize="fullscreen",o.aspectRatioReset=!0,o.autoSize=!1,await m.default.request(f),(0,D.addClass)(f,"art-fullscreen"),o.emit("resize"),o.emit("fullscreen",!0),d.show=""):(o.aspectRatioReset=!0,o.autoSize=o.option.autoSize,await m.default.exit(),(0,D.removeClass)(f,"art-fullscreen"),o.emit("resize"),o.emit("fullscreen"),d.show="")}})):document.fullscreenEnabled||i.webkitSupportsFullscreen?(v=>{(0,D.def)(v,"fullscreen",{get:()=>i.webkitDisplayingFullscreen,set(c){c?(v.normalSize="fullscreen",i.webkitEnterFullscreen(),v.emit("fullscreen",!0),d.show=""):(i.webkitExitFullscreen(),v.emit("fullscreen"),d.show="")}})})(S):(0,D.def)(S,"fullscreen",{get:()=>!1,set(){d.show=g.get("Fullscreen Not Supported")}}),(0,D.def)(S,"fullscreen",(0,D.get)(S,"fullscreen"))})}},{"../libs/screenfull":"dXDKn","../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dXDKn:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);const b=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],u=(()=>{if(typeof document>"u")return!1;const S=b[0],g={};for(const d of b)if(d[1]in document){for(const[i,f]of d.entries())g[S[i]]=f;return g}return!1})(),m={change:u.fullscreenchange,error:u.fullscreenerror};let D={request:(S=document.documentElement,g)=>new Promise((d,i)=>{const f=()=>{D.off("change",f),d()};D.on("change",f);const o=S[u.requestFullscreen](g);o instanceof Promise&&o.then(f).catch(i)}),exit:()=>new Promise((S,g)=>{if(!D.isFullscreen)return void S();const d=()=>{D.off("change",d),S()};D.on("change",d);const i=document[u.exitFullscreen]();i instanceof Promise&&i.then(d).catch(g)}),toggle:(S,g)=>D.isFullscreen?D.exit():D.request(S,g),onchange(S){D.on("change",S)},onerror(S){D.on("error",S)},on(S,g){const d=m[S];d&&document.addEventListener(d,g,!1)},off(S,g){const d=m[S];d&&document.removeEventListener(d,g,!1)},raw:u};Object.defineProperties(D,{isFullscreen:{get:()=>Boolean(document[u.fullscreenElement])},element:{enumerable:!0,get:()=>document[u.fullscreenElement]},isEnabled:{enumerable:!0,get:()=>Boolean(document[u.fullscreenEnabled])}}),u||(D={isEnabled:!1}),E.default=D},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dsFtO:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{notice:m,template:{$player:D}}=u;(0,b.def)(u,"fullscreenWeb",{get:()=>(0,b.hasClass)(D,"art-fullscreen-web"),set(S){S?(u.normalSize="fullscreenWeb",(0,b.addClass)(D,"art-fullscreen-web"),u.aspectRatioReset=!0,u.autoSize=!1,u.emit("resize"),u.emit("fullscreenWeb",!0),m.show=""):((0,b.removeClass)(D,"art-fullscreen-web"),u.aspectRatioReset=!0,u.autoSize=u.option.autoSize,u.emit("resize"),u.emit("fullscreenWeb"),m.show="")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gYMLD:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{i18n:m,notice:D,template:{$video:S}}=u;document.pictureInPictureEnabled?function(g){const{template:{$video:d},events:{proxy:i},notice:f}=g;d.disablePictureInPicture=!1,(0,b.def)(g,"pip",{get:()=>document.pictureInPictureElement,set(o){o?(g.normalSize="pip",d.requestPictureInPicture().catch(v=>{throw f.show=v,v})):document.exitPictureInPicture().catch(v=>{throw f.show=v,v})}}),i(d,"enterpictureinpicture",()=>{g.emit("pip",!0)}),i(d,"leavepictureinpicture",()=>{g.emit("pip")})}(u):S.webkitSupportsPresentationMode?function(g){const{$video:d}=g.template;d.webkitSetPresentationMode("inline"),(0,b.def)(g,"pip",{get:()=>d.webkitPresentationMode==="picture-in-picture",set(i){i?(g.normalSize="pip",d.webkitSetPresentationMode("picture-in-picture"),g.emit("pip",!0)):(d.webkitSetPresentationMode("inline"),g.emit("pip"))}})}(u):(0,b.def)(u,"pip",{get:()=>!1,set(){D.show=m.get("PIP Not Supported")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],fMSRd:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{$video:m}=u.template;(0,b.def)(u,"loaded",{get:()=>u.loadedTime/m.duration}),(0,b.def)(u,"loadedTime",{get:()=>m.buffered.length?m.buffered.end(m.buffered.length-1):0})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],iRHNE:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){(0,b.def)(u,"played",{get:()=>u.currentTime/u.duration})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dQ40z:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{$video:m}=u.template;(0,b.def)(u,"playing",{get:()=>m.currentTime>0&&!m.paused&&!m.ended&&m.readyState>2})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],iF844:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{$container:m,$player:D,$video:S}=u.template;(0,b.def)(u,"autoSize",{get:()=>(0,b.hasClass)(m,"art-auto-size"),set(g){if(g){const{videoWidth:d,videoHeight:i}=S,{width:f,height:o}=m.getBoundingClientRect(),v=d/i,c=f/o;if((0,b.addClass)(m,"art-auto-size"),c>v){const h=o*v/f*100;(0,b.setStyle)(D,"width",`${h}%`),(0,b.setStyle)(D,"height","100%")}else{const h=f/v/o*100;(0,b.setStyle)(D,"width","100%"),(0,b.setStyle)(D,"height",`${h}%`)}u.emit("autoSize",{width:u.width,height:u.height})}else(0,b.removeClass)(m,"art-auto-size"),(0,b.setStyle)(D,"width",null),(0,b.setStyle)(D,"height",null),u.emit("autoSize")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1hAm8":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){(0,b.def)(u,"rect",{get:()=>u.template.$player.getBoundingClientRect()});const m=["bottom","height","left","right","top","width"];for(let D=0;D<m.length;D++){const S=m[D];(0,b.def)(u,S,{get:()=>u.rect[S]})}(0,b.def)(u,"x",{get:()=>u.left+window.pageXOffset}),(0,b.def)(u,"y",{get:()=>u.top+window.pageYOffset})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],dhi4g:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{template:{$player:m},i18n:D,notice:S}=u;(0,b.def)(u,"flip",{get:()=>m.dataset.flip||"normal",set(g){g||(g="normal");const d=["normal","horizontal","vertical"];(0,b.errorHandle)(d.includes(g),`'flip' only accept ${d.toString()} as parameters`),g==="normal"?delete m.dataset.flip:m.dataset.flip=g;const i=g.replace(g[0],g[0].toUpperCase());S.show=`${D.get("Video Flip")}: ${D.get(i)}`,u.emit("flip",g)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eQPx9:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{i18n:m,option:D,storage:S,events:{proxy:g},template:{$player:d,$miniClose:i,$miniTitle:f,$miniHeader:o}}=u;let v=!1,c=0,h=0,t=0,e=0;g(o,"mousedown",n=>{v=!0,c=n.pageX,h=n.pageY,t=u.left,e=u.top}),g(document,"mousemove",n=>{if(v){(0,b.addClass)(d,"art-is-dragging");const r=e+n.pageY-h,l=t+n.pageX-c;(0,b.setStyle)(d,"top",`${r}px`),(0,b.setStyle)(d,"left",`${l}px`),S.set("top",r),S.set("left",l)}}),g(document,"mouseup",()=>{v=!1,(0,b.removeClass)(d,"art-is-dragging")}),g(i,"click",()=>{u.mini=!1,v=!1,(0,b.removeClass)(d,"art-is-dragging")}),(0,b.append)(f,D.title||m.get("Mini Player")),(0,b.def)(u,"mini",{get:()=>(0,b.hasClass)(d,"art-mini"),set(n){if(n){u.normalSize="mini",u.autoSize=!1,(0,b.addClass)(d,"art-mini");const r=S.get("top"),l=S.get("left");if(r&&l)(0,b.setStyle)(d,"top",`${r}px`),(0,b.setStyle)(d,"left",`${l}px`),(0,b.isInViewport)(o)||(S.del("top"),S.del("left"),u.mini=!0);else{const s=window.innerHeight-u.height-50,a=window.innerWidth-u.width-50;S.set("top",s),S.set("left",a),(0,b.setStyle)(d,"top",`${s}px`),(0,b.setStyle)(d,"left",`${a}px`)}u.aspectRatio=!1,u.playbackRate=!1,u.notice.show="",u.emit("mini",!0)}else(0,b.removeClass)(d,"art-mini"),(0,b.setStyle)(d,"top",null),(0,b.setStyle)(d,"left",null),u.aspectRatio=!1,u.playbackRate=!1,u.autoSize=D.autoSize,u.notice.show="",u.emit("mini")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gQaVE:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){let m=[];(0,b.def)(u,"loop",{get:()=>m,set:D=>{if(Array.isArray(D)&&typeof D[0]=="number"&&typeof D[1]=="number"){const S=(0,b.clamp)(D[0],0,Math.min(D[1],u.duration)),g=(0,b.clamp)(D[1],S,u.duration);g-S>=1?(m=[S,g],u.emit("loop",m)):(m=[],u.emit("loop"))}else m=[],u.emit("loop")}}),u.on("video:timeupdate",()=>{m.length&&(u.currentTime<m[0]||u.currentTime>m[1])&&(u.seek=m[0])})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"7n9Pt":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{option:m,template:{$poster:D}}=u;(0,b.def)(u,"poster",{get:()=>m.poster,set(S){m.poster=S,(0,b.setStyle)(D,"backgroundImage",`url(${S})`)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"8Az1F":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{option:m,template:{$container:D,$video:S}}=u,g=D.style.height;(0,b.def)(u,"autoHeight",{get:()=>(0,b.hasClass)(D,"art-auto-height"),set(d){if(d){const{clientWidth:i}=D,{videoHeight:f,videoWidth:o}=S,v=f*(i/o);(0,b.setStyle)(D,"height",v+"px"),(0,b.addClass)(D,"art-auto-height"),u.autoSize=m.autoSize,u.emit("autoHeight",v)}else(0,b.setStyle)(D,"height",g),(0,b.removeClass)(D,"art-auto-height"),u.autoSize=m.autoSize,u.emit("autoHeight")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kXlsI:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{option:m,template:{$player:D}}=u;(0,b.def)(u,"theme",{get:()=>getComputedStyle(D).getPropertyValue("--theme"),set(S){m.theme=S,D.style.setProperty("--theme",S)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],b8f4Q:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){(0,b.def)(u,"title",{get:()=>u.option.title,set(m){u.option.title=m}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4fP62":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const m=["mini","pip","fullscreen","fullscreenWeb"];(0,b.def)(u,"normalSize",{get:()=>m.every(D=>!u[D]),set(D){m.filter(S=>S!==D).forEach(S=>{u[S]&&(u[S]=!1)})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gdNfa:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{clamp:m}=u.constructor.utils,{notice:D,template:S,i18n:g}=u;let d=0,i=[];u.on("subtitle:switch",()=>{i=[]}),(0,b.def)(u,"subtitleOffset",{get:()=>d,set(f){if(S.$track&&S.$track.track){const o=Array.from(S.$track.track.cues);d=m(f,-5,5);for(let v=0;v<o.length;v++){const c=o[v];i[v]||(i[v]={startTime:c.startTime,endTime:c.endTime}),c.startTime=m(i[v].startTime+d,0,u.duration),c.endTime=m(i[v].endTime+d,0,u.duration)}u.subtitle.update(),D.show=`${g.get("Subtitle Offset")}: ${f}s`,u.emit("subtitleOffset",f)}else u.emit("subtitleOffset",0)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bDxGv:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{i18n:m,notice:D,events:{proxy:S},template:{$video:g}}=u;let d=!0;window.WebKitPlaybackTargetAvailabilityEvent&&g.webkitShowPlaybackTargetPicker?S(g,"webkitplaybacktargetavailabilitychanged",i=>{switch(i.availability){case"available":d=!0;break;case"not-available":d=!1}}):d=!1,(0,b.def)(u,"airplay",{value(){d?(g.webkitShowPlaybackTargetPicker(),u.emit("airplay")):D.show=m.get("AirPlay Not Available")}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],luxZi:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{option:m,storage:D,template:{$video:S,$poster:g}}=u;Object.keys(m.moreVideoAttr).forEach(i=>{u.attr(i,m.moreVideoAttr[i])}),m.muted&&(u.muted=m.muted),m.volume&&(S.volume=(0,b.clamp)(m.volume,0,1));const d=D.get("volume");typeof d=="number"&&(S.volume=(0,b.clamp)(d,0,1)),m.poster&&(0,b.setStyle)(g,"backgroundImage",`url(${m.poster})`),m.autoplay&&(S.autoplay=m.autoplay),m.playsInline&&(S.playsInline=!0,S["webkit-playsinline"]=!0),m.theme&&(u.theme=m.theme),u.url=m.url}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],b25aJ:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("../config"),m=b.interopDefault(u),D=M("../utils");E.default=function(S){const{i18n:g,notice:d,option:i,constructor:f,events:{proxy:o},template:{$player:v,$video:c,$poster:h}}=S;let t=0;for(let e=0;e<m.default.events.length;e++)o(c,m.default.events[e],n=>{S.emit(`video:${n.type}`,n)});S.on("video:canplay",()=>{t=0,S.loading.show=!1}),S.once("video:canplay",()=>{S.loading.show=!1,S.controls.show=!0,S.mask.show=!0,S.isReady=!0,S.emit("ready")}),S.on("video:ended",()=>{i.loop?(S.seek=0,S.play(),S.controls.show=!1,S.mask.show=!1):(S.controls.show=!0,S.mask.show=!0)}),S.on("video:error",async()=>{t<f.RECONNECT_TIME_MAX?(await(0,D.sleep)(f.RECONNECT_SLEEP_TIME),t+=1,S.url=i.url,d.show=`${g.get("Reconnect")}: ${t}`,S.emit("error",t)):(S.mask.show=!0,S.loading.show=!1,S.controls.show=!0,(0,D.addClass)(v,"art-error"),await(0,D.sleep)(f.RECONNECT_SLEEP_TIME),d.show=g.get("Video Load Failed"),S.destroy(!1))}),S.on("video:loadedmetadata",()=>{S.autoSize=i.autoSize,D.isMobile&&(S.loading.show=!1,S.controls.show=!0,S.mask.show=!0)}),S.on("video:loadstart",()=>{S.loading.show=!0,S.mask.show=!1,S.controls.show=!0}),S.on("video:pause",()=>{S.controls.show=!0,S.mask.show=!0}),S.on("video:play",()=>{S.mask.show=!1,(0,D.setStyle)(h,"display","none")}),S.on("video:playing",()=>{S.mask.show=!1}),S.on("video:seeked",()=>{S.loading.show=!1}),S.on("video:seeking",()=>{S.loading.show=!0,S.mask.show=!1}),S.on("video:timeupdate",()=>{S.mask.show=!1}),S.on("video:waiting",()=>{S.loading.show=!0,S.mask.show=!1})}},{"../config":"ej4fZ","../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3qXcr":[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("../utils"),m=M("../utils/component"),D=b.interopDefault(m),S=M("./fullscreen"),g=b.interopDefault(S),d=M("./fullscreenWeb"),i=b.interopDefault(d),f=M("./pip"),o=b.interopDefault(f),v=M("./playAndPause"),c=b.interopDefault(v),h=M("./progress"),t=b.interopDefault(h),e=M("./time"),n=b.interopDefault(e),r=M("./volume"),l=b.interopDefault(r),s=M("./setting"),a=b.interopDefault(s),p=M("./thumbnails"),A=b.interopDefault(p),_=M("./screenshot"),y=b.interopDefault(_),L=M("./quality"),x=b.interopDefault(L),T=M("./loop"),O=b.interopDefault(T),R=M("./airplay"),I=b.interopDefault(R);class C extends D.default{constructor(F){super(F),this.name="control";const{constructor:B,events:{proxy:k},template:{$player:U}}=F;let N=Date.now();k(U,["click","mousemove","touchstart","touchmove"],()=>{this.show=!0,(0,u.removeClass)(U,"art-hide-cursor"),(0,u.addClass)(U,"art-hover"),N=Date.now()}),F.on("video:timeupdate",()=>{!F.isInput&&F.playing&&this.show&&Date.now()-N>=B.CONTROL_HIDE_TIME&&(this.show=!1,(0,u.addClass)(U,"art-hide-cursor"),(0,u.removeClass)(U,"art-hover"))}),this.init()}init(){const{option:F}=this.art;F.isLive||this.add((0,t.default)({name:"progress",position:"top",index:10})),!F.thumbnails.url||F.isLive||u.isMobile||this.add((0,A.default)({name:"thumbnails",position:"top",index:20})),this.add((0,O.default)({name:"loop",position:"top",index:30})),this.add((0,c.default)({name:"playAndPause",position:"left",index:10})),this.add((0,l.default)({name:"volume",position:"left",index:20})),F.isLive||this.add((0,n.default)({name:"time",position:"left",index:30})),F.quality.length&&this.add((0,x.default)({name:"quality",position:"right",index:10})),F.screenshot&&!u.isMobile&&this.add((0,y.default)({name:"screenshot",position:"right",index:20})),F.setting&&this.add((0,a.default)({name:"setting",position:"right",index:30})),F.pip&&this.add((0,o.default)({name:"pip",position:"right",index:40})),F.airplay&&window.WebKitPlaybackTargetAvailabilityEvent&&this.add((0,I.default)({name:"airplay",position:"right",index:50})),F.fullscreenWeb&&this.add((0,i.default)({name:"fullscreenWeb",position:"right",index:60})),F.fullscreen&&this.add((0,g.default)({name:"fullscreen",position:"right",index:70}));for(let B=0;B<F.controls.length;B++)this.add(F.controls[B])}add(F){const B=typeof F=="function"?F(this.art):F,{$progress:k,$controlsLeft:U,$controlsRight:N}=this.art.template;switch(B.position){case"top":this.$parent=k;break;case"left":this.$parent=U;break;case"right":this.$parent=N;break;default:(0,u.errorHandle)(!1,"Control option.position must one of 'top', 'left', 'right'")}super.add(B)}}E.default=C},{"../utils":"5yYFo","../utils/component":"5MLcx","./fullscreen":"43BKT","./fullscreenWeb":"kQJHz","./pip":"aWne0","./playAndPause":"4z78f","./progress":"19nwD","./time":"lh90q","./volume":"hsA6A","./setting":"4rv3i","./thumbnails":"lTgvI","./screenshot":"71GuX","./quality":"f9VNW","./loop":"d1O2Q","./airplay":"aIzPt","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"5MLcx":[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("./dom"),m=M("option-validator"),D=b.interopDefault(m),S=M("../scheme"),g=M("./property"),d=M("./error");E.default=class{constructor(i){this.id=0,this.art=i,this.add=this.add.bind(this)}get show(){return(0,u.hasClass)(this.art.template.$player,`art-${this.name}-show`)}set show(i){const{$player:f}=this.art.template,o=`art-${this.name}-show`;i?(0,u.addClass)(f,o):(0,u.removeClass)(f,o),this.art.emit(this.name,i)}set toggle(i){i&&(this.show=!this.show)}add(i){const f=typeof i=="function"?i(this.art):i;if(f.html=f.html||"",(0,D.default)(f,S.ComponentOption),!this.$parent||!this.name||f.disable)return;const o=f.name||`${this.name}${this.id}`;(0,d.errorHandle)(!(0,g.has)(this,o),`Cannot add an existing name [${o}] to the [${this.name}]`),this.id+=1;const v=document.createElement("div");(0,u.addClass)(v,`art-${this.name}`),(0,u.addClass)(v,`art-${this.name}-${o}`);const c=Array.from(this.$parent.children);v.dataset.index=f.index||this.id;const h=c.find(t=>Number(t.dataset.index)>=Number(v.dataset.index));return h?h.insertAdjacentElement("beforebegin",v):(0,u.append)(this.$parent,v),f.html&&(0,u.append)(v,f.html),f.style&&(0,u.setStyles)(v,f.style),f.tooltip&&(0,u.tooltip)(v,f.tooltip),f.click&&this.art.events.proxy(v,"click",t=>{t.preventDefault(),f.click.call(this.art,this,t)}),f.selector&&["left","right"].includes(f.position)&&this.selector(f,v),f.mounted&&f.mounted.call(this.art,v),v.childNodes.length===1&&v.childNodes[0].nodeType===3&&(0,u.addClass)(v,"art-control-onlyText"),(0,g.def)(this,o,{value:v}),v}selector(i,f){const{hover:o,proxy:v}=this.art.events;(0,u.addClass)(f,"art-control-selector");const c=document.createElement("div");(0,u.addClass)(c,"art-selector-value"),(0,u.append)(c,i.html),f.innerText="",(0,u.append)(f,c);const h=i.selector.map((n,r)=>`<div class="art-selector-item ${n.default?"art-current":""}" data-index="${r}">${n.html}</div>`).join(""),t=document.createElement("div");(0,u.addClass)(t,"art-selector-list"),(0,u.append)(t,h),(0,u.append)(f,t);const e=()=>{const n=(0,u.getStyle)(f,"width")/2-(0,u.getStyle)(t,"width")/2;t.style.left=`${n}px`};o(f,e),v(t,"click",async n=>{const r=(n.composedPath()||[]).find(a=>(0,u.hasClass)(a,"art-selector-item"));if(!r)return;(0,u.inverseClass)(r,"art-current");const l=Number(r.dataset.index),s=i.selector[l]||{};if(c.innerText=r.innerText,i.onSelect){const a=await i.onSelect.call(this.art,s,r,n);typeof a!="string"&&typeof a!="number"||(c.innerHTML=a)}e(),this.art.emit("selector",s,r)})}}},{"./dom":"fqaW9","option-validator":"eaJBf","../scheme":"3izFE","./property":"5ynPA","./error":"kNZvP","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"43BKT":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>({...u,tooltip:m.i18n.get("Fullscreen"),mounted:D=>{const{events:{proxy:S},icons:g,i18n:d}=m,i=(0,b.append)(D,g.fullscreenOn),f=(0,b.append)(D,g.fullscreenOff);(0,b.setStyle)(f,"display","none"),S(D,"click",()=>{m.fullscreen=!m.fullscreen}),m.on("fullscreen",o=>{o?((0,b.tooltip)(D,d.get("Exit Fullscreen")),(0,b.setStyle)(i,"display","none"),(0,b.setStyle)(f,"display","inline-flex")):((0,b.tooltip)(D,d.get("Fullscreen")),(0,b.setStyle)(i,"display","inline-flex"),(0,b.setStyle)(f,"display","none"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kQJHz:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>({...u,tooltip:m.i18n.get("Web Fullscreen"),mounted:D=>{const{events:{proxy:S},icons:g,i18n:d}=m,i=(0,b.append)(D,g.fullscreenWebOn),f=(0,b.append)(D,g.fullscreenWebOff);(0,b.setStyle)(f,"display","none"),S(D,"click",()=>{m.fullscreenWeb=!m.fullscreenWeb}),m.on("fullscreenWeb",o=>{o?((0,b.tooltip)(D,d.get("Exit Web Fullscreen")),(0,b.setStyle)(i,"display","none"),(0,b.setStyle)(f,"display","inline-flex")):((0,b.tooltip)(D,d.get("Web Fullscreen")),(0,b.setStyle)(i,"display","inline-flex"),(0,b.setStyle)(f,"display","none"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aWne0:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>({...u,tooltip:m.i18n.get("PIP Mode"),mounted:D=>{const{events:{proxy:S},icons:g,i18n:d}=m;(0,b.append)(D,g.pip),S(D,"click",()=>{m.pip=!m.pip}),m.on("pip",i=>{(0,b.tooltip)(D,d.get(i?"Exit PIP Mode":"PIP Mode"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4z78f":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>({...u,mounted:D=>{const{events:{proxy:S},icons:g,i18n:d}=m,i=(0,b.append)(D,g.play),f=(0,b.append)(D,g.pause);function o(){(0,b.setStyle)(i,"display","flex"),(0,b.setStyle)(f,"display","none")}function v(){(0,b.setStyle)(i,"display","none"),(0,b.setStyle)(f,"display","flex")}(0,b.tooltip)(i,d.get("Play")),(0,b.tooltip)(f,d.get("Pause")),S(i,"click",()=>{m.play()}),S(f,"click",()=>{m.pause()}),m.playing?v():o(),m.on("video:playing",()=>{v()}),m.on("video:pause",()=>{o()})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"19nwD":[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E),b.export(E,"getPosFromEvent",()=>m);var u=M("../utils");function m(D,S){const{$progress:g}=D.template,{left:d}=g.getBoundingClientRect(),i=S.pageX,f=(0,u.clamp)(i-d,0,g.clientWidth),o=f/g.clientWidth*D.duration;return{second:o,time:(0,u.secondToTime)(o),width:f,percentage:(0,u.clamp)(f/g.clientWidth,0,1)}}E.default=function(D){return S=>{const{icons:g,option:d,events:{proxy:i}}=S;return{...D,html:'<div class="art-control-progress-inner"><div class="art-progress-loaded"></div><div class="art-progress-played"></div><div class="art-progress-highlight"></div><div class="art-progress-indicator"></div><div class="art-progress-tip"></div></div>',mounted:f=>{let o=!1;const v=(0,u.query)(".art-progress-loaded",f),c=(0,u.query)(".art-progress-played",f),h=(0,u.query)(".art-progress-highlight",f),t=(0,u.query)(".art-progress-indicator",f),e=(0,u.query)(".art-progress-tip",f);(0,u.setStyle)(c,"backgroundColor","var(--theme)");let n=S.constructor.INDICATOR_SIZE;function r(l,s){l==="loaded"&&(0,u.setStyle)(v,"width",100*s+"%"),l==="played"&&((0,u.setStyle)(c,"width",100*s+"%"),(0,u.setStyle)(t,"left",`calc(${100*s}% - ${n/2}px)`))}g.indicator?(n=S.constructor.INDICATOR_SIZE_ICON,(0,u.append)(t,g.indicator)):(0,u.setStyles)(t,{backgroundColor:"var(--theme)"}),u.isMobile&&(n=S.constructor.INDICATOR_SIZE_MOBILE,g.indicator&&(n=S.constructor.INDICATOR_SIZE_MOBILE_ICON)),(0,u.setStyles)(t,{left:`-${n/2}px`,width:`${n}px`,height:`${n}px`}),S.on("video:loadedmetadata",()=>{for(let l=0;l<d.highlight.length;l++){const s=d.highlight[l],a=(0,u.clamp)(s.time,0,S.duration)/S.duration*100;(0,u.append)(h,`<span data-text="${s.text}" data-time="${s.time}" style="left: ${a}%"></span>`)}}),r("loaded",S.loaded),S.on("setBar",(l,s)=>{r(l,s)}),S.on("video:progress",()=>{r("loaded",S.loaded)}),S.on("video:timeupdate",()=>{r("played",S.played)}),S.on("video:ended",()=>{r("played",1)}),u.isMobile||(i(f,"click",l=>{if(l.target!==t){const{second:s,percentage:a}=m(S,l);r("played",a),S.seek=s}}),i(f,"mousemove",l=>{(0,u.setStyle)(e,"display","block"),(0,u.includeFromEvent)(l,h)?function(s){const{width:a}=m(S,s),{text:p}=s.target.dataset;e.innerHTML=p;const A=e.clientWidth;a<=A/2?(0,u.setStyle)(e,"left",0):a>f.clientWidth-A/2?(0,u.setStyle)(e,"left",f.clientWidth-A+"px"):(0,u.setStyle)(e,"left",a-A/2+"px")}(l):function(s){const{width:a,time:p}=m(S,s);e.innerHTML=p;const A=e.clientWidth;a<=A/2?(0,u.setStyle)(e,"left",0):a>f.clientWidth-A/2?(0,u.setStyle)(e,"left",f.clientWidth-A+"px"):(0,u.setStyle)(e,"left",a-A/2+"px")}(l)}),i(f,"mouseout",()=>{(0,u.setStyle)(e,"display","none")}),i(t,"mousedown",()=>{o=!0}),i(document,"mousemove",l=>{if(o){const{second:s,percentage:a}=m(S,l);r("played",a),S.seek=s}}),i(document,"mouseup",()=>{o&&(o=!1)}))}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],lh90q:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>({...u,style:{cursor:"auto"},mounted:D=>{function S(){const d=`${(0,b.secondToTime)(m.currentTime)} / ${(0,b.secondToTime)(m.duration)}`;d!==D.innerText&&(D.innerText=d)}S();const g=["video:loadedmetadata","video:timeupdate","video:progress"];for(let d=0;d<g.length;d++)m.on(g[d],S)}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hsA6A:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>({...u,mounted:D=>{const{events:{proxy:S},icons:g,i18n:d}=m;let i=!1;const f=m.constructor.VOLUME_PANEL_WIDTH,o=m.constructor.VOLUME_HANDLE_WIDTH,v=(0,b.append)(D,g.volume),c=(0,b.append)(D,g.volumeClose),h=(0,b.append)(D,'<div class="art-volume-panel"></div>'),t=(0,b.append)(h,'<div class="art-volume-slider-handle"></div>');function e(r){const{left:l}=h.getBoundingClientRect();return(0,b.clamp)(r.pageX-l-o/2,0,f-o/2)/(f-o)}function n(r=.7){if(m.muted||r===0)(0,b.setStyle)(v,"display","none"),(0,b.setStyle)(c,"display","flex"),(0,b.setStyle)(t,"left","0");else{const l=(f-o)*r;(0,b.setStyle)(v,"display","flex"),(0,b.setStyle)(c,"display","none"),(0,b.setStyle)(t,"left",`${l}px`)}}(0,b.tooltip)(v,d.get("Mute")),(0,b.setStyle)(c,"display","none"),b.isMobile&&(0,b.setStyle)(h,"display","none"),n(m.volume),m.on("video:volumechange",()=>{n(m.volume)}),S(v,"click",()=>{m.muted=!0}),S(c,"click",()=>{m.muted=!1}),S(h,"click",r=>{m.muted=!1,m.volume=e(r)}),S(t,"mousedown",()=>{i=!0}),S(D,"mousemove",r=>{i&&(m.muted=!1,m.volume=e(r))}),S(document,"mouseup",()=>{i&&(i=!1)})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4rv3i":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>({...u,tooltip:m.i18n.get("Show Setting"),mounted:D=>{const{events:{proxy:S},icons:g,i18n:d}=m;(0,b.append)(D,g.setting),S(D,"click",()=>{m.setting.toggle=!0}),m.on("setting",i=>{(0,b.tooltip)(D,d.get(i?"Hide Setting":"Show Setting"))})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],lTgvI:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils"),u=M("./progress");E.default=function(m){return D=>({...m,mounted:S=>{const{option:g,template:{$progress:d,$video:i},events:{proxy:f,loadImg:o}}=D;let v=null,c=!1,h=!1;f(d,"mousemove",async t=>{c||(c=!0,v=await o(g.thumbnails.url),h=!0),h&&((0,b.setStyle)(S,"display","block"),function(e){const{width:n}=(0,u.getPosFromEvent)(D,e),{url:r,number:l,column:s,width:a,height:p}=g.thumbnails,A=a||v.naturalWidth/s,_=p||A/(i.videoWidth/i.videoHeight),y=d.clientWidth/l,L=Math.floor(n/y),x=Math.ceil(L/s)-1,T=L%s||s-1;(0,b.setStyle)(S,"backgroundImage",`url(${r})`),(0,b.setStyle)(S,"height",`${_}px`),(0,b.setStyle)(S,"width",`${A}px`),(0,b.setStyle)(S,"backgroundPosition",`-${T*A}px -${x*_}px`),n<=A/2?(0,b.setStyle)(S,"left",0):n>d.clientWidth-A/2?(0,b.setStyle)(S,"left",d.clientWidth-A+"px"):(0,b.setStyle)(S,"left",n-A/2+"px")}(t))}),f(d,"mouseout",()=>{(0,b.setStyle)(S,"display","none")})}})}},{"../utils":"5yYFo","./progress":"19nwD","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"71GuX":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>({...u,tooltip:m.i18n.get("Screenshot"),mounted:D=>{const{events:{proxy:S},icons:g}=m;(0,b.append)(D,g.screenshot),S(D,"click",()=>{m.screenshot()})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],f9VNW:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E),E.default=function(b){return u=>{const m=u.option.quality,D=m.find(S=>S.default)||m[0];return{...b,html:D?D.html:"",selector:m,onSelect(S){u.switchQuality(S.url,S.html)}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],d1O2Q:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>({...u,mounted:D=>{const S=(0,b.append)(D,'<span class="art-loop-point"></span>'),g=(0,b.append)(D,'<span class="art-loop-point"></span>');m.on("loop",d=>{d?((0,b.setStyle)(D,"display","block"),(0,b.setStyle)(S,"left",`calc(${d[0]/m.duration*100}% - ${S.clientWidth}px)`),(0,b.setStyle)(g,"left",d[1]/m.duration*100+"%")):(0,b.setStyle)(D,"display","none")})}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aIzPt:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>({...u,tooltip:m.i18n.get("AirPlay"),mounted:D=>{const{events:{proxy:S},icons:g}=m;(0,b.append)(D,g.airplay),S(D,"click",()=>m.airplay())}})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hTnNz:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("../utils"),m=M("../utils/component"),D=b.interopDefault(m),S=M("./playbackRate"),g=b.interopDefault(S),d=M("./aspectRatio"),i=b.interopDefault(d),f=M("./flip"),o=b.interopDefault(f),v=M("./info"),c=b.interopDefault(v),h=M("./version"),t=b.interopDefault(h),e=M("./close"),n=b.interopDefault(e);class r extends D.default{constructor(s){super(s),this.name="contextmenu",this.$parent=s.template.$contextmenu,u.isMobile||this.init()}init(){const{option:s,template:{$player:a,$contextmenu:p},events:{proxy:A}}=this.art;s.playbackRate&&this.add((0,g.default)({name:"playbackRate",index:10})),s.aspectRatio&&this.add((0,i.default)({name:"aspectRatio",index:20})),s.flip&&this.add((0,o.default)({name:"flip",index:30})),this.add((0,c.default)({name:"info",index:40})),this.add((0,t.default)({name:"version",index:50})),this.add((0,n.default)({name:"close",index:60}));for(let _=0;_<s.contextmenu.length;_++)this.add(s.contextmenu[_]);A(a,"contextmenu",_=>{_.preventDefault(),this.show=!0;const y=_.clientX,L=_.clientY,{height:x,width:T,left:O,top:R}=a.getBoundingClientRect(),{height:I,width:C}=p.getBoundingClientRect();let w=y-O,F=L-R;y+C>O+T&&(w=T-C),L+I>R+x&&(F=x-I),(0,u.setStyles)(p,{top:`${F}px`,left:`${w}px`})}),A(a,"click",_=>{(0,u.includeFromEvent)(_,p)||(this.show=!1)}),this.art.on("blur",()=>{this.show=!1})}}E.default=r},{"../utils":"5yYFo","../utils/component":"5MLcx","./playbackRate":"1uTBJ","./aspectRatio":"cFKj0","./flip":"l7S3g","./info":"ihHBb","./version":"3q8wK","./close":"sLP7j","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1uTBJ":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>{const{i18n:D}=m;return{...u,html:`${D.get("Play Speed")}:<span data-value="0.5">0.5</span><span data-value="0.75">0.75</span><span data-value="1.0" class="art-current">${D.get("Normal")}</span><span data-value="1.25">1.25</span><span data-value="1.5">1.5</span><span data-value="2.0">2.0</span>`,click:(S,g)=>{const{value:d}=g.target.dataset;d&&(m.playbackRate=Number(d),S.show=!1)},mounted:S=>{m.on("playbackRate",g=>{const d=(0,b.queryAll)("span",S).find(i=>Number(i.dataset.value)===g);d&&(0,b.inverseClass)(d,"art-current")})}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cFKj0:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>{const{i18n:D}=m;return{...u,html:`${D.get("Aspect Ratio")}:<span data-value="default" class="art-current">${D.get("Default")}</span><span data-value="4:3">4:3</span><span data-value="16:9">16:9</span>`,click:(S,g)=>{const{value:d}=g.target.dataset;d&&(m.aspectRatio=d,S.show=!1)},mounted:S=>{m.on("aspectRatio",g=>{const d=(0,b.queryAll)("span",S).find(i=>i.dataset.value===g);d&&(0,b.inverseClass)(d,"art-current")})}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],l7S3g:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){return m=>{const{i18n:D}=m;return{...u,html:`${D.get("Video Flip")}:<span data-value="normal" class="art-current">${D.get("Normal")}</span><span data-value="horizontal">${D.get("Horizontal")}</span><span data-value="vertical">${D.get("Vertical")}</span>`,click:(S,g)=>{const{value:d}=g.target.dataset;d&&(m.flip=d,S.show=!1)},mounted:S=>{m.on("flip",g=>{const d=(0,b.queryAll)("span",S).find(i=>i.dataset.value===g);d&&(0,b.inverseClass)(d,"art-current")})}}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ihHBb:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E),E.default=function(b){return u=>({...b,html:u.i18n.get("Video Info"),click:m=>{u.info.show=!0,m.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"3q8wK":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E),E.default=function(b){return{...b,html:'<a href="https://artplayer.org" target="_blank">ArtPlayer 4.5.4</a>'}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],sLP7j:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E),E.default=function(b){return u=>({...b,html:u.i18n.get("Close"),click:m=>{m.show=!1}})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bfwuE:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("./utils"),m=M("./utils/component"),D=b.interopDefault(m);class S extends D.default{constructor(d){super(d),this.name="info",u.isMobile||this.init()}init(){const{constructor:d,events:{proxy:i},template:{$infoPanel:f,$infoClose:o,$video:v}}=this.art;i(o,"click",()=>{this.show=!1});let c=null;const h=(0,u.queryAll)("[data-video]",f)||[];this.art.on("destroy",()=>{clearTimeout(c)}),function t(){for(let e=0;e<h.length;e++){const n=h[e],r=v[n.dataset.video],l=typeof r=="number"?r.toFixed(2):r;n.innerText!==l&&(n.innerText=l)}c=setTimeout(t,d.INFO_LOOP_TIME)}()}}E.default=S},{"./utils":"5yYFo","./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bWZ2U:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("./utils"),m=M("./utils/component"),D=b.interopDefault(m),S=M("option-validator"),g=b.interopDefault(S),d=M("./scheme"),i=b.interopDefault(d);class f extends D.default{constructor(v){super(v),this.name="subtitle",this.init(v.option.subtitle)}get url(){return this.art.template.$track.src}set url(v){this.switch(v)}get textTrack(){return this.art.template.$video.textTracks[0]}get activeCue(){return this.textTrack.activeCues[0]}style(v,c){const{$subtitle:h}=this.art.template;return typeof v=="object"?(0,u.setStyles)(h,v):(0,u.setStyle)(h,v,c)}update(){const{$subtitle:v}=this.art.template;v.innerHTML="",this.activeCue&&(v.innerHTML=this.activeCue.text.split(/\r?\n/).map(c=>`<p>${(0,u.escape)(c)}</p>`).join(""),this.art.emit("subtitleUpdate",this.activeCue.text))}async switch(v,c={}){const{i18n:h,notice:t,option:e}=this.art,n={...e.subtitle,...c,url:v},r=await this.init(n);return c.name&&(t.show=`${h.get("Switch Subtitle")}: ${c.name}`),r}init(v){if((0,g.default)(v,i.default.subtitle),!v.url)return;const{notice:c,events:{proxy:h},template:{$subtitle:t,$video:e,$track:n}}=this.art;if(!n){const r=document.createElement("track");r.default=!0,r.kind="metadata",e.appendChild(r),this.art.template.$track=r,h(this.textTrack,"cuechange",this.update.bind(this))}return this.style(v.style),(0,u.errorHandle)(window.fetch,"fetch not support"),fetch(v.url).then(r=>r.arrayBuffer()).then(r=>{(0,u.errorHandle)(window.TextDecoder,"TextDecoder not support");const l=new TextDecoder(v.encoding).decode(r);switch(this.art.emit("subtitleLoad",v.url),v.type||(0,u.getExt)(v.url)){case"srt":return(0,u.vttToBlob)((0,u.srtToVtt)(l));case"ass":return(0,u.vttToBlob)((0,u.assToVtt)(l));case"vtt":return(0,u.vttToBlob)(l);default:return v.url}}).then(r=>(t.innerHTML="",this.url===r||(URL.revokeObjectURL(this.url),this.art.template.$track.src=r,this.art.emit("subtitleSwitch",r)),r)).catch(r=>{throw c.show=r,r})}}E.default=f},{"./utils":"5yYFo","./utils/component":"5MLcx","option-validator":"eaJBf","./scheme":"3izFE","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"9oLaG":[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("../utils/error"),m=M("./clickInit"),D=b.interopDefault(m),S=M("./hoverInit"),g=b.interopDefault(S),d=M("./mousemoveInit"),i=b.interopDefault(d),f=M("./resizeInit"),o=b.interopDefault(f),v=M("./gestureInit"),c=b.interopDefault(v),h=M("./viewInit"),t=b.interopDefault(h);E.default=class{constructor(e){this.destroyEvents=[],this.proxy=this.proxy.bind(this),this.hover=this.hover.bind(this),this.loadImg=this.loadImg.bind(this),e.whitelist.state&&((0,D.default)(e,this),(0,g.default)(e,this),(0,i.default)(e,this),(0,o.default)(e,this),(0,c.default)(e,this),(0,t.default)(e,this))}proxy(e,n,r,l={}){if(Array.isArray(n))return n.map(a=>this.proxy(e,a,r,l));e.addEventListener(n,r,l);const s=()=>e.removeEventListener(n,r,l);return this.destroyEvents.push(s),s}hover(e,n,r){n&&this.proxy(e,"mouseenter",n),r&&this.proxy(e,"mouseleave",r)}loadImg(e){return new Promise((n,r)=>{let l;if(e instanceof HTMLImageElement)l=e;else{if(typeof e!="string")return r(new u.ArtPlayerError("Unable to get Image"));l=new Image,l.src=e}if(l.complete)return n(l);this.proxy(l,"load",()=>n(l)),this.proxy(l,"error",()=>r(new u.ArtPlayerError(`Failed to load Image: ${l.src}`)))})}destroy(){for(let e=0;e<this.destroyEvents.length;e++)this.destroyEvents[e]()}}},{"../utils/error":"kNZvP","./clickInit":"hrnqi","./hoverInit":"eIqcL","./mousemoveInit":"hEy8X","./resizeInit":"9c8lQ","./gestureInit":"gzHdo","./viewInit":"cJlT5","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hrnqi:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u,m){const{constructor:D,template:{$player:S,$video:g}}=u;m.proxy(document,["click","contextmenu"],i=>{(0,b.includeFromEvent)(i,S)?(u.isInput=i.target.tagName==="INPUT",u.isFocus=!0,u.emit("focus")):(u.isInput=!1,u.isFocus=!1,u.emit("blur"))});let d=0;m.proxy(g,"click",()=>{const i=Date.now();i-d<=D.DB_CLICE_TIME?(u.emit("dblclick"),b.isMobile?u.isLock||u.toggle():u.fullscreen=!u.fullscreen):(u.emit("click"),b.isMobile||u.toggle()),d=i})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eIqcL:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u,m){const{$player:D}=u.template;m.hover(D,()=>{(0,b.addClass)(D,"art-hover"),u.emit("hover",!0)},()=>{(0,b.removeClass)(D,"art-hover"),u.emit("hover")})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],hEy8X:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E),E.default=function(b,u){const{$player:m}=b.template;u.proxy(m,"mousemove",D=>{b.emit("mousemove",D)})}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"9c8lQ":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u,m){const{option:D}=u,S=(0,b.throttle)(()=>{u.normalSize&&(u.autoSize=D.autoSize),u.aspectRatioReset=!0,u.notice.show="",u.emit("resize")},u.constructor.RESIZE_TIME);m.proxy(window,["orientationchange","resize"],()=>{S()}),screen&&screen.orientation&&screen.orientation.onchange&&m.proxy(screen.orientation,"change",()=>{S()})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gzHdo:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u,m){if(b.isMobile&&!u.option.isLive){const{$video:D,$bottom:S,$controls:g}=u.template;let d=!1,i=0,f=0,o=0;const v=t=>{if(t.touches.length===1&&!u.isLock){d=!0;const{clientX:e,clientY:n}=t.touches[0];i=e,f=n,o=u.currentTime}},c=t=>{if(t.touches.length===1&&d&&u.duration){const e=u.plugins.autoOrientation&&u.plugins.autoOrientation.state,{clientX:n,clientY:r}=t.touches[0],l=(0,b.clamp)((n-i)/u.width,-1,1),s=(0,b.clamp)((r-f)/u.height,-1,1),a=e?s:l,p=(0,b.clamp)(o+u.duration*a*u.constructor.TOUCH_MOVE_RATIO,0,u.duration);u.seek=p,u.emit("setBar","played",(0,b.clamp)(p/u.duration,0,1)),u.notice.show=`${(0,b.secondToTime)(p)} / ${(0,b.secondToTime)(u.duration)}`}},h=()=>{d&&(i=0,f=0,o=0,d=!1)};m.proxy(S,"touchstart",t=>{(0,b.includeFromEvent)(t,g)||v(t)}),m.proxy(S,"touchmove",c),m.proxy(D,"touchstart",v),m.proxy(D,"touchmove",c),m.proxy(document,"touchend",h)}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cJlT5:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u,m){const{option:D,constructor:S,template:{$container:g}}=u,d=(0,b.throttle)(()=>{u.emit("view",(0,b.isInViewport)(g,S.SCROLL_GAP))},S.SCROLL_TIME);m.proxy(window,"scroll",()=>{d()}),u.on("view",i=>{D.autoMini&&(u.mini=!i)})}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],cKO4X:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("./utils");E.default=class{constructor(u){this.art=u,this.keys={},u.option.hotkey&&!b.isMobile&&this.init()}init(){const{proxy:u}=this.art.events;this.add(27,()=>{this.art.fullscreenWeb&&(this.art.fullscreenWeb=!1)}),this.add(32,()=>{this.art.toggle()}),this.add(37,()=>{this.art.backward=5}),this.add(38,()=>{this.art.volume+=.1}),this.add(39,()=>{this.art.forward=5}),this.add(40,()=>{this.art.volume-=.1}),u(window,"keydown",m=>{if(this.art.isFocus){const D=document.activeElement.tagName.toUpperCase(),S=document.activeElement.getAttribute("contenteditable");if(D!=="INPUT"&&D!=="TEXTAREA"&&S!==""&&S!=="true"){const g=this.keys[m.keyCode];if(g){m.preventDefault();for(let d=0;d<g.length;d++)g[d].call(this.art,m);this.art.emit("hotkey",m)}}}})}add(u,m){return this.keys[u]?this.keys[u].push(m):this.keys[u]=[m],this}remove(u,m){if(this.keys[u]){const D=this.keys[u].indexOf(m);D!==-1&&this.keys[u].splice(D,1)}return this}}},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],kZD92:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("./utils/component"),m=b.interopDefault(u);class D extends m.default{constructor(g){super(g);const{option:d,template:{$layer:i}}=g;this.name="layer",this.$parent=i;for(let f=0;f<d.layers.length;f++)this.add(d.layers[f])}}E.default=D},{"./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],c9b9e:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("./utils"),m=M("./utils/component"),D=b.interopDefault(m);class S extends D.default{constructor(d){super(d),this.name="loading",(0,u.append)(d.template.$loading,d.icons.loading)}}E.default=S},{"./utils":"5yYFo","./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],SxQeL:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("./utils");E.default=class{constructor(u){this.art=u,this.timer=null}set show(u){const{constructor:m,template:{$player:D,$noticeInner:S}}=this.art;u?(S.innerText=u instanceof Error?u.message.trim():u,(0,b.addClass)(D,"art-notice-show"),clearTimeout(this.timer),this.timer=setTimeout(()=>{S.innerText="",(0,b.removeClass)(D,"art-notice-show")},m.NOTICE_TIME)):(0,b.removeClass)(D,"art-notice-show")}}},{"./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aJ0dF:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("./utils"),m=M("./utils/component"),D=b.interopDefault(m);class S extends D.default{constructor(d){super(d),this.name="mask";const{template:i,icons:f,events:o}=d,v=(0,u.append)(i.$state,f.state),c=(0,u.append)(i.$state,f.error);(0,u.setStyle)(c,"display","none"),d.on("destroy",()=>{(0,u.setStyle)(v,"display","none"),(0,u.setStyle)(c,"display",null)}),o.proxy(i.$state,"click",()=>d.play())}}E.default=S},{"./utils":"5yYFo","./utils/component":"5MLcx","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],jx1Wu:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("../utils"),m=M("bundle-text:./loading.svg"),D=b.interopDefault(m),S=M("bundle-text:./state.svg"),g=b.interopDefault(S),d=M("bundle-text:./check.svg"),i=b.interopDefault(d),f=M("bundle-text:./play.svg"),o=b.interopDefault(f),v=M("bundle-text:./pause.svg"),c=b.interopDefault(v),h=M("bundle-text:./volume.svg"),t=b.interopDefault(h),e=M("bundle-text:./volume-close.svg"),n=b.interopDefault(e),r=M("bundle-text:./screenshot.svg"),l=b.interopDefault(r),s=M("bundle-text:./setting.svg"),a=b.interopDefault(s),p=M("bundle-text:./arrow-left.svg"),A=b.interopDefault(p),_=M("bundle-text:./arrow-right.svg"),y=b.interopDefault(_),L=M("bundle-text:./playback-rate.svg"),x=b.interopDefault(L),T=M("bundle-text:./aspect-ratio.svg"),O=b.interopDefault(T),R=M("bundle-text:./config.svg"),I=b.interopDefault(R),C=M("bundle-text:./pip.svg"),w=b.interopDefault(C),F=M("bundle-text:./lock.svg"),B=b.interopDefault(F),k=M("bundle-text:./unlock.svg"),U=b.interopDefault(k),N=M("bundle-text:./fullscreen-off.svg"),j=b.interopDefault(N),K=M("bundle-text:./fullscreen-on.svg"),H=b.interopDefault(K),V=M("bundle-text:./fullscreen-web-off.svg"),G=b.interopDefault(V),ee=M("bundle-text:./fullscreen-web-on.svg"),q=b.interopDefault(ee),z=M("bundle-text:./switch-on.svg"),X=b.interopDefault(z),J=M("bundle-text:./switch-off.svg"),ie=b.interopDefault(J),ae=M("bundle-text:./flip.svg"),se=b.interopDefault(ae),le=M("bundle-text:./error.svg"),ue=b.interopDefault(le),Z=M("bundle-text:./close.svg"),oe=b.interopDefault(Z),de=M("bundle-text:./airplay.svg"),ce=b.interopDefault(de);E.default=class{constructor(ve){const he={loading:D.default,state:g.default,play:o.default,pause:c.default,check:i.default,volume:t.default,volumeClose:n.default,screenshot:l.default,setting:a.default,pip:w.default,arrowLeft:A.default,arrowRight:y.default,playbackRate:x.default,aspectRatio:O.default,config:I.default,lock:B.default,flip:se.default,unlock:U.default,fullscreenOff:j.default,fullscreenOn:H.default,fullscreenWebOff:G.default,fullscreenWebOn:q.default,switchOn:X.default,switchOff:ie.default,error:ue.default,close:oe.default,airplay:ce.default,...ve.option.icons};Object.keys(he).forEach(ye=>{(0,u.def)(this,ye,{get:()=>{const fe=document.createElement("i");return(0,u.addClass)(fe,"art-icon"),(0,u.addClass)(fe,`art-icon-${ye}`),(0,u.append)(fe,he[ye]),fe}})})}}},{"../utils":"5yYFo","bundle-text:./loading.svg":"gFMCI","bundle-text:./state.svg":"iYMJD","bundle-text:./check.svg":"hyrDV","bundle-text:./play.svg":"eZys6","bundle-text:./pause.svg":"hITjK","bundle-text:./volume.svg":"hNNiX","bundle-text:./volume-close.svg":"dC2M2","bundle-text:./screenshot.svg":"9hKk0","bundle-text:./setting.svg":"47p50","bundle-text:./arrow-left.svg":"5je49","bundle-text:./arrow-right.svg":"2HKZ5","bundle-text:./playback-rate.svg":"hdBpQ","bundle-text:./aspect-ratio.svg":"alUG1","bundle-text:./config.svg":"6B4Bn","bundle-text:./pip.svg":"2Ya1d","bundle-text:./lock.svg":"5Bna4","bundle-text:./unlock.svg":"daCyz","bundle-text:./fullscreen-off.svg":"bx7Yh","bundle-text:./fullscreen-on.svg":"fxY8n","bundle-text:./fullscreen-web-off.svg":"96euD","bundle-text:./fullscreen-web-on.svg":"ccnBB","bundle-text:./switch-on.svg":"26OlL","bundle-text:./switch-off.svg":"i0DjT","bundle-text:./flip.svg":"hdfqR","bundle-text:./error.svg":"9sWnY","bundle-text:./close.svg":"hxSqS","bundle-text:./airplay.svg":"52Tr6","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],gFMCI:[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" class="uil-default"><path fill="none" class="bk" d="M0 0h100v100H0z"/><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="translate(0 -30)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-1s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(30 105.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.9166666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(60 75.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.8333333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(90 65 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.75s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(120 58.66 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(150 54.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5833333333333334s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(180 50 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.5s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-150 45.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.4166666666666667s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-120 41.34 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-90 35 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.25s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-60 24.02 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.16666666666666666s" repeatCount="indefinite"/></rect><rect x="47" y="40" width="6" height="20" rx="5" ry="5" fill="#fff" transform="rotate(-30 -5.98 65)"><animate attributeName="opacity" from="1" to="0" dur="1s" begin="-0.08333333333333333s" repeatCount="indefinite"/></rect></svg>'},{}],iYMJD:[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="60" width="60" style="filter:drop-shadow(0 1px 1px #000)" viewBox="0 0 24 24"><path d="M20 2H4C1.8 2 0 3.8 0 6v12c0 2.2 1.8 4 4 4h16c2.2 0 4-1.8 4-4V6c0-2.2-1.8-4-4-4zm-4.4 10.8L10.5 16c-.6.5-1.5 0-1.5-.8V8.8c0-.8.9-1.3 1.5-.8l5.1 3.2c.7.3.7 1.3 0 1.6z"/></svg>'},{}],hyrDV:[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" style="width:100%;height:100%"><path d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z" fill="#fff"/></svg>'},{}],eZys6:[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M17.982 9.275 8.06 3.27A2.013 2.013 0 0 0 5 4.994v12.011a2.017 2.017 0 0 0 3.06 1.725l9.922-6.005a2.017 2.017 0 0 0 0-3.45z"/></svg>'},{}],hITjK:[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M7 3a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2zm8 0a2 2 0 0 0-2 2v12a2 2 0 1 0 4 0V5a2 2 0 0 0-2-2z"/></svg>'},{}],hNNiX:[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M10.188 4.65 6 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39V5.04a.498.498 0 0 0-.812-.39zm4.258-.872a1 1 0 0 0-.862 1.804 6.002 6.002 0 0 1-.007 10.838 1 1 0 0 0 .86 1.806A8.001 8.001 0 0 0 19 11a8.001 8.001 0 0 0-4.554-7.222z"/><path d="M15 11a3.998 3.998 0 0 0-2-3.465v6.93A3.998 3.998 0 0 0 15 11z"/></svg>'},{}],dC2M2:[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><path d="M15 11a3.998 3.998 0 0 0-2-3.465v2.636l1.865 1.865A4.02 4.02 0 0 0 15 11z"/><path d="M13.583 5.583A5.998 5.998 0 0 1 17 11a6 6 0 0 1-.585 2.587l1.477 1.477a8.001 8.001 0 0 0-3.446-11.286 1 1 0 0 0-.863 1.805zm5.195 13.195-2.121-2.121-1.414-1.414-1.415-1.415L13 13l-2-2-3.889-3.889-3.889-3.889a.999.999 0 1 0-1.414 1.414L5.172 8H5a2 2 0 0 0-2 2v2a2 2 0 0 0 2 2h1l4.188 3.35a.5.5 0 0 0 .812-.39v-3.131l2.587 2.587-.01.005a1 1 0 0 0 .86 1.806c.215-.102.424-.214.627-.333l2.3 2.3a1.001 1.001 0 0 0 1.414-1.416zM11 5.04a.5.5 0 0 0-.813-.39L8.682 5.854 11 8.172V5.04z"/></svg>'},{}],"9hKk0":[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22" viewBox="0 0 50 50"><path d="M19.402 6a5 5 0 0 0-4.902 4.012L14.098 12H9a5 5 0 0 0-5 5v21a5 5 0 0 0 5 5h32a5 5 0 0 0 5-5V17a5 5 0 0 0-5-5h-5.098l-.402-1.988A5 5 0 0 0 30.598 6ZM25 17c5.52 0 10 4.48 10 10s-4.48 10-10 10-10-4.48-10-10 4.48-10 10-10Zm0 2c-4.41 0-8 3.59-8 8s3.59 8 8 8 8-3.59 8-8-3.59-8-8-8Z"/></svg>'},{}],"47p50":[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" height="22" width="22"><circle cx="11" cy="11" r="2"/><path d="M19.164 8.861 17.6 8.6a6.978 6.978 0 0 0-1.186-2.099l.574-1.533a1 1 0 0 0-.436-1.217l-1.997-1.153a1.001 1.001 0 0 0-1.272.23l-1.008 1.225a7.04 7.04 0 0 0-2.55.001L8.716 2.829a1 1 0 0 0-1.272-.23L5.447 3.751a1 1 0 0 0-.436 1.217l.574 1.533A6.997 6.997 0 0 0 4.4 8.6l-1.564.261A.999.999 0 0 0 2 9.847v2.306c0 .489.353.906.836.986l1.613.269a7 7 0 0 0 1.228 2.075l-.558 1.487a1 1 0 0 0 .436 1.217l1.997 1.153c.423.244.961.147 1.272-.23l1.04-1.263a7.089 7.089 0 0 0 2.272 0l1.04 1.263a1 1 0 0 0 1.272.23l1.997-1.153a1 1 0 0 0 .436-1.217l-.557-1.487c.521-.61.94-1.31 1.228-2.075l1.613-.269a.999.999 0 0 0 .835-.986V9.847a.999.999 0 0 0-.836-.986zM11 15a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/></svg>'},{}],"5je49":[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="m19.41 20.09-4.58-4.59 4.58-4.59L18 9.5l-6 6 6 6z" fill="#fff"/></svg>'},{}],"2HKZ5":[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="m12.59 20.34 4.58-4.59-4.58-4.59L14 9.75l6 6-6 6z" fill="#fff"/></svg>'},{}],hdBpQ:[function(M,P,E){P.exports='<svg height="24" width="24"><path d="M10 8v8l6-4-6-4zM6.3 5l-.6-.8C7.2 3 9 2.2 11 2l.1 1c-1.8.2-3.4.9-4.8 2zM5 6.3l-.8-.6C3 7.2 2.2 9 2 11l1 .1c.2-1.8.9-3.4 2-4.8zm0 11.4c-1.1-1.4-1.8-3.1-2-4.8L2 13c.2 2 1 3.8 2.2 5.4l.8-.7zm6.1 3.3c-1.8-.2-3.4-.9-4.8-2l-.6.8C7.2 21 9 21.8 11 22l.1-1zM22 12c0-5.2-3.9-9.4-9-10l-.1 1c4.6.5 8.1 4.3 8.1 9s-3.5 8.5-8.1 9l.1 1c5.2-.5 9-4.8 9-10z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],alUG1:[function(M,P,E){P.exports=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 88 88" style="width:100%;height:100%;transform:translate(0,0)"><defs><clipPath id="__lottie_element_216"><path d="M0 0h88v88H0z"/></clipPath></defs><g style="display:block" clip-path="url('#__lottie_element_216')"><path fill="#FFF" d="m12.438-12.702-2.82 2.82c-.79.79-.79 2.05 0 2.83l7.07 7.07-7.07 7.07c-.79.79-.79 2.05 0 2.83l2.82 2.83c.79.78 2.05.78 2.83 0l11.32-11.31c.78-.78.78-2.05 0-2.83l-11.32-11.31c-.78-.79-2.04-.79-2.83 0zm-24.88 0c-.74-.74-1.92-.78-2.7-.12l-.13.12-11.31 11.31a2 2 0 0 0-.12 2.7l.12.13 11.31 11.31a2 2 0 0 0 2.7.12l.13-.12 2.83-2.83c.74-.74.78-1.91.11-2.7l-.11-.13-7.07-7.07 7.07-7.07c.74-.74.78-1.91.11-2.7l-.11-.13-2.83-2.82zM28-28c4.42 0 8 3.58 8 8v40c0 4.42-3.58 8-8 8h-56c-4.42 0-8-3.58-8-8v-40c0-4.42 3.58-8 8-8h56z" style="--darkreader-inline-fill:#a8a6a4" transform="translate(44 44)"/></g></svg>`},{}],"6B4Bn":[function(M,P,E){P.exports='<svg height="24" width="24"><path d="M15 17h6v1h-6v-1zm-4 0H3v1h8v2h1v-5h-1v2zm3-9h1V3h-1v2H3v1h11v2zm4-3v1h3V5h-3zM6 14h1V9H6v2H3v1h3v2zm4-2h11v-1H10v1z" fill="#fff" style="--darkreader-inline-fill:#a8a6a4"/></svg>'},{}],"2Ya1d":[function(M,P,E){P.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36" height="32" width="32"><path d="M25 17h-8v6h8v-6Zm4 8V10.98C29 9.88 28.1 9 27 9H9c-1.1 0-2 .88-2 1.98V25c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2Zm-2 .02H9V10.97h18v14.05Z"/></svg>'},{}],"5Bna4":[function(M,P,E){P.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="M298.667 426.667v-85.334a213.333 213.333 0 1 1 426.666 0v85.334H768A85.333 85.333 0 0 1 853.333 512v256A85.333 85.333 0 0 1 768 853.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667zM512 213.333a128 128 0 0 0-128 128v85.334h256v-85.334a128 128 0 0 0-128-128z" fill="#fff"/></svg>'},{}],daCyz:[function(M,P,E){P.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path d="m666.752 194.517-49.365 74.112A128 128 0 0 0 384 341.333l.043 85.334h384A85.333 85.333 0 0 1 853.376 512v256a85.333 85.333 0 0 1-85.333 85.333H256A85.333 85.333 0 0 1 170.667 768V512A85.333 85.333 0 0 1 256 426.667h42.667v-85.334a213.333 213.333 0 0 1 368.085-146.816z" fill="#fff"/></svg>'},{}],bx7Yh:[function(M,P,E){P.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M768 298.667h170.667V384h-256V128H768v170.667zM341.333 384h-256v-85.333H256V128h85.333v256zM768 725.333V896h-85.333V640h256v85.333H768zM341.333 640v256H256V725.333H85.333V640h256z"/></svg>'},{}],fxY8n:[function(M,P,E){P.exports='<svg class="icon" width="22" height="22" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M625.778 256H768v142.222h113.778v-256h-256V256zM256 398.222V256h142.222V142.222h-256v256H256zm512 227.556V768H625.778v113.778h256v-256H768zM398.222 768H256V625.778H142.222v256h256V768z"/></svg>'},{}],"96euD":[function(M,P,E){P.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zM896 512a64 64 0 0 1 7.488 127.552L896 640H768v128a64 64 0 0 1-56.512 63.552L704 832a64 64 0 0 1-63.552-56.512L640 768V582.592c0-34.496 25.024-66.112 61.632-70.208l8-.384H896zm-640 0a64 64 0 0 1-7.488-127.552L256 384h128V256a64 64 0 0 1 56.512-63.552L448 192a64 64 0 0 1 63.552 56.512L512 256v185.408c0 34.432-25.024 66.112-61.632 70.144l-8 .448H256z"/></svg>'},{}],ccnBB:[function(M,P,E){P.exports='<svg class="icon" width="18" height="18" viewBox="0 0 1152 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M1075.2 0H76.8A76.8 76.8 0 0 0 0 76.8v870.4a76.8 76.8 0 0 0 76.8 76.8h998.4a76.8 76.8 0 0 0 76.8-76.8V76.8A76.8 76.8 0 0 0 1075.2 0zM1024 128v768H128V128h896zm-576 64a64 64 0 0 1 7.488 127.552L448 320H320v128a64 64 0 0 1-56.512 63.552L256 512a64 64 0 0 1-63.552-56.512L192 448V262.592c0-34.432 25.024-66.112 61.632-70.144l8-.448H448zm256 640a64 64 0 0 1-7.488-127.552L704 704h128V576a64 64 0 0 1 56.512-63.552L896 512a64 64 0 0 1 63.552 56.512L960 576v185.408c0 34.496-25.024 66.112-61.632 70.208l-8 .384H704z"/></svg>'},{}],"26OlL":[function(M,P,E){P.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1664 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#648FFC" d="M1152 0H512a512 512 0 0 0 0 1024h640a512 512 0 0 0 0-1024zm0 960a448 448 0 1 1 448-448 448 448 0 0 1-448 448z"/></svg>'},{}],i0DjT:[function(M,P,E){P.exports='<svg class="icon" width="26" height="26" viewBox="0 0 1740 1024" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M511.898 1024h670.515c282.419-.41 511.18-229.478 511.18-511.898 0-282.419-228.761-511.488-511.18-511.897H511.898C229.478.615.717 229.683.717 512.102c0 282.42 228.761 511.488 511.18 511.898zm-.564-975.36A464.589 464.589 0 1 1 48.026 513.024 463.872 463.872 0 0 1 511.334 48.435v.205z"/></svg>'},{}],hdfqR:[function(M,P,E){P.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M554.667 810.667V896h-85.334v-85.333h85.334zm-384-632.662a42.667 42.667 0 0 1 34.986 18.219l203.904 291.328a42.667 42.667 0 0 1 0 48.896L205.611 827.776A42.667 42.667 0 0 1 128 803.328V220.672a42.667 42.667 0 0 1 42.667-42.667zm682.666 0a42.667 42.667 0 0 1 42.368 37.718l.299 4.949v582.656a42.667 42.667 0 0 1-74.24 28.63l-3.413-4.182-203.904-291.328a42.667 42.667 0 0 1-3.03-43.861l3.03-5.035 203.946-291.328a42.667 42.667 0 0 1 34.944-18.219zM554.667 640v85.333h-85.334V640h85.334zm-358.4-320.896V716.8L335.957 512 196.31 319.104zm358.4 150.23v85.333h-85.334v-85.334h85.334zm0-170.667V384h-85.334v-85.333h85.334zm0-170.667v85.333h-85.334V128h85.334z" fill="#fff"/></svg>'},{}],"9sWnY":[function(M,P,E){P.exports='<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="50" height="50"><path d="M593.818 168.55 949.82 763.76c26.153 43.746 10.732 99.738-34.447 125.052-14.397 8.069-30.72 12.308-47.37 12.308H155.976c-52.224 0-94.536-40.96-94.536-91.505 0-16.097 4.383-31.928 12.718-45.875l356.004-595.19c26.173-43.724 84.009-58.654 129.208-33.341a93.082 93.082 0 0 1 34.448 33.341zM512 819.2a61.44 61.44 0 1 0 0-122.88 61.44 61.44 0 0 0 0 122.88zm0-512a72.315 72.315 0 0 0-71.762 81.306l25.723 205.721a46.408 46.408 0 0 0 92.078 0l25.723-205.742A72.315 72.315 0 0 0 512 307.2z"/></svg>'},{}],hxSqS:[function(M,P,E){P.exports='<svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="m571.733 512 268.8-268.8c17.067-17.067 17.067-42.667 0-59.733-17.066-17.067-42.666-17.067-59.733 0L512 452.267l-268.8-268.8c-17.067-17.067-42.667-17.067-59.733 0-17.067 17.066-17.067 42.666 0 59.733l268.8 268.8-268.8 268.8c-17.067 17.067-17.067 42.667 0 59.733 8.533 8.534 19.2 12.8 29.866 12.8s21.334-4.266 29.867-12.8l268.8-268.8 268.8 268.8c8.533 8.534 19.2 12.8 29.867 12.8s21.333-4.266 29.866-12.8c17.067-17.066 17.067-42.666 0-59.733L571.733 512z"/></svg>'},{}],"52Tr6":[function(M,P,E){P.exports='<svg width="18" height="18" xmlns="http://www.w3.org/2000/svg"><g fill="#fff"><path d="M16 1H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h3v-2H3V3h12v8h-2v2h3a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1Z"/><path d="M4 17h10l-5-6z"/></g></svg>'},{}],hdF39:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("./flip"),m=b.interopDefault(u),D=M("./aspectRatio"),S=b.interopDefault(D),g=M("./playbackRate"),d=b.interopDefault(g),i=M("./subtitleOffset"),f=b.interopDefault(i),o=M("../utils/component"),v=b.interopDefault(o),c=M("../utils");function h(n,r,l){for(let s=0;s<n.length;s++){const a=n[s];a.$parentItem=r,a.$parentList=l,a.selector&&h(a.selector,a,n)}return n}function t(n){return["string","number"].includes(typeof n)}class e extends v.default{constructor(r){super(r);const{option:l,events:{proxy:s},template:{$setting:a,$player:p}}=r;if(this.name="setting",this.$parent=a,this.option=[],this.events=[],this.cache=new Map,l.setting){l.playbackRate&&this.option.push((0,d.default)(r)),l.aspectRatio&&this.option.push((0,S.default)(r)),l.flip&&this.option.push((0,m.default)(r)),l.subtitleOffset&&this.option.push((0,f.default)(r));for(let A=0;A<l.settings.length;A++)this.option.push(l.settings[A]);this.option=h(this.option),this.init(this.option),r.on("blur",()=>{this.show&&(this.show=!1,this.init(this.option))}),s(p,"click",A=>{!this.show||(0,c.includeFromEvent)(A,r.controls.setting)||(0,c.includeFromEvent)(A,this.$parent)||(this.show=!1,this.init(this.option))})}}add(r){typeof r=="function"?this.option.push(r(this.art)):this.option.push(r),this.cache=new Map,this.events.forEach(l=>l()),this.events=[],this.$parent.innerHTML="",this.option=h(this.option),this.init(this.option)}creatHeader(r){const{icons:l,events:{proxy:s}}=this.art,a=document.createElement("div");(0,c.addClass)(a,"art-setting-item"),(0,c.addClass)(a,"art-setting-item-back");const p=(0,c.append)(a,'<div class="art-setting-item-left"></div>'),A=document.createElement("div");(0,c.addClass)(A,"art-setting-item-left-icon"),(0,c.append)(A,l.arrowLeft),(0,c.append)(p,A),(0,c.append)(p,r.$parentItem.html);const _=s(a,"click",()=>{this.init(r.$parentList)});return this.events.push(_),a}creatItem(r,l){const{icons:s,events:{proxy:a}}=this.art,p=document.createElement("div");(0,c.addClass)(p,"art-setting-item"),t(l.name)&&(p.dataset.name=l.name),t(l.value)&&(p.dataset.value=l.value);const A=(0,c.append)(p,'<div class="art-setting-item-left"></div>'),_=(0,c.append)(p,'<div class="art-setting-item-right"></div>'),y=document.createElement("div");switch((0,c.addClass)(y,"art-setting-item-left-icon"),r){case"switch":case"range":(0,c.append)(y,t(l.icon)||l.icon instanceof Element?l.icon:s.config);break;case"selector":l.selector&&l.selector.length?(0,c.append)(y,t(l.icon)||l.icon instanceof Element?l.icon:s.config):(0,c.append)(y,s.check)}(0,c.append)(A,y),l.$icon=y,(0,c.def)(l,"icon",{configurable:!0,get:()=>y.innerHTML,set(T){t(T)&&(y.innerHTML=T)}});const L=document.createElement("div");(0,c.addClass)(L,"art-setting-item-left-text"),(0,c.append)(L,l.html||""),(0,c.append)(A,L),l.$html=L,(0,c.def)(l,"html",{configurable:!0,get:()=>L.innerHTML,set(T){t(T)&&(L.innerHTML=T)}});const x=document.createElement("div");switch((0,c.addClass)(x,"art-setting-item-right-tooltip"),(0,c.append)(x,l.tooltip||""),(0,c.append)(_,x),l.$tooltip=x,(0,c.def)(l,"tooltip",{configurable:!0,get:()=>x.innerHTML,set(T){t(T)&&(x.innerHTML=T)}}),r){case"switch":{const T=document.createElement("div");(0,c.addClass)(T,"art-setting-item-right-icon");const O=(0,c.append)(T,s.switchOn),R=(0,c.append)(T,s.switchOff);(0,c.setStyle)(l.switch?R:O,"display","none"),(0,c.append)(_,T),l.$switch=l.switch,(0,c.def)(l,"switch",{configurable:!0,get:()=>l.$switch,set(I){l.$switch=I,I?((0,c.setStyle)(R,"display","none"),(0,c.setStyle)(O,"display",null)):((0,c.setStyle)(R,"display",null),(0,c.setStyle)(O,"display","none"))}});break}case"range":{const T=document.createElement("div");(0,c.addClass)(T,"art-setting-item-right-icon");const O=(0,c.append)(T,'<input type="range">');O.value=l.range[0]||0,O.min=l.range[1]||0,O.max=l.range[2]||10,O.step=l.range[3]||1,(0,c.addClass)(O,"art-setting-range"),(0,c.append)(_,T),l.$range=O,(0,c.def)(l,"range",{configurable:!0,get:()=>O.valueAsNumber,set(R){O.value=Number(R)}})}break;case"selector":if(l.selector&&l.selector.length){const T=document.createElement("div");(0,c.addClass)(T,"art-setting-item-right-icon"),(0,c.append)(T,s.arrowRight),(0,c.append)(_,T)}}switch(r){case"switch":if(l.onSwitch){const T=a(p,"click",async O=>{l.switch=await l.onSwitch.call(this.art,l,p,O)});this.events.push(T)}break;case"range":if(l.onRange&&l.$range){const T=a(l.$range,"change",async O=>{l.tooltip=await l.onRange.call(this.art,l,p,O)});this.events.push(T)}break;case"selector":{const T=a(p,"click",async O=>{if(l.selector&&l.selector.length)this.init(l.selector,l.width);else if((0,c.inverseClass)(p,"art-current"),l.$parentList&&this.init(l.$parentList),l.$parentItem&&l.$parentItem.onSelect){const R=await l.$parentItem.onSelect.call(this.art,l,p,O);l.$parentItem.$tooltip&&t(R)&&(l.$parentItem.$tooltip.innerHTML=R)}});this.events.push(T),l.default&&(0,c.addClass)(p,"art-current")}}return p}init(r,l){const{constructor:s}=this.art;if(this.cache.has(r)){const a=this.cache.get(r);(0,c.inverseClass)(a,"art-current"),(0,c.setStyle)(this.$parent,"width",`${a.dataset.width}px`),(0,c.setStyle)(this.$parent,"height",`${a.dataset.height}px`)}else{const a=document.createElement("div");(0,c.addClass)(a,"art-setting-panel"),a.dataset.width=l||s.SETTING_WIDTH,a.dataset.height=r.length*s.SETTING_ITEM_HEIGHT,r[0]&&r[0].$parentItem&&((0,c.append)(a,this.creatHeader(r[0])),a.dataset.height=Number(a.dataset.height)+s.SETTING_ITEM_HEIGHT);for(let p=0;p<r.length;p++){const A=r[p];(0,c.has)(A,"switch")?(0,c.append)(a,this.creatItem("switch",A)):(0,c.has)(A,"range")?(0,c.append)(a,this.creatItem("range",A)):(0,c.append)(a,this.creatItem("selector",A))}(0,c.append)(this.$parent,a),this.cache.set(r,a),(0,c.inverseClass)(a,"art-current"),(0,c.setStyle)(this.$parent,"width",`${a.dataset.width}px`),(0,c.setStyle)(this.$parent,"height",`${a.dataset.height}px`),r[0]&&r[0].$parentItem&&r[0].$parentItem.mounted&&r[0].$parentItem.mounted.call(this.art,a,r[0].$parentItem)}}}E.default=e},{"./flip":"eyzeE","./aspectRatio":"jTfLi","./playbackRate":"aowja","./subtitleOffset":"aPjJK","../utils/component":"5MLcx","../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eyzeE:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{i18n:m,icons:D,constructor:S}=u,g={normal:"Normal",horizontal:"Horizontal",vertical:"Vertical"};function d(i,f,o){f&&(f.innerText=m.get(g[o]));const v=(0,b.queryAll)(".art-setting-item",i).find(c=>c.dataset.value===o);v&&(0,b.inverseClass)(v,"art-current")}return{width:S.SETTING_ITEM_WIDTH,html:m.get("Video Flip"),tooltip:m.get(g[u.flip]),icon:D.flip,selector:Object.keys(g).map(i=>({value:i,default:i===u.flip,html:m.get(g[i])})),onSelect(i){u.flip=i.value},mounted:(i,f)=>{d(i,f.$tooltip,u.flip),u.on("flip",()=>{d(i,f.$tooltip,u.flip)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],jTfLi:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{i18n:m,icons:D,constructor:S}=u;function g(i){return i==="default"?m.get("Default"):i}function d(i,f,o){f&&(f.innerText=g(o));const v=(0,b.queryAll)(".art-setting-item",i).find(c=>c.dataset.value===o);v&&(0,b.inverseClass)(v,"art-current")}return{width:S.SETTING_ITEM_WIDTH,html:m.get("Aspect Ratio"),icon:D.aspectRatio,tooltip:g(u.aspectRatio),selector:["default","4:3","16:9"].map(i=>({value:i,default:i===u.aspectRatio,html:g(i)})),onSelect(i){u.aspectRatio=i.value},mounted:(i,f)=>{d(i,f.$tooltip,u.aspectRatio),u.on("aspectRatio",()=>{d(i,f.$tooltip,u.aspectRatio)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aowja:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{i18n:m,icons:D,constructor:S}=u;function g(i){return i===1?m.get("Normal"):i}function d(i,f,o){f&&(f.innerText=g(o));const v=(0,b.queryAll)(".art-setting-item",i).find(c=>Number(c.dataset.value)===o);v&&(0,b.inverseClass)(v,"art-current")}return{width:S.SETTING_ITEM_WIDTH,html:m.get("Play Speed"),tooltip:g(u.playbackRate),icon:D.playbackRate,selector:[.5,.75,1,1.25,1.5,2].map(i=>({value:i,default:i===u.playbackRate,html:g(i)})),onSelect(i){u.playbackRate=i.value},mounted:(i,f)=>{d(i,f.$tooltip,u.playbackRate),u.on("playbackRate",()=>{d(i,f.$tooltip,u.playbackRate)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],aPjJK:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{i18n:m,icons:D,constructor:S}=u;function g(i){return i===0?m.get("Normal"):i}function d(i,f,o){f&&(f.innerText=g(o));const v=(0,b.queryAll)(".art-setting-item",i).find(c=>Number(c.dataset.value)===o);v&&(0,b.inverseClass)(v,"art-current")}return{width:S.SETTING_ITEM_WIDTH,html:m.get("Subtitle Offset"),tooltip:g(u.subtitleOffset),icon:D.subtitle,selector:[-5,-4,-3,-2,-1,0,1,2,3,4,5].map(i=>({value:i,default:i===u.subtitleOffset,html:g(i)})),onSelect(i){u.subtitleOffset=i.value},mounted:(i,f)=>{d(i,f.$tooltip,u.subtitleOffset),u.on("subtitleOffset",()=>{d(i,f.$tooltip,u.subtitleOffset)})}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bCcu0:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E),E.default=class{constructor(){this.name="artplayer_settings",this.settings={}}get(b){try{const u=JSON.parse(window.localStorage.getItem(this.name))||{};return b?u[b]:u}catch{return b?this.settings[b]:this.settings}}set(b,u){try{const m=Object.assign({},this.get(),{[b]:u});window.localStorage.setItem(this.name,JSON.stringify(m))}catch{this.settings[b]=u}}del(b){try{const u=this.get();delete u[b],window.localStorage.setItem(this.name,JSON.stringify(u))}catch{delete this.settings[b]}}clear(){try{window.localStorage.removeItem(this.name)}catch{this.settings={}}}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1v13t":[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("../utils"),m=M("./miniProgressBar"),D=b.interopDefault(m),S=M("./autoOrientation"),g=b.interopDefault(S),d=M("./autoPlayback"),i=b.interopDefault(d),f=M("./fastForward"),o=b.interopDefault(f),v=M("./lock"),c=b.interopDefault(v);E.default=class{constructor(h){this.art=h,this.id=0;const{option:t}=h;t.miniProgressBar&&!t.isLive&&this.add(D.default),t.lock&&u.isMobile&&this.add(c.default),t.autoPlayback&&!t.isLive&&this.add(i.default),t.autoOrientation&&u.isMobile&&this.add(g.default),t.fastForward&&u.isMobile&&!t.isLive&&this.add(o.default);for(let e=0;e<t.plugins.length;e++)this.add(t.plugins[e])}add(h){this.id+=1;const t=h.call(this,this.art),e=t&&t.name||h.name||`plugin${this.id}`;return(0,u.errorHandle)(!(0,u.has)(this,e),`Cannot add a plugin that already has the same name: ${e}`),(0,u.def)(this,e,{value:t}),this}}},{"../utils":"5yYFo","./miniProgressBar":"2h4YZ","./autoOrientation":"bcdCk","./autoPlayback":"1nHHC","./fastForward":"4gkmX","./lock":"ij5nM","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"2h4YZ":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E),E.default=function(b){return b.on("ready",()=>{b.layers.add({name:"miniProgressBar",mounted(u){b.on("destroy",()=>{u.style.display="none"}),b.on("video:timeupdate",()=>{u.style.width=100*b.played+"%"}),b.on("setBar",(m,D)=>{m==="played"&&(u.style.width=100*D+"%")})}})}),{name:"miniProgressBar"}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],bcdCk:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{option:m,constructor:D,template:{$player:S,$video:g}}=u;return u.on("fullscreenWeb",d=>{if(d){const{videoWidth:i,videoHeight:f}=g,{clientWidth:o,clientHeight:v}=document.documentElement;(i>f&&o<v||i<f&&o>v)&&setTimeout(()=>{(0,b.setStyle)(S,"width",`${v}px`),(0,b.setStyle)(S,"height",`${o}px`),(0,b.setStyle)(S,"transform-origin","0 0"),(0,b.setStyle)(S,"transform",`rotate(90deg) translate(0, -${o}px)`),(0,b.addClass)(S,"art-auto-orientation"),u.emit("resize")},D.MOBILE_AUTO_ORIENTATION_TIME)}else(0,b.hasClass)(S,"art-auto-orientation")&&((0,b.setStyle)(S,"width",null),(0,b.setStyle)(S,"height",null),(0,b.setStyle)(S,"transform",null),(0,b.setStyle)(S,"transform-origin",null),(0,b.removeClass)(S,"art-auto-orientation"),u.aspectRatioReset=!0,u.autoSize=m.autoSize,u.notice.show="",u.emit("resize"))}),u.on("fullscreen",async d=>{const i=screen.orientation.type;if(d){const{videoWidth:f,videoHeight:o}=g,{clientWidth:v,clientHeight:c}=document.documentElement;if(f>o&&v<c||f<o&&v>c){const h=i.startsWith("portrait")?"landscape":"portrait";await screen.orientation.lock(h),(0,b.addClass)(S,"art-auto-orientation-fullscreen")}}else(0,b.hasClass)(S,"art-auto-orientation-fullscreen")&&(await screen.orientation.lock(i),(0,b.removeClass)(S,"art-auto-orientation-fullscreen"))}),{name:"autoOrientation",get state(){return(0,b.hasClass)(S,"art-auto-orientation")}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"1nHHC":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{i18n:m,icons:D,storage:S,constructor:g,events:{proxy:d},template:{$poster:i}}=u,f=u.layers.add({name:"autoPlayback",html:'<div class="art-autoPlayback-close"></div><div class="art-autoPlayback-last"></div><div class="art-autoPlayback-jump"></div>'}),o=(0,b.query)(".art-autoPlayback-last",f),v=(0,b.query)(".art-autoPlayback-jump",f),c=(0,b.query)(".art-autoPlayback-close",f);return u.on("video:timeupdate",()=>{const h=S.get("times")||{},t=Object.keys(h);t.length>g.AUTO_PLAYBACK_MAX&&delete h[t[0]],h[u.option.id||u.option.url]=u.currentTime,S.set("times",h)}),u.on("ready",()=>{const h=(S.get("times")||{})[u.option.id||u.option.url];h&&h>=g.AUTO_PLAYBACK_MIN&&((0,b.append)(c,D.close),(0,b.setStyle)(f,"display","flex"),o.innerText=`${m.get("Last Seen")} ${(0,b.secondToTime)(h)}`,v.innerText=m.get("Jump Play"),d(c,"click",()=>{(0,b.setStyle)(f,"display","none")}),d(v,"click",()=>{u.seek=h,u.play(),(0,b.setStyle)(i,"display","none"),(0,b.setStyle)(f,"display","none")}),u.once("video:timeupdate",()=>{setTimeout(()=>{(0,b.setStyle)(f,"display","none")},g.AUTO_PLAYBACK_TIMEOUT)}))}),{name:"autoPlayback",get times(){return S.get("times")||{}},clear:()=>S.del("times"),delete(h){const t=S.get("times")||{};return delete t[h],S.set("times",t),t}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],"4gkmX":[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{constructor:m,events:{proxy:D},template:{$player:S,$video:g}}=u;let d=null,i=!1;const f=()=>{clearTimeout(d),i&&(i=!1,u.playbackRate=1,(0,b.removeClass)(S,"art-fast-forward"))};return D(g,"touchstart",o=>{o.touches.length===1&&u.playing&&!u.isLock&&(d=setTimeout(()=>{i=!0,u.playbackRate=m.FAST_FORWARD_VALUE,(0,b.addClass)(S,"art-fast-forward")},m.FAST_FORWARD_TIME))}),D(document,"touchmove",f),D(document,"touchend",f),{name:"fastForward",get state(){return(0,b.hasClass)(S,"art-fast-forward")}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],ij5nM:[function(M,P,E){M("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(E);var b=M("../utils");E.default=function(u){const{layers:m,icons:D,template:{$player:S}}=u;return m.add({name:"lock",mounted(g){const d=(0,b.append)(g,D.lock),i=(0,b.append)(g,D.unlock);(0,b.setStyle)(d,"display","none"),u.on("lock",f=>{f?((0,b.setStyle)(d,"display","inline-flex"),(0,b.setStyle)(i,"display","none")):((0,b.setStyle)(d,"display","none"),(0,b.setStyle)(i,"display","inline-flex"))})},click(){(0,b.hasClass)(S,"art-lock")?((0,b.removeClass)(S,"art-lock"),this.isLock=!1,u.emit("lock",!1)):((0,b.addClass)(S,"art-lock"),this.isLock=!0,u.emit("lock",!0))}}),{name:"lock",get state(){return(0,b.hasClass)(S,"art-lock")}}}},{"../utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}],eD5Ch:[function(M,P,E){var b=M("@parcel/transformer-js/src/esmodule-helpers.js");b.defineInteropFlag(E);var u=M("./config"),m=b.interopDefault(u),D=M("./utils");E.default=class{constructor(S){const{option:g,events:{proxy:d},template:{$video:i}}=S;for(let v=0;v<m.default.events.length;v++)d(i,m.default.events[v],c=>{S.emit(`video:${c.type}`,c)});Object.keys(g.moreVideoAttr).forEach(v=>{i[v]=g.moreVideoAttr[v]}),g.muted&&(i.muted=g.muted),g.volume&&(i.volume=(0,D.clamp)(g.volume,0,1)),g.poster&&(i.poster=g.poster),g.autoplay&&(i.autoplay=g.autoplay),g.playsInline&&(i.playsInline=!0,i["webkit-playsinline"]=!0);const f=g.type||(0,D.getExt)(g.url),o=g.customType[f];f&&o?(o(i,g.url,S),S.emit("customType",f)):(i.src=g.url,S.emit("url",i.src))}}},{"./config":"ej4fZ","./utils":"5yYFo","@parcel/transformer-js/src/esmodule-helpers.js":"b7MJY"}]},["E13ST"],"E13ST")})(Ge);const ht=ke(Ge.exports);var He={exports:{}};(function(xe,Pe){(function(P,E){xe.exports=E()})(self,function(){return function(){var M={"./node_modules/es6-promise/dist/es6-promise.js":function(u,m,D){/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */(function(S,g){u.exports=g()})(this,function(){function S(W){var Y=typeof W;return W!==null&&(Y==="object"||Y==="function")}function g(W){return typeof W=="function"}var d=void 0;Array.isArray?d=Array.isArray:d=function(W){return Object.prototype.toString.call(W)==="[object Array]"};var i=d,f=0,o=void 0,v=void 0,c=function(Y,$){L[f]=Y,L[f+1]=$,f+=2,f===2&&(v?v(x):O())};function h(W){v=W}function t(W){c=W}var e=typeof window<"u"?window:void 0,n=e||{},r=n.MutationObserver||n.WebKitMutationObserver,l=typeof self>"u"&&typeof process<"u"&&{}.toString.call(process)==="[object process]",s=typeof Uint8ClampedArray<"u"&&typeof importScripts<"u"&&typeof MessageChannel<"u";function a(){return function(){return process.nextTick(x)}}function p(){return typeof o<"u"?function(){o(x)}:y()}function A(){var W=0,Y=new r(x),$=document.createTextNode("");return Y.observe($,{characterData:!0}),function(){$.data=W=++W%2}}function _(){var W=new MessageChannel;return W.port1.onmessage=x,function(){return W.port2.postMessage(0)}}function y(){var W=setTimeout;return function(){return W(x,1)}}var L=new Array(1e3);function x(){for(var W=0;W<f;W+=2){var Y=L[W],$=L[W+1];Y($),L[W]=void 0,L[W+1]=void 0}f=0}function T(){try{var W=Function("return this")().require("vertx");return o=W.runOnLoop||W.runOnContext,p()}catch{return y()}}var O=void 0;l?O=a():r?O=A():s?O=_():e===void 0?O=T():O=y();function R(W,Y){var $=this,Q=new this.constructor(w);Q[C]===void 0&&ue(Q);var re=$._state;if(re){var ne=arguments[re-1];c(function(){return ie(re,Q,ne,$._result)})}else X($,Q,W,Y);return Q}function I(W){var Y=this;if(W&&typeof W=="object"&&W.constructor===Y)return W;var $=new Y(w);return G($,W),$}var C=Math.random().toString(36).substring(2);function w(){}var F=void 0,B=1,k=2;function U(){return new TypeError("You cannot resolve a promise with itself")}function N(){return new TypeError("A promises callback cannot return that same promise.")}function j(W,Y,$,Q){try{W.call(Y,$,Q)}catch(re){return re}}function K(W,Y,$){c(function(Q){var re=!1,ne=j($,Y,function(te){re||(re=!0,Y!==te?G(Q,te):q(Q,te))},function(te){re||(re=!0,z(Q,te))},"Settle: "+(Q._label||" unknown promise"));!re&&ne&&(re=!0,z(Q,ne))},W)}function H(W,Y){Y._state===B?q(W,Y._result):Y._state===k?z(W,Y._result):X(Y,void 0,function($){return G(W,$)},function($){return z(W,$)})}function V(W,Y,$){Y.constructor===W.constructor&&$===R&&Y.constructor.resolve===I?H(W,Y):$===void 0?q(W,Y):g($)?K(W,Y,$):q(W,Y)}function G(W,Y){if(W===Y)z(W,U());else if(S(Y)){var $=void 0;try{$=Y.then}catch(Q){z(W,Q);return}V(W,Y,$)}else q(W,Y)}function ee(W){W._onerror&&W._onerror(W._result),J(W)}function q(W,Y){W._state===F&&(W._result=Y,W._state=B,W._subscribers.length!==0&&c(J,W))}function z(W,Y){W._state===F&&(W._state=k,W._result=Y,c(ee,W))}function X(W,Y,$,Q){var re=W._subscribers,ne=re.length;W._onerror=null,re[ne]=Y,re[ne+B]=$,re[ne+k]=Q,ne===0&&W._state&&c(J,W)}function J(W){var Y=W._subscribers,$=W._state;if(Y.length!==0){for(var Q=void 0,re=void 0,ne=W._result,te=0;te<Y.length;te+=3)Q=Y[te],re=Y[te+$],Q?ie($,Q,re,ne):re(ne);W._subscribers.length=0}}function ie(W,Y,$,Q){var re=g($),ne=void 0,te=void 0,Ee=!0;if(re){try{ne=$(Q)}catch(pe){Ee=!1,te=pe}if(Y===ne){z(Y,N());return}}else ne=Q;Y._state!==F||(re&&Ee?G(Y,ne):Ee===!1?z(Y,te):W===B?q(Y,ne):W===k&&z(Y,ne))}function ae(W,Y){try{Y(function(Q){G(W,Q)},function(Q){z(W,Q)})}catch($){z(W,$)}}var se=0;function le(){return se++}function ue(W){W[C]=se++,W._state=void 0,W._result=void 0,W._subscribers=[]}function Z(){return new Error("Array Methods must be provided an Array")}var oe=function(){function W(Y,$){this._instanceConstructor=Y,this.promise=new Y(w),this.promise[C]||ue(this.promise),i($)?(this.length=$.length,this._remaining=$.length,this._result=new Array(this.length),this.length===0?q(this.promise,this._result):(this.length=this.length||0,this._enumerate($),this._remaining===0&&q(this.promise,this._result))):z(this.promise,Z())}return W.prototype._enumerate=function($){for(var Q=0;this._state===F&&Q<$.length;Q++)this._eachEntry($[Q],Q)},W.prototype._eachEntry=function($,Q){var re=this._instanceConstructor,ne=re.resolve;if(ne===I){var te=void 0,Ee=void 0,pe=!1;try{te=$.then}catch(_e){pe=!0,Ee=_e}if(te===R&&$._state!==F)this._settledAt($._state,Q,$._result);else if(typeof te!="function")this._remaining--,this._result[Q]=$;else if(re===fe){var ge=new re(w);pe?z(ge,Ee):V(ge,$,te),this._willSettleAt(ge,Q)}else this._willSettleAt(new re(function(_e){return _e($)}),Q)}else this._willSettleAt(ne($),Q)},W.prototype._settledAt=function($,Q,re){var ne=this.promise;ne._state===F&&(this._remaining--,$===k?z(ne,re):this._result[Q]=re),this._remaining===0&&q(ne,this._result)},W.prototype._willSettleAt=function($,Q){var re=this;X($,void 0,function(ne){return re._settledAt(B,Q,ne)},function(ne){return re._settledAt(k,Q,ne)})},W}();function de(W){return new oe(this,W).promise}function ce(W){var Y=this;return i(W)?new Y(function($,Q){for(var re=W.length,ne=0;ne<re;ne++)Y.resolve(W[ne]).then($,Q)}):new Y(function($,Q){return Q(new TypeError("You must pass an array to race."))})}function ve(W){var Y=this,$=new Y(w);return z($,W),$}function he(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function ye(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var fe=function(){function W(Y){this[C]=le(),this._result=this._state=void 0,this._subscribers=[],w!==Y&&(typeof Y!="function"&&he(),this instanceof W?ae(this,Y):ye())}return W.prototype.catch=function($){return this.then(null,$)},W.prototype.finally=function($){var Q=this,re=Q.constructor;return g($)?Q.then(function(ne){return re.resolve($()).then(function(){return ne})},function(ne){return re.resolve($()).then(function(){throw ne})}):Q.then($,$)},W}();fe.prototype.then=R,fe.all=de,fe.race=ce,fe.resolve=I,fe.reject=ve,fe._setScheduler=h,fe._setAsap=t,fe._asap=c;function me(){var W=void 0;if(typeof D.g<"u")W=D.g;else if(typeof self<"u")W=self;else try{W=Function("return this")()}catch{throw new Error("polyfill failed because global object is unavailable in this environment")}var Y=W.Promise;if(Y){var $=null;try{$=Object.prototype.toString.call(Y.resolve())}catch{}if($==="[object Promise]"&&!Y.cast)return}W.Promise=fe}return fe.polyfill=me,fe.Promise=fe,fe})},"./node_modules/events/events.js":function(u){var m=typeof Reflect=="object"?Reflect:null,D=m&&typeof m.apply=="function"?m.apply:function(y,L,x){return Function.prototype.apply.call(y,L,x)},S;m&&typeof m.ownKeys=="function"?S=m.ownKeys:Object.getOwnPropertySymbols?S=function(y){return Object.getOwnPropertyNames(y).concat(Object.getOwnPropertySymbols(y))}:S=function(y){return Object.getOwnPropertyNames(y)};function g(_){console&&console.warn&&console.warn(_)}var d=Number.isNaN||function(y){return y!==y};function i(){i.init.call(this)}u.exports=i,u.exports.once=a,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var f=10;function o(_){if(typeof _!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof _)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(_){if(typeof _!="number"||_<0||d(_))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+_+".");f=_}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(y){if(typeof y!="number"||y<0||d(y))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+y+".");return this._maxListeners=y,this};function v(_){return _._maxListeners===void 0?i.defaultMaxListeners:_._maxListeners}i.prototype.getMaxListeners=function(){return v(this)},i.prototype.emit=function(y){for(var L=[],x=1;x<arguments.length;x++)L.push(arguments[x]);var T=y==="error",O=this._events;if(O!==void 0)T=T&&O.error===void 0;else if(!T)return!1;if(T){var R;if(L.length>0&&(R=L[0]),R instanceof Error)throw R;var I=new Error("Unhandled error."+(R?" ("+R.message+")":""));throw I.context=R,I}var C=O[y];if(C===void 0)return!1;if(typeof C=="function")D(C,this,L);else for(var w=C.length,F=r(C,w),x=0;x<w;++x)D(F[x],this,L);return!0};function c(_,y,L,x){var T,O,R;if(o(L),O=_._events,O===void 0?(O=_._events=Object.create(null),_._eventsCount=0):(O.newListener!==void 0&&(_.emit("newListener",y,L.listener?L.listener:L),O=_._events),R=O[y]),R===void 0)R=O[y]=L,++_._eventsCount;else if(typeof R=="function"?R=O[y]=x?[L,R]:[R,L]:x?R.unshift(L):R.push(L),T=v(_),T>0&&R.length>T&&!R.warned){R.warned=!0;var I=new Error("Possible EventEmitter memory leak detected. "+R.length+" "+String(y)+" listeners added. Use emitter.setMaxListeners() to increase limit");I.name="MaxListenersExceededWarning",I.emitter=_,I.type=y,I.count=R.length,g(I)}return _}i.prototype.addListener=function(y,L){return c(this,y,L,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(y,L){return c(this,y,L,!0)};function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function t(_,y,L){var x={fired:!1,wrapFn:void 0,target:_,type:y,listener:L},T=h.bind(x);return T.listener=L,x.wrapFn=T,T}i.prototype.once=function(y,L){return o(L),this.on(y,t(this,y,L)),this},i.prototype.prependOnceListener=function(y,L){return o(L),this.prependListener(y,t(this,y,L)),this},i.prototype.removeListener=function(y,L){var x,T,O,R,I;if(o(L),T=this._events,T===void 0)return this;if(x=T[y],x===void 0)return this;if(x===L||x.listener===L)--this._eventsCount===0?this._events=Object.create(null):(delete T[y],T.removeListener&&this.emit("removeListener",y,x.listener||L));else if(typeof x!="function"){for(O=-1,R=x.length-1;R>=0;R--)if(x[R]===L||x[R].listener===L){I=x[R].listener,O=R;break}if(O<0)return this;O===0?x.shift():l(x,O),x.length===1&&(T[y]=x[0]),T.removeListener!==void 0&&this.emit("removeListener",y,I||L)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(y){var L,x,T;if(x=this._events,x===void 0)return this;if(x.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):x[y]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete x[y]),this;if(arguments.length===0){var O=Object.keys(x),R;for(T=0;T<O.length;++T)R=O[T],R!=="removeListener"&&this.removeAllListeners(R);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(L=x[y],typeof L=="function")this.removeListener(y,L);else if(L!==void 0)for(T=L.length-1;T>=0;T--)this.removeListener(y,L[T]);return this};function e(_,y,L){var x=_._events;if(x===void 0)return[];var T=x[y];return T===void 0?[]:typeof T=="function"?L?[T.listener||T]:[T]:L?s(T):r(T,T.length)}i.prototype.listeners=function(y){return e(this,y,!0)},i.prototype.rawListeners=function(y){return e(this,y,!1)},i.listenerCount=function(_,y){return typeof _.listenerCount=="function"?_.listenerCount(y):n.call(_,y)},i.prototype.listenerCount=n;function n(_){var y=this._events;if(y!==void 0){var L=y[_];if(typeof L=="function")return 1;if(L!==void 0)return L.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?S(this._events):[]};function r(_,y){for(var L=new Array(y),x=0;x<y;++x)L[x]=_[x];return L}function l(_,y){for(;y+1<_.length;y++)_[y]=_[y+1];_.pop()}function s(_){for(var y=new Array(_.length),L=0;L<y.length;++L)y[L]=_[L].listener||_[L];return y}function a(_,y){return new Promise(function(L,x){function T(R){_.removeListener(y,O),x(R)}function O(){typeof _.removeListener=="function"&&_.removeListener("error",T),L([].slice.call(arguments))}A(_,y,O,{once:!0}),y!=="error"&&p(_,T,{once:!0})})}function p(_,y,L){typeof _.on=="function"&&A(_,"error",y,L)}function A(_,y,L,x){if(typeof _.on=="function")x.once?_.once(y,L):_.on(y,L);else if(typeof _.addEventListener=="function")_.addEventListener(y,function T(O){x.once&&_.removeEventListener(y,T),L(O)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof _)}},"./node_modules/webworkify-webpack/index.js":function(u,m,D){function S(h){var t={};function e(r){if(t[r])return t[r].exports;var l=t[r]={i:r,l:!1,exports:{}};return h[r].call(l.exports,l,l.exports,e),l.l=!0,l.exports}e.m=h,e.c=t,e.i=function(r){return r},e.d=function(r,l,s){e.o(r,l)||Object.defineProperty(r,l,{configurable:!1,enumerable:!0,get:s})},e.r=function(r){Object.defineProperty(r,"__esModule",{value:!0})},e.n=function(r){var l=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(l,"a",l),l},e.o=function(r,l){return Object.prototype.hasOwnProperty.call(r,l)},e.p="/",e.oe=function(r){throw console.error(r),r};var n=e(e.s=ENTRY_MODULE);return n.default||n}var g="[\\.|\\-|\\+|\\w|/|@]+",d="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+g+").*?\\)";function i(h){return(h+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function f(h){return!isNaN(1*h)}function o(h,t,e){var n={};n[e]=[];var r=t.toString(),l=r.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return n;for(var s=l[1],a=new RegExp("(\\\\n|\\W)"+i(s)+d,"g"),p;p=a.exec(r);)p[3]!=="dll-reference"&&n[e].push(p[3]);for(a=new RegExp("\\("+i(s)+'\\("(dll-reference\\s('+g+'))"\\)\\)'+d,"g");p=a.exec(r);)h[p[2]]||(n[e].push(p[1]),h[p[2]]=D(p[1]).m),n[p[2]]=n[p[2]]||[],n[p[2]].push(p[4]);for(var A=Object.keys(n),_=0;_<A.length;_++)for(var y=0;y<n[A[_]].length;y++)f(n[A[_]][y])&&(n[A[_]][y]=1*n[A[_]][y]);return n}function v(h){var t=Object.keys(h);return t.reduce(function(e,n){return e||h[n].length>0},!1)}function c(h,t){for(var e={main:[t]},n={main:[]},r={main:{}};v(e);)for(var l=Object.keys(e),s=0;s<l.length;s++){var a=l[s],p=e[a],A=p.pop();if(r[a]=r[a]||{},!(r[a][A]||!h[a][A])){r[a][A]=!0,n[a]=n[a]||[],n[a].push(A);for(var _=o(h,h[a][A],a),y=Object.keys(_),L=0;L<y.length;L++)e[y[L]]=e[y[L]]||[],e[y[L]]=e[y[L]].concat(_[y[L]])}}return n}u.exports=function(h,t){t=t||{};var e={main:D.m},n=t.all?{main:Object.keys(e.main)}:c(e,h),r="";Object.keys(n).filter(function(A){return A!=="main"}).forEach(function(A){for(var _=0;n[A][_];)_++;n[A].push(_),e[A][_]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",r=r+"var "+A+" = ("+S.toString().replace("ENTRY_MODULE",JSON.stringify(_))+")({"+n[A].map(function(y){return""+JSON.stringify(y)+": "+e[A][y].toString()}).join(",")+`});
`}),r=r+"new (("+S.toString().replace("ENTRY_MODULE",JSON.stringify(h))+")({"+n.main.map(function(A){return""+JSON.stringify(A)+": "+e.main[A].toString()}).join(",")+"}))(self);";var l=new window.Blob([r],{type:"text/javascript"});if(t.bare)return l;var s=window.URL||window.webkitURL||window.mozURL||window.msURL,a=s.createObjectURL(l),p=new window.Worker(a);return p.objectURL=a,p}},"./src/config.js":function(u,m,D){D.r(m),D.d(m,{defaultConfig:function(){return S},createDefaultConfig:function(){return g}});var S={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function g(){return Object.assign({},S)}},"./src/core/features.js":function(u,m,D){D.r(m);var S=D("./src/io/io-controller.js"),g=D("./src/config.js"),d=function(){function i(){}return i.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},i.supportNetworkStreamIO=function(){var f=new S.default({},(0,g.createDefaultConfig)()),o=f.loaderType;return f.destroy(),o=="fetch-stream-loader"||o=="xhr-moz-chunked-loader"},i.getNetworkLoaderTypeName=function(){var f=new S.default({},(0,g.createDefaultConfig)()),o=f.loaderType;return f.destroy(),o},i.supportNativeMediaPlayback=function(f){i.videoElement==null&&(i.videoElement=window.document.createElement("video"));var o=i.videoElement.canPlayType(f);return o==="probably"||o=="maybe"},i.getFeatureList=function(){var f={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return f.mseFlvPlayback=i.supportMSEH264Playback(),f.networkStreamIO=i.supportNetworkStreamIO(),f.networkLoaderName=i.getNetworkLoaderTypeName(),f.mseLiveFlvPlayback=f.mseFlvPlayback&&f.networkStreamIO,f.nativeMP4H264Playback=i.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),f.nativeWebmVP8Playback=i.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),f.nativeWebmVP9Playback=i.supportNativeMediaPlayback('video/webm; codecs="vp9"'),f},i}();m.default=d},"./src/core/media-info.js":function(u,m,D){D.r(m);var S=function(){function g(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return g.prototype.isComplete=function(){var d=this.hasAudio===!1||this.hasAudio===!0&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null,i=this.hasVideo===!1||this.hasVideo===!0&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&d&&i},g.prototype.isSeekable=function(){return this.hasKeyframesIndex===!0},g.prototype.getNearestKeyframe=function(d){if(this.keyframesIndex==null)return null;var i=this.keyframesIndex,f=this._search(i.times,d);return{index:f,milliseconds:i.times[f],fileposition:i.filepositions[f]}},g.prototype._search=function(d,i){var f=0,o=d.length-1,v=0,c=0,h=o;for(i<d[0]&&(f=0,c=h+1);c<=h;)if(v=c+Math.floor((h-c)/2),v===o||i>=d[v]&&i<d[v+1]){f=v;break}else d[v]<i?c=v+1:h=v-1;return f},g}();m.default=S},"./src/core/media-segment-info.js":function(u,m,D){D.r(m),D.d(m,{SampleInfo:function(){return S},MediaSegmentInfo:function(){return g},IDRSampleList:function(){return d},MediaSegmentInfoList:function(){return i}});var S=function(){function f(o,v,c,h,t){this.dts=o,this.pts=v,this.duration=c,this.originalDts=h,this.isSyncPoint=t,this.fileposition=null}return f}(),g=function(){function f(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return f.prototype.appendSyncPoint=function(o){o.isSyncPoint=!0,this.syncPoints.push(o)},f}(),d=function(){function f(){this._list=[]}return f.prototype.clear=function(){this._list=[]},f.prototype.appendArray=function(o){var v=this._list;o.length!==0&&(v.length>0&&o[0].originalDts<v[v.length-1].originalDts&&this.clear(),Array.prototype.push.apply(v,o))},f.prototype.getLastSyncPointBeforeDts=function(o){if(this._list.length==0)return null;var v=this._list,c=0,h=v.length-1,t=0,e=0,n=h;for(o<v[0].dts&&(c=0,e=n+1);e<=n;)if(t=e+Math.floor((n-e)/2),t===h||o>=v[t].dts&&o<v[t+1].dts){c=t;break}else v[t].dts<o?e=t+1:n=t-1;return this._list[c]},f}(),i=function(){function f(o){this._type=o,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),f.prototype.isEmpty=function(){return this._list.length===0},f.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},f.prototype._searchNearestSegmentBefore=function(o){var v=this._list;if(v.length===0)return-2;var c=v.length-1,h=0,t=0,e=c,n=0;if(o<v[0].originalBeginDts)return n=-1,n;for(;t<=e;)if(h=t+Math.floor((e-t)/2),h===c||o>v[h].lastSample.originalDts&&o<v[h+1].originalBeginDts){n=h;break}else v[h].originalBeginDts<o?t=h+1:e=h-1;return n},f.prototype._searchNearestSegmentAfter=function(o){return this._searchNearestSegmentBefore(o)+1},f.prototype.append=function(o){var v=this._list,c=o,h=this._lastAppendLocation,t=0;h!==-1&&h<v.length&&c.originalBeginDts>=v[h].lastSample.originalDts&&(h===v.length-1||h<v.length-1&&c.originalBeginDts<v[h+1].originalBeginDts)?t=h+1:v.length>0&&(t=this._searchNearestSegmentBefore(c.originalBeginDts)+1),this._lastAppendLocation=t,this._list.splice(t,0,c)},f.prototype.getLastSegmentBefore=function(o){var v=this._searchNearestSegmentBefore(o);return v>=0?this._list[v]:null},f.prototype.getLastSampleBefore=function(o){var v=this.getLastSegmentBefore(o);return v!=null?v.lastSample:null},f.prototype.getLastSyncPointBefore=function(o){for(var v=this._searchNearestSegmentBefore(o),c=this._list[v].syncPoints;c.length===0&&v>0;)v--,c=this._list[v].syncPoints;return c.length>0?c[c.length-1]:null},f}()},"./src/core/mse-controller.js":function(u,m,D){D.r(m);var S=D("./node_modules/events/events.js"),g=D.n(S),d=D("./src/utils/logger.js"),i=D("./src/utils/browser.js"),f=D("./src/core/mse-events.js"),o=D("./src/core/media-segment-info.js"),v=D("./src/utils/exception.js"),c=function(){function h(t){this.TAG="MSEController",this._config=t,this._emitter=new(g()),this._config.isLive&&this._config.autoCleanupSourceBuffer==null&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new o.IDRSampleList}return h.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},h.prototype.on=function(t,e){this._emitter.addListener(t,e)},h.prototype.off=function(t,e){this._emitter.removeListener(t,e)},h.prototype.attachMediaElement=function(t){if(this._mediaSource)throw new v.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var e=this._mediaSource=new window.MediaSource;e.addEventListener("sourceopen",this.e.onSourceOpen),e.addEventListener("sourceended",this.e.onSourceEnded),e.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=t,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),t.src=this._mediaSourceObjectURL},h.prototype.detachMediaElement=function(){if(this._mediaSource){var t=this._mediaSource;for(var e in this._sourceBuffers){var n=this._pendingSegments[e];n.splice(0,n.length),this._pendingSegments[e]=null,this._pendingRemoveRanges[e]=null,this._lastInitSegments[e]=null;var r=this._sourceBuffers[e];if(r){if(t.readyState!=="closed"){try{t.removeSourceBuffer(r)}catch(l){d.default.e(this.TAG,l.message)}r.removeEventListener("error",this.e.onSourceBufferError),r.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[e]=null,this._sourceBuffers[e]=null}}if(t.readyState==="open")try{t.endOfStream()}catch(l){d.default.e(this.TAG,l.message)}t.removeEventListener("sourceopen",this.e.onSourceOpen),t.removeEventListener("sourceended",this.e.onSourceEnded),t.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},h.prototype.appendInitSegment=function(t,e){if(!this._mediaSource||this._mediaSource.readyState!=="open"){this._pendingSourceBufferInit.push(t),this._pendingSegments[t.type].push(t);return}var n=t,r=""+n.container;n.codec&&n.codec.length>0&&(r+=";codecs="+n.codec);var l=!1;if(d.default.v(this.TAG,"Received Initialization Segment, mimeType: "+r),this._lastInitSegments[n.type]=n,r!==this._mimeTypes[n.type]){if(this._mimeTypes[n.type])d.default.v(this.TAG,"Notice: "+n.type+" mimeType changed, origin: "+this._mimeTypes[n.type]+", target: "+r);else{l=!0;try{var s=this._sourceBuffers[n.type]=this._mediaSource.addSourceBuffer(r);s.addEventListener("error",this.e.onSourceBufferError),s.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(a){d.default.e(this.TAG,a.message),this._emitter.emit(f.default.ERROR,{code:a.code,msg:a.message});return}}this._mimeTypes[n.type]=r}e||this._pendingSegments[n.type].push(n),l||this._sourceBuffers[n.type]&&!this._sourceBuffers[n.type].updating&&this._doAppendSegments(),i.default.safari&&n.container==="audio/mpeg"&&n.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=n.mediaDuration/1e3,this._updateMediaSourceDuration())},h.prototype.appendMediaSegment=function(t){var e=t;this._pendingSegments[e.type].push(e),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var n=this._sourceBuffers[e.type];n&&!n.updating&&!this._hasPendingRemoveRanges()&&this._doAppendSegments()},h.prototype.seek=function(t){for(var e in this._sourceBuffers)if(!!this._sourceBuffers[e]){var n=this._sourceBuffers[e];if(this._mediaSource.readyState==="open")try{n.abort()}catch(A){d.default.e(this.TAG,A.message)}this._idrList.clear();var r=this._pendingSegments[e];if(r.splice(0,r.length),this._mediaSource.readyState!=="closed"){for(var l=0;l<n.buffered.length;l++){var s=n.buffered.start(l),a=n.buffered.end(l);this._pendingRemoveRanges[e].push({start:s,end:a})}if(n.updating||this._doRemoveRanges(),i.default.safari){var p=this._lastInitSegments[e];p&&(this._pendingSegments[e].push(p),n.updating||this._doAppendSegments())}}}},h.prototype.endOfStream=function(){var t=this._mediaSource,e=this._sourceBuffers;if(!t||t.readyState!=="open"){t&&t.readyState==="closed"&&this._hasPendingSegments()&&(this._hasPendingEos=!0);return}e.video&&e.video.updating||e.audio&&e.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,t.endOfStream())},h.prototype.getNearestKeyframe=function(t){return this._idrList.getLastSyncPointBeforeDts(t)},h.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var n=this._sourceBuffers[e];if(n){var r=n.buffered;if(r.length>=1&&t-r.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},h.prototype._doCleanupSourceBuffer=function(){var t=this._mediaElement.currentTime;for(var e in this._sourceBuffers){var n=this._sourceBuffers[e];if(n){for(var r=n.buffered,l=!1,s=0;s<r.length;s++){var a=r.start(s),p=r.end(s);if(a<=t&&t<p+3){if(t-a>=this._config.autoCleanupMaxBackwardDuration){l=!0;var A=t-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[e].push({start:a,end:A})}}else p<t&&(l=!0,this._pendingRemoveRanges[e].push({start:a,end:p}))}l&&!n.updating&&this._doRemoveRanges()}}},h.prototype._updateMediaSourceDuration=function(){var t=this._sourceBuffers;if(!(this._mediaElement.readyState===0||this._mediaSource.readyState!=="open")&&!(t.video&&t.video.updating||t.audio&&t.audio.updating)){var e=this._mediaSource.duration,n=this._pendingMediaDuration;n>0&&(isNaN(e)||n>e)&&(d.default.v(this.TAG,"Update MediaSource duration from "+e+" to "+n),this._mediaSource.duration=n),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},h.prototype._doRemoveRanges=function(){for(var t in this._pendingRemoveRanges)if(!(!this._sourceBuffers[t]||this._sourceBuffers[t].updating))for(var e=this._sourceBuffers[t],n=this._pendingRemoveRanges[t];n.length&&!e.updating;){var r=n.shift();e.remove(r.start,r.end)}},h.prototype._doAppendSegments=function(){var t=this._pendingSegments;for(var e in t)if(!(!this._sourceBuffers[e]||this._sourceBuffers[e].updating)&&t[e].length>0){var n=t[e].shift();if(n.timestampOffset){var r=this._sourceBuffers[e].timestampOffset,l=n.timestampOffset/1e3,s=Math.abs(r-l);s>.1&&(d.default.v(this.TAG,"Update MPEG audio timestampOffset from "+r+" to "+l),this._sourceBuffers[e].timestampOffset=l),delete n.timestampOffset}if(!n.data||n.data.byteLength===0)continue;try{this._sourceBuffers[e].appendBuffer(n.data),this._isBufferFull=!1,e==="video"&&n.hasOwnProperty("info")&&this._idrList.appendArray(n.info.syncPoints)}catch(a){this._pendingSegments[e].unshift(n),a.code===22?(this._isBufferFull||this._emitter.emit(f.default.BUFFER_FULL),this._isBufferFull=!0):(d.default.e(this.TAG,a.message),this._emitter.emit(f.default.ERROR,{code:a.code,msg:a.message}))}}},h.prototype._onSourceOpen=function(){if(d.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var t=this._pendingSourceBufferInit;t.length;){var e=t.shift();this.appendInitSegment(e,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(f.default.SOURCE_OPEN)},h.prototype._onSourceEnded=function(){d.default.v(this.TAG,"MediaSource onSourceEnded")},h.prototype._onSourceClose=function(){d.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&this.e!=null&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},h.prototype._hasPendingSegments=function(){var t=this._pendingSegments;return t.video.length>0||t.audio.length>0},h.prototype._hasPendingRemoveRanges=function(){var t=this._pendingRemoveRanges;return t.video.length>0||t.audio.length>0},h.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(f.default.UPDATE_END)},h.prototype._onSourceBufferError=function(t){d.default.e(this.TAG,"SourceBuffer Error: "+t)},h}();m.default=c},"./src/core/mse-events.js":function(u,m,D){D.r(m);var S={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};m.default=S},"./src/core/transmuxer.js":function(u,m,D){D.r(m);var S=D("./node_modules/events/events.js"),g=D.n(S),d=D("./node_modules/webworkify-webpack/index.js"),i=D.n(d),f=D("./src/utils/logger.js"),o=D("./src/utils/logging-control.js"),v=D("./src/core/transmuxing-controller.js"),c=D("./src/core/transmuxing-events.js"),h=D("./src/core/media-info.js"),t=function(){function e(n,r){if(this.TAG="Transmuxer",this._emitter=new(g()),r.enableWorker&&typeof Worker<"u")try{this._worker=i()("./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[n,r]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},o.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:o.default.getConfig()})}catch{f.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new v.default(n,r)}else this._controller=new v.default(n,r);if(this._controller){var l=this._controller;l.on(c.default.IO_ERROR,this._onIOError.bind(this)),l.on(c.default.DEMUX_ERROR,this._onDemuxError.bind(this)),l.on(c.default.INIT_SEGMENT,this._onInitSegment.bind(this)),l.on(c.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),l.on(c.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),l.on(c.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),l.on(c.default.MEDIA_INFO,this._onMediaInfo.bind(this)),l.on(c.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),l.on(c.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),l.on(c.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),l.on(c.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return e.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),o.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(n,r){this._emitter.addListener(n,r)},e.prototype.off=function(n,r){this._emitter.removeListener(n,r)},e.prototype.hasWorker=function(){return this._worker!=null},e.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},e.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},e.prototype.seek=function(n){this._worker?this._worker.postMessage({cmd:"seek",param:n}):this._controller.seek(n)},e.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},e.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},e.prototype._onInitSegment=function(n,r){var l=this;Promise.resolve().then(function(){l._emitter.emit(c.default.INIT_SEGMENT,n,r)})},e.prototype._onMediaSegment=function(n,r){var l=this;Promise.resolve().then(function(){l._emitter.emit(c.default.MEDIA_SEGMENT,n,r)})},e.prototype._onLoadingComplete=function(){var n=this;Promise.resolve().then(function(){n._emitter.emit(c.default.LOADING_COMPLETE)})},e.prototype._onRecoveredEarlyEof=function(){var n=this;Promise.resolve().then(function(){n._emitter.emit(c.default.RECOVERED_EARLY_EOF)})},e.prototype._onMediaInfo=function(n){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.MEDIA_INFO,n)})},e.prototype._onMetaDataArrived=function(n){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.METADATA_ARRIVED,n)})},e.prototype._onScriptDataArrived=function(n){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.SCRIPTDATA_ARRIVED,n)})},e.prototype._onStatisticsInfo=function(n){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.STATISTICS_INFO,n)})},e.prototype._onIOError=function(n,r){var l=this;Promise.resolve().then(function(){l._emitter.emit(c.default.IO_ERROR,n,r)})},e.prototype._onDemuxError=function(n,r){var l=this;Promise.resolve().then(function(){l._emitter.emit(c.default.DEMUX_ERROR,n,r)})},e.prototype._onRecommendSeekpoint=function(n){var r=this;Promise.resolve().then(function(){r._emitter.emit(c.default.RECOMMEND_SEEKPOINT,n)})},e.prototype._onLoggingConfigChanged=function(n){this._worker&&this._worker.postMessage({cmd:"logging_config",param:n})},e.prototype._onWorkerMessage=function(n){var r=n.data,l=r.data;if(r.msg==="destroyed"||this._workerDestroying){this._workerDestroying=!1,this._worker.terminate(),this._worker=null;return}switch(r.msg){case c.default.INIT_SEGMENT:case c.default.MEDIA_SEGMENT:this._emitter.emit(r.msg,l.type,l.data);break;case c.default.LOADING_COMPLETE:case c.default.RECOVERED_EARLY_EOF:this._emitter.emit(r.msg);break;case c.default.MEDIA_INFO:Object.setPrototypeOf(l,h.default.prototype),this._emitter.emit(r.msg,l);break;case c.default.METADATA_ARRIVED:case c.default.SCRIPTDATA_ARRIVED:case c.default.STATISTICS_INFO:this._emitter.emit(r.msg,l);break;case c.default.IO_ERROR:case c.default.DEMUX_ERROR:this._emitter.emit(r.msg,l.type,l.info);break;case c.default.RECOMMEND_SEEKPOINT:this._emitter.emit(r.msg,l);break;case"logcat_callback":f.default.emitter.emit("log",l.type,l.logcat);break}},e}();m.default=t},"./src/core/transmuxing-controller.js":function(u,m,D){D.r(m);var S=D("./node_modules/events/events.js"),g=D.n(S),d=D("./src/utils/logger.js"),i=D("./src/utils/browser.js"),f=D("./src/core/media-info.js"),o=D("./src/demux/flv-demuxer.js"),v=D("./src/remux/mp4-remuxer.js"),c=D("./src/demux/demux-errors.js"),h=D("./src/io/io-controller.js"),t=D("./src/core/transmuxing-events.js"),e=function(){function n(r,l){this.TAG="TransmuxingController",this._emitter=new(g()),this._config=l,r.segments||(r.segments=[{duration:r.duration,filesize:r.filesize,url:r.url}]),typeof r.cors!="boolean"&&(r.cors=!0),typeof r.withCredentials!="boolean"&&(r.withCredentials=!1),this._mediaDataSource=r,this._currentSegmentIndex=0;var s=0;this._mediaDataSource.segments.forEach(function(a){a.timestampBase=s,s+=a.duration,a.cors=r.cors,a.withCredentials=r.withCredentials,l.referrerPolicy&&(a.referrerPolicy=l.referrerPolicy)}),!isNaN(s)&&this._mediaDataSource.duration!==s&&(this._mediaDataSource.duration=s),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return n.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},n.prototype.on=function(r,l){this._emitter.addListener(r,l)},n.prototype.off=function(r,l){this._emitter.removeListener(r,l)},n.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},n.prototype._loadSegment=function(r,l){this._currentSegmentIndex=r;var s=this._mediaDataSource.segments[r],a=this._ioctl=new h.default(s,this._config,r);a.onError=this._onIOException.bind(this),a.onSeeked=this._onIOSeeked.bind(this),a.onComplete=this._onIOComplete.bind(this),a.onRedirect=this._onIORedirect.bind(this),a.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),l?this._demuxer.bindDataSource(this._ioctl):a.onDataArrival=this._onInitChunkArrival.bind(this),a.open(l)},n.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},n.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},n.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},n.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},n.prototype.seek=function(r){if(!(this._mediaInfo==null||!this._mediaInfo.isSeekable())){var l=this._searchSegmentIndexContains(r);if(l===this._currentSegmentIndex){var s=this._mediaInfo.segments[l];if(s==null)this._pendingSeekTime=r;else{var a=s.getNearestKeyframe(r);this._remuxer.seek(a.milliseconds),this._ioctl.seek(a.fileposition),this._pendingResolveSeekPoint=a.milliseconds}}else{var p=this._mediaInfo.segments[l];if(p==null)this._pendingSeekTime=r,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(l);else{var a=p.getNearestKeyframe(r);this._internalAbort(),this._remuxer.seek(r),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[l].timestampBase,this._loadSegment(l,a.fileposition),this._pendingResolveSeekPoint=a.milliseconds,this._reportSegmentMediaInfo(l)}}this._enableStatisticsReporter()}},n.prototype._searchSegmentIndexContains=function(r){for(var l=this._mediaDataSource.segments,s=l.length-1,a=0;a<l.length;a++)if(r<l[a].timestampBase){s=a-1;break}return s},n.prototype._onInitChunkArrival=function(r,l){var s=this,a=null,p=0;if(l>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,p=this._demuxer.parseChunks(r,l);else if((a=o.default.probe(r)).match){this._demuxer=new o.default(a,this._config),this._remuxer||(this._remuxer=new v.default(this._config));var A=this._mediaDataSource;A.duration!=null&&!isNaN(A.duration)&&(this._demuxer.overridedDuration=A.duration),typeof A.hasAudio=="boolean"&&(this._demuxer.overridedHasAudio=A.hasAudio),typeof A.hasVideo=="boolean"&&(this._demuxer.overridedHasVideo=A.hasVideo),this._demuxer.timestampBase=A.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),p=this._demuxer.parseChunks(r,l)}else a=null,d.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){s._internalAbort()}),this._emitter.emit(t.default.DEMUX_ERROR,c.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),p=0;return p},n.prototype._onMediaInfo=function(r){var l=this;this._mediaInfo==null&&(this._mediaInfo=Object.assign({},r),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,f.default.prototype));var s=Object.assign({},r);Object.setPrototypeOf(s,f.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=s,this._reportSegmentMediaInfo(this._currentSegmentIndex),this._pendingSeekTime!=null&&Promise.resolve().then(function(){var a=l._pendingSeekTime;l._pendingSeekTime=null,l.seek(a)})},n.prototype._onMetaDataArrived=function(r){this._emitter.emit(t.default.METADATA_ARRIVED,r)},n.prototype._onScriptDataArrived=function(r){this._emitter.emit(t.default.SCRIPTDATA_ARRIVED,r)},n.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},n.prototype._onIOComplete=function(r){var l=r,s=l+1;s<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(s)):(this._remuxer.flushStashedSamples(),this._emitter.emit(t.default.LOADING_COMPLETE),this._disableStatisticsReporter())},n.prototype._onIORedirect=function(r){var l=this._ioctl.extraData;this._mediaDataSource.segments[l].redirectedURL=r},n.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(t.default.RECOVERED_EARLY_EOF)},n.prototype._onIOException=function(r,l){d.default.e(this.TAG,"IOException: type = "+r+", code = "+l.code+", msg = "+l.msg),this._emitter.emit(t.default.IO_ERROR,r,l),this._disableStatisticsReporter()},n.prototype._onDemuxException=function(r,l){d.default.e(this.TAG,"DemuxException: type = "+r+", info = "+l),this._emitter.emit(t.default.DEMUX_ERROR,r,l)},n.prototype._onRemuxerInitSegmentArrival=function(r,l){this._emitter.emit(t.default.INIT_SEGMENT,r,l)},n.prototype._onRemuxerMediaSegmentArrival=function(r,l){if(this._pendingSeekTime==null&&(this._emitter.emit(t.default.MEDIA_SEGMENT,r,l),this._pendingResolveSeekPoint!=null&&r==="video")){var s=l.info.syncPoints,a=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,i.default.safari&&s.length>0&&s[0].originalDts===a&&(a=s[0].pts),this._emitter.emit(t.default.RECOMMEND_SEEKPOINT,a)}},n.prototype._enableStatisticsReporter=function(){this._statisticsReporter==null&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},n.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},n.prototype._reportSegmentMediaInfo=function(r){var l=this._mediaInfo.segments[r],s=Object.assign({},l);s.duration=this._mediaInfo.duration,s.segmentCount=this._mediaInfo.segmentCount,delete s.segments,delete s.keyframesIndex,this._emitter.emit(t.default.MEDIA_INFO,s)},n.prototype._reportStatisticsInfo=function(){var r={};r.url=this._ioctl.currentURL,r.hasRedirect=this._ioctl.hasRedirect,r.hasRedirect&&(r.redirectedURL=this._ioctl.currentRedirectedURL),r.speed=this._ioctl.currentSpeed,r.loaderType=this._ioctl.loaderType,r.currentSegmentIndex=this._currentSegmentIndex,r.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(t.default.STATISTICS_INFO,r)},n}();m.default=e},"./src/core/transmuxing-events.js":function(u,m,D){D.r(m);var S={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};m.default=S},"./src/core/transmuxing-worker.js":function(u,m,D){D.r(m);var S=D("./src/utils/logging-control.js"),g=D("./src/utils/polyfill.js"),d=D("./src/core/transmuxing-controller.js"),i=D("./src/core/transmuxing-events.js"),f=function(o){var v=null,c=y.bind(this);g.default.install(),o.addEventListener("message",function(L){switch(L.data.cmd){case"init":v=new d.default(L.data.param[0],L.data.param[1]),v.on(i.default.IO_ERROR,p.bind(this)),v.on(i.default.DEMUX_ERROR,A.bind(this)),v.on(i.default.INIT_SEGMENT,h.bind(this)),v.on(i.default.MEDIA_SEGMENT,t.bind(this)),v.on(i.default.LOADING_COMPLETE,e.bind(this)),v.on(i.default.RECOVERED_EARLY_EOF,n.bind(this)),v.on(i.default.MEDIA_INFO,r.bind(this)),v.on(i.default.METADATA_ARRIVED,l.bind(this)),v.on(i.default.SCRIPTDATA_ARRIVED,s.bind(this)),v.on(i.default.STATISTICS_INFO,a.bind(this)),v.on(i.default.RECOMMEND_SEEKPOINT,_.bind(this));break;case"destroy":v&&(v.destroy(),v=null),o.postMessage({msg:"destroyed"});break;case"start":v.start();break;case"stop":v.stop();break;case"seek":v.seek(L.data.param);break;case"pause":v.pause();break;case"resume":v.resume();break;case"logging_config":{var x=L.data.param;S.default.applyConfig(x),x.enableCallback===!0?S.default.addLogListener(c):S.default.removeLogListener(c);break}}});function h(L,x){var T={msg:i.default.INIT_SEGMENT,data:{type:L,data:x}};o.postMessage(T,[x.data])}function t(L,x){var T={msg:i.default.MEDIA_SEGMENT,data:{type:L,data:x}};o.postMessage(T,[x.data])}function e(){var L={msg:i.default.LOADING_COMPLETE};o.postMessage(L)}function n(){var L={msg:i.default.RECOVERED_EARLY_EOF};o.postMessage(L)}function r(L){var x={msg:i.default.MEDIA_INFO,data:L};o.postMessage(x)}function l(L){var x={msg:i.default.METADATA_ARRIVED,data:L};o.postMessage(x)}function s(L){var x={msg:i.default.SCRIPTDATA_ARRIVED,data:L};o.postMessage(x)}function a(L){var x={msg:i.default.STATISTICS_INFO,data:L};o.postMessage(x)}function p(L,x){o.postMessage({msg:i.default.IO_ERROR,data:{type:L,info:x}})}function A(L,x){o.postMessage({msg:i.default.DEMUX_ERROR,data:{type:L,info:x}})}function _(L){o.postMessage({msg:i.default.RECOMMEND_SEEKPOINT,data:L})}function y(L,x){o.postMessage({msg:"logcat_callback",data:{type:L,logcat:x}})}};m.default=f},"./src/demux/amf-parser.js":function(u,m,D){D.r(m);var S=D("./src/utils/logger.js"),g=D("./src/utils/utf8-conv.js"),d=D("./src/utils/exception.js"),i=function(){var o=new ArrayBuffer(2);return new DataView(o).setInt16(0,256,!0),new Int16Array(o)[0]===256}(),f=function(){function o(){}return o.parseScriptData=function(v,c,h){var t={};try{var e=o.parseValue(v,c,h),n=o.parseValue(v,c+e.size,h-e.size);t[e.data]=n.data}catch(r){S.default.e("AMF",r.toString())}return t},o.parseObject=function(v,c,h){if(h<3)throw new d.IllegalStateException("Data not enough when parse ScriptDataObject");var t=o.parseString(v,c,h),e=o.parseValue(v,c+t.size,h-t.size),n=e.objectEnd;return{data:{name:t.data,value:e.data},size:t.size+e.size,objectEnd:n}},o.parseVariable=function(v,c,h){return o.parseObject(v,c,h)},o.parseString=function(v,c,h){if(h<2)throw new d.IllegalStateException("Data not enough when parse String");var t=new DataView(v,c,h),e=t.getUint16(0,!i),n;return e>0?n=(0,g.default)(new Uint8Array(v,c+2,e)):n="",{data:n,size:2+e}},o.parseLongString=function(v,c,h){if(h<4)throw new d.IllegalStateException("Data not enough when parse LongString");var t=new DataView(v,c,h),e=t.getUint32(0,!i),n;return e>0?n=(0,g.default)(new Uint8Array(v,c+4,e)):n="",{data:n,size:4+e}},o.parseDate=function(v,c,h){if(h<10)throw new d.IllegalStateException("Data size invalid when parse Date");var t=new DataView(v,c,h),e=t.getFloat64(0,!i),n=t.getInt16(8,!i);return e+=n*60*1e3,{data:new Date(e),size:8+2}},o.parseValue=function(v,c,h){if(h<1)throw new d.IllegalStateException("Data not enough when parse Value");var t=new DataView(v,c,h),e=1,n=t.getUint8(0),r,l=!1;try{switch(n){case 0:r=t.getFloat64(1,!i),e+=8;break;case 1:{var s=t.getUint8(1);r=!!s,e+=1;break}case 2:{var a=o.parseString(v,c+1,h-1);r=a.data,e+=a.size;break}case 3:{r={};var p=0;for((t.getUint32(h-4,!i)&16777215)===9&&(p=3);e<h-4;){var A=o.parseObject(v,c+e,h-e-p);if(A.objectEnd)break;r[A.data.name]=A.data.value,e+=A.size}if(e<=h-3){var _=t.getUint32(e-1,!i)&16777215;_===9&&(e+=3)}break}case 8:{r={},e+=4;var p=0;for((t.getUint32(h-4,!i)&16777215)===9&&(p=3);e<h-8;){var y=o.parseVariable(v,c+e,h-e-p);if(y.objectEnd)break;r[y.data.name]=y.data.value,e+=y.size}if(e<=h-3){var _=t.getUint32(e-1,!i)&16777215;_===9&&(e+=3)}break}case 9:r=void 0,e=1,l=!0;break;case 10:{r=[];var L=t.getUint32(1,!i);e+=4;for(var x=0;x<L;x++){var T=o.parseValue(v,c+e,h-e);r.push(T.data),e+=T.size}break}case 11:{var O=o.parseDate(v,c+1,h-1);r=O.data,e+=O.size;break}case 12:{var R=o.parseString(v,c+1,h-1);r=R.data,e+=R.size;break}default:e=h,S.default.w("AMF","Unsupported AMF value type "+n)}}catch(I){S.default.e("AMF",I.toString())}return{data:r,size:e,objectEnd:l}},o}();m.default=f},"./src/demux/demux-errors.js":function(u,m,D){D.r(m);var S={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};m.default=S},"./src/demux/exp-golomb.js":function(u,m,D){D.r(m);var S=D("./src/utils/exception.js"),g=function(){function d(i){this.TAG="ExpGolomb",this._buffer=i,this._buffer_index=0,this._total_bytes=i.byteLength,this._total_bits=i.byteLength*8,this._current_word=0,this._current_word_bits_left=0}return d.prototype.destroy=function(){this._buffer=null},d.prototype._fillCurrentWord=function(){var i=this._total_bytes-this._buffer_index;if(i<=0)throw new S.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var f=Math.min(4,i),o=new Uint8Array(4);o.set(this._buffer.subarray(this._buffer_index,this._buffer_index+f)),this._current_word=new DataView(o.buffer).getUint32(0,!1),this._buffer_index+=f,this._current_word_bits_left=f*8},d.prototype.readBits=function(i){if(i>32)throw new S.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(i<=this._current_word_bits_left){var f=this._current_word>>>32-i;return this._current_word<<=i,this._current_word_bits_left-=i,f}var o=this._current_word_bits_left?this._current_word:0;o=o>>>32-this._current_word_bits_left;var v=i-this._current_word_bits_left;this._fillCurrentWord();var c=Math.min(v,this._current_word_bits_left),h=this._current_word>>>32-c;return this._current_word<<=c,this._current_word_bits_left-=c,o=o<<c|h,o},d.prototype.readBool=function(){return this.readBits(1)===1},d.prototype.readByte=function(){return this.readBits(8)},d.prototype._skipLeadingZero=function(){var i;for(i=0;i<this._current_word_bits_left;i++)if((this._current_word&2147483648>>>i)!==0)return this._current_word<<=i,this._current_word_bits_left-=i,i;return this._fillCurrentWord(),i+this._skipLeadingZero()},d.prototype.readUEG=function(){var i=this._skipLeadingZero();return this.readBits(i+1)-1},d.prototype.readSEG=function(){var i=this.readUEG();return i&1?i+1>>>1:-1*(i>>>1)},d}();m.default=g},"./src/demux/flv-demuxer.js":function(u,m,D){D.r(m);var S=D("./src/utils/logger.js"),g=D("./src/demux/amf-parser.js"),d=D("./src/demux/sps-parser.js"),i=D("./src/demux/demux-errors.js"),f=D("./src/core/media-info.js"),o=D("./src/utils/exception.js");function v(h,t){return h[t]<<24|h[t+1]<<16|h[t+2]<<8|h[t+3]}var c=function(){function h(t,e){this.TAG="FLVDemuxer",this._config=e,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new f.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var n=new ArrayBuffer(2);return new DataView(n).setInt16(0,256,!0),new Int16Array(n)[0]===256}()}return h.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},h.probe=function(t){var e=new Uint8Array(t),n={match:!1};if(e[0]!==70||e[1]!==76||e[2]!==86||e[3]!==1)return n;var r=(e[4]&4)>>>2!==0,l=(e[4]&1)!==0,s=v(e,5);return s<9?n:{match:!0,consumed:s,dataOffset:s,hasAudioTrack:r,hasVideoTrack:l}},h.prototype.bindDataSource=function(t){return t.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(h.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(t){this._onTrackMetadata=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(t){this._onMediaInfo=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(t){this._onMetaDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(t){this._onScriptDataArrived=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onError",{get:function(){return this._onError},set:function(t){this._onError=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(t){this._onDataAvailable=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(t){this._timestampBase=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"overridedDuration",{get:function(){return this._duration},set:function(t){this._durationOverrided=!0,this._duration=t,this._mediaInfo.duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"overridedHasAudio",{set:function(t){this._hasAudioFlagOverrided=!0,this._hasAudio=t,this._mediaInfo.hasAudio=t},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"overridedHasVideo",{set:function(t){this._hasVideoFlagOverrided=!0,this._hasVideo=t,this._mediaInfo.hasVideo=t},enumerable:!1,configurable:!0}),h.prototype.resetMediaInfo=function(){this._mediaInfo=new f.default},h.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!this._hasAudio&&this._hasVideo?this._videoInitialMetadataDispatched:!1},h.prototype.parseChunks=function(t,e){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable)throw new o.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var n=0,r=this._littleEndian;if(e===0)if(t.byteLength>13){var l=h.probe(t);n=l.dataOffset}else return 0;if(this._firstParse){this._firstParse=!1,e+n!==this._dataOffset&&S.default.w(this.TAG,"First time parsing but chunk byteStart invalid!");var s=new DataView(t,n),a=s.getUint32(0,!r);a!==0&&S.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),n+=4}for(;n<t.byteLength;){this._dispatch=!0;var s=new DataView(t,n);if(n+11+4>t.byteLength)break;var p=s.getUint8(0),A=s.getUint32(0,!r)&16777215;if(n+11+A+4>t.byteLength)break;if(p!==8&&p!==9&&p!==18){S.default.w(this.TAG,"Unsupported tag type "+p+", skipped"),n+=11+A+4;continue}var _=s.getUint8(4),y=s.getUint8(5),L=s.getUint8(6),x=s.getUint8(7),T=L|y<<8|_<<16|x<<24,O=s.getUint32(7,!r)&16777215;O!==0&&S.default.w(this.TAG,"Meet tag which has StreamID != 0!");var R=n+11;switch(p){case 8:this._parseAudioData(t,R,A,T);break;case 9:this._parseVideoData(t,R,A,T,e+n);break;case 18:this._parseScriptData(t,R,A);break}var I=s.getUint32(11+A,!r);I!==11+A&&S.default.w(this.TAG,"Invalid PrevTagSize "+I),n+=11+A+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),n},h.prototype._parseScriptData=function(t,e,n){var r=g.default.parseScriptData(t,e,n);if(r.hasOwnProperty("onMetaData")){if(r.onMetaData==null||typeof r.onMetaData!="object"){S.default.w(this.TAG,"Invalid onMetaData structure!");return}this._metadata&&S.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=r;var l=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},l)),typeof l.hasAudio=="boolean"&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=l.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),typeof l.hasVideo=="boolean"&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=l.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),typeof l.audiodatarate=="number"&&(this._mediaInfo.audioDataRate=l.audiodatarate),typeof l.videodatarate=="number"&&(this._mediaInfo.videoDataRate=l.videodatarate),typeof l.width=="number"&&(this._mediaInfo.width=l.width),typeof l.height=="number"&&(this._mediaInfo.height=l.height),typeof l.duration=="number"){if(!this._durationOverrided){var s=Math.floor(l.duration*this._timescale);this._duration=s,this._mediaInfo.duration=s}}else this._mediaInfo.duration=0;if(typeof l.framerate=="number"){var a=Math.floor(l.framerate*1e3);if(a>0){var p=a/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=p,this._referenceFrameRate.fps_num=a,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=p}}if(typeof l.keyframes=="object"){this._mediaInfo.hasKeyframesIndex=!0;var A=l.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(A),l.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=l,S.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(r).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},r))},h.prototype._parseKeyframesIndex=function(t){for(var e=[],n=[],r=1;r<t.times.length;r++){var l=this._timestampBase+Math.floor(t.times[r]*1e3);e.push(l),n.push(t.filepositions[r])}return{times:e,filepositions:n}},h.prototype._parseAudioData=function(t,e,n,r){if(n<=1){S.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");return}if(!(this._hasAudioFlagOverrided===!0&&this._hasAudio===!1)){this._littleEndian;var l=new DataView(t,e,n),s=l.getUint8(0),a=s>>>4;if(a!==2&&a!==10){this._onError(i.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+a);return}var p=0,A=(s&12)>>>2;if(A>=0&&A<=4)p=this._flvSoundRateTable[A];else{this._onError(i.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+A);return}var _=s&1,y=this._audioMetadata,L=this._audioTrack;if(y||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),y=this._audioMetadata={},y.type="audio",y.id=L.id,y.timescale=this._timescale,y.duration=this._duration,y.audioSampleRate=p,y.channelCount=_===0?1:2),a===10){var x=this._parseAACAudioData(t,e+1,n-1);if(x==null)return;if(x.packetType===0){y.config&&S.default.w(this.TAG,"Found another AudioSpecificConfig!");var T=x.data;y.audioSampleRate=T.samplingRate,y.channelCount=T.channelCount,y.codec=T.codec,y.originalCodec=T.originalCodec,y.config=T.config,y.refSampleDuration=1024/y.audioSampleRate*y.timescale,S.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",y);var O=this._mediaInfo;O.audioCodec=y.originalCodec,O.audioSampleRate=y.audioSampleRate,O.audioChannelCount=y.channelCount,O.hasVideo?O.videoCodec!=null&&(O.mimeType='video/x-flv; codecs="'+O.videoCodec+","+O.audioCodec+'"'):O.mimeType='video/x-flv; codecs="'+O.audioCodec+'"',O.isComplete()&&this._onMediaInfo(O)}else if(x.packetType===1){var R=this._timestampBase+r,I={unit:x.data,length:x.data.byteLength,dts:R,pts:R};L.samples.push(I),L.length+=x.data.length}else S.default.e(this.TAG,"Flv: Unsupported AAC data type "+x.packetType)}else if(a===2){if(!y.codec){var T=this._parseMP3AudioData(t,e+1,n-1,!0);if(T==null)return;y.audioSampleRate=T.samplingRate,y.channelCount=T.channelCount,y.codec=T.codec,y.originalCodec=T.originalCodec,y.refSampleDuration=1152/y.audioSampleRate*y.timescale,S.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",y);var O=this._mediaInfo;O.audioCodec=y.codec,O.audioSampleRate=y.audioSampleRate,O.audioChannelCount=y.channelCount,O.audioDataRate=T.bitRate,O.hasVideo?O.videoCodec!=null&&(O.mimeType='video/x-flv; codecs="'+O.videoCodec+","+O.audioCodec+'"'):O.mimeType='video/x-flv; codecs="'+O.audioCodec+'"',O.isComplete()&&this._onMediaInfo(O)}var C=this._parseMP3AudioData(t,e+1,n-1,!1);if(C==null)return;var R=this._timestampBase+r,w={unit:C,length:C.byteLength,dts:R,pts:R};L.samples.push(w),L.length+=C.length}}},h.prototype._parseAACAudioData=function(t,e,n){if(n<=1){S.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");return}var r={},l=new Uint8Array(t,e,n);return r.packetType=l[0],l[0]===0?r.data=this._parseAACAudioSpecificConfig(t,e+1,n-1):r.data=l.subarray(1),r},h.prototype._parseAACAudioSpecificConfig=function(t,e,n){var r=new Uint8Array(t,e,n),l=null,s=0,a=0,p=0,A=null;if(s=a=r[0]>>>3,p=(r[0]&7)<<1|r[1]>>>7,p<0||p>=this._mpegSamplingRates.length){this._onError(i.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");return}var _=this._mpegSamplingRates[p],y=(r[1]&120)>>>3;if(y<0||y>=8){this._onError(i.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration");return}s===5&&(A=(r[1]&7)<<1|r[2]>>>7,(r[2]&124)>>>2);var L=self.navigator.userAgent.toLowerCase();return L.indexOf("firefox")!==-1?p>=6?(s=5,l=new Array(4),A=p-3):(s=2,l=new Array(2),A=p):L.indexOf("android")!==-1?(s=2,l=new Array(2),A=p):(s=5,A=p,l=new Array(4),p>=6?A=p-3:y===1&&(s=2,l=new Array(2),A=p)),l[0]=s<<3,l[0]|=(p&15)>>>1,l[1]=(p&15)<<7,l[1]|=(y&15)<<3,s===5&&(l[1]|=(A&15)>>>1,l[2]=(A&1)<<7,l[2]|=2<<2,l[3]=0),{config:l,samplingRate:_,channelCount:y,codec:"mp4a.40."+s,originalCodec:"mp4a.40."+a}},h.prototype._parseMP3AudioData=function(t,e,n,r){if(n<4){S.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!");return}this._littleEndian;var l=new Uint8Array(t,e,n),s=null;if(r){if(l[0]!==255)return;var a=l[1]>>>3&3,p=(l[1]&6)>>1,A=(l[2]&240)>>>4,_=(l[2]&12)>>>2,y=l[3]>>>6&3,L=y!==3?2:1,x=0,T=0,O="mp3";switch(a){case 0:x=this._mpegAudioV25SampleRateTable[_];break;case 2:x=this._mpegAudioV20SampleRateTable[_];break;case 3:x=this._mpegAudioV10SampleRateTable[_];break}switch(p){case 1:A<this._mpegAudioL3BitRateTable.length&&(T=this._mpegAudioL3BitRateTable[A]);break;case 2:A<this._mpegAudioL2BitRateTable.length&&(T=this._mpegAudioL2BitRateTable[A]);break;case 3:A<this._mpegAudioL1BitRateTable.length&&(T=this._mpegAudioL1BitRateTable[A]);break}s={bitRate:T,samplingRate:x,channelCount:L,codec:O,originalCodec:O}}else s=l;return s},h.prototype._parseVideoData=function(t,e,n,r,l){if(n<=1){S.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");return}if(!(this._hasVideoFlagOverrided===!0&&this._hasVideo===!1)){var s=new Uint8Array(t,e,n)[0],a=(s&240)>>>4,p=s&15;if(p!==7){this._onError(i.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+p);return}this._parseAVCVideoPacket(t,e+1,n-1,r,l,a)}},h.prototype._parseAVCVideoPacket=function(t,e,n,r,l,s){if(n<4){S.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");return}var a=this._littleEndian,p=new DataView(t,e,n),A=p.getUint8(0),_=p.getUint32(0,!a)&16777215,y=_<<8>>8;if(A===0)this._parseAVCDecoderConfigurationRecord(t,e+4,n-4);else if(A===1)this._parseAVCVideoData(t,e+4,n-4,r,l,s,y);else if(A!==2){this._onError(i.default.FORMAT_ERROR,"Flv: Invalid video packet type "+A);return}},h.prototype._parseAVCDecoderConfigurationRecord=function(t,e,n){if(n<7){S.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");return}var r=this._videoMetadata,l=this._videoTrack,s=this._littleEndian,a=new DataView(t,e,n);r?typeof r.avcc<"u"&&S.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),r=this._videoMetadata={},r.type="video",r.id=l.id,r.timescale=this._timescale,r.duration=this._duration);var p=a.getUint8(0),A=a.getUint8(1);if(a.getUint8(2),a.getUint8(3),p!==1||A===0){this._onError(i.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");return}if(this._naluLengthSize=(a.getUint8(4)&3)+1,this._naluLengthSize!==3&&this._naluLengthSize!==4){this._onError(i.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));return}var _=a.getUint8(5)&31;if(_===0){this._onError(i.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");return}else _>1&&S.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+_);for(var y=6,L=0;L<_;L++){var x=a.getUint16(y,!s);if(y+=2,x!==0){var T=new Uint8Array(t,e+y,x);y+=x;var O=d.default.parseSPS(T);if(L===0){r.codecWidth=O.codec_size.width,r.codecHeight=O.codec_size.height,r.presentWidth=O.present_size.width,r.presentHeight=O.present_size.height,r.profile=O.profile_string,r.level=O.level_string,r.bitDepth=O.bit_depth,r.chromaFormat=O.chroma_format,r.sarRatio=O.sar_ratio,r.frameRate=O.frame_rate,(O.frame_rate.fixed===!1||O.frame_rate.fps_num===0||O.frame_rate.fps_den===0)&&(r.frameRate=this._referenceFrameRate);var R=r.frameRate.fps_den,I=r.frameRate.fps_num;r.refSampleDuration=r.timescale*(R/I);for(var C=T.subarray(1,4),w="avc1.",F=0;F<3;F++){var B=C[F].toString(16);B.length<2&&(B="0"+B),w+=B}r.codec=w;var k=this._mediaInfo;k.width=r.codecWidth,k.height=r.codecHeight,k.fps=r.frameRate.fps,k.profile=r.profile,k.level=r.level,k.refFrames=O.ref_frames,k.chromaFormat=O.chroma_format_string,k.sarNum=r.sarRatio.width,k.sarDen=r.sarRatio.height,k.videoCodec=w,k.hasAudio?k.audioCodec!=null&&(k.mimeType='video/x-flv; codecs="'+k.videoCodec+","+k.audioCodec+'"'):k.mimeType='video/x-flv; codecs="'+k.videoCodec+'"',k.isComplete()&&this._onMediaInfo(k)}}}var U=a.getUint8(y);if(U===0){this._onError(i.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");return}else U>1&&S.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+U);y++;for(var L=0;L<U;L++){var x=a.getUint16(y,!s);y+=2,x!==0&&(y+=x)}r.avcc=new Uint8Array(n),r.avcc.set(new Uint8Array(t,e,n),0),S.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",r)},h.prototype._parseAVCVideoData=function(t,e,n,r,l,s,a){for(var p=this._littleEndian,A=new DataView(t,e,n),_=[],y=0,L=0,x=this._naluLengthSize,T=this._timestampBase+r,O=s===1;L<n;){if(L+4>=n){S.default.w(this.TAG,"Malformed Nalu near timestamp "+T+", offset = "+L+", dataSize = "+n);break}var R=A.getUint32(L,!p);if(x===3&&(R>>>=8),R>n-x){S.default.w(this.TAG,"Malformed Nalus near timestamp "+T+", NaluSize > DataSize!");return}var I=A.getUint8(L+x)&31;I===5&&(O=!0);var C=new Uint8Array(t,e+L,x+R),w={type:I,data:C};_.push(w),y+=C.byteLength,L+=x+R}if(_.length){var F=this._videoTrack,B={units:_,length:y,isKeyframe:O,dts:T,cts:a,pts:T+a};O&&(B.fileposition=l),F.samples.push(B),F.length+=y}},h}();m.default=c},"./src/demux/sps-parser.js":function(u,m,D){D.r(m);var S=D("./src/demux/exp-golomb.js"),g=function(){function d(){}return d._ebsp2rbsp=function(i){for(var f=i,o=f.byteLength,v=new Uint8Array(o),c=0,h=0;h<o;h++)h>=2&&f[h]===3&&f[h-1]===0&&f[h-2]===0||(v[c]=f[h],c++);return new Uint8Array(v.buffer,0,c)},d.parseSPS=function(i){var f=d._ebsp2rbsp(i),o=new S.default(f);o.readByte();var v=o.readByte();o.readByte();var c=o.readByte();o.readUEG();var h=d.getProfileString(v),t=d.getLevelString(c),e=1,n=420,r=[0,420,422,444],l=8;if((v===100||v===110||v===122||v===244||v===44||v===83||v===86||v===118||v===128||v===138||v===144)&&(e=o.readUEG(),e===3&&o.readBits(1),e<=3&&(n=r[e]),l=o.readUEG()+8,o.readUEG(),o.readBits(1),o.readBool()))for(var s=e!==3?8:12,a=0;a<s;a++)o.readBool()&&(a<6?d._skipScalingList(o,16):d._skipScalingList(o,64));o.readUEG();var p=o.readUEG();if(p===0)o.readUEG();else if(p===1){o.readBits(1),o.readSEG(),o.readSEG();for(var A=o.readUEG(),a=0;a<A;a++)o.readSEG()}var _=o.readUEG();o.readBits(1);var y=o.readUEG(),L=o.readUEG(),x=o.readBits(1);x===0&&o.readBits(1),o.readBits(1);var T=0,O=0,R=0,I=0,C=o.readBool();C&&(T=o.readUEG(),O=o.readUEG(),R=o.readUEG(),I=o.readUEG());var w=1,F=1,B=0,k=!0,U=0,N=0,j=o.readBool();if(j){if(o.readBool()){var K=o.readByte(),H=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],V=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];K>0&&K<16?(w=H[K-1],F=V[K-1]):K===255&&(w=o.readByte()<<8|o.readByte(),F=o.readByte()<<8|o.readByte())}if(o.readBool()&&o.readBool(),o.readBool()&&(o.readBits(4),o.readBool()&&o.readBits(24)),o.readBool()&&(o.readUEG(),o.readUEG()),o.readBool()){var G=o.readBits(32),ee=o.readBits(32);k=o.readBool(),U=ee,N=G*2,B=U/N}}var q=1;(w!==1||F!==1)&&(q=w/F);var z=0,X=0;if(e===0)z=1,X=2-x;else{var J=e===3?1:2,ie=e===1?2:1;z=J,X=ie*(2-x)}var ae=(y+1)*16,se=(2-x)*((L+1)*16);ae-=(T+O)*z,se-=(R+I)*X;var le=Math.ceil(ae*q);return o.destroy(),o=null,{profile_string:h,level_string:t,bit_depth:l,ref_frames:_,chroma_format:n,chroma_format_string:d.getChromaFormatString(n),frame_rate:{fixed:k,fps:B,fps_den:N,fps_num:U},sar_ratio:{width:w,height:F},codec_size:{width:ae,height:se},present_size:{width:le,height:se}}},d._skipScalingList=function(i,f){for(var o=8,v=8,c=0,h=0;h<f;h++)v!==0&&(c=i.readSEG(),v=(o+c+256)%256),o=v===0?o:v},d.getProfileString=function(i){switch(i){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},d.getLevelString=function(i){return(i/10).toFixed(1)},d.getChromaFormatString=function(i){switch(i){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},d}();m.default=g},"./src/flv.js":function(u,m,D){D.r(m);var S=D("./src/utils/polyfill.js"),g=D("./src/core/features.js"),d=D("./src/io/loader.js"),i=D("./src/player/flv-player.js"),f=D("./src/player/native-player.js"),o=D("./src/player/player-events.js"),v=D("./src/player/player-errors.js"),c=D("./src/utils/logging-control.js"),h=D("./src/utils/exception.js");S.default.install();function t(l,s){var a=l;if(a==null||typeof a!="object")throw new h.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!a.hasOwnProperty("type"))throw new h.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(a.type){case"flv":return new i.default(a,s);default:return new f.default(a,s)}}function e(){return g.default.supportMSEH264Playback()}function n(){return g.default.getFeatureList()}var r={};r.createPlayer=t,r.isSupported=e,r.getFeatureList=n,r.BaseLoader=d.BaseLoader,r.LoaderStatus=d.LoaderStatus,r.LoaderErrors=d.LoaderErrors,r.Events=o.default,r.ErrorTypes=v.ErrorTypes,r.ErrorDetails=v.ErrorDetails,r.FlvPlayer=i.default,r.NativePlayer=f.default,r.LoggingControl=c.default,Object.defineProperty(r,"version",{enumerable:!0,get:function(){return"1.6.2"}}),m.default=r},"./src/index.js":function(u,m,D){u.exports=D("./src/flv.js").default},"./src/io/fetch-stream-loader.js":function(u,m,D){D.r(m);var S=D("./src/utils/browser.js"),g=D("./src/io/loader.js"),d=D("./src/utils/exception.js"),i=function(){var o=function(v,c){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,t){h.__proto__=t}||function(h,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])},o(v,c)};return function(v,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");o(v,c);function h(){this.constructor=v}v.prototype=c===null?Object.create(c):(h.prototype=c.prototype,new h)}}(),f=function(o){i(v,o);function v(c,h){var t=o.call(this,"fetch-stream-loader")||this;return t.TAG="FetchStreamLoader",t._seekHandler=c,t._config=h,t._needStash=!0,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return v.isSupported=function(){try{var c=S.default.msedge&&S.default.version.minor>=15048,h=S.default.msedge?c:!0;return self.fetch&&self.ReadableStream&&h}catch{return!1}},v.prototype.destroy=function(){this.isWorking()&&this.abort(),o.prototype.destroy.call(this)},v.prototype.open=function(c,h){var t=this;this._dataSource=c,this._range=h;var e=c.url;this._config.reuseRedirectedURL&&c.redirectedURL!=null&&(e=c.redirectedURL);var n=this._seekHandler.getConfig(e,h),r=new self.Headers;if(typeof n.headers=="object"){var l=n.headers;for(var s in l)l.hasOwnProperty(s)&&r.append(s,l[s])}var a={method:"GET",headers:r,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if(typeof this._config.headers=="object")for(var s in this._config.headers)r.append(s,this._config.headers[s]);c.cors===!1&&(a.mode="same-origin"),c.withCredentials&&(a.credentials="include"),c.referrerPolicy&&(a.referrerPolicy=c.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,a.signal=this._abortController.signal),this._status=g.LoaderStatus.kConnecting,self.fetch(n.url,a).then(function(p){if(t._requestAbort){t._status=g.LoaderStatus.kIdle,p.body.cancel();return}if(p.ok&&p.status>=200&&p.status<=299){if(p.url!==n.url&&t._onURLRedirect){var A=t._seekHandler.removeURLParameters(p.url);t._onURLRedirect(A)}var _=p.headers.get("Content-Length");return _!=null&&(t._contentLength=parseInt(_),t._contentLength!==0&&t._onContentLengthKnown&&t._onContentLengthKnown(t._contentLength)),t._pump.call(t,p.body.getReader())}else if(t._status=g.LoaderStatus.kError,t._onError)t._onError(g.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:p.status,msg:p.statusText});else throw new d.RuntimeException("FetchStreamLoader: Http code invalid, "+p.status+" "+p.statusText)}).catch(function(p){if(!(t._abortController&&t._abortController.signal.aborted))if(t._status=g.LoaderStatus.kError,t._onError)t._onError(g.LoaderErrors.EXCEPTION,{code:-1,msg:p.message});else throw p})},v.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==g.LoaderStatus.kBuffering||!S.default.chrome)&&this._abortController)try{this._abortController.abort()}catch{}},v.prototype._pump=function(c){var h=this;return c.read().then(function(t){if(t.done)if(h._contentLength!==null&&h._receivedLength<h._contentLength){h._status=g.LoaderStatus.kError;var e=g.LoaderErrors.EARLY_EOF,n={code:-1,msg:"Fetch stream meet Early-EOF"};if(h._onError)h._onError(e,n);else throw new d.RuntimeException(n.msg)}else h._status=g.LoaderStatus.kComplete,h._onComplete&&h._onComplete(h._range.from,h._range.from+h._receivedLength-1);else{if(h._abortController&&h._abortController.signal.aborted){h._status=g.LoaderStatus.kComplete;return}else if(h._requestAbort===!0)return h._status=g.LoaderStatus.kComplete,c.cancel();h._status=g.LoaderStatus.kBuffering;var r=t.value.buffer,l=h._range.from+h._receivedLength;h._receivedLength+=r.byteLength,h._onDataArrival&&h._onDataArrival(r,l,h._receivedLength),h._pump(c)}}).catch(function(t){if(h._abortController&&h._abortController.signal.aborted){h._status=g.LoaderStatus.kComplete;return}if(!(t.code===11&&S.default.msedge)){h._status=g.LoaderStatus.kError;var e=0,n=null;if((t.code===19||t.message==="network error")&&(h._contentLength===null||h._contentLength!==null&&h._receivedLength<h._contentLength)?(e=g.LoaderErrors.EARLY_EOF,n={code:t.code,msg:"Fetch stream meet Early-EOF"}):(e=g.LoaderErrors.EXCEPTION,n={code:t.code,msg:t.message}),h._onError)h._onError(e,n);else throw new d.RuntimeException(n.msg)}})},v}(g.BaseLoader);m.default=f},"./src/io/io-controller.js":function(u,m,D){D.r(m);var S=D("./src/utils/logger.js"),g=D("./src/io/speed-sampler.js"),d=D("./src/io/loader.js"),i=D("./src/io/fetch-stream-loader.js"),f=D("./src/io/xhr-moz-chunked-loader.js"),o=D("./src/io/xhr-range-loader.js"),v=D("./src/io/websocket-loader.js"),c=D("./src/io/range-seek-handler.js"),h=D("./src/io/param-seek-handler.js"),t=D("./src/utils/exception.js"),e=function(){function n(r,l,s){this.TAG="IOController",this._config=l,this._extraData=s,this._stashInitialSize=1024*384,l.stashInitialSize!=null&&l.stashInitialSize>0&&(this._stashInitialSize=l.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=1024*1024*3,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,l.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=r,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(r.url),this._refTotalLength=r.filesize?r.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new g.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return n.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},n.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},n.prototype.isPaused=function(){return this._paused},Object.defineProperty(n.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"extraData",{get:function(){return this._extraData},set:function(r){this._extraData=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(r){this._onDataArrival=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(r){this._onSeeked=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onError",{get:function(){return this._onError},set:function(r){this._onError=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onComplete",{get:function(){return this._onComplete},set:function(r){this._onComplete=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(r){this._onRedirect=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(r){this._onRecoveredEarlyEof=r},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasRedirect",{get:function(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=null},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"currentSpeed",{get:function(){return this._loaderClass===o.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),n.prototype._selectSeekHandler=function(){var r=this._config;if(r.seekType==="range")this._seekHandler=new c.default(this._config.rangeLoadZeroStart);else if(r.seekType==="param"){var l=r.seekParamStart||"bstart",s=r.seekParamEnd||"bend";this._seekHandler=new h.default(l,s)}else if(r.seekType==="custom"){if(typeof r.customSeekHandler!="function")throw new t.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new r.customSeekHandler}else throw new t.InvalidArgumentException("Invalid seekType in config: "+r.seekType)},n.prototype._selectLoader=function(){if(this._config.customLoader!=null)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=v.default;else if(i.default.isSupported())this._loaderClass=i.default;else if(f.default.isSupported())this._loaderClass=f.default;else if(o.default.isSupported())this._loaderClass=o.default;else throw new t.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!")},n.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},n.prototype.open=function(r){this._currentRange={from:0,to:-1},r&&(this._currentRange.from=r),this._speedSampler.reset(),r||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},n.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},n.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),this._stashUsed!==0?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},n.prototype.resume=function(){if(this._paused){this._paused=!1;var r=this._resumeFrom;this._resumeFrom=0,this._internalSeek(r,!0)}},n.prototype.seek=function(r){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(r,!0)},n.prototype._internalSeek=function(r,l){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(l),this._loader.destroy(),this._loader=null;var s={from:r,to:-1};this._currentRange={from:s.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,s),this._onSeeked&&this._onSeeked()},n.prototype.updateUrl=function(r){if(!r||typeof r!="string"||r.length===0)throw new t.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=r},n.prototype._expandBuffer=function(r){for(var l=this._stashSize;l+1024*1024*1<r;)l*=2;if(l+=1024*1024*1,l!==this._bufferSize){var s=new ArrayBuffer(l);if(this._stashUsed>0){var a=new Uint8Array(this._stashBuffer,0,this._stashUsed),p=new Uint8Array(s,0,l);p.set(a,0)}this._stashBuffer=s,this._bufferSize=l}},n.prototype._normalizeSpeed=function(r){var l=this._speedNormalizeList,s=l.length-1,a=0,p=0,A=s;if(r<l[0])return l[0];for(;p<=A;){if(a=p+Math.floor((A-p)/2),a===s||r>=l[a]&&r<l[a+1])return l[a];l[a]<r?p=a+1:A=a-1}},n.prototype._adjustStashSize=function(r){var l=0;this._config.isLive||r<512?l=r:r>=512&&r<=1024?l=Math.floor(r*1.5):l=r*2,l>8192&&(l=8192);var s=l*1024+1024*1024*1;this._bufferSize<s&&this._expandBuffer(s),this._stashSize=l*1024},n.prototype._dispatchChunks=function(r,l){return this._currentRange.to=l+r.byteLength-1,this._onDataArrival(r,l)},n.prototype._onURLRedirect=function(r){this._redirectedURL=r,this._onRedirect&&this._onRedirect(r)},n.prototype._onContentLengthKnown=function(r){r&&this._fullRequestFlag&&(this._totalLength=r,this._fullRequestFlag=!1)},n.prototype._onLoaderChunkArrival=function(r,l,s){if(!this._onDataArrival)throw new t.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(r.byteLength);var a=this._speedSampler.lastSecondKBps;if(a!==0){var p=this._normalizeSpeed(a);this._speedNormalized!==p&&(this._speedNormalized=p,this._adjustStashSize(p))}if(this._enableStash)if(this._stashUsed===0&&this._stashByteStart===0&&(this._stashByteStart=l),this._stashUsed+r.byteLength<=this._stashSize){var y=new Uint8Array(this._stashBuffer,0,this._stashSize);y.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength}else{var y=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var x=this._stashBuffer.slice(0,this._stashUsed),A=this._dispatchChunks(x,this._stashByteStart);if(A<x.byteLength){if(A>0){var L=new Uint8Array(x,A);y.set(L,0),this._stashUsed=L.byteLength,this._stashByteStart+=A}}else this._stashUsed=0,this._stashByteStart+=A;this._stashUsed+r.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+r.byteLength),y=new Uint8Array(this._stashBuffer,0,this._bufferSize)),y.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength}else{var A=this._dispatchChunks(r,l);if(A<r.byteLength){var _=r.byteLength-A;_>this._bufferSize&&(this._expandBuffer(_),y=new Uint8Array(this._stashBuffer,0,this._bufferSize)),y.set(new Uint8Array(r,A),0),this._stashUsed+=_,this._stashByteStart=l+A}}}else if(this._stashUsed===0){var A=this._dispatchChunks(r,l);if(A<r.byteLength){var _=r.byteLength-A;_>this._bufferSize&&this._expandBuffer(_);var y=new Uint8Array(this._stashBuffer,0,this._bufferSize);y.set(new Uint8Array(r,A),0),this._stashUsed+=_,this._stashByteStart=l+A}}else{this._stashUsed+r.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+r.byteLength);var y=new Uint8Array(this._stashBuffer,0,this._bufferSize);y.set(new Uint8Array(r),this._stashUsed),this._stashUsed+=r.byteLength;var A=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(A<this._stashUsed&&A>0){var L=new Uint8Array(this._stashBuffer,A);y.set(L,0)}this._stashUsed-=A,this._stashByteStart+=A}}},n.prototype._flushStashBuffer=function(r){if(this._stashUsed>0){var l=this._stashBuffer.slice(0,this._stashUsed),s=this._dispatchChunks(l,this._stashByteStart),a=l.byteLength-s;if(s<l.byteLength)if(r)S.default.w(this.TAG,a+" bytes unconsumed data remain when flush buffer, dropped");else{if(s>0){var p=new Uint8Array(this._stashBuffer,0,this._bufferSize),A=new Uint8Array(l,s);p.set(A,0),this._stashUsed=A.byteLength,this._stashByteStart+=s}return 0}return this._stashUsed=0,this._stashByteStart=0,a}return 0},n.prototype._onLoaderComplete=function(r,l){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},n.prototype._onLoaderError=function(r,l){switch(S.default.e(this.TAG,"Loader error, code = "+l.code+", msg = "+l.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,r=d.LoaderErrors.UNRECOVERABLE_EARLY_EOF),r){case d.LoaderErrors.EARLY_EOF:{if(!this._config.isLive&&this._totalLength){var s=this._currentRange.to+1;s<this._totalLength&&(S.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(s,!1));return}r=d.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break}case d.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case d.LoaderErrors.CONNECTING_TIMEOUT:case d.LoaderErrors.HTTP_STATUS_CODE_INVALID:case d.LoaderErrors.EXCEPTION:break}if(this._onError)this._onError(r,l);else throw new t.RuntimeException("IOException: "+l.msg)},n}();m.default=e},"./src/io/loader.js":function(u,m,D){D.r(m),D.d(m,{LoaderStatus:function(){return g},LoaderErrors:function(){return d},BaseLoader:function(){return i}});var S=D("./src/utils/exception.js"),g={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},d={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},i=function(){function f(o){this._type=o||"undefined",this._status=g.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return f.prototype.destroy=function(){this._status=g.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},f.prototype.isWorking=function(){return this._status===g.kConnecting||this._status===g.kBuffering},Object.defineProperty(f.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(o){this._onContentLengthKnown=o},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(o){this._onURLRedirect=o},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(o){this._onDataArrival=o},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onError",{get:function(){return this._onError},set:function(o){this._onError=o},enumerable:!1,configurable:!0}),Object.defineProperty(f.prototype,"onComplete",{get:function(){return this._onComplete},set:function(o){this._onComplete=o},enumerable:!1,configurable:!0}),f.prototype.open=function(o,v){throw new S.NotImplementedException("Unimplemented abstract function!")},f.prototype.abort=function(){throw new S.NotImplementedException("Unimplemented abstract function!")},f}()},"./src/io/param-seek-handler.js":function(u,m,D){D.r(m);var S=function(){function g(d,i){this._startName=d,this._endName=i}return g.prototype.getConfig=function(d,i){var f=d;if(i.from!==0||i.to!==-1){var o=!0;f.indexOf("?")===-1&&(f+="?",o=!1),o&&(f+="&"),f+=this._startName+"="+i.from.toString(),i.to!==-1&&(f+="&"+this._endName+"="+i.to.toString())}return{url:f,headers:{}}},g.prototype.removeURLParameters=function(d){var i=d.split("?")[0],f=void 0,o=d.indexOf("?");o!==-1&&(f=d.substring(o+1));var v="";if(f!=null&&f.length>0)for(var c=f.split("&"),h=0;h<c.length;h++){var t=c[h].split("="),e=h>0;t[0]!==this._startName&&t[0]!==this._endName&&(e&&(v+="&"),v+=c[h])}return v.length===0?i:i+"?"+v},g}();m.default=S},"./src/io/range-seek-handler.js":function(u,m,D){D.r(m);var S=function(){function g(d){this._zeroStart=d||!1}return g.prototype.getConfig=function(d,i){var f={};if(i.from!==0||i.to!==-1){var o=void 0;i.to!==-1?o="bytes="+i.from.toString()+"-"+i.to.toString():o="bytes="+i.from.toString()+"-",f.Range=o}else this._zeroStart&&(f.Range="bytes=0-");return{url:d,headers:f}},g.prototype.removeURLParameters=function(d){return d},g}();m.default=S},"./src/io/speed-sampler.js":function(u,m,D){D.r(m);var S=function(){function g(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return g.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},g.prototype.addBytes=function(d){this._firstCheckpoint===0?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=d,this._totalBytes+=d):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=d,this._totalBytes+=d):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=d,this._totalBytes+=d,this._lastCheckpoint=this._now())},Object.defineProperty(g.prototype,"currentKBps",{get:function(){this.addBytes(0);var d=(this._now()-this._lastCheckpoint)/1e3;return d==0&&(d=1),this._intervalBytes/d/1024},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),this._lastSecondBytes!==0?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(g.prototype,"averageKBps",{get:function(){var d=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/d/1024},enumerable:!1,configurable:!0}),g}();m.default=S},"./src/io/websocket-loader.js":function(u,m,D){D.r(m);var S=D("./src/io/loader.js"),g=D("./src/utils/exception.js"),d=function(){var f=function(o,v){return f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(c,h){c.__proto__=h}||function(c,h){for(var t in h)Object.prototype.hasOwnProperty.call(h,t)&&(c[t]=h[t])},f(o,v)};return function(o,v){if(typeof v!="function"&&v!==null)throw new TypeError("Class extends value "+String(v)+" is not a constructor or null");f(o,v);function c(){this.constructor=o}o.prototype=v===null?Object.create(v):(c.prototype=v.prototype,new c)}}(),i=function(f){d(o,f);function o(){var v=f.call(this,"websocket-loader")||this;return v.TAG="WebSocketLoader",v._needStash=!0,v._ws=null,v._requestAbort=!1,v._receivedLength=0,v}return o.isSupported=function(){try{return typeof self.WebSocket<"u"}catch{return!1}},o.prototype.destroy=function(){this._ws&&this.abort(),f.prototype.destroy.call(this)},o.prototype.open=function(v){try{var c=this._ws=new self.WebSocket(v.url);c.binaryType="arraybuffer",c.onopen=this._onWebSocketOpen.bind(this),c.onclose=this._onWebSocketClose.bind(this),c.onmessage=this._onWebSocketMessage.bind(this),c.onerror=this._onWebSocketError.bind(this),this._status=S.LoaderStatus.kConnecting}catch(t){this._status=S.LoaderStatus.kError;var h={code:t.code,msg:t.message};if(this._onError)this._onError(S.LoaderErrors.EXCEPTION,h);else throw new g.RuntimeException(h.msg)}},o.prototype.abort=function(){var v=this._ws;v&&(v.readyState===0||v.readyState===1)&&(this._requestAbort=!0,v.close()),this._ws=null,this._status=S.LoaderStatus.kComplete},o.prototype._onWebSocketOpen=function(v){this._status=S.LoaderStatus.kBuffering},o.prototype._onWebSocketClose=function(v){if(this._requestAbort===!0){this._requestAbort=!1;return}this._status=S.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)},o.prototype._onWebSocketMessage=function(v){var c=this;if(v.data instanceof ArrayBuffer)this._dispatchArrayBuffer(v.data);else if(v.data instanceof Blob){var h=new FileReader;h.onload=function(){c._dispatchArrayBuffer(h.result)},h.readAsArrayBuffer(v.data)}else{this._status=S.LoaderStatus.kError;var t={code:-1,msg:"Unsupported WebSocket message type: "+v.data.constructor.name};if(this._onError)this._onError(S.LoaderErrors.EXCEPTION,t);else throw new g.RuntimeException(t.msg)}},o.prototype._dispatchArrayBuffer=function(v){var c=v,h=this._receivedLength;this._receivedLength+=c.byteLength,this._onDataArrival&&this._onDataArrival(c,h,this._receivedLength)},o.prototype._onWebSocketError=function(v){this._status=S.LoaderStatus.kError;var c={code:v.code,msg:v.message};if(this._onError)this._onError(S.LoaderErrors.EXCEPTION,c);else throw new g.RuntimeException(c.msg)},o}(S.BaseLoader);m.default=i},"./src/io/xhr-moz-chunked-loader.js":function(u,m,D){D.r(m);var S=D("./src/utils/logger.js"),g=D("./src/io/loader.js"),d=D("./src/utils/exception.js"),i=function(){var o=function(v,c){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,t){h.__proto__=t}||function(h,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])},o(v,c)};return function(v,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");o(v,c);function h(){this.constructor=v}v.prototype=c===null?Object.create(c):(h.prototype=c.prototype,new h)}}(),f=function(o){i(v,o);function v(c,h){var t=o.call(this,"xhr-moz-chunked-loader")||this;return t.TAG="MozChunkedLoader",t._seekHandler=c,t._config=h,t._needStash=!0,t._xhr=null,t._requestAbort=!1,t._contentLength=null,t._receivedLength=0,t}return v.isSupported=function(){try{var c=new XMLHttpRequest;return c.open("GET","https://example.com",!0),c.responseType="moz-chunked-arraybuffer",c.responseType==="moz-chunked-arraybuffer"}catch(h){return S.default.w("MozChunkedLoader",h.message),!1}},v.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),o.prototype.destroy.call(this)},v.prototype.open=function(c,h){this._dataSource=c,this._range=h;var t=c.url;this._config.reuseRedirectedURL&&c.redirectedURL!=null&&(t=c.redirectedURL);var e=this._seekHandler.getConfig(t,h);this._requestURL=e.url;var n=this._xhr=new XMLHttpRequest;if(n.open("GET",e.url,!0),n.responseType="moz-chunked-arraybuffer",n.onreadystatechange=this._onReadyStateChange.bind(this),n.onprogress=this._onProgress.bind(this),n.onloadend=this._onLoadEnd.bind(this),n.onerror=this._onXhrError.bind(this),c.withCredentials&&(n.withCredentials=!0),typeof e.headers=="object"){var r=e.headers;for(var l in r)r.hasOwnProperty(l)&&n.setRequestHeader(l,r[l])}if(typeof this._config.headers=="object"){var r=this._config.headers;for(var l in r)r.hasOwnProperty(l)&&n.setRequestHeader(l,r[l])}this._status=g.LoaderStatus.kConnecting,n.send()},v.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=g.LoaderStatus.kComplete},v.prototype._onReadyStateChange=function(c){var h=c.target;if(h.readyState===2){if(h.responseURL!=null&&h.responseURL!==this._requestURL&&this._onURLRedirect){var t=this._seekHandler.removeURLParameters(h.responseURL);this._onURLRedirect(t)}if(h.status!==0&&(h.status<200||h.status>299))if(this._status=g.LoaderStatus.kError,this._onError)this._onError(g.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:h.status,msg:h.statusText});else throw new d.RuntimeException("MozChunkedLoader: Http code invalid, "+h.status+" "+h.statusText);else this._status=g.LoaderStatus.kBuffering}},v.prototype._onProgress=function(c){if(this._status!==g.LoaderStatus.kError){this._contentLength===null&&c.total!==null&&c.total!==0&&(this._contentLength=c.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var h=c.target.response,t=this._range.from+this._receivedLength;this._receivedLength+=h.byteLength,this._onDataArrival&&this._onDataArrival(h,t,this._receivedLength)}},v.prototype._onLoadEnd=function(c){if(this._requestAbort===!0){this._requestAbort=!1;return}else if(this._status===g.LoaderStatus.kError)return;this._status=g.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)},v.prototype._onXhrError=function(c){this._status=g.LoaderStatus.kError;var h=0,t=null;if(this._contentLength&&c.loaded<this._contentLength?(h=g.LoaderErrors.EARLY_EOF,t={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(h=g.LoaderErrors.EXCEPTION,t={code:-1,msg:c.constructor.name+" "+c.type}),this._onError)this._onError(h,t);else throw new d.RuntimeException(t.msg)},v}(g.BaseLoader);m.default=f},"./src/io/xhr-range-loader.js":function(u,m,D){D.r(m);var S=D("./src/utils/logger.js"),g=D("./src/io/speed-sampler.js"),d=D("./src/io/loader.js"),i=D("./src/utils/exception.js"),f=function(){var v=function(c,h){return v=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},v(c,h)};return function(c,h){if(typeof h!="function"&&h!==null)throw new TypeError("Class extends value "+String(h)+" is not a constructor or null");v(c,h);function t(){this.constructor=c}c.prototype=h===null?Object.create(h):(t.prototype=h.prototype,new t)}}(),o=function(v){f(c,v);function c(h,t){var e=v.call(this,"xhr-range-loader")||this;return e.TAG="RangeLoader",e._seekHandler=h,e._config=t,e._needStash=!1,e._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],e._currentChunkSizeKB=384,e._currentSpeedNormalized=0,e._zeroSpeedChunkCount=0,e._xhr=null,e._speedSampler=new g.default,e._requestAbort=!1,e._waitForTotalLength=!1,e._totalLengthReceived=!1,e._currentRequestURL=null,e._currentRedirectedURL=null,e._currentRequestRange=null,e._totalLength=null,e._contentLength=null,e._receivedLength=0,e._lastTimeLoaded=0,e}return c.isSupported=function(){try{var h=new XMLHttpRequest;return h.open("GET","https://example.com",!0),h.responseType="arraybuffer",h.responseType==="arraybuffer"}catch(t){return S.default.w("RangeLoader",t.message),!1}},c.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),v.prototype.destroy.call(this)},Object.defineProperty(c.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),c.prototype.open=function(h,t){this._dataSource=h,this._range=t,this._status=d.LoaderStatus.kConnecting;var e=!1;this._dataSource.filesize!=null&&this._dataSource.filesize!==0&&(e=!0,this._totalLength=this._dataSource.filesize),!this._totalLengthReceived&&!e?(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1})):this._openSubRange()},c.prototype._openSubRange=function(){var h=this._currentChunkSizeKB*1024,t=this._range.from+this._receivedLength,e=t+h;this._contentLength!=null&&e-this._range.from>=this._contentLength&&(e=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:e},this._internalOpen(this._dataSource,this._currentRequestRange)},c.prototype._internalOpen=function(h,t){this._lastTimeLoaded=0;var e=h.url;this._config.reuseRedirectedURL&&(this._currentRedirectedURL!=null?e=this._currentRedirectedURL:h.redirectedURL!=null&&(e=h.redirectedURL));var n=this._seekHandler.getConfig(e,t);this._currentRequestURL=n.url;var r=this._xhr=new XMLHttpRequest;if(r.open("GET",n.url,!0),r.responseType="arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onload=this._onLoad.bind(this),r.onerror=this._onXhrError.bind(this),h.withCredentials&&(r.withCredentials=!0),typeof n.headers=="object"){var l=n.headers;for(var s in l)l.hasOwnProperty(s)&&r.setRequestHeader(s,l[s])}if(typeof this._config.headers=="object"){var l=this._config.headers;for(var s in l)l.hasOwnProperty(s)&&r.setRequestHeader(s,l[s])}r.send()},c.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=d.LoaderStatus.kComplete},c.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},c.prototype._onReadyStateChange=function(h){var t=h.target;if(t.readyState===2){if(t.responseURL!=null){var e=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&e!==this._currentRedirectedURL&&(this._currentRedirectedURL=e,this._onURLRedirect&&this._onURLRedirect(e))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=d.LoaderStatus.kBuffering}else if(this._status=d.LoaderStatus.kError,this._onError)this._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText});else throw new i.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText)}},c.prototype._onProgress=function(h){if(this._status!==d.LoaderStatus.kError){if(this._contentLength===null){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var e=h.total;this._internalAbort(),e!=null&e!==0&&(this._totalLength=e)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t){this._openSubRange();return}this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var n=h.loaded-this._lastTimeLoaded;this._lastTimeLoaded=h.loaded,this._speedSampler.addBytes(n)}},c.prototype._normalizeSpeed=function(h){var t=this._chunkSizeKBList,e=t.length-1,n=0,r=0,l=e;if(h<t[0])return t[0];for(;r<=l;){if(n=r+Math.floor((l-r)/2),n===e||h>=t[n]&&h<t[n+1])return t[n];t[n]<h?r=n+1:l=n-1}},c.prototype._onLoad=function(h){if(this._status!==d.LoaderStatus.kError){if(this._waitForTotalLength){this._waitForTotalLength=!1;return}this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(t===0&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),t!==0){var e=this._normalizeSpeed(t);this._currentSpeedNormalized!==e&&(this._currentSpeedNormalized=e,this._currentChunkSizeKB=e)}var n=h.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=n.byteLength;var l=!1;this._contentLength!=null&&this._receivedLength<this._contentLength?this._openSubRange():l=!0,this._onDataArrival&&this._onDataArrival(n,r,this._receivedLength),l&&(this._status=d.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},c.prototype._onXhrError=function(h){this._status=d.LoaderStatus.kError;var t=0,e=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=d.LoaderErrors.EARLY_EOF,e={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=d.LoaderErrors.EXCEPTION,e={code:-1,msg:h.constructor.name+" "+h.type}),this._onError)this._onError(t,e);else throw new i.RuntimeException(e.msg)},c}(d.BaseLoader);m.default=o},"./src/player/flv-player.js":function(u,m,D){D.r(m);var S=D("./node_modules/events/events.js"),g=D.n(S),d=D("./src/utils/logger.js"),i=D("./src/utils/browser.js"),f=D("./src/player/player-events.js"),o=D("./src/core/transmuxer.js"),v=D("./src/core/transmuxing-events.js"),c=D("./src/core/mse-controller.js"),h=D("./src/core/mse-events.js"),t=D("./src/player/player-errors.js"),e=D("./src/config.js"),n=D("./src/utils/exception.js"),r=function(){function l(s,a){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(g()),this._config=(0,e.createDefaultConfig)(),typeof a=="object"&&Object.assign(this._config,a),s.type.toLowerCase()!=="flv")throw new n.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");s.isLive===!0&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=s,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var p=i.default.chrome&&(i.default.version.major<50||i.default.version.major===50&&i.default.version.build<2661);this._alwaysSeekKeyframe=!!(p||i.default.msedge||i.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return l.prototype.destroy=function(){this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},l.prototype.on=function(s,a){var p=this;s===f.default.MEDIA_INFO?this._mediaInfo!=null&&Promise.resolve().then(function(){p._emitter.emit(f.default.MEDIA_INFO,p.mediaInfo)}):s===f.default.STATISTICS_INFO&&this._statisticsInfo!=null&&Promise.resolve().then(function(){p._emitter.emit(f.default.STATISTICS_INFO,p.statisticsInfo)}),this._emitter.addListener(s,a)},l.prototype.off=function(s,a){this._emitter.removeListener(s,a)},l.prototype.attachMediaElement=function(s){var a=this;if(this._mediaElement=s,s.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),s.addEventListener("seeking",this.e.onvSeeking),s.addEventListener("canplay",this.e.onvCanPlay),s.addEventListener("stalled",this.e.onvStalled),s.addEventListener("progress",this.e.onvProgress),this._msectl=new c.default(this._config),this._msectl.on(h.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(h.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(h.default.SOURCE_OPEN,function(){a._mseSourceOpened=!0,a._hasPendingLoad&&(a._hasPendingLoad=!1,a.load())}),this._msectl.on(h.default.ERROR,function(p){a._emitter.emit(f.default.ERROR,t.ErrorTypes.MEDIA_ERROR,t.ErrorDetails.MEDIA_MSE_ERROR,p)}),this._msectl.attachMediaElement(s),this._pendingSeekTime!=null)try{s.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},l.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},l.prototype.load=function(){var s=this;if(!this._mediaElement)throw new n.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new n.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1){this._hasPendingLoad=!0;return}this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new o.default(this._mediaDataSource,this._config),this._transmuxer.on(v.default.INIT_SEGMENT,function(a,p){s._msectl.appendInitSegment(p)}),this._transmuxer.on(v.default.MEDIA_SEGMENT,function(a,p){if(s._msectl.appendMediaSegment(p),s._config.lazyLoad&&!s._config.isLive){var A=s._mediaElement.currentTime;p.info.endDts>=(A+s._config.lazyLoadMaxDuration)*1e3&&s._progressChecker==null&&(d.default.v(s.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),s._suspendTransmuxer())}}),this._transmuxer.on(v.default.LOADING_COMPLETE,function(){s._msectl.endOfStream(),s._emitter.emit(f.default.LOADING_COMPLETE)}),this._transmuxer.on(v.default.RECOVERED_EARLY_EOF,function(){s._emitter.emit(f.default.RECOVERED_EARLY_EOF)}),this._transmuxer.on(v.default.IO_ERROR,function(a,p){s._emitter.emit(f.default.ERROR,t.ErrorTypes.NETWORK_ERROR,a,p)}),this._transmuxer.on(v.default.DEMUX_ERROR,function(a,p){s._emitter.emit(f.default.ERROR,t.ErrorTypes.MEDIA_ERROR,a,{code:-1,msg:p})}),this._transmuxer.on(v.default.MEDIA_INFO,function(a){s._mediaInfo=a,s._emitter.emit(f.default.MEDIA_INFO,Object.assign({},a))}),this._transmuxer.on(v.default.METADATA_ARRIVED,function(a){s._emitter.emit(f.default.METADATA_ARRIVED,a)}),this._transmuxer.on(v.default.SCRIPTDATA_ARRIVED,function(a){s._emitter.emit(f.default.SCRIPTDATA_ARRIVED,a)}),this._transmuxer.on(v.default.STATISTICS_INFO,function(a){s._statisticsInfo=s._fillStatisticsInfo(a),s._emitter.emit(f.default.STATISTICS_INFO,Object.assign({},s._statisticsInfo))}),this._transmuxer.on(v.default.RECOMMEND_SEEKPOINT,function(a){s._mediaElement&&!s._config.accurateSeek&&(s._requestSetTime=!0,s._mediaElement.currentTime=a/1e3)}),this._transmuxer.open()}},l.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},l.prototype.play=function(){return this._mediaElement.play()},l.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(l.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(s){this._mediaElement.volume=s},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(s){this._mediaElement.muted=s},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(s){this._mediaElement?this._internalSeek(s):this._pendingSeekTime=s},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(l.prototype,"statisticsInfo",{get:function(){return this._statisticsInfo==null&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),l.prototype._fillStatisticsInfo=function(s){if(s.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return s;var a=!0,p=0,A=0;if(this._mediaElement.getVideoPlaybackQuality){var _=this._mediaElement.getVideoPlaybackQuality();p=_.totalVideoFrames,A=_.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(p=this._mediaElement.webkitDecodedFrameCount,A=this._mediaElement.webkitDroppedFrameCount):a=!1;return a&&(s.decodedFrames=p,s.droppedFrames=A),s},l.prototype._onmseUpdateEnd=function(){if(!(!this._config.lazyLoad||this._config.isLive)){for(var s=this._mediaElement.buffered,a=this._mediaElement.currentTime,p=0,A=0;A<s.length;A++){var _=s.start(A),y=s.end(A);if(_<=a&&a<y){p=y;break}}p>=a+this._config.lazyLoadMaxDuration&&this._progressChecker==null&&(d.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},l.prototype._onmseBufferFull=function(){d.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),this._progressChecker==null&&this._suspendTransmuxer()},l.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),this._progressChecker==null&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},l.prototype._checkProgressAndResume=function(){for(var s=this._mediaElement.currentTime,a=this._mediaElement.buffered,p=!1,A=0;A<a.length;A++){var _=a.start(A),y=a.end(A);if(s>=_&&s<y){s>=y-this._config.lazyLoadRecoverDuration&&(p=!0);break}}p&&(window.clearInterval(this._progressChecker),this._progressChecker=null,p&&(d.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},l.prototype._isTimepointBuffered=function(s){for(var a=this._mediaElement.buffered,p=0;p<a.length;p++){var A=a.start(p),_=a.end(p);if(s>=A&&s<_)return!0}return!1},l.prototype._internalSeek=function(s){var a=this._isTimepointBuffered(s),p=!1,A=0;if(s<1&&this._mediaElement.buffered.length>0){var _=this._mediaElement.buffered.start(0);(_<1&&s<_||i.default.safari)&&(p=!0,A=i.default.safari?.1:_)}if(p)this._requestSetTime=!0,this._mediaElement.currentTime=A;else if(a){if(!this._alwaysSeekKeyframe)this._requestSetTime=!0,this._mediaElement.currentTime=s;else{var y=this._msectl.getNearestKeyframe(Math.floor(s*1e3));this._requestSetTime=!0,y!=null?this._mediaElement.currentTime=y.dts/1e3:this._mediaElement.currentTime=s}this._progressChecker!=null&&this._checkProgressAndResume()}else this._progressChecker!=null&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(s),this._transmuxer.seek(Math.floor(s*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=s)},l.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var s=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(s)||(this._progressChecker!=null&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(s),this._transmuxer.seek(Math.floor(s*1e3)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=s))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},l.prototype._checkAndResumeStuckPlayback=function(s){var a=this._mediaElement;if(s||!this._receivedCanPlay||a.readyState<2){var p=a.buffered;p.length>0&&a.currentTime<p.start(0)&&(d.default.w(this.TAG,"Playback seems stuck at "+a.currentTime+", seek to "+p.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=p.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},l.prototype._onvLoadedMetadata=function(s){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},l.prototype._onvSeeking=function(s){var a=this._mediaElement.currentTime,p=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=!1;return}if(a<1&&p.length>0){var A=p.start(0);if(A<1&&a<A||i.default.safari){this._requestSetTime=!0,this._mediaElement.currentTime=i.default.safari?.1:A;return}}if(this._isTimepointBuffered(a)){if(this._alwaysSeekKeyframe){var _=this._msectl.getNearestKeyframe(Math.floor(a*1e3));_!=null&&(this._requestSetTime=!0,this._mediaElement.currentTime=_.dts/1e3)}this._progressChecker!=null&&this._checkProgressAndResume();return}this._seekpointRecord={seekPoint:a,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},l.prototype._onvCanPlay=function(s){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},l.prototype._onvStalled=function(s){this._checkAndResumeStuckPlayback(!0)},l.prototype._onvProgress=function(s){this._checkAndResumeStuckPlayback()},l}();m.default=r},"./src/player/native-player.js":function(u,m,D){D.r(m);var S=D("./node_modules/events/events.js"),g=D.n(S),d=D("./src/player/player-events.js"),i=D("./src/config.js"),f=D("./src/utils/exception.js"),o=function(){function v(c,h){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(g()),this._config=(0,i.createDefaultConfig)(),typeof h=="object"&&Object.assign(this._config,h),c.type.toLowerCase()==="flv")throw new f.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(c.hasOwnProperty("segments"))throw new f.InvalidArgumentException("NativePlayer("+c.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=c,this._mediaElement=null}return v.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},v.prototype.on=function(c,h){var t=this;c===d.default.MEDIA_INFO?this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(d.default.MEDIA_INFO,t.mediaInfo)}):c===d.default.STATISTICS_INFO&&this._mediaElement!=null&&this._mediaElement.readyState!==0&&Promise.resolve().then(function(){t._emitter.emit(d.default.STATISTICS_INFO,t.statisticsInfo)}),this._emitter.addListener(c,h)},v.prototype.off=function(c,h){this._emitter.removeListener(c,h)},v.prototype.attachMediaElement=function(c){if(this._mediaElement=c,c.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._pendingSeekTime!=null)try{c.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch{}},v.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},v.prototype.load=function(){if(!this._mediaElement)throw new f.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},v.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),this._statisticsReporter!=null&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},v.prototype.play=function(){return this._mediaElement.play()},v.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(v.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(c){this._mediaElement.volume=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(c){this._mediaElement.muted=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(c){this._mediaElement?this._mediaElement.currentTime=c:this._pendingSeekTime=c},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"mediaInfo",{get:function(){var c=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",h={mimeType:c+this._mediaDataSource.type};return this._mediaElement&&(h.duration=Math.floor(this._mediaElement.duration*1e3),this._mediaElement instanceof HTMLVideoElement&&(h.width=this._mediaElement.videoWidth,h.height=this._mediaElement.videoHeight)),h},enumerable:!1,configurable:!0}),Object.defineProperty(v.prototype,"statisticsInfo",{get:function(){var c={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return c;var h=!0,t=0,e=0;if(this._mediaElement.getVideoPlaybackQuality){var n=this._mediaElement.getVideoPlaybackQuality();t=n.totalVideoFrames,e=n.droppedVideoFrames}else this._mediaElement.webkitDecodedFrameCount!=null?(t=this._mediaElement.webkitDecodedFrameCount,e=this._mediaElement.webkitDroppedFrameCount):h=!1;return h&&(c.decodedFrames=t,c.droppedFrames=e),c},enumerable:!1,configurable:!0}),v.prototype._onvLoadedMetadata=function(c){this._pendingSeekTime!=null&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(d.default.MEDIA_INFO,this.mediaInfo)},v.prototype._reportStatisticsInfo=function(){this._emitter.emit(d.default.STATISTICS_INFO,this.statisticsInfo)},v}();m.default=o},"./src/player/player-errors.js":function(u,m,D){D.r(m),D.d(m,{ErrorTypes:function(){return d},ErrorDetails:function(){return i}});var S=D("./src/io/loader.js"),g=D("./src/demux/demux-errors.js"),d={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},i={NETWORK_EXCEPTION:S.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:S.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:S.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:S.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:g.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:g.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:g.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":function(u,m,D){D.r(m);var S={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"};m.default=S},"./src/remux/aac-silent.js":function(u,m,D){D.r(m);var S=function(){function g(){}return g.getSilentFrame=function(d,i){if(d==="mp4a.40.2"){if(i===1)return new Uint8Array([0,200,0,128,35,128]);if(i===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(i===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(i===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(i===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(i===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(i===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(i===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(i===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},g}();m.default=S},"./src/remux/mp4-generator.js":function(u,m,D){D.r(m);var S=function(){function g(){}return g.init=function(){g.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var d in g.types)g.types.hasOwnProperty(d)&&(g.types[d]=[d.charCodeAt(0),d.charCodeAt(1),d.charCodeAt(2),d.charCodeAt(3)]);var i=g.constants={};i.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),i.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),i.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),i.STSC=i.STCO=i.STTS,i.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),i.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),i.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),i.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),i.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},g.box=function(d){for(var i=8,f=null,o=Array.prototype.slice.call(arguments,1),v=o.length,c=0;c<v;c++)i+=o[c].byteLength;f=new Uint8Array(i),f[0]=i>>>24&255,f[1]=i>>>16&255,f[2]=i>>>8&255,f[3]=i&255,f.set(d,4);for(var h=8,c=0;c<v;c++)f.set(o[c],h),h+=o[c].byteLength;return f},g.generateInitSegment=function(d){var i=g.box(g.types.ftyp,g.constants.FTYP),f=g.moov(d),o=new Uint8Array(i.byteLength+f.byteLength);return o.set(i,0),o.set(f,i.byteLength),o},g.moov=function(d){var i=g.mvhd(d.timescale,d.duration),f=g.trak(d),o=g.mvex(d);return g.box(g.types.moov,i,f,o)},g.mvhd=function(d,i){return g.box(g.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},g.trak=function(d){return g.box(g.types.trak,g.tkhd(d),g.mdia(d))},g.tkhd=function(d){var i=d.id,f=d.duration,o=d.presentWidth,v=d.presentHeight;return g.box(g.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255,0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>>8&255,o&255,0,0,v>>>8&255,v&255,0,0]))},g.mdia=function(d){return g.box(g.types.mdia,g.mdhd(d),g.hdlr(d),g.minf(d))},g.mdhd=function(d){var i=d.timescale,f=d.duration;return g.box(g.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255,f>>>24&255,f>>>16&255,f>>>8&255,f&255,85,196,0,0]))},g.hdlr=function(d){var i=null;return d.type==="audio"?i=g.constants.HDLR_AUDIO:i=g.constants.HDLR_VIDEO,g.box(g.types.hdlr,i)},g.minf=function(d){var i=null;return d.type==="audio"?i=g.box(g.types.smhd,g.constants.SMHD):i=g.box(g.types.vmhd,g.constants.VMHD),g.box(g.types.minf,i,g.dinf(),g.stbl(d))},g.dinf=function(){var d=g.box(g.types.dinf,g.box(g.types.dref,g.constants.DREF));return d},g.stbl=function(d){var i=g.box(g.types.stbl,g.stsd(d),g.box(g.types.stts,g.constants.STTS),g.box(g.types.stsc,g.constants.STSC),g.box(g.types.stsz,g.constants.STSZ),g.box(g.types.stco,g.constants.STCO));return i},g.stsd=function(d){return d.type==="audio"?d.codec==="mp3"?g.box(g.types.stsd,g.constants.STSD_PREFIX,g.mp3(d)):g.box(g.types.stsd,g.constants.STSD_PREFIX,g.mp4a(d)):g.box(g.types.stsd,g.constants.STSD_PREFIX,g.avc1(d))},g.mp3=function(d){var i=d.channelCount,f=d.audioSampleRate,o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,f>>>8&255,f&255,0,0]);return g.box(g.types[".mp3"],o)},g.mp4a=function(d){var i=d.channelCount,f=d.audioSampleRate,o=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i,0,16,0,0,0,0,f>>>8&255,f&255,0,0]);return g.box(g.types.mp4a,o,g.esds(d))},g.esds=function(d){var i=d.config||[],f=i.length,o=new Uint8Array([0,0,0,0,3,23+f,0,1,0,4,15+f,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([f]).concat(i).concat([6,1,2]));return g.box(g.types.esds,o)},g.avc1=function(d){var i=d.avcc,f=d.codecWidth,o=d.codecHeight,v=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>>8&255,f&255,o>>>8&255,o&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return g.box(g.types.avc1,v,g.box(g.types.avcC,i))},g.mvex=function(d){return g.box(g.types.mvex,g.trex(d))},g.trex=function(d){var i=d.id,f=new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return g.box(g.types.trex,f)},g.moof=function(d,i){return g.box(g.types.moof,g.mfhd(d.sequenceNumber),g.traf(d,i))},g.mfhd=function(d){var i=new Uint8Array([0,0,0,0,d>>>24&255,d>>>16&255,d>>>8&255,d&255]);return g.box(g.types.mfhd,i)},g.traf=function(d,i){var f=d.id,o=g.box(g.types.tfhd,new Uint8Array([0,0,0,0,f>>>24&255,f>>>16&255,f>>>8&255,f&255])),v=g.box(g.types.tfdt,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,i&255])),c=g.sdtp(d),h=g.trun(d,c.byteLength+16+16+8+16+8+8);return g.box(g.types.traf,o,v,h,c)},g.sdtp=function(d){for(var i=d.samples||[],f=i.length,o=new Uint8Array(4+f),v=0;v<f;v++){var c=i[v].flags;o[v+4]=c.isLeading<<6|c.dependsOn<<4|c.isDependedOn<<2|c.hasRedundancy}return g.box(g.types.sdtp,o)},g.trun=function(d,i){var f=d.samples||[],o=f.length,v=12+16*o,c=new Uint8Array(v);i+=8+v,c.set([0,0,15,1,o>>>24&255,o>>>16&255,o>>>8&255,o&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255],0);for(var h=0;h<o;h++){var t=f[h].duration,e=f[h].size,n=f[h].flags,r=f[h].cts;c.set([t>>>24&255,t>>>16&255,t>>>8&255,t&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,n.isLeading<<2|n.dependsOn,n.isDependedOn<<6|n.hasRedundancy<<4|n.isNonSync,0,0,r>>>24&255,r>>>16&255,r>>>8&255,r&255],12+16*h)}return g.box(g.types.trun,c)},g.mdat=function(d){return g.box(g.types.mdat,d)},g}();S.init(),m.default=S},"./src/remux/mp4-remuxer.js":function(u,m,D){D.r(m);var S=D("./src/utils/logger.js"),g=D("./src/remux/mp4-generator.js"),d=D("./src/remux/aac-silent.js"),i=D("./src/utils/browser.js"),f=D("./src/core/media-segment-info.js"),o=D("./src/utils/exception.js"),v=function(){function c(h){this.TAG="MP4Remuxer",this._config=h,this._isLive=h.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new f.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new f.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!!(i.default.chrome&&(i.default.version.major<50||i.default.version.major===50&&i.default.version.build<2661)),this._fillSilentAfterSeek=i.default.msedge||i.default.msie,this._mp3UseMpegAudio=!i.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return c.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},c.prototype.bindDataSource=function(h){return h.onDataAvailable=this.remux.bind(this),h.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(c.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(h){this._onInitSegment=h},enumerable:!1,configurable:!0}),Object.defineProperty(c.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(h){this._onMediaSegment=h},enumerable:!1,configurable:!0}),c.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},c.prototype.seek=function(h){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},c.prototype.remux=function(h,t){if(!this._onMediaSegment)throw new o.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(h,t),this._remuxVideo(t),this._remuxAudio(h)},c.prototype._onTrackMetadataReceived=function(h,t){var e=null,n="mp4",r=t.codec;if(h==="audio")this._audioMeta=t,t.codec==="mp3"&&this._mp3UseMpegAudio?(n="mpeg",r="",e=new Uint8Array):e=g.default.generateInitSegment(t);else if(h==="video")this._videoMeta=t,e=g.default.generateInitSegment(t);else return;if(!this._onInitSegment)throw new o.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(h,{type:h,data:e.buffer,codec:r,container:h+"/"+n,mediaDuration:t.duration})},c.prototype._calculateDtsBase=function(h,t){this._dtsBaseInited||(h.samples&&h.samples.length&&(this._audioDtsBase=h.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},c.prototype.flushStashedSamples=function(){var h=this._videoStashedLastSample,t=this._audioStashedLastSample,e={type:"video",id:1,sequenceNumber:0,samples:[],length:0};h!=null&&(e.samples.push(h),e.length=h.length);var n={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};t!=null&&(n.samples.push(t),n.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(e,!0),this._remuxAudio(n,!0)},c.prototype._remuxAudio=function(h,t){if(this._audioMeta!=null){var e=h,n=e.samples,r=void 0,l=-1,s=-1,a=this._audioMeta.refSampleDuration,p=this._audioMeta.codec==="mp3"&&this._mp3UseMpegAudio,A=this._dtsBaseInited&&this._audioNextDts===void 0,_=!1;if(!(!n||n.length===0)&&!(n.length===1&&!t)){var y=0,L=null,x=0;p?(y=0,x=e.length):(y=8,x=8+e.length);var T=null;if(n.length>1&&(T=n.pop(),x-=T.length),this._audioStashedLastSample!=null){var O=this._audioStashedLastSample;this._audioStashedLastSample=null,n.unshift(O),x+=O.length}T!=null&&(this._audioStashedLastSample=T);var R=n[0].dts-this._dtsBase;if(this._audioNextDts)r=R-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())r=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&this._audioMeta.originalCodec!=="mp3"&&(_=!0);else{var I=this._audioSegmentInfoList.getLastSampleBefore(R);if(I!=null){var C=R-(I.originalDts+I.duration);C<=3&&(C=0);var w=I.dts+I.duration+C;r=R-w}else r=0}if(_){var F=R-r,B=this._videoSegmentInfoList.getLastSegmentBefore(R);if(B!=null&&B.beginDts<F){var k=d.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(k){var U=B.beginDts,N=F-B.beginDts;S.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+U+", duration: "+N),n.unshift({unit:k,dts:U,pts:U}),x+=k.byteLength}}else _=!1}for(var j=[],K=0;K<n.length;K++){var O=n[K],H=O.unit,V=O.dts-this._dtsBase,U=V,G=!1,ee=null,q=0;if(!(V<-.001)){if(this._audioMeta.codec!=="mp3"){var z=V,X=3;if(this._audioNextDts&&(z=this._audioNextDts),r=V-z,r<=-X*a){S.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+V+" ms ,curRefDts: "+z+" ms)  due to dtsCorrection: "+r+" ms overlap.");continue}else if(r>=X*a&&this._fillAudioTimestampGap&&!i.default.safari){G=!0;var J=Math.floor(r/a);S.default.w(this.TAG,`Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.
`+("originalDts: "+V+" ms, curRefDts: "+z+" ms, ")+("dtsCorrection: "+Math.round(r)+" ms, generate: "+J+" frames")),U=Math.floor(z),q=Math.floor(z+a)-U;var k=d.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);k==null&&(S.default.w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),k=H),ee=[];for(var ie=0;ie<J;ie++){z=z+a;var ae=Math.floor(z),se=Math.floor(z+a)-ae,le={dts:ae,pts:ae,cts:0,unit:k,size:k.byteLength,duration:se,originalDts:V,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};ee.push(le),x+=le.size}this._audioNextDts=z+a}else U=Math.floor(z),q=Math.floor(z+a)-U,this._audioNextDts=z+a}else{if(U=V-r,K!==n.length-1){var ue=n[K+1].dts-this._dtsBase-r;q=ue-U}else if(T!=null){var ue=T.dts-this._dtsBase-r;q=ue-U}else j.length>=1?q=j[j.length-1].duration:q=Math.floor(a);this._audioNextDts=U+q}l===-1&&(l=U),j.push({dts:U,pts:U,cts:0,unit:O.unit,size:O.unit.byteLength,duration:q,originalDts:V,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),G&&j.push.apply(j,ee)}}if(j.length===0){e.samples=[],e.length=0;return}p?L=new Uint8Array(x):(L=new Uint8Array(x),L[0]=x>>>24&255,L[1]=x>>>16&255,L[2]=x>>>8&255,L[3]=x&255,L.set(g.default.types.mdat,4));for(var K=0;K<j.length;K++){var H=j[K].unit;L.set(H,y),y+=H.byteLength}var Z=j[j.length-1];s=Z.dts+Z.duration;var oe=new f.MediaSegmentInfo;oe.beginDts=l,oe.endDts=s,oe.beginPts=l,oe.endPts=s,oe.originalBeginDts=j[0].originalDts,oe.originalEndDts=Z.originalDts+Z.duration,oe.firstSample=new f.SampleInfo(j[0].dts,j[0].pts,j[0].duration,j[0].originalDts,!1),oe.lastSample=new f.SampleInfo(Z.dts,Z.pts,Z.duration,Z.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(oe),e.samples=j,e.sequenceNumber++;var de=null;p?de=new Uint8Array:de=g.default.moof(e,l),e.samples=[],e.length=0;var ce={type:"audio",data:this._mergeBoxes(de,L).buffer,sampleCount:j.length,info:oe};p&&A&&(ce.timestampOffset=l),this._onMediaSegment("audio",ce)}}},c.prototype._remuxVideo=function(h,t){if(this._videoMeta!=null){var e=h,n=e.samples,r=void 0,l=-1,s=-1,a=-1,p=-1;if(!(!n||n.length===0)&&!(n.length===1&&!t)){var A=8,_=null,y=8+h.length,L=null;if(n.length>1&&(L=n.pop(),y-=L.length),this._videoStashedLastSample!=null){var x=this._videoStashedLastSample;this._videoStashedLastSample=null,n.unshift(x),y+=x.length}L!=null&&(this._videoStashedLastSample=L);var T=n[0].dts-this._dtsBase;if(this._videoNextDts)r=T-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())r=0;else{var O=this._videoSegmentInfoList.getLastSampleBefore(T);if(O!=null){var R=T-(O.originalDts+O.duration);R<=3&&(R=0);var I=O.dts+O.duration+R;r=T-I}else r=0}for(var C=new f.MediaSegmentInfo,w=[],F=0;F<n.length;F++){var x=n[F],B=x.dts-this._dtsBase,k=x.isKeyframe,U=B-r,N=x.cts,j=U+N;l===-1&&(l=U,a=j);var K=0;if(F!==n.length-1){var H=n[F+1].dts-this._dtsBase-r;K=H-U}else if(L!=null){var H=L.dts-this._dtsBase-r;K=H-U}else w.length>=1?K=w[w.length-1].duration:K=Math.floor(this._videoMeta.refSampleDuration);if(k){var V=new f.SampleInfo(U,j,K,x.dts,!0);V.fileposition=x.fileposition,C.appendSyncPoint(V)}w.push({dts:U,pts:j,cts:N,units:x.units,size:x.length,isKeyframe:k,duration:K,originalDts:B,flags:{isLeading:0,dependsOn:k?2:1,isDependedOn:k?1:0,hasRedundancy:0,isNonSync:k?0:1}})}_=new Uint8Array(y),_[0]=y>>>24&255,_[1]=y>>>16&255,_[2]=y>>>8&255,_[3]=y&255,_.set(g.default.types.mdat,4);for(var F=0;F<w.length;F++)for(var G=w[F].units;G.length;){var ee=G.shift(),q=ee.data;_.set(q,A),A+=q.byteLength}var z=w[w.length-1];if(s=z.dts+z.duration,p=z.pts+z.duration,this._videoNextDts=s,C.beginDts=l,C.endDts=s,C.beginPts=a,C.endPts=p,C.originalBeginDts=w[0].originalDts,C.originalEndDts=z.originalDts+z.duration,C.firstSample=new f.SampleInfo(w[0].dts,w[0].pts,w[0].duration,w[0].originalDts,w[0].isKeyframe),C.lastSample=new f.SampleInfo(z.dts,z.pts,z.duration,z.originalDts,z.isKeyframe),this._isLive||this._videoSegmentInfoList.append(C),e.samples=w,e.sequenceNumber++,this._forceFirstIDR){var X=w[0].flags;X.dependsOn=2,X.isNonSync=0}var J=g.default.moof(e,l);e.samples=[],e.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(J,_).buffer,sampleCount:w.length,info:C})}}},c.prototype._mergeBoxes=function(h,t){var e=new Uint8Array(h.byteLength+t.byteLength);return e.set(h,0),e.set(t,h.byteLength),e},c}();m.default=v},"./src/utils/browser.js":function(u,m,D){D.r(m);var S={};function g(){var d=self.navigator.userAgent.toLowerCase(),i=/(edge)\/([\w.]+)/.exec(d)||/(opr)[\/]([\w.]+)/.exec(d)||/(chrome)[ \/]([\w.]+)/.exec(d)||/(iemobile)[\/]([\w.]+)/.exec(d)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(d)||/(webkit)[ \/]([\w.]+)/.exec(d)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(d)||/(msie) ([\w.]+)/.exec(d)||d.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(d)||d.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(d)||[],f=/(ipad)/.exec(d)||/(ipod)/.exec(d)||/(windows phone)/.exec(d)||/(iphone)/.exec(d)||/(kindle)/.exec(d)||/(android)/.exec(d)||/(windows)/.exec(d)||/(mac)/.exec(d)||/(linux)/.exec(d)||/(cros)/.exec(d)||[],o={browser:i[5]||i[3]||i[1]||"",version:i[2]||i[4]||"0",majorVersion:i[4]||i[2]||"0",platform:f[0]||""},v={};if(o.browser){v[o.browser]=!0;var c=o.majorVersion.split(".");v.version={major:parseInt(o.majorVersion,10),string:o.version},c.length>1&&(v.version.minor=parseInt(c[1],10)),c.length>2&&(v.version.build=parseInt(c[2],10))}if(o.platform&&(v[o.platform]=!0),(v.chrome||v.opr||v.safari)&&(v.webkit=!0),v.rv||v.iemobile){v.rv&&delete v.rv;var h="msie";o.browser=h,v[h]=!0}if(v.edge){delete v.edge;var t="msedge";o.browser=t,v[t]=!0}if(v.opr){var e="opera";o.browser=e,v[e]=!0}if(v.safari&&v.android){var n="android";o.browser=n,v[n]=!0}v.name=o.browser,v.platform=o.platform;for(var r in S)S.hasOwnProperty(r)&&delete S[r];Object.assign(S,v)}g(),m.default=S},"./src/utils/exception.js":function(u,m,D){D.r(m),D.d(m,{RuntimeException:function(){return g},IllegalStateException:function(){return d},InvalidArgumentException:function(){return i},NotImplementedException:function(){return f}});var S=function(){var o=function(v,c){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,t){h.__proto__=t}||function(h,t){for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(h[e]=t[e])},o(v,c)};return function(v,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");o(v,c);function h(){this.constructor=v}v.prototype=c===null?Object.create(c):(h.prototype=c.prototype,new h)}}(),g=function(){function o(v){this._message=v}return Object.defineProperty(o.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(o.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),o.prototype.toString=function(){return this.name+": "+this.message},o}(),d=function(o){S(v,o);function v(c){return o.call(this,c)||this}return Object.defineProperty(v.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),v}(g),i=function(o){S(v,o);function v(c){return o.call(this,c)||this}return Object.defineProperty(v.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),v}(g),f=function(o){S(v,o);function v(c){return o.call(this,c)||this}return Object.defineProperty(v.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),v}(g)},"./src/utils/logger.js":function(u,m,D){D.r(m);var S=D("./node_modules/events/events.js"),g=D.n(S),d=function(){function i(){}return i.e=function(f,o){(!f||i.FORCE_GLOBAL_TAG)&&(f=i.GLOBAL_TAG);var v="["+f+"] > "+o;i.ENABLE_CALLBACK&&i.emitter.emit("log","error",v),i.ENABLE_ERROR&&(console.error?console.error(v):console.warn?console.warn(v):console.log(v))},i.i=function(f,o){(!f||i.FORCE_GLOBAL_TAG)&&(f=i.GLOBAL_TAG);var v="["+f+"] > "+o;i.ENABLE_CALLBACK&&i.emitter.emit("log","info",v),i.ENABLE_INFO&&(console.info?console.info(v):console.log(v))},i.w=function(f,o){(!f||i.FORCE_GLOBAL_TAG)&&(f=i.GLOBAL_TAG);var v="["+f+"] > "+o;i.ENABLE_CALLBACK&&i.emitter.emit("log","warn",v),i.ENABLE_WARN&&(console.warn?console.warn(v):console.log(v))},i.d=function(f,o){(!f||i.FORCE_GLOBAL_TAG)&&(f=i.GLOBAL_TAG);var v="["+f+"] > "+o;i.ENABLE_CALLBACK&&i.emitter.emit("log","debug",v),i.ENABLE_DEBUG&&(console.debug?console.debug(v):console.log(v))},i.v=function(f,o){(!f||i.FORCE_GLOBAL_TAG)&&(f=i.GLOBAL_TAG);var v="["+f+"] > "+o;i.ENABLE_CALLBACK&&i.emitter.emit("log","verbose",v),i.ENABLE_VERBOSE&&console.log(v)},i}();d.GLOBAL_TAG="flv.js",d.FORCE_GLOBAL_TAG=!1,d.ENABLE_ERROR=!0,d.ENABLE_INFO=!0,d.ENABLE_WARN=!0,d.ENABLE_DEBUG=!0,d.ENABLE_VERBOSE=!0,d.ENABLE_CALLBACK=!1,d.emitter=new(g()),m.default=d},"./src/utils/logging-control.js":function(u,m,D){D.r(m);var S=D("./node_modules/events/events.js"),g=D.n(S),d=D("./src/utils/logger.js"),i=function(){function f(){}return Object.defineProperty(f,"forceGlobalTag",{get:function(){return d.default.FORCE_GLOBAL_TAG},set:function(o){d.default.FORCE_GLOBAL_TAG=o,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"globalTag",{get:function(){return d.default.GLOBAL_TAG},set:function(o){d.default.GLOBAL_TAG=o,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableAll",{get:function(){return d.default.ENABLE_VERBOSE&&d.default.ENABLE_DEBUG&&d.default.ENABLE_INFO&&d.default.ENABLE_WARN&&d.default.ENABLE_ERROR},set:function(o){d.default.ENABLE_VERBOSE=o,d.default.ENABLE_DEBUG=o,d.default.ENABLE_INFO=o,d.default.ENABLE_WARN=o,d.default.ENABLE_ERROR=o,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableDebug",{get:function(){return d.default.ENABLE_DEBUG},set:function(o){d.default.ENABLE_DEBUG=o,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableVerbose",{get:function(){return d.default.ENABLE_VERBOSE},set:function(o){d.default.ENABLE_VERBOSE=o,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableInfo",{get:function(){return d.default.ENABLE_INFO},set:function(o){d.default.ENABLE_INFO=o,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableWarn",{get:function(){return d.default.ENABLE_WARN},set:function(o){d.default.ENABLE_WARN=o,f._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(f,"enableError",{get:function(){return d.default.ENABLE_ERROR},set:function(o){d.default.ENABLE_ERROR=o,f._notifyChange()},enumerable:!1,configurable:!0}),f.getConfig=function(){return{globalTag:d.default.GLOBAL_TAG,forceGlobalTag:d.default.FORCE_GLOBAL_TAG,enableVerbose:d.default.ENABLE_VERBOSE,enableDebug:d.default.ENABLE_DEBUG,enableInfo:d.default.ENABLE_INFO,enableWarn:d.default.ENABLE_WARN,enableError:d.default.ENABLE_ERROR,enableCallback:d.default.ENABLE_CALLBACK}},f.applyConfig=function(o){d.default.GLOBAL_TAG=o.globalTag,d.default.FORCE_GLOBAL_TAG=o.forceGlobalTag,d.default.ENABLE_VERBOSE=o.enableVerbose,d.default.ENABLE_DEBUG=o.enableDebug,d.default.ENABLE_INFO=o.enableInfo,d.default.ENABLE_WARN=o.enableWarn,d.default.ENABLE_ERROR=o.enableError,d.default.ENABLE_CALLBACK=o.enableCallback},f._notifyChange=function(){var o=f.emitter;if(o.listenerCount("change")>0){var v=f.getConfig();o.emit("change",v)}},f.registerListener=function(o){f.emitter.addListener("change",o)},f.removeListener=function(o){f.emitter.removeListener("change",o)},f.addLogListener=function(o){d.default.emitter.addListener("log",o),d.default.emitter.listenerCount("log")>0&&(d.default.ENABLE_CALLBACK=!0,f._notifyChange())},f.removeLogListener=function(o){d.default.emitter.removeListener("log",o),d.default.emitter.listenerCount("log")===0&&(d.default.ENABLE_CALLBACK=!1,f._notifyChange())},f}();i.emitter=new(g()),m.default=i},"./src/utils/polyfill.js":function(u,m,D){D.r(m);var S=function(){function g(){}return g.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(d,i){return d.__proto__=i,d},Object.assign=Object.assign||function(d){if(d==null)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(d),f=1;f<arguments.length;f++){var o=arguments[f];if(o!=null)for(var v in o)o.hasOwnProperty(v)&&(i[v]=o[v])}return i},typeof self.Promise!="function"&&D("./node_modules/es6-promise/dist/es6-promise.js").polyfill()},g}();S.install(),m.default=S},"./src/utils/utf8-conv.js":function(u,m,D){D.r(m);function S(d,i,f){var o=d;if(i+f<o.length){for(;f--;)if((o[++i]&192)!==128)return!1;return!0}else return!1}function g(d){for(var i=[],f=d,o=0,v=d.length;o<v;){if(f[o]<128){i.push(String.fromCharCode(f[o])),++o;continue}else if(!(f[o]<192)){if(f[o]<224){if(S(f,o,1)){var c=(f[o]&31)<<6|f[o+1]&63;if(c>=128){i.push(String.fromCharCode(c&65535)),o+=2;continue}}}else if(f[o]<240){if(S(f,o,2)){var c=(f[o]&15)<<12|(f[o+1]&63)<<6|f[o+2]&63;if(c>=2048&&(c&63488)!==55296){i.push(String.fromCharCode(c&65535)),o+=3;continue}}}else if(f[o]<248&&S(f,o,3)){var c=(f[o]&7)<<18|(f[o+1]&63)<<12|(f[o+2]&63)<<6|f[o+3]&63;if(c>65536&&c<1114112){c-=65536,i.push(String.fromCharCode(c>>>10|55296)),i.push(String.fromCharCode(c&1023|56320)),o+=4;continue}}}i.push(String.fromCharCode(65533)),++o}return i.join("")}m.default=g}},P={};function E(u){var m=P[u];if(m!==void 0)return m.exports;var D=P[u]={exports:{}};return M[u].call(D.exports,D,D.exports,E),D.exports}E.m=M,function(){E.n=function(u){var m=u&&u.__esModule?function(){return u.default}:function(){return u};return E.d(m,{a:m}),m}}(),function(){E.d=function(u,m){for(var D in m)E.o(m,D)&&!E.o(u,D)&&Object.defineProperty(u,D,{enumerable:!0,get:m[D]})}}(),function(){E.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}()}(),function(){E.o=function(u,m){return Object.prototype.hasOwnProperty.call(u,m)}}(),function(){E.r=function(u){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(u,"__esModule",{value:!0})}}();var b=E("./src/index.js");return b}()})})(He);const vt=ke(He.exports);var Ve={exports:{}};(function(xe,Pe){typeof window<"u"&&function(P,E){xe.exports=E()}(Be,function(){return function(M){var P={};function E(b){if(P[b])return P[b].exports;var u=P[b]={i:b,l:!1,exports:{}};return M[b].call(u.exports,u,u.exports,E),u.l=!0,u.exports}return E.m=M,E.c=P,E.d=function(b,u,m){E.o(b,u)||Object.defineProperty(b,u,{enumerable:!0,get:m})},E.r=function(b){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(b,"__esModule",{value:!0})},E.t=function(b,u){if(u&1&&(b=E(b)),u&8||u&4&&typeof b=="object"&&b&&b.__esModule)return b;var m=Object.create(null);if(E.r(m),Object.defineProperty(m,"default",{enumerable:!0,value:b}),u&2&&typeof b!="string")for(var D in b)E.d(m,D,function(S){return b[S]}.bind(null,D));return m},E.n=function(b){var u=b&&b.__esModule?function(){return b.default}:function(){return b};return E.d(u,"a",u),u},E.o=function(b,u){return Object.prototype.hasOwnProperty.call(b,u)},E.p="/dist/",E(E.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(M,P,E){var b=Object.prototype.hasOwnProperty,u="~";function m(){}Object.create&&(m.prototype=Object.create(null),new m().__proto__||(u=!1));function D(i,f,o){this.fn=i,this.context=f,this.once=o||!1}function S(i,f,o,v,c){if(typeof o!="function")throw new TypeError("The listener must be a function");var h=new D(o,v||i,c),t=u?u+f:f;return i._events[t]?i._events[t].fn?i._events[t]=[i._events[t],h]:i._events[t].push(h):(i._events[t]=h,i._eventsCount++),i}function g(i,f){--i._eventsCount===0?i._events=new m:delete i._events[f]}function d(){this._events=new m,this._eventsCount=0}d.prototype.eventNames=function(){var f=[],o,v;if(this._eventsCount===0)return f;for(v in o=this._events)b.call(o,v)&&f.push(u?v.slice(1):v);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(o)):f},d.prototype.listeners=function(f){var o=u?u+f:f,v=this._events[o];if(!v)return[];if(v.fn)return[v.fn];for(var c=0,h=v.length,t=new Array(h);c<h;c++)t[c]=v[c].fn;return t},d.prototype.listenerCount=function(f){var o=u?u+f:f,v=this._events[o];return v?v.fn?1:v.length:0},d.prototype.emit=function(f,o,v,c,h,t){var e=u?u+f:f;if(!this._events[e])return!1;var n=this._events[e],r=arguments.length,l,s;if(n.fn){switch(n.once&&this.removeListener(f,n.fn,void 0,!0),r){case 1:return n.fn.call(n.context),!0;case 2:return n.fn.call(n.context,o),!0;case 3:return n.fn.call(n.context,o,v),!0;case 4:return n.fn.call(n.context,o,v,c),!0;case 5:return n.fn.call(n.context,o,v,c,h),!0;case 6:return n.fn.call(n.context,o,v,c,h,t),!0}for(s=1,l=new Array(r-1);s<r;s++)l[s-1]=arguments[s];n.fn.apply(n.context,l)}else{var a=n.length,p;for(s=0;s<a;s++)switch(n[s].once&&this.removeListener(f,n[s].fn,void 0,!0),r){case 1:n[s].fn.call(n[s].context);break;case 2:n[s].fn.call(n[s].context,o);break;case 3:n[s].fn.call(n[s].context,o,v);break;case 4:n[s].fn.call(n[s].context,o,v,c);break;default:if(!l)for(p=1,l=new Array(r-1);p<r;p++)l[p-1]=arguments[p];n[s].fn.apply(n[s].context,l)}}return!0},d.prototype.on=function(f,o,v){return S(this,f,o,v,!1)},d.prototype.once=function(f,o,v){return S(this,f,o,v,!0)},d.prototype.removeListener=function(f,o,v,c){var h=u?u+f:f;if(!this._events[h])return this;if(!o)return g(this,h),this;var t=this._events[h];if(t.fn)t.fn===o&&(!c||t.once)&&(!v||t.context===v)&&g(this,h);else{for(var e=0,n=[],r=t.length;e<r;e++)(t[e].fn!==o||c&&!t[e].once||v&&t[e].context!==v)&&n.push(t[e]);n.length?this._events[h]=n.length===1?n[0]:n:g(this,h)}return this},d.prototype.removeAllListeners=function(f){var o;return f?(o=u?u+f:f,this._events[o]&&g(this,o)):(this._events=new m,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=u,d.EventEmitter=d,M.exports=d},"./node_modules/url-toolkit/src/url-toolkit.js":function(M,P,E){(function(b){var u=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,m=/^(?=([^\/?#]*))\1([^]*)$/,D=/(?:\/|^)\.(?=\/)/g,S=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,g={buildAbsoluteURL:function(d,i,f){if(f=f||{},d=d.trim(),i=i.trim(),!i){if(!f.alwaysNormalize)return d;var o=g.parseURL(d);if(!o)throw new Error("Error trying to parse base URL.");return o.path=g.normalizePath(o.path),g.buildURLFromParts(o)}var v=g.parseURL(i);if(!v)throw new Error("Error trying to parse relative URL.");if(v.scheme)return f.alwaysNormalize?(v.path=g.normalizePath(v.path),g.buildURLFromParts(v)):i;var c=g.parseURL(d);if(!c)throw new Error("Error trying to parse base URL.");if(!c.netLoc&&c.path&&c.path[0]!=="/"){var h=m.exec(c.path);c.netLoc=h[1],c.path=h[2]}c.netLoc&&!c.path&&(c.path="/");var t={scheme:c.scheme,netLoc:v.netLoc,path:null,params:v.params,query:v.query,fragment:v.fragment};if(!v.netLoc&&(t.netLoc=c.netLoc,v.path[0]!=="/"))if(!v.path)t.path=c.path,v.params||(t.params=c.params,v.query||(t.query=c.query));else{var e=c.path,n=e.substring(0,e.lastIndexOf("/")+1)+v.path;t.path=g.normalizePath(n)}return t.path===null&&(t.path=f.alwaysNormalize?g.normalizePath(v.path):v.path),g.buildURLFromParts(t)},parseURL:function(d){var i=u.exec(d);return i?{scheme:i[1]||"",netLoc:i[2]||"",path:i[3]||"",params:i[4]||"",query:i[5]||"",fragment:i[6]||""}:null},normalizePath:function(d){for(d=d.split("").reverse().join("").replace(D,"");d.length!==(d=d.replace(S,"")).length;);return d.split("").reverse().join("")},buildURLFromParts:function(d){return d.scheme+d.netLoc+d.path+d.params+d.query+d.fragment}};M.exports=g})()},"./node_modules/webworkify-webpack/index.js":function(M,P,E){function b(f){var o={};function v(h){if(o[h])return o[h].exports;var t=o[h]={i:h,l:!1,exports:{}};return f[h].call(t.exports,t,t.exports,v),t.l=!0,t.exports}v.m=f,v.c=o,v.i=function(h){return h},v.d=function(h,t,e){v.o(h,t)||Object.defineProperty(h,t,{configurable:!1,enumerable:!0,get:e})},v.r=function(h){Object.defineProperty(h,"__esModule",{value:!0})},v.n=function(h){var t=h&&h.__esModule?function(){return h.default}:function(){return h};return v.d(t,"a",t),t},v.o=function(h,t){return Object.prototype.hasOwnProperty.call(h,t)},v.p="/",v.oe=function(h){throw console.error(h),h};var c=v(v.s=ENTRY_MODULE);return c.default||c}var u="[\\.|\\-|\\+|\\w|/|@]+",m="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+u+").*?\\)";function D(f){return(f+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function S(f){return!isNaN(1*f)}function g(f,o,v){var c={};c[v]=[];var h=o.toString(),t=h.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!t)return c;for(var e=t[1],n=new RegExp("(\\\\n|\\W)"+D(e)+m,"g"),r;r=n.exec(h);)r[3]!=="dll-reference"&&c[v].push(r[3]);for(n=new RegExp("\\("+D(e)+'\\("(dll-reference\\s('+u+'))"\\)\\)'+m,"g");r=n.exec(h);)f[r[2]]||(c[v].push(r[1]),f[r[2]]=E(r[1]).m),c[r[2]]=c[r[2]]||[],c[r[2]].push(r[4]);for(var l=Object.keys(c),s=0;s<l.length;s++)for(var a=0;a<c[l[s]].length;a++)S(c[l[s]][a])&&(c[l[s]][a]=1*c[l[s]][a]);return c}function d(f){var o=Object.keys(f);return o.reduce(function(v,c){return v||f[c].length>0},!1)}function i(f,o){for(var v={main:[o]},c={main:[]},h={main:{}};d(v);)for(var t=Object.keys(v),e=0;e<t.length;e++){var n=t[e],r=v[n],l=r.pop();if(h[n]=h[n]||{},!(h[n][l]||!f[n][l])){h[n][l]=!0,c[n]=c[n]||[],c[n].push(l);for(var s=g(f,f[n][l],n),a=Object.keys(s),p=0;p<a.length;p++)v[a[p]]=v[a[p]]||[],v[a[p]]=v[a[p]].concat(s[a[p]])}}return c}M.exports=function(f,o){o=o||{};var v={main:E.m},c=o.all?{main:Object.keys(v.main)}:i(v,f),h="";Object.keys(c).filter(function(l){return l!=="main"}).forEach(function(l){for(var s=0;c[l][s];)s++;c[l].push(s),v[l][s]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",h=h+"var "+l+" = ("+b.toString().replace("ENTRY_MODULE",JSON.stringify(s))+")({"+c[l].map(function(a){return""+JSON.stringify(a)+": "+v[l][a].toString()}).join(",")+`});
`}),h=h+"new (("+b.toString().replace("ENTRY_MODULE",JSON.stringify(f))+")({"+c.main.map(function(l){return""+JSON.stringify(l)+": "+v.main[l].toString()}).join(",")+"}))(self);";var t=new window.Blob([h],{type:"text/javascript"});if(o.bare)return t;var e=window.URL||window.webkitURL||window.mozURL||window.msURL,n=e.createObjectURL(t),r=new window.Worker(n);return r.objectURL=n,r}},"./src/config.ts":function(M,P,E){E.r(P),E.d(P,"hlsDefaultConfig",function(){return p}),E.d(P,"mergeConfig",function(){return _}),E.d(P,"enableStreamingMode",function(){return y});var b=E("./src/controller/abr-controller.ts"),u=E("./src/controller/audio-stream-controller.ts"),m=E("./src/controller/audio-track-controller.ts"),D=E("./src/controller/subtitle-stream-controller.ts"),S=E("./src/controller/subtitle-track-controller.ts"),g=E("./src/controller/buffer-controller.ts"),d=E("./src/controller/timeline-controller.ts"),i=E("./src/controller/cap-level-controller.ts"),f=E("./src/controller/fps-controller.ts"),o=E("./src/controller/eme-controller.ts"),v=E("./src/controller/cmcd-controller.ts"),c=E("./src/utils/xhr-loader.ts"),h=E("./src/utils/fetch-loader.ts"),t=E("./src/utils/cues.ts"),e=E("./src/utils/mediakeys-helper.ts"),n=E("./src/utils/logger.ts");function r(){return r=Object.assign?Object.assign.bind():function(L){for(var x=1;x<arguments.length;x++){var T=arguments[x];for(var O in T)Object.prototype.hasOwnProperty.call(T,O)&&(L[O]=T[O])}return L},r.apply(this,arguments)}function l(L,x){var T=Object.keys(L);if(Object.getOwnPropertySymbols){var O=Object.getOwnPropertySymbols(L);x&&(O=O.filter(function(R){return Object.getOwnPropertyDescriptor(L,R).enumerable})),T.push.apply(T,O)}return T}function s(L){for(var x=1;x<arguments.length;x++){var T=arguments[x]!=null?arguments[x]:{};x%2?l(Object(T),!0).forEach(function(O){a(L,O,T[O])}):Object.getOwnPropertyDescriptors?Object.defineProperties(L,Object.getOwnPropertyDescriptors(T)):l(Object(T)).forEach(function(O){Object.defineProperty(L,O,Object.getOwnPropertyDescriptor(T,O))})}return L}function a(L,x,T){return x in L?Object.defineProperty(L,x,{value:T,enumerable:!0,configurable:!0,writable:!0}):L[x]=T,L}var p=s(s({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:c.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:b.default,bufferController:g.default,capLevelController:i.default,fpsController:f.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:e.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},A()),{},{subtitleStreamController:D.SubtitleStreamController,subtitleTrackController:S.default,timelineController:d.TimelineController,audioStreamController:u.default,audioTrackController:m.default,emeController:o.default,cmcdController:v.default});function A(){return{cueHandler:t.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function _(L,x){if((x.liveSyncDurationCount||x.liveMaxLatencyDurationCount)&&(x.liveSyncDuration||x.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(x.liveMaxLatencyDurationCount!==void 0&&(x.liveSyncDurationCount===void 0||x.liveMaxLatencyDurationCount<=x.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(x.liveMaxLatencyDuration!==void 0&&(x.liveSyncDuration===void 0||x.liveMaxLatencyDuration<=x.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return r({},L,x)}function y(L){var x=L.loader;if(x!==h.default&&x!==c.default)n.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),L.progressive=!1;else{var T=Object(h.fetchSupported)();T&&(L.loader=h.default,L.progressive=!0,L.enableSoftwareAES=!0,n.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(M,P,E){E.r(P);var b=E("./src/polyfills/number.ts"),u=E("./src/utils/ewma-bandwidth-estimator.ts"),m=E("./src/events.ts"),D=E("./src/utils/buffer-helper.ts"),S=E("./src/errors.ts"),g=E("./src/types/loader.ts"),d=E("./src/utils/logger.ts");function i(v,c){for(var h=0;h<c.length;h++){var t=c[h];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function f(v,c,h){return c&&i(v.prototype,c),h&&i(v,h),Object.defineProperty(v,"prototype",{writable:!1}),v}var o=function(){function v(h){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=h;var t=h.config;this.bwEstimator=new u.default(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var c=v.prototype;return c.registerListeners=function(){var t=this.hls;t.on(m.Events.FRAG_LOADING,this.onFragLoading,this),t.on(m.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(m.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(m.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(m.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var t=this.hls;t.off(m.Events.FRAG_LOADING,this.onFragLoading,this),t.off(m.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(m.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(m.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(m.Events.ERROR,this.onError,this)},c.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},c.onFragLoading=function(t,e){var n=e.frag;if(n.type===g.PlaylistLevelType.MAIN&&!this.timer){var r;this.fragCurrent=n,this.partCurrent=(r=e.part)!=null?r:null,this.timer=self.setInterval(this.onCheck,100)}},c.onLevelLoaded=function(t,e){var n=this.hls.config;e.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)},c._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,n=this.hls,r=n.autoLevelEnabled,l=n.config,s=n.media;if(!(!t||!s)){var a=e?e.stats:t.stats,p=e?e.duration:t.duration;if(a.aborted){d.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!r||s.paused||!s.playbackRate||!s.readyState)){var A=performance.now()-a.loading.start,_=Math.abs(s.playbackRate);if(!(A<=500*p/_)){var y=n.levels,L=n.minAutoLevel,x=y[t.level],T=a.total||Math.max(a.loaded,Math.round(p*x.maxBitrate/8)),O=Math.max(1,a.bwEstimate?a.bwEstimate/8:a.loaded*1e3/A),R=(T-a.loaded)/O,I=s.currentTime,C=(D.BufferHelper.bufferInfo(s,I,l.maxBufferHole).end-I)/_;if(!(C>=2*p/_||R<=C)){var w=Number.POSITIVE_INFINITY,F;for(F=t.level-1;F>L;F--){var B=y[F].maxBitrate;if(w=p*B/(8*.8*O),w<C)break}if(!(w>=R)){var k=this.bwEstimator.getEstimate();d.logger.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+F+`
      Current BW estimate: `+(Object(b.isFiniteNumber)(k)?(k/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+R.toFixed(3)+` s
      Estimated load time for the next fragment: `+w.toFixed(3)+` s
      Time to underbuffer: `+C.toFixed(3)+" s"),n.nextLoadLevel=F,this.bwEstimator.sample(A,a.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),n.trigger(m.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:a})}}}}}},c.onFragLoaded=function(t,e){var n=e.frag,r=e.part;if(n.type===g.PlaylistLevelType.MAIN&&Object(b.isFiniteNumber)(n.sn)){var l=r?r.stats:n.stats,s=r?r.duration:n.duration;if(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=this.hls.levels[n.level],p=(a.loaded?a.loaded.bytes:0)+l.loaded,A=(a.loaded?a.loaded.duration:0)+s;a.loaded={bytes:p,duration:A},a.realBitrate=Math.round(8*p/A)}if(n.bitrateTest){var _={stats:l,frag:n,part:r,id:n.type};this.onFragBuffered(m.Events.FRAG_BUFFERED,_),n.bitrateTest=!1}}},c.onFragBuffered=function(t,e){var n=e.frag,r=e.part,l=r?r.stats:n.stats;if(!l.aborted&&!(n.type!==g.PlaylistLevelType.MAIN||n.sn==="initSegment")){var s=l.parsing.end-l.loading.start;this.bwEstimator.sample(s,l.loaded),l.bwEstimate=this.bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},c.onError=function(t,e){switch(e.details){case S.ErrorDetails.FRAG_LOAD_ERROR:case S.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},c.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},c.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,n=this.hls,r=n.maxAutoLevel,l=n.config,s=n.minAutoLevel,a=n.media,p=e?e.duration:t?t.duration:0,A=a?a.currentTime:0,_=a&&a.playbackRate!==0?Math.abs(a.playbackRate):1,y=this.bwEstimator?this.bwEstimator.getEstimate():l.abrEwmaDefaultEstimate,L=(D.BufferHelper.bufferInfo(a,A,l.maxBufferHole).end-A)/_,x=this.findBestLevel(y,s,r,L,l.abrBandWidthFactor,l.abrBandWidthUpFactor);if(x>=0)return x;d.logger.trace((L?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var T=p?Math.min(p,l.maxStarvationDelay):l.maxStarvationDelay,O=l.abrBandWidthFactor,R=l.abrBandWidthUpFactor;if(!L){var I=this.bitrateTestDelay;if(I){var C=p?Math.min(p,l.maxLoadingDelay):l.maxLoadingDelay;T=C-I,d.logger.trace("bitrate test took "+Math.round(1e3*I)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*T)+" ms"),O=R=1}}return x=this.findBestLevel(y,s,r,L+T,O,R),Math.max(x,0)},c.findBestLevel=function(t,e,n,r,l,s){for(var a,p=this.fragCurrent,A=this.partCurrent,_=this.lastLoadedFragLevel,y=this.hls.levels,L=y[_],x=!!(L!=null&&(a=L.details)!==null&&a!==void 0&&a.live),T=L==null?void 0:L.codecSet,O=A?A.duration:p?p.duration:0,R=n;R>=e;R--){var I=y[R];if(!(!I||T&&I.codecSet!==T)){var C=I.details,w=(A?C==null?void 0:C.partTarget:C==null?void 0:C.averagetargetduration)||O,F=void 0;R<=_?F=l*t:F=s*t;var B=y[R].maxBitrate,k=B*w/F;if(d.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+R+"/"+Math.round(F)+"/"+B+"/"+w+"/"+r+"/"+k),F>B&&(!k||x&&!this.bitrateTestDelay||k<r))return R}}return-1},f(v,[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;if(t!==-1&&(!e||!e.canEstimate()))return t;var n=this.getNextABRAutoLevel();return t!==-1&&(n=Math.min(t,n)),n},set:function(t){this._nextAutoLevel=t}}]),v}();P.default=o},"./src/controller/audio-stream-controller.ts":function(M,P,E){E.r(P);var b=E("./src/polyfills/number.ts"),u=E("./src/controller/base-stream-controller.ts"),m=E("./src/events.ts"),D=E("./src/utils/buffer-helper.ts"),S=E("./src/controller/fragment-tracker.ts"),g=E("./src/types/level.ts"),d=E("./src/types/loader.ts"),i=E("./src/loader/fragment.ts"),f=E("./src/demux/chunk-cache.ts"),o=E("./src/demux/transmuxer-interface.ts"),v=E("./src/types/transmuxer.ts"),c=E("./src/controller/fragment-finders.ts"),h=E("./src/utils/discontinuities.ts"),t=E("./src/errors.ts");function e(){return e=Object.assign?Object.assign.bind():function(a){for(var p=1;p<arguments.length;p++){var A=arguments[p];for(var _ in A)Object.prototype.hasOwnProperty.call(A,_)&&(a[_]=A[_])}return a},e.apply(this,arguments)}function n(a,p){a.prototype=Object.create(p.prototype),a.prototype.constructor=a,r(a,p)}function r(a,p){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,y){return _.__proto__=y,_},r(a,p)}var l=100,s=function(a){n(p,a);function p(_,y){var L;return L=a.call(this,_,y,"[audio-stream-controller]")||this,L.videoBuffer=null,L.videoTrackCC=-1,L.waitingVideoCC=-1,L.audioSwitch=!1,L.trackId=-1,L.waitingData=null,L.mainDetails=null,L.bufferFlushed=!1,L.cachedTrackLoadedData=null,L._registerListeners(),L}var A=p.prototype;return A.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},A._registerListeners=function(){var y=this.hls;y.on(m.Events.MEDIA_ATTACHED,this.onMediaAttached,this),y.on(m.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.on(m.Events.MANIFEST_LOADING,this.onManifestLoading,this),y.on(m.Events.LEVEL_LOADED,this.onLevelLoaded,this),y.on(m.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),y.on(m.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),y.on(m.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),y.on(m.Events.ERROR,this.onError,this),y.on(m.Events.BUFFER_RESET,this.onBufferReset,this),y.on(m.Events.BUFFER_CREATED,this.onBufferCreated,this),y.on(m.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),y.on(m.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),y.on(m.Events.FRAG_BUFFERED,this.onFragBuffered,this)},A._unregisterListeners=function(){var y=this.hls;y.off(m.Events.MEDIA_ATTACHED,this.onMediaAttached,this),y.off(m.Events.MEDIA_DETACHING,this.onMediaDetaching,this),y.off(m.Events.MANIFEST_LOADING,this.onManifestLoading,this),y.off(m.Events.LEVEL_LOADED,this.onLevelLoaded,this),y.off(m.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),y.off(m.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),y.off(m.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),y.off(m.Events.ERROR,this.onError,this),y.off(m.Events.BUFFER_RESET,this.onBufferReset,this),y.off(m.Events.BUFFER_CREATED,this.onBufferCreated,this),y.off(m.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),y.off(m.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),y.off(m.Events.FRAG_BUFFERED,this.onFragBuffered,this)},A.onInitPtsFound=function(y,L){var x=L.frag,T=L.id,O=L.initPTS;if(T==="main"){var R=x.cc;this.initPTS[x.cc]=O,this.log("InitPTS for cc: "+R+" found from main: "+O),this.videoTrackCC=R,this.state===u.State.WAITING_INIT_PTS&&this.tick()}},A.startLoad=function(y){if(!this.levels){this.startPosition=y,this.state=u.State.STOPPED;return}var L=this.lastCurrentTime;this.stopLoad(),this.setInterval(l),this.fragLoadError=0,L>0&&y===-1?(this.log("Override startPosition with lastCurrentTime @"+L.toFixed(3)),y=L,this.state=u.State.IDLE):(this.loadedmetadata=!1,this.state=u.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=y,this.tick()},A.doTick=function(){switch(this.state){case u.State.IDLE:this.doTickIdle();break;case u.State.WAITING_TRACK:{var y,L=this.levels,x=this.trackId,T=L==null||(y=L[x])===null||y===void 0?void 0:y.details;if(T){if(this.waitForCdnTuneIn(T))break;this.state=u.State.WAITING_INIT_PTS}break}case u.State.FRAG_LOADING_WAITING_RETRY:{var O,R=performance.now(),I=this.retryDate;(!I||R>=I||(O=this.media)!==null&&O!==void 0&&O.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=u.State.IDLE);break}case u.State.WAITING_INIT_PTS:{var C=this.waitingData;if(C){var w=C.frag,F=C.part,B=C.cache,k=C.complete;if(this.initPTS[w.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=u.State.FRAG_LOADING;var U=B.flush(),N={frag:w,part:F,payload:U,networkDetails:null};this._handleFragmentLoadProgress(N),k&&a.prototype._handleFragmentLoadComplete.call(this,N)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+w.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var j=this.getLoadPosition(),K=D.BufferHelper.bufferInfo(this.mediaBuffer,j,this.config.maxBufferHole),H=Object(c.fragmentWithinToleranceTest)(K.end,this.config.maxFragLookUpTolerance,w);H<0&&(this.log("Waiting fragment cc ("+w.cc+") @ "+w.start+" cancelled because another fragment at "+K.end+" is needed"),this.clearWaitingFragment())}}else this.state=u.State.IDLE}}this.onTickEnd()},A.clearWaitingFragment=function(){var y=this.waitingData;y&&(this.fragmentTracker.removeFragment(y.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=u.State.IDLE)},A.resetLoadingState=function(){this.clearWaitingFragment(),a.prototype.resetLoadingState.call(this)},A.onTickEnd=function(){var y=this.media;if(!(!y||!y.readyState)){var L=this.mediaBuffer?this.mediaBuffer:y,x=L.buffered;!this.loadedmetadata&&x.length&&(this.loadedmetadata=!0),this.lastCurrentTime=y.currentTime}},A.doTickIdle=function(){var y,L,x=this.hls,T=this.levels,O=this.media,R=this.trackId,I=x.config;if(!(!T||!T[R])&&!(!O&&(this.startFragRequested||!I.startFragPrefetch))){var C=T[R],w=C.details;if(!w||w.live&&this.levelLastLoaded!==R||this.waitForCdnTuneIn(w)){this.state=u.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,i.ElementaryStreamTypes.AUDIO,d.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,d.PlaylistLevelType.AUDIO);if(F!==null){var B=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,d.PlaylistLevelType.MAIN),k=F.len,U=this.getMaxBufferLength(B==null?void 0:B.len),N=this.audioSwitch;if(!(k>=U&&!N)){if(!N&&this._streamEnded(F,w)){x.trigger(m.Events.BUFFER_EOS,{type:"audio"}),this.state=u.State.ENDED;return}var j=w.fragments,K=j[0].start,H=F.end;if(N){var V=this.getLoadPosition();H=V,w.PTSKnown&&V<K&&(F.end>K||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),O.currentTime=K+.05)}if(!(B&&H>B.end+w.targetduration)&&!((!B||!B.len)&&F.len)){var G=this.getNextFragment(H,w);if(!G){this.bufferFlushed=!0;return}((y=G.decryptdata)===null||y===void 0?void 0:y.keyFormat)==="identity"&&!((L=G.decryptdata)!==null&&L!==void 0&&L.key)?this.loadKey(G,w):this.loadFragment(G,w,H)}}}}},A.getMaxBufferLength=function(y){var L=a.prototype.getMaxBufferLength.call(this);return y?Math.max(L,y):L},A.onMediaDetaching=function(){this.videoBuffer=null,a.prototype.onMediaDetaching.call(this)},A.onAudioTracksUpdated=function(y,L){var x=L.audioTracks;this.resetTransmuxer(),this.levels=x.map(function(T){return new g.Level(T)})},A.onAudioTrackSwitching=function(y,L){var x=!!L.url;this.trackId=L.id;var T=this.fragCurrent;T!=null&&T.loader&&T.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),x?this.setInterval(l):this.resetTransmuxer(),x?(this.audioSwitch=!0,this.state=u.State.IDLE):this.state=u.State.STOPPED,this.tick()},A.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},A.onLevelLoaded=function(y,L){this.mainDetails=L.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(m.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},A.onAudioTrackLoaded=function(y,L){var x;if(this.mainDetails==null){this.cachedTrackLoadedData=L;return}var T=this.levels,O=L.details,R=L.id;if(!T){this.warn("Audio tracks were reset while loading level "+R);return}this.log("Track "+R+" loaded ["+O.startSN+","+O.endSN+"],duration:"+O.totalduration);var I=T[R],C=0;if(O.live||(x=I.details)!==null&&x!==void 0&&x.live){var w=this.mainDetails;if(O.fragments[0]||(O.deltaUpdateFailed=!0),O.deltaUpdateFailed||!w)return;!I.details&&O.hasProgramDateTime&&w.hasProgramDateTime?(Object(h.alignMediaPlaylistByPDT)(O,w),C=O.fragments[0].start):C=this.alignPlaylists(O,I.details)}I.details=O,this.levelLastLoaded=R,!this.startFragRequested&&(this.mainDetails||!O.live)&&this.setStartPosition(I.details,C),this.state===u.State.WAITING_TRACK&&!this.waitForCdnTuneIn(O)&&(this.state=u.State.IDLE),this.tick()},A._handleFragmentLoadProgress=function(y){var L,x=y.frag,T=y.part,O=y.payload,R=this.config,I=this.trackId,C=this.levels;if(!C){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+x.sn+" of level "+x.level+" will not be buffered");return}var w=C[I];console.assert(w,"Audio track is defined on fragment load progress");var F=w.details;console.assert(F,"Audio track details are defined on fragment load progress");var B=R.defaultAudioCodec||w.audioCodec||"mp4a.40.2",k=this.transmuxer;k||(k=this.transmuxer=new o.default(this.hls,d.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var U=this.initPTS[x.cc],N=(L=x.initSegment)===null||L===void 0?void 0:L.data;if(U!==void 0){var j=!1,K=T?T.index:-1,H=K!==-1,V=new v.ChunkMetadata(x.level,x.sn,x.stats.chunkCount,O.byteLength,K,H);k.push(O,N,B,"",x,T,F.totalduration,j,V,U)}else{this.log("Unknown video PTS for cc "+x.cc+", waiting for video PTS before demuxing audio frag "+x.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+I);var G=this.waitingData=this.waitingData||{frag:x,part:T,cache:new f.default,complete:!1},ee=G.cache;ee.push(new Uint8Array(O)),this.waitingVideoCC=this.videoTrackCC,this.state=u.State.WAITING_INIT_PTS}},A._handleFragmentLoadComplete=function(y){if(this.waitingData){this.waitingData.complete=!0;return}a.prototype._handleFragmentLoadComplete.call(this,y)},A.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},A.onBufferCreated=function(y,L){var x=L.tracks.audio;x&&(this.mediaBuffer=x.buffer),L.tracks.video&&(this.videoBuffer=L.tracks.video.buffer)},A.onFragBuffered=function(y,L){var x=L.frag,T=L.part;if(x.type===d.PlaylistLevelType.AUDIO){if(this.fragContextChanged(x)){this.warn("Fragment "+x.sn+(T?" p: "+T.index:"")+" of level "+x.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}x.sn!=="initSegment"&&(this.fragPrevious=x,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(m.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(x,T)}},A.onError=function(y,L){switch(L.details){case t.ErrorDetails.FRAG_LOAD_ERROR:case t.ErrorDetails.FRAG_LOAD_TIMEOUT:case t.ErrorDetails.KEY_LOAD_ERROR:case t.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.AUDIO,L);break;case t.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case t.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==u.State.ERROR&&this.state!==u.State.STOPPED&&(this.state=L.fatal?u.State.ERROR:u.State.IDLE,this.warn(L.details+" while loading frag, switching to "+this.state+" state"));break;case t.ErrorDetails.BUFFER_FULL_ERROR:if(L.parent==="audio"&&(this.state===u.State.PARSING||this.state===u.State.PARSED)){var x=!0,T=this.getFwdBufferInfo(this.mediaBuffer,d.PlaylistLevelType.AUDIO);T&&T.len>.5&&(x=!this.reduceMaxBufferLength(T.len)),x&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},A.onBufferFlushed=function(y,L){var x=L.type;x===i.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},A._handleTransmuxComplete=function(y){var L,x="audio",T=this.hls,O=y.remuxResult,R=y.chunkMeta,I=this.getCurrentContext(R);if(!I){this.warn("The loading context changed while buffering fragment "+R.sn+" of level "+R.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(R.level);return}var C=I.frag,w=I.part,F=I.level.details,B=O.audio,k=O.text,U=O.id3,N=O.initSegment;if(!(this.fragContextChanged(C)||!F)){if(this.state=u.State.PARSING,this.audioSwitch&&B&&this.completeAudioSwitch(),N!=null&&N.tracks&&(this._bufferInitSegment(N.tracks,C,R),T.trigger(m.Events.FRAG_PARSING_INIT_SEGMENT,{frag:C,id:x,tracks:N.tracks})),B){var j=B.startPTS,K=B.endPTS,H=B.startDTS,V=B.endDTS;w&&(w.elementaryStreams[i.ElementaryStreamTypes.AUDIO]={startPTS:j,endPTS:K,startDTS:H,endDTS:V}),C.setElementaryStreamInfo(i.ElementaryStreamTypes.AUDIO,j,K,H,V),this.bufferFragmentData(B,C,w,R)}if(U!=null&&(L=U.samples)!==null&&L!==void 0&&L.length){var G=e({id:x,frag:C,details:F},U);T.trigger(m.Events.FRAG_PARSING_METADATA,G)}if(k){var ee=e({id:x,frag:C,details:F},k);T.trigger(m.Events.FRAG_PARSING_USERDATA,ee)}}},A._bufferInitSegment=function(y,L,x){if(this.state===u.State.PARSING){y.video&&delete y.video;var T=y.audio;if(!!T){T.levelCodec=T.codec,T.id="audio",this.log("Init audio buffer, container:"+T.container+", codecs[parsed]=["+T.codec+"]"),this.hls.trigger(m.Events.BUFFER_CODECS,y);var O=T.initSegment;if(O!=null&&O.byteLength){var R={type:"audio",frag:L,part:null,chunkMeta:x,parent:L.type,data:O};this.hls.trigger(m.Events.BUFFER_APPENDING,R)}this.tick()}}},A.loadFragment=function(y,L,x){var T=this.fragmentTracker.getState(y);this.fragCurrent=y,(this.audioSwitch||T===S.FragmentState.NOT_LOADED||T===S.FragmentState.PARTIAL)&&(y.sn==="initSegment"?this._loadInitSegment(y):L.live&&!Object(b.isFiniteNumber)(this.initPTS[y.cc])?(this.log("Waiting for video PTS in continuity counter "+y.cc+" of live stream before loading audio fragment "+y.sn+" of level "+this.trackId),this.state=u.State.WAITING_INIT_PTS):(this.startFragRequested=!0,a.prototype.loadFragment.call(this,y,L,x)))},A.completeAudioSwitch=function(){var y=this.hls,L=this.media,x=this.trackId;L&&(this.log("Switching audio track : flushing all audio"),a.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,y.trigger(m.Events.AUDIO_TRACK_SWITCHED,{id:x})},p}(u.default);P.default=s},"./src/controller/audio-track-controller.ts":function(M,P,E){E.r(P);var b=E("./src/events.ts"),u=E("./src/errors.ts"),m=E("./src/controller/base-playlist-controller.ts"),D=E("./src/types/loader.ts");function S(o,v){for(var c=0;c<v.length;c++){var h=v[c];h.enumerable=h.enumerable||!1,h.configurable=!0,"value"in h&&(h.writable=!0),Object.defineProperty(o,h.key,h)}}function g(o,v,c){return v&&S(o.prototype,v),c&&S(o,c),Object.defineProperty(o,"prototype",{writable:!1}),o}function d(o,v){o.prototype=Object.create(v.prototype),o.prototype.constructor=o,i(o,v)}function i(o,v){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(h,t){return h.__proto__=t,h},i(o,v)}var f=function(o){d(v,o);function v(h){var t;return t=o.call(this,h,"[audio-track-controller]")||this,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.trackName="",t.selectDefaultTrack=!0,t.registerListeners(),t}var c=v.prototype;return c.registerListeners=function(){var t=this.hls;t.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(b.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var t=this.hls;t.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(b.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(b.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(b.Events.ERROR,this.onError,this)},c.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,o.prototype.destroy.call(this)},c.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},c.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},c.onAudioTrackLoaded=function(t,e){var n=e.id,r=e.details,l=this.tracksInGroup[n];if(!l){this.warn("Invalid audio track id "+n);return}var s=l.details;l.details=e.details,this.log("audioTrack "+n+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,e,s))},c.onLevelLoading=function(t,e){this.switchLevel(e.level)},c.onLevelSwitching=function(t,e){this.switchLevel(e.level)},c.switchLevel=function(t){var e=this.hls.levels[t];if(!!(e!=null&&e.audioGroupIds)){var n=e.audioGroupIds[e.urlId];if(this.groupId!==n){this.groupId=n;var r=this.tracks.filter(function(s){return!n||s.groupId===n});this.selectDefaultTrack&&!r.some(function(s){return s.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=r;var l={audioTracks:r};this.log("Updating audio tracks, "+r.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(b.Events.AUDIO_TRACKS_UPDATED,l),this.selectInitialTrack()}}},c.onError=function(t,e){o.prototype.onError.call(this,t,e),!(e.fatal||!e.context)&&e.context.type===D.PlaylistContextType.AUDIO_TRACK&&e.context.id===this.trackId&&e.context.groupId===this.groupId&&this.retryLoadingOrFail(e)},c.setAudioTrack=function(t){var e=this.tracksInGroup;if(t<0||t>=e.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var n=e[this.trackId];this.log("Now switching to audio-track index "+t);var r=e[t],l=r.id,s=r.groupId,a=s===void 0?"":s,p=r.name,A=r.type,_=r.url;if(this.trackId=t,this.trackName=p,this.selectDefaultTrack=!1,this.hls.trigger(b.Events.AUDIO_TRACK_SWITCHING,{id:l,groupId:a,name:p,type:A,url:_}),!(r.details&&!r.details.live)){var y=this.switchParams(r.url,n==null?void 0:n.details);this.loadPlaylist(y)}},c.selectInitialTrack=function(){var t=this.tracksInGroup;console.assert(t.length,"Initial audio track should be selected when tracks are known");var e=this.trackName,n=this.findTrackId(e)||this.findTrackId();n!==-1?this.setAudioTrack(n):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},c.findTrackId=function(t){for(var e=this.tracksInGroup,n=0;n<e.length;n++){var r=e[n];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1},c.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var n=e.id,r=e.groupId,l=e.url;if(t)try{l=t.addDirectives(l)}catch(s){this.warn("Could not construct new URL with HLS Delivery Directives: "+s)}this.log("loading audio-track playlist for id: "+n),this.clearTimer(),this.hls.trigger(b.Events.AUDIO_TRACK_LOADING,{url:l,id:n,groupId:r,deliveryDirectives:t||null})}},g(v,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}]),v}(m.default);P.default=f},"./src/controller/base-playlist-controller.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return g});var b=E("./src/polyfills/number.ts"),u=E("./src/types/level.ts"),m=E("./src/controller/level-helper.ts"),D=E("./src/utils/logger.ts"),S=E("./src/errors.ts"),g=function(){function d(f,o){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=D.logger.log.bind(D.logger,o+":"),this.warn=D.logger.warn.bind(D.logger,o+":"),this.hls=f}var i=d.prototype;return i.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},i.onError=function(o,v){v.fatal&&v.type===S.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},i.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},i.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},i.stopLoad=function(){this.canLoad=!1,this.clearTimer()},i.switchParams=function(o,v){var c=v==null?void 0:v.renditionReports;if(c)for(var h=0;h<c.length;h++){var t=c[h],e=""+t.URI;if(e===o.slice(-e.length)){var n=parseInt(t["LAST-MSN"]),r=parseInt(t["LAST-PART"]);if(v&&this.hls.config.lowLatencyMode){var l=Math.min(v.age-v.partTarget,v.targetduration);r!==void 0&&l>v.partTarget&&(r+=1)}if(Object(b.isFiniteNumber)(n))return new u.HlsUrlParameters(n,Object(b.isFiniteNumber)(r)?r:void 0,u.HlsSkip.No)}}},i.loadPlaylist=function(o){},i.shouldLoadTrack=function(o){return this.canLoad&&o&&!!o.url&&(!o.details||o.details.live)},i.playlistLoaded=function(o,v,c){var h=this,t=v.details,e=v.stats,n=e.loading.end?Math.max(0,self.performance.now()-e.loading.end):0;if(t.advancedDateTime=Date.now()-n,t.live||c!=null&&c.live){if(t.reloaded(c),c&&this.log("live playlist "+o+" "+(t.advanced?"REFRESHED "+t.lastPartSn+"-"+t.lastPartIndex:"MISSED")),c&&t.fragments.length>0&&Object(m.mergeDetails)(c,t),!this.canLoad||!t.live)return;var r,l=void 0,s=void 0;if(t.canBlockReload&&t.endSN&&t.advanced){var a=this.hls.config.lowLatencyMode,p=t.lastPartSn,A=t.endSN,_=t.lastPartIndex,y=_!==-1,L=p===A,x=a?0:_;y?(l=L?A+1:p,s=L?x:_+1):l=A+1;var T=t.age,O=T+t.ageHeader,R=Math.min(O-t.partTarget,t.targetduration*1.5);if(R>0){if(c&&R>c.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+c.tuneInGoal+" to: "+R+" with playlist age: "+t.age),R=0;else{var I=Math.floor(R/t.targetduration);if(l+=I,s!==void 0){var C=Math.round(R%t.targetduration/t.partTarget);s+=C}this.log("CDN Tune-in age: "+t.ageHeader+"s last advanced "+T.toFixed(2)+"s goal: "+R+" skip sn "+I+" to part "+s)}t.tuneInGoal=R}if(r=this.getDeliveryDirectives(t,v.deliveryDirectives,l,s),a||!L){this.loadPlaylist(r);return}}else r=this.getDeliveryDirectives(t,v.deliveryDirectives,l,s);var w=Object(m.computeReloadInterval)(t,e);l!==void 0&&t.canBlockReload&&(w-=t.partTarget||1),this.log("reload live playlist "+o+" in "+Math.round(w)+" ms"),this.timer=self.setTimeout(function(){return h.loadPlaylist(r)},w)}else this.clearTimer()},i.getDeliveryDirectives=function(o,v,c,h){var t=Object(u.getSkipValue)(o,c);return v!=null&&v.skip&&o.deltaUpdateFailed&&(c=v.msn,h=v.part,t=u.HlsSkip.No),new u.HlsUrlParameters(c,h,t)},i.retryLoadingOrFail=function(o){var v=this,c=this.hls.config,h=this.retryCount<c.levelLoadingMaxRetry;if(h){var t;if(this.retryCount++,o.details.indexOf("LoadTimeOut")>-1&&(t=o.context)!==null&&t!==void 0&&t.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+o.details+'"'),this.loadPlaylist();else{var e=Math.min(Math.pow(2,this.retryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return v.loadPlaylist()},e),this.warn("retry playlist loading #"+this.retryCount+" in "+e+' ms after "'+o.details+'"')}}else this.warn('cannot recover from error "'+o.details+'"'),this.clearTimer(),o.fatal=!0;return h},d}()},"./src/controller/base-stream-controller.ts":function(M,P,E){E.r(P),E.d(P,"State",function(){return A}),E.d(P,"default",function(){return _});var b=E("./src/polyfills/number.ts"),u=E("./src/task-loop.ts"),m=E("./src/controller/fragment-tracker.ts"),D=E("./src/utils/buffer-helper.ts"),S=E("./src/utils/logger.ts"),g=E("./src/events.ts"),d=E("./src/errors.ts"),i=E("./src/types/transmuxer.ts"),f=E("./src/utils/mp4-tools.ts"),o=E("./src/utils/discontinuities.ts"),v=E("./src/controller/fragment-finders.ts"),c=E("./src/controller/level-helper.ts"),h=E("./src/loader/fragment-loader.ts"),t=E("./src/crypt/decrypter.ts"),e=E("./src/utils/time-ranges.ts"),n=E("./src/types/loader.ts");function r(y,L){for(var x=0;x<L.length;x++){var T=L[x];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(y,T.key,T)}}function l(y,L,x){return L&&r(y.prototype,L),x&&r(y,x),Object.defineProperty(y,"prototype",{writable:!1}),y}function s(y){if(y===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return y}function a(y,L){y.prototype=Object.create(L.prototype),y.prototype.constructor=y,p(y,L)}function p(y,L){return p=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(T,O){return T.__proto__=O,T},p(y,L)}var A={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},_=function(y){a(L,y);function L(T,O,R){var I;return I=y.call(this)||this,I.hls=void 0,I.fragPrevious=null,I.fragCurrent=null,I.fragmentTracker=void 0,I.transmuxer=null,I._state=A.STOPPED,I.media=void 0,I.mediaBuffer=void 0,I.config=void 0,I.bitrateTest=!1,I.lastCurrentTime=0,I.nextLoadPosition=0,I.startPosition=0,I.loadedmetadata=!1,I.fragLoadError=0,I.retryDate=0,I.levels=null,I.fragmentLoader=void 0,I.levelLastLoaded=null,I.startFragRequested=!1,I.decrypter=void 0,I.initPTS=[],I.onvseeking=null,I.onvended=null,I.logPrefix="",I.log=void 0,I.warn=void 0,I.logPrefix=R,I.log=S.logger.log.bind(S.logger,R+":"),I.warn=S.logger.warn.bind(S.logger,R+":"),I.hls=T,I.fragmentLoader=new h.default(T.config),I.fragmentTracker=O,I.config=T.config,I.decrypter=new t.default(T,T.config),T.on(g.Events.KEY_LOADED,I.onKeyLoaded,s(I)),I}var x=L.prototype;return x.doTick=function(){this.onTickEnd()},x.onTickEnd=function(){},x.startLoad=function(O){},x.stopLoad=function(){this.fragmentLoader.abort();var O=this.fragCurrent;O&&this.fragmentTracker.removeFragment(O),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=A.STOPPED},x._streamEnded=function(O,R){var I=this.fragCurrent,C=this.fragmentTracker;if(!R.live&&I&&I.sn>=R.endSN&&!O.nextStart){var w=R.partList;if(w!=null&&w.length){var F=w[w.length-1],B=D.BufferHelper.isBuffered(this.media,F.start+F.duration/2);return B}var k=C.getState(I);return k===m.FragmentState.PARTIAL||k===m.FragmentState.OK}return!1},x.onMediaAttached=function(O,R){var I=this.media=this.mediaBuffer=R.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),I.addEventListener("seeking",this.onvseeking),I.addEventListener("ended",this.onvended);var C=this.config;this.levels&&C.autoStartLoad&&this.state===A.STOPPED&&this.startLoad(C.startPosition)},x.onMediaDetaching=function(){var O=this.media;O!=null&&O.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),O&&(O.removeEventListener("seeking",this.onvseeking),O.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},x.onMediaSeeking=function(){var O=this.config,R=this.fragCurrent,I=this.media,C=this.mediaBuffer,w=this.state,F=I?I.currentTime:0,B=D.BufferHelper.bufferInfo(C||I,F,O.maxBufferHole);if(this.log("media seeking to "+(Object(b.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+w),w===A.ENDED)this.resetLoadingState();else if(R&&!B.len){var k=O.maxFragLookUpTolerance,U=R.start-k,N=R.start+R.duration+k,j=F>N;(F<U||j)&&(j&&R.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),R.loader.abort()),this.resetLoadingState())}I&&(this.lastCurrentTime=F),!this.loadedmetadata&&!B.len&&(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},x.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},x.onKeyLoaded=function(O,R){if(!(this.state!==A.KEY_LOADING||R.frag!==this.fragCurrent||!this.levels)){this.state=A.IDLE;var I=this.levels[R.frag.level].details;I&&this.loadFragment(R.frag,I,R.frag.start)}},x.onHandlerDestroying=function(){this.stopLoad(),y.prototype.onHandlerDestroying.call(this)},x.onHandlerDestroyed=function(){this.state=A.STOPPED,this.hls.off(g.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,y.prototype.onHandlerDestroyed.call(this)},x.loadKey=function(O,R){this.log("Loading key for "+O.sn+" of ["+R.startSN+"-"+R.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+O.level),this.state=A.KEY_LOADING,this.fragCurrent=O,this.hls.trigger(g.Events.KEY_LOADING,{frag:O})},x.loadFragment=function(O,R,I){this._loadFragForPlayback(O,R,I)},x._loadFragForPlayback=function(O,R,I){var C=this,w=function(B){if(C.fragContextChanged(O)){C.warn("Fragment "+O.sn+(B.part?" p: "+B.part.index:"")+" of level "+O.level+" was dropped during download."),C.fragmentTracker.removeFragment(O);return}O.stats.chunkCount++,C._handleFragmentLoadProgress(B)};this._doFragLoad(O,R,I,w).then(function(F){if(!!F){C.fragLoadError=0;var B=C.state;if(C.fragContextChanged(O)){(B===A.FRAG_LOADING||!C.fragCurrent&&B===A.PARSING)&&(C.fragmentTracker.removeFragment(O),C.state=A.IDLE);return}"payload"in F&&(C.log("Loaded fragment "+O.sn+" of level "+O.level),C.hls.trigger(g.Events.FRAG_LOADED,F)),C._handleFragmentLoadComplete(F)}}).catch(function(F){C.state!==A.STOPPED&&(C.warn(F),C.resetFragmentLoading(O))})},x.flushMainBuffer=function(O,R,I){if(I===void 0&&(I=null),!!(O-R)){var C={startOffset:O,endOffset:R,type:I};this.fragLoadError=0,this.hls.trigger(g.Events.BUFFER_FLUSHING,C)}},x._loadInitSegment=function(O){var R=this;this._doFragLoad(O).then(function(I){if(!I||R.fragContextChanged(O)||!R.levels)throw new Error("init load aborted");return I}).then(function(I){var C=R.hls,w=I.payload,F=O.decryptdata;if(w&&w.byteLength>0&&F&&F.key&&F.iv&&F.method==="AES-128"){var B=self.performance.now();return R.decrypter.webCryptoDecrypt(new Uint8Array(w),F.key.buffer,F.iv.buffer).then(function(k){var U=self.performance.now();return C.trigger(g.Events.FRAG_DECRYPTED,{frag:O,payload:k,stats:{tstart:B,tdecrypt:U}}),I.payload=k,I})}return I}).then(function(I){var C=R.fragCurrent,w=R.hls,F=R.levels;if(!F)throw new Error("init load aborted, missing levels");var B=F[O.level].details;console.assert(B,"Level details are defined when init segment is loaded");var k=O.stats;R.state=A.IDLE,R.fragLoadError=0,O.data=new Uint8Array(I.payload),k.parsing.start=k.buffering.start=self.performance.now(),k.parsing.end=k.buffering.end=self.performance.now(),I.frag===C&&w.trigger(g.Events.FRAG_BUFFERED,{stats:k,frag:C,part:null,id:O.type}),R.tick()}).catch(function(I){R.warn(I),R.resetFragmentLoading(O)})},x.fragContextChanged=function(O){var R=this.fragCurrent;return!O||!R||O.level!==R.level||O.sn!==R.sn||O.urlId!==R.urlId},x.fragBufferedComplete=function(O,R){var I=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+O.type+" sn: "+O.sn+(R?" part: "+R.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+O.level+" "+e.default.toString(D.BufferHelper.getBuffered(I))),this.state=A.IDLE,this.tick()},x._handleFragmentLoadComplete=function(O){var R=this.transmuxer;if(!!R){var I=O.frag,C=O.part,w=O.partsLoaded,F=!w||w.length===0||w.some(function(k){return!k}),B=new i.ChunkMetadata(I.level,I.sn,I.stats.chunkCount+1,0,C?C.index:-1,!F);R.flush(B)}},x._handleFragmentLoadProgress=function(O){},x._doFragLoad=function(O,R,I,C){var w=this;if(I===void 0&&(I=null),!this.levels)throw new Error("frag load aborted, missing levels");if(I=Math.max(O.start,I||0),this.config.lowLatencyMode&&R){var F=R.partList;if(F&&C){I>O.end&&R.fragmentHint&&(O=R.fragmentHint);var B=this.getNextPart(F,O,I);if(B>-1){var k=F[B];return this.log("Loading part sn: "+O.sn+" p: "+k.index+" cc: "+O.cc+" of playlist ["+R.startSN+"-"+R.endSN+"] parts [0-"+B+"-"+(F.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+O.level+", target: "+parseFloat(I.toFixed(3))),this.nextLoadPosition=k.start+k.duration,this.state=A.FRAG_LOADING,this.hls.trigger(g.Events.FRAG_LOADING,{frag:O,part:F[B],targetBufferTime:I}),this.doFragPartsLoad(O,F,B,C).catch(function(U){return w.handleFragLoadError(U)})}else if(!O.url||this.loadedEndOfParts(F,I))return Promise.resolve(null)}}return this.log("Loading fragment "+O.sn+" cc: "+O.cc+" "+(R?"of ["+R.startSN+"-"+R.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+O.level+", target: "+parseFloat(I.toFixed(3))),Object(b.isFiniteNumber)(O.sn)&&!this.bitrateTest&&(this.nextLoadPosition=O.start+O.duration),this.state=A.FRAG_LOADING,this.hls.trigger(g.Events.FRAG_LOADING,{frag:O,targetBufferTime:I}),this.fragmentLoader.load(O,C).catch(function(U){return w.handleFragLoadError(U)})},x.doFragPartsLoad=function(O,R,I,C){var w=this;return new Promise(function(F,B){var k=[],U=function N(j){var K=R[j];w.fragmentLoader.loadPart(O,K,C).then(function(H){k[K.index]=H;var V=H.part;w.hls.trigger(g.Events.FRAG_LOADED,H);var G=R[j+1];if(G&&G.fragment===O)N(j+1);else return F({frag:O,part:V,partsLoaded:k})}).catch(B)};U(I)})},x.handleFragLoadError=function(O){var R=O.data;return R&&R.details===d.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(R.frag,R.part):this.hls.trigger(g.Events.ERROR,R),null},x._handleTransmuxerFlush=function(O){var R=this.getCurrentContext(O);if(!R||this.state!==A.PARSING){this.fragCurrent||(this.state=A.IDLE);return}var I=R.frag,C=R.part,w=R.level,F=self.performance.now();I.stats.parsing.end=F,C&&(C.stats.parsing.end=F),this.updateLevelTiming(I,C,w,O.partial)},x.getCurrentContext=function(O){var R=this.levels,I=O.level,C=O.sn,w=O.part;if(!R||!R[I])return this.warn("Levels object was unset while buffering fragment "+C+" of level "+I+". The current chunk will not be buffered."),null;var F=R[I],B=w>-1?Object(c.getPartWith)(F,C,w):null,k=B?B.fragment:Object(c.getFragmentWithSN)(F,C,this.fragCurrent);return k?{frag:k,part:B,level:F}:null},x.bufferFragmentData=function(O,R,I,C){if(!(!O||this.state!==A.PARSING)){var w=O.data1,F=O.data2,B=w;if(w&&F&&(B=Object(f.appendUint8Array)(w,F)),!(!B||!B.length)){var k={type:O.type,frag:R,part:I,chunkMeta:C,parent:R.type,data:B};this.hls.trigger(g.Events.BUFFER_APPENDING,k),O.dropped&&O.independent&&!I&&this.flushBufferGap(R)}}},x.flushBufferGap=function(O){var R=this.media;if(!!R){if(!D.BufferHelper.isBuffered(R,R.currentTime)){this.flushMainBuffer(0,O.start);return}var I=R.currentTime,C=D.BufferHelper.bufferInfo(R,I,0),w=O.duration,F=Math.min(this.config.maxFragLookUpTolerance*2,w*.25),B=Math.max(Math.min(O.start-F,C.end-F),I+F);O.start-B>F&&this.flushMainBuffer(B,O.start)}},x.getFwdBufferInfo=function(O,R){var I=this.config,C=this.getLoadPosition();if(!Object(b.isFiniteNumber)(C))return null;var w=D.BufferHelper.bufferInfo(O,C,I.maxBufferHole);if(w.len===0&&w.nextStart!==void 0){var F=this.fragmentTracker.getBufferedFrag(C,R);if(F&&w.nextStart<F.end)return D.BufferHelper.bufferInfo(O,C,Math.max(w.nextStart,I.maxBufferHole))}return w},x.getMaxBufferLength=function(O){var R=this.config,I;return O?I=Math.max(8*R.maxBufferSize/O,R.maxBufferLength):I=R.maxBufferLength,Math.min(I,R.maxMaxBufferLength)},x.reduceMaxBufferLength=function(O){var R=this.config,I=O||R.maxBufferLength;return R.maxMaxBufferLength>=I?(R.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+R.maxMaxBufferLength+"s"),!0):!1},x.getNextFragment=function(O,R){var I=R.fragments,C=I.length;if(!C)return null;var w=this.config,F=I[0].start,B;if(R.live){var k=w.initialLiveManifestSize;if(C<k)return this.warn("Not enough fragments to start playback (have: "+C+", need: "+k+")"),null;!R.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(B=this.getInitialLiveFragment(R,I),this.startPosition=B?this.hls.liveSyncPosition||B.start:O)}else O<=F&&(B=I[0]);if(!B){var U=w.lowLatencyMode?R.partEnd:R.fragmentEnd;B=this.getFragmentAtPosition(O,U,R)}return this.mapToInitFragWhenRequired(B)},x.mapToInitFragWhenRequired=function(O){return O!=null&&O.initSegment&&!(O!=null&&O.initSegment.data)&&!this.bitrateTest?O.initSegment:O},x.getNextPart=function(O,R,I){for(var C=-1,w=!1,F=!0,B=0,k=O.length;B<k;B++){var U=O[B];if(F=F&&!U.independent,C>-1&&I<U.start)break;var N=U.loaded;!N&&(w||U.independent||F)&&U.fragment===R&&(C=B),w=N}return C},x.loadedEndOfParts=function(O,R){var I=O[O.length-1];return I&&R>I.start&&I.loaded},x.getInitialLiveFragment=function(O,R){var I=this.fragPrevious,C=null;if(I){if(O.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+I.programDateTime),C=Object(v.findFragmentByPDT)(R,I.endProgramDateTime,this.config.maxFragLookUpTolerance)),!C){var w=I.sn+1;if(w>=O.startSN&&w<=O.endSN){var F=R[w-O.startSN];I.cc===F.cc&&(C=F,this.log("Live playlist, switching playlist, load frag with next SN: "+C.sn))}C||(C=Object(v.findFragWithCC)(R,I.cc),C&&this.log("Live playlist, switching playlist, load frag with same CC: "+C.sn))}}else{var B=this.hls.liveSyncPosition;B!==null&&(C=this.getFragmentAtPosition(B,this.bitrateTest?O.fragmentEnd:O.edge,O))}return C},x.getFragmentAtPosition=function(O,R,I){var C=this.config,w=this.fragPrevious,F=I.fragments,B=I.endSN,k=I.fragmentHint,U=C.maxFragLookUpTolerance,N=!!(C.lowLatencyMode&&I.partList&&k);N&&k&&!this.bitrateTest&&(F=F.concat(k),B=k.sn);var j;if(O<R){var K=O>R-U?0:U;j=Object(v.findFragmentByPTS)(w,F,O,K)}else j=F[F.length-1];if(j){var H=j.sn-I.startSN,V=w&&j.level===w.level,G=F[H+1];w&&j.sn===w.sn&&!N&&V&&(j.sn<B&&this.fragmentTracker.getState(G)!==m.FragmentState.OK?(this.log("SN "+j.sn+" just loaded, load next one: "+G.sn),j=G):j=null)}return j},x.synchronizeToLiveEdge=function(O){var R=this.config,I=this.media;if(!!I){var C=this.hls.liveSyncPosition,w=I.currentTime,F=O.fragments[0].start,B=O.edge,k=w>=F-R.maxFragLookUpTolerance&&w<=B;if(C!==null&&I.duration>C&&(w<C||!k)){var U=R.liveMaxLatencyDuration!==void 0?R.liveMaxLatencyDuration:R.liveMaxLatencyDurationCount*O.targetduration;(!k&&I.readyState<4||w<B-U)&&(this.loadedmetadata||(this.nextLoadPosition=C),I.readyState&&(this.warn("Playback: "+w.toFixed(3)+" is located too far from the end of live sliding playlist: "+B+", reset currentTime to : "+C.toFixed(3)),I.currentTime=C))}}},x.alignPlaylists=function(O,R){var I=this.levels,C=this.levelLastLoaded,w=this.fragPrevious,F=C!==null?I[C]:null,B=O.fragments.length;if(!B)return this.warn("No fragments in live playlist"),0;var k=O.fragments[0].start,U=!R,N=O.alignedSliding&&Object(b.isFiniteNumber)(k);if(U||!N&&!k){Object(o.alignStream)(w,F,O);var j=O.fragments[0].start;return this.log("Live playlist sliding: "+j.toFixed(2)+" start-sn: "+(R?R.startSN:"na")+"->"+O.startSN+" prev-sn: "+(w?w.sn:"na")+" fragments: "+B),j}return k},x.waitForCdnTuneIn=function(O){var R=3;return O.live&&O.canBlockReload&&O.partTarget&&O.tuneInGoal>Math.max(O.partHoldBack,O.partTarget*R)},x.setStartPosition=function(O,R){var I=this.startPosition;if(I<R&&(I=-1),I===-1||this.lastCurrentTime===-1){var C=O.startTimeOffset;Object(b.isFiniteNumber)(C)?(I=R+C,C<0&&(I+=O.totalduration),I=Math.min(Math.max(R,I),R+O.totalduration),this.log("Start time offset "+C+" found in playlist, adjust startPosition to "+I),this.startPosition=I):O.live?I=this.hls.liveSyncPosition||R:this.startPosition=I=0,this.lastCurrentTime=I}this.nextLoadPosition=I},x.getLoadPosition=function(){var O=this.media,R=0;return this.loadedmetadata&&O?R=O.currentTime:this.nextLoadPosition&&(R=this.nextLoadPosition),R},x.handleFragLoadAborted=function(O,R){this.transmuxer&&O.sn!=="initSegment"&&O.stats.aborted&&(this.warn("Fragment "+O.sn+(R?" part"+R.index:"")+" of level "+O.level+" was aborted"),this.resetFragmentLoading(O))},x.resetFragmentLoading=function(O){(!this.fragCurrent||!this.fragContextChanged(O))&&(this.state=A.IDLE)},x.onFragmentOrKeyLoadError=function(O,R){if(!R.fatal){var I=R.frag;if(!(!I||I.type!==O)){var C=this.fragCurrent;console.assert(C&&I.sn===C.sn&&I.level===C.level&&I.urlId===C.urlId,"Frag load error must match current frag to retry");var w=this.config;if(this.fragLoadError+1<=w.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(I.level))return;var F=Math.min(Math.pow(2,this.fragLoadError)*w.fragLoadingRetryDelay,w.fragLoadingMaxRetryTimeout);this.warn("Fragment "+I.sn+" of "+O+" "+I.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=A.FRAG_LOADING_WAITING_RETRY}else R.levelRetry?(O===n.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=A.IDLE):(S.logger.error(R.details+" reaches max retry, redispatch as fatal ..."),R.fatal=!0,this.hls.stopLoad(),this.state=A.ERROR)}}},x.afterBufferFlushed=function(O,R,I){if(!!O){var C=D.BufferHelper.getBuffered(O);this.fragmentTracker.detectEvictedFragments(R,C,I),this.state===A.ENDED&&this.resetLoadingState()}},x.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=A.IDLE},x.resetLiveStartWhenNotLoaded=function(O){if(!this.loadedmetadata){this.startFragRequested=!1;var R=this.levels?this.levels[O].details:null;if(R!=null&&R.live)return this.startPosition=-1,this.setStartPosition(R,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},x.updateLevelTiming=function(O,R,I,C){var w=this,F=I.details;console.assert(!!F,"level.details must be defined");var B=Object.keys(O.elementaryStreams).reduce(function(k,U){var N=O.elementaryStreams[U];if(N){var j=N.endPTS-N.startPTS;if(j<=0)return w.warn("Could not parse fragment "+O.sn+" "+U+" duration reliably ("+j+")"),k||!1;var K=C?0:Object(c.updateFragPTSDTS)(F,O,N.startPTS,N.endPTS,N.startDTS,N.endDTS);return w.hls.trigger(g.Events.LEVEL_PTS_UPDATED,{details:F,level:I,drift:K,type:U,frag:O,start:N.startPTS,end:N.endPTS}),!0}return k},!1);B||(this.warn("Found no media in fragment "+O.sn+" of level "+I.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=A.PARSED,this.hls.trigger(g.Events.FRAG_PARSED,{frag:O,part:R})},x.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},l(L,[{key:"state",get:function(){return this._state},set:function(O){var R=this._state;R!==O&&(this._state=O,this.log(R+"->"+O))}}]),L}(u.default)},"./src/controller/buffer-controller.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return v});var b=E("./src/polyfills/number.ts"),u=E("./src/events.ts"),m=E("./src/utils/logger.ts"),D=E("./src/errors.ts"),S=E("./src/utils/buffer-helper.ts"),g=E("./src/utils/mediasource-helper.ts"),d=E("./src/loader/fragment.ts"),i=E("./src/controller/buffer-operation-queue.ts"),f=Object(g.getMediaSource)(),o=/([ha]vc.)(?:\.[^.,]+)+/,v=function(){function c(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var n=e.hls,r=e.media,l=e.mediaSource;m.logger.log("[buffer-controller]: Media source opened"),r&&(e.updateMediaElementDuration(),n.trigger(u.Events.MEDIA_ATTACHED,{media:r})),l&&l.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){m.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){m.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var h=c.prototype;return h.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},h.destroy=function(){this.unregisterListeners(),this.details=null},h.registerListeners=function(){var e=this.hls;e.on(u.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(u.Events.BUFFER_RESET,this.onBufferReset,this),e.on(u.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.on(u.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.on(u.Events.BUFFER_EOS,this.onBufferEos,this),e.on(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(u.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(u.Events.FRAG_PARSED,this.onFragParsed,this),e.on(u.Events.FRAG_CHANGED,this.onFragChanged,this)},h.unregisterListeners=function(){var e=this.hls;e.off(u.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(u.Events.BUFFER_RESET,this.onBufferReset,this),e.off(u.Events.BUFFER_APPENDING,this.onBufferAppending,this),e.off(u.Events.BUFFER_CODECS,this.onBufferCodecs,this),e.off(u.Events.BUFFER_EOS,this.onBufferEos,this),e.off(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(u.Events.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(u.Events.FRAG_PARSED,this.onFragParsed,this),e.off(u.Events.FRAG_CHANGED,this.onFragChanged,this)},h._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new i.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},h.onManifestParsed=function(e,n){var r=2;(n.audio&&!n.video||!n.altAudio)&&(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,this.details=null,m.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},h.onMediaAttaching=function(e,n){var r=this.media=n.media;if(r&&f){var l=this.mediaSource=new f;l.addEventListener("sourceopen",this._onMediaSourceOpen),l.addEventListener("sourceended",this._onMediaSourceEnded),l.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(l),this._objectUrl=r.src}},h.onMediaDetaching=function(){var e=this.media,n=this.mediaSource,r=this._objectUrl;if(n){if(m.logger.log("[buffer-controller]: media source detaching"),n.readyState==="open")try{n.endOfStream()}catch(l){m.logger.warn("[buffer-controller]: onMediaDetaching: "+l.message+" while calling endOfStream")}this.onBufferReset(),n.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("sourceended",this._onMediaSourceEnded),n.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(r&&self.URL.revokeObjectURL(r),e.src===r?(e.removeAttribute("src"),e.load()):m.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(u.Events.MEDIA_DETACHED,void 0)},h.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach(function(n){var r=e.sourceBuffer[n];try{r&&(e.removeBufferListeners(n),e.mediaSource&&e.mediaSource.removeSourceBuffer(r),e.sourceBuffer[n]=void 0)}catch(l){m.logger.warn("[buffer-controller]: Failed to reset the "+n+" buffer",l)}}),this._initSourceBuffer()},h.onBufferCodecs=function(e,n){var r=this,l=this.getSourceBufferTypes().length;Object.keys(n).forEach(function(s){if(l){var a=r.tracks[s];if(a&&typeof a.buffer.changeType=="function"){var p=n[s],A=p.id,_=p.codec,y=p.levelCodec,L=p.container,x=p.metadata,T=(a.levelCodec||a.codec).replace(o,"$1"),O=(y||_).replace(o,"$1");if(T!==O){var R=L+";codecs="+(y||_);r.appendChangeType(s,R),m.logger.log("[buffer-controller]: switching codec "+T+" to "+O),r.tracks[s]={buffer:a.buffer,codec:_,container:L,levelCodec:y,metadata:x,id:A}}}}else r.pendingTracks[s]=n[s]}),!l&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},h.appendChangeType=function(e,n){var r=this,l=this.operationQueue,s={execute:function(){var p=r.sourceBuffer[e];p&&(m.logger.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+n),p.changeType(n)),l.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(p){m.logger.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",p)}};l.append(s,e)},h.onBufferAppending=function(e,n){var r=this,l=this.hls,s=this.operationQueue,a=this.tracks,p=n.data,A=n.type,_=n.frag,y=n.part,L=n.chunkMeta,x=L.buffering[A],T=self.performance.now();x.start=T;var O=_.stats.buffering,R=y?y.stats.buffering:null;O.start===0&&(O.start=T),R&&R.start===0&&(R.start=T);var I=a.audio,C=A==="audio"&&L.id===1&&(I==null?void 0:I.container)==="audio/mpeg",w={execute:function(){if(x.executeStart=self.performance.now(),C){var B=r.sourceBuffer[A];if(B){var k=_.start-B.timestampOffset;Math.abs(k)>=.1&&(m.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+_.start+" (delta: "+k+") sn: "+_.sn+")"),B.timestampOffset=_.start)}}r.appendExecutor(p,A)},onStart:function(){},onComplete:function(){var B=self.performance.now();x.executeEnd=x.end=B,O.first===0&&(O.first=B),R&&R.first===0&&(R.first=B);var k=r.sourceBuffer,U={};for(var N in k)U[N]=S.BufferHelper.getBuffered(k[N]);r.appendError=0,r.hls.trigger(u.Events.BUFFER_APPENDED,{type:A,frag:_,part:y,chunkMeta:L,parent:_.type,timeRanges:U})},onError:function(B){m.logger.error("[buffer-controller]: Error encountered while trying to append to the "+A+" SourceBuffer",B);var k={type:D.ErrorTypes.MEDIA_ERROR,parent:_.type,details:D.ErrorDetails.BUFFER_APPEND_ERROR,err:B,fatal:!1};B.code===DOMException.QUOTA_EXCEEDED_ERR?k.details=D.ErrorDetails.BUFFER_FULL_ERROR:(r.appendError++,k.details=D.ErrorDetails.BUFFER_APPEND_ERROR,r.appendError>l.config.appendErrorMaxRetry&&(m.logger.error("[buffer-controller]: Failed "+l.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),k.fatal=!0)),l.trigger(u.Events.ERROR,k)}};s.append(w,A)},h.onBufferFlushing=function(e,n){var r=this,l=this.operationQueue,s=function(p){return{execute:r.removeExecutor.bind(r,p,n.startOffset,n.endOffset),onStart:function(){},onComplete:function(){r.hls.trigger(u.Events.BUFFER_FLUSHED,{type:p})},onError:function(_){m.logger.warn("[buffer-controller]: Failed to remove from "+p+" SourceBuffer",_)}}};n.type?l.append(s(n.type),n.type):this.getSourceBufferTypes().forEach(function(a){l.append(s(a),a)})},h.onFragParsed=function(e,n){var r=this,l=n.frag,s=n.part,a=[],p=s?s.elementaryStreams:l.elementaryStreams;p[d.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(p[d.ElementaryStreamTypes.AUDIO]&&a.push("audio"),p[d.ElementaryStreamTypes.VIDEO]&&a.push("video"));var A=function(){var y=self.performance.now();l.stats.buffering.end=y,s&&(s.stats.buffering.end=y);var L=s?s.stats:l.stats;r.hls.trigger(u.Events.FRAG_BUFFERED,{frag:l,part:s,stats:L,id:l.type})};a.length===0&&m.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+l.type+" level: "+l.level+" sn: "+l.sn),this.blockBuffers(A,a)},h.onFragChanged=function(e,n){this.flushBackBuffer()},h.onBufferEos=function(e,n){var r=this,l=this.getSourceBufferTypes().reduce(function(s,a){var p=r.sourceBuffer[a];return(!n.type||n.type===a)&&p&&!p.ended&&(p.ended=!0,m.logger.log("[buffer-controller]: "+a+" sourceBuffer now EOS")),s&&!!(!p||p.ended)},!0);l&&this.blockBuffers(function(){var s=r.mediaSource;!s||s.readyState!=="open"||s.endOfStream()})},h.onLevelUpdated=function(e,n){var r=n.details;!r.fragments.length||(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},h.flushBackBuffer=function(){var e=this.hls,n=this.details,r=this.media,l=this.sourceBuffer;if(!(!r||n===null)){var s=this.getSourceBufferTypes();if(!!s.length){var a=n.live&&e.config.liveBackBufferLength!==null?e.config.liveBackBufferLength:e.config.backBufferLength;if(!(!Object(b.isFiniteNumber)(a)||a<0)){var p=r.currentTime,A=n.levelTargetDuration,_=Math.max(a,A),y=Math.floor(p/A)*A-_;s.forEach(function(L){var x=l[L];if(x){var T=S.BufferHelper.getBuffered(x);T.length>0&&y>T.start(0)&&(e.trigger(u.Events.BACK_BUFFER_REACHED,{bufferEnd:y}),n.live&&e.trigger(u.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:y}),e.trigger(u.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:y,type:L}))}})}}}},h.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var e=this.details,n=this.hls,r=this.media,l=this.mediaSource,s=e.fragments[0].start+e.totalduration,a=r.duration,p=Object(b.isFiniteNumber)(l.duration)?l.duration:0;e.live&&n.config.liveDurationInfinity?(m.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),l.duration=1/0,this.updateSeekableRange(e)):(s>p&&s>a||!Object(b.isFiniteNumber)(a))&&(m.logger.log("[buffer-controller]: Updating Media Source duration to "+s.toFixed(3)),l.duration=s)}},h.updateSeekableRange=function(e){var n=this.mediaSource,r=e.fragments,l=r.length;if(l&&e.live&&n!==null&&n!==void 0&&n.setLiveSeekableRange){var s=Math.max(0,r[0].start),a=Math.max(s,s+e.totalduration);n.setLiveSeekableRange(s,a)}},h.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,n=this.operationQueue,r=this.pendingTracks,l=Object.keys(r).length;if(l&&!e||l===2){this.createSourceBuffers(r),this.pendingTracks={};var s=this.getSourceBufferTypes();if(s.length===0){this.hls.trigger(u.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}s.forEach(function(a){n.executeNext(a)})}},h.createSourceBuffers=function(e){var n=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");var l=0;for(var s in e)if(!n[s]){var a=e[s];if(!a)throw Error("source buffer exists for track "+s+", however track does not");var p=a.levelCodec||a.codec,A=a.container+";codecs="+p;m.logger.log("[buffer-controller]: creating sourceBuffer("+A+")");try{var _=n[s]=r.addSourceBuffer(A),y=s;this.addBufferListener(y,"updatestart",this._onSBUpdateStart),this.addBufferListener(y,"updateend",this._onSBUpdateEnd),this.addBufferListener(y,"error",this._onSBUpdateError),this.tracks[s]={buffer:_,codec:p,container:a.container,levelCodec:a.levelCodec,metadata:a.metadata,id:a.id},l++}catch(L){m.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+L.message),this.hls.trigger(u.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:L,mimeType:A})}}l&&this.hls.trigger(u.Events.BUFFER_CREATED,{tracks:this.tracks})},h._onSBUpdateStart=function(e){var n=this.operationQueue,r=n.current(e);r.onStart()},h._onSBUpdateEnd=function(e){var n=this.operationQueue,r=n.current(e);r.onComplete(),n.shiftAndExecuteNext(e)},h._onSBUpdateError=function(e,n){m.logger.error("[buffer-controller]: "+e+" SourceBuffer error",n),this.hls.trigger(u.Events.ERROR,{type:D.ErrorTypes.MEDIA_ERROR,details:D.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var r=this.operationQueue.current(e);r&&r.onError(n)},h.removeExecutor=function(e,n,r){var l=this.media,s=this.mediaSource,a=this.operationQueue,p=this.sourceBuffer,A=p[e];if(!l||!s||!A){m.logger.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),a.shiftAndExecuteNext(e);return}var _=Object(b.isFiniteNumber)(l.duration)?l.duration:1/0,y=Object(b.isFiniteNumber)(s.duration)?s.duration:1/0,L=Math.max(0,n),x=Math.min(r,_,y);x>L?(m.logger.log("[buffer-controller]: Removing ["+L+","+x+"] from the "+e+" SourceBuffer"),console.assert(!A.updating,e+" sourceBuffer must not be updating"),A.remove(L,x)):a.shiftAndExecuteNext(e)},h.appendExecutor=function(e,n){var r=this.operationQueue,l=this.sourceBuffer,s=l[n];if(!s){m.logger.warn("[buffer-controller]: Attempting to append to the "+n+" SourceBuffer, but it does not exist"),r.shiftAndExecuteNext(n);return}s.ended=!1,console.assert(!s.updating,n+" sourceBuffer must not be updating"),s.appendBuffer(e)},h.blockBuffers=function(e,n){var r=this;if(n===void 0&&(n=this.getSourceBufferTypes()),!n.length){m.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);return}var l=this.operationQueue,s=n.map(function(a){return l.appendBlocker(a)});Promise.all(s).then(function(){e(),n.forEach(function(a){var p=r.sourceBuffer[a];(!p||!p.updating)&&l.shiftAndExecuteNext(a)})})},h.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},h.addBufferListener=function(e,n,r){var l=this.sourceBuffer[e];if(!!l){var s=r.bind(this,e);this.listeners[e].push({event:n,listener:s}),l.addEventListener(n,s)}},h.removeBufferListeners=function(e){var n=this.sourceBuffer[e];!n||this.listeners[e].forEach(function(r){n.removeEventListener(r.event,r.listener)})},c}()},"./src/controller/buffer-operation-queue.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return u});var b=E("./src/utils/logger.ts"),u=function(){function m(S){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=S}var D=m.prototype;return D.append=function(g,d){var i=this.queues[d];i.push(g),i.length===1&&this.buffers[d]&&this.executeNext(d)},D.insertAbort=function(g,d){var i=this.queues[d];i.unshift(g),this.executeNext(d)},D.appendBlocker=function(g){var d,i=new Promise(function(o){d=o}),f={execute:d,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(f,g),i},D.executeNext=function(g){var d=this.buffers,i=this.queues,f=d[g],o=i[g];if(o.length){var v=o[0];try{v.execute()}catch(c){b.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),v.onError(c),(!f||!f.updating)&&(o.shift(),this.executeNext(g))}}},D.shiftAndExecuteNext=function(g){this.queues[g].shift(),this.executeNext(g)},D.current=function(g){return this.queues[g][0]},m}()},"./src/controller/cap-level-controller.ts":function(M,P,E){E.r(P);var b=E("./src/events.ts");function u(S,g){for(var d=0;d<g.length;d++){var i=g[d];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(S,i.key,i)}}function m(S,g,d){return g&&u(S.prototype,g),d&&u(S,d),Object.defineProperty(S,"prototype",{writable:!1}),S}var D=function(){function S(d){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=d,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var g=S.prototype;return g.setStreamController=function(i){this.streamController=i},g.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},g.registerListeners=function(){var i=this.hls;i.on(b.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.on(b.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(b.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},g.unregisterListener=function(){var i=this.hls;i.off(b.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.off(b.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(b.Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},g.onFpsDropLevelCapping=function(i,f){S.isLevelAllowed(f.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(f.droppedLevel)},g.onMediaAttaching=function(i,f){this.media=f.media instanceof HTMLVideoElement?f.media:null},g.onManifestParsed=function(i,f){var o=this.hls;this.restrictedLevels=[],this.firstLevel=f.firstLevel,o.config.capLevelToPlayerSize&&f.video&&this.startCapping()},g.onBufferCodecs=function(i,f){var o=this.hls;o.config.capLevelToPlayerSize&&f.video&&this.startCapping()},g.onMediaDetaching=function(){this.stopCapping()},g.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var i=this.hls.levels;if(i.length){var f=this.hls;f.autoLevelCapping=this.getMaxLevel(i.length-1),f.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=f.autoLevelCapping}}},g.getMaxLevel=function(i){var f=this,o=this.hls.levels;if(!o.length)return-1;var v=o.filter(function(c,h){return S.isLevelAllowed(h,f.restrictedLevels)&&h<=i});return this.clientRect=null,S.getMaxLevelByMediaSize(v,this.mediaWidth,this.mediaHeight)},g.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},g.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},g.getDimensions=function(){if(this.clientRect)return this.clientRect;var i=this.media,f={width:0,height:0};if(i){var o=i.getBoundingClientRect();f.width=o.width,f.height=o.height,!f.width&&!f.height&&(f.width=o.right-o.left||i.width||0,f.height=o.bottom-o.top||i.height||0)}return this.clientRect=f,f},S.isLevelAllowed=function(i,f){return f===void 0&&(f=[]),f.indexOf(i)===-1},S.getMaxLevelByMediaSize=function(i,f,o){if(!i||!i.length)return-1;for(var v=function(n,r){return r?n.width!==r.width||n.height!==r.height:!0},c=i.length-1,h=0;h<i.length;h+=1){var t=i[h];if((t.width>=f||t.height>=o)&&v(t,i[h+1])){c=h;break}}return c},m(S,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var i=1;if(!this.hls.config.ignoreDevicePixelRatio)try{i=self.devicePixelRatio}catch{}return i}}]),S}();P.default=D},"./src/controller/cmcd-controller.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return v});var b=E("./src/events.ts"),u=E("./src/types/cmcd.ts"),m=E("./src/utils/buffer-helper.ts"),D=E("./src/utils/logger.ts");function S(c,h){for(var t=0;t<h.length;t++){var e=h[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(c,e.key,e)}}function g(c,h,t){return h&&S(c.prototype,h),t&&S(c,t),Object.defineProperty(c,"prototype",{writable:!1}),c}function d(c,h){var t=typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(t)return(t=t.call(c)).next.bind(t);if(Array.isArray(c)||(t=i(c))||h&&c&&typeof c.length=="number"){t&&(c=t);var e=0;return function(){return e>=c.length?{done:!0}:{done:!1,value:c[e++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function i(c,h){if(!!c){if(typeof c=="string")return f(c,h);var t=Object.prototype.toString.call(c).slice(8,-1);if(t==="Object"&&c.constructor&&(t=c.constructor.name),t==="Map"||t==="Set")return Array.from(c);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return f(c,h)}}function f(c,h){(h==null||h>c.length)&&(h=c.length);for(var t=0,e=new Array(h);t<h;t++)e[t]=c[t];return e}function o(){return o=Object.assign?Object.assign.bind():function(c){for(var h=1;h<arguments.length;h++){var t=arguments[h];for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&(c[e]=t[e])}return c},o.apply(this,arguments)}var v=function(){function c(t){var e=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){e.initialized&&(e.starved=!0),e.buffering=!0},this.onPlaying=function(){e.initialized||(e.initialized=!0),e.buffering=!1},this.applyPlaylistData=function(l){try{e.apply(l,{ot:u.CMCDObjectType.MANIFEST,su:!e.initialized})}catch(s){D.logger.warn("Could not generate manifest CMCD data.",s)}},this.applyFragmentData=function(l){try{var s=l.frag,a=e.hls.levels[s.level],p=e.getObjectType(s),A={d:s.duration*1e3,ot:p};(p===u.CMCDObjectType.VIDEO||p===u.CMCDObjectType.AUDIO||p==u.CMCDObjectType.MUXED)&&(A.br=a.bitrate/1e3,A.tb=e.getTopBandwidth(p)/1e3,A.bl=e.getBufferLength(p)),e.apply(l,A)}catch(_){D.logger.warn("Could not generate segment CMCD data.",_)}},this.hls=t;var n=this.config=t.config,r=n.cmcd;r!=null&&(n.pLoader=this.createPlaylistLoader(),n.fLoader=this.createFragmentLoader(),this.sid=r.sessionId||c.uuid(),this.cid=r.contentId,this.useHeaders=r.useHeaders===!0,this.registerListeners())}var h=c.prototype;return h.registerListeners=function(){var e=this.hls;e.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this)},h.unregisterListeners=function(){var e=this.hls;e.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.Events.MEDIA_DETACHED,this.onMediaDetached,this),e.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},h.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},h.onMediaAttached=function(e,n){this.media=n.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},h.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},h.onBufferCreated=function(e,n){var r,l;this.audioBuffer=(r=n.tracks.audio)===null||r===void 0?void 0:r.buffer,this.videoBuffer=(l=n.tracks.video)===null||l===void 0?void 0:l.buffer},h.createData=function(){var e;return{v:u.CMCDVersion,sf:u.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)===null||e===void 0?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},h.apply=function(e,n){n===void 0&&(n={}),o(n,this.createData());var r=n.ot===u.CMCDObjectType.INIT||n.ot===u.CMCDObjectType.VIDEO||n.ot===u.CMCDObjectType.MUXED;if(this.starved&&r&&(n.bs=!0,n.su=!0,this.starved=!1),n.su==null&&(n.su=this.buffering),this.useHeaders){var l=c.toHeaders(n);if(!Object.keys(l).length)return;e.headers||(e.headers={}),o(e.headers,l)}else{var s=c.toQuery(n);if(!s)return;e.url=c.appendQueryToUri(e.url,s)}},h.getObjectType=function(e){var n=e.type;if(n==="subtitle")return u.CMCDObjectType.TIMED_TEXT;if(e.sn==="initSegment")return u.CMCDObjectType.INIT;if(n==="audio")return u.CMCDObjectType.AUDIO;if(n==="main")return this.hls.audioTracks.length?u.CMCDObjectType.VIDEO:u.CMCDObjectType.MUXED},h.getTopBandwidth=function(e){var n=0,r,l=this.hls;if(e===u.CMCDObjectType.AUDIO)r=l.audioTracks;else{var s=l.maxAutoLevel,a=s>-1?s+1:l.levels.length;r=l.levels.slice(0,a)}for(var p=d(r),A;!(A=p()).done;){var _=A.value;_.bitrate>n&&(n=_.bitrate)}return n>0?n:NaN},h.getBufferLength=function(e){var n=this.hls.media,r=e===u.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!r||!n)return NaN;var l=m.BufferHelper.bufferInfo(r,n.currentTime,this.config.maxBufferHole);return l.len*1e3},h.createPlaylistLoader=function(){var e=this.config.pLoader,n=this.applyPlaylistData,r=e||this.config.loader;return function(){function l(a){this.loader=void 0,this.loader=new r(a)}var s=l.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(p,A,_){n(p),this.loader.load(p,A,_)},g(l,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),l}()},h.createFragmentLoader=function(){var e=this.config.fLoader,n=this.applyFragmentData,r=e||this.config.loader;return function(){function l(a){this.loader=void 0,this.loader=new r(a)}var s=l.prototype;return s.destroy=function(){this.loader.destroy()},s.abort=function(){this.loader.abort()},s.load=function(p,A,_){n(p),this.loader.load(p,A,_)},g(l,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),l}()},c.uuid=function(){var e=URL.createObjectURL(new Blob),n=e.toString();return URL.revokeObjectURL(e),n.slice(n.lastIndexOf("/")+1)},c.serialize=function(e){for(var n=[],r=function(C){return!Number.isNaN(C)&&C!=null&&C!==""&&C!==!1},l=function(C){return Math.round(C)},s=function(C){return l(C/100)*100},a=function(C){return encodeURIComponent(C)},p={br:l,d:l,bl:s,dl:s,mtp:s,nor:a,rtp:s,tb:l},A=Object.keys(e||{}).sort(),_=d(A),y;!(y=_()).done;){var L=y.value,x=e[L];if(!!r(x)&&!(L==="v"&&x===1)&&!(L=="pr"&&x===1)){var T=p[L];T&&(x=T(x));var O=typeof x,R=void 0;L==="ot"||L==="sf"||L==="st"?R=L+"="+x:O==="boolean"?R=L:O==="number"?R=L+"="+x:R=L+"="+JSON.stringify(x),n.push(R)}}return n.join(",")},c.toHeaders=function(e){for(var n=Object.keys(e),r={},l=["Object","Request","Session","Status"],s=[{},{},{},{}],a={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},p=0,A=n;p<A.length;p++){var _=A[p],y=a[_]!=null?a[_]:1;s[y][_]=e[_]}for(var L=0;L<s.length;L++){var x=c.serialize(s[L]);x&&(r["CMCD-"+l[L]]=x)}return r},c.toQuery=function(e){return"CMCD="+encodeURIComponent(c.serialize(e))},c.appendQueryToUri=function(e,n){if(!n)return e;var r=e.includes("?")?"&":"?";return""+e+r+n},c}()},"./src/controller/eme-controller.ts":function(M,P,E){E.r(P);var b=E("./src/events.ts"),u=E("./src/errors.ts"),m=E("./src/utils/logger.ts"),D=E("./src/utils/mediakeys-helper.ts");function S(v,c){for(var h=0;h<c.length;h++){var t=c[h];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function g(v,c,h){return c&&S(v.prototype,c),h&&S(v,h),Object.defineProperty(v,"prototype",{writable:!1}),v}var d=3,i=function(c,h,t){var e={audioCapabilities:[],videoCapabilities:[]};return c.forEach(function(n){e.audioCapabilities.push({contentType:'audio/mp4; codecs="'+n+'"',robustness:t.audioRobustness||""})}),h.forEach(function(n){e.videoCapabilities.push({contentType:'video/mp4; codecs="'+n+'"',robustness:t.videoRobustness||""})}),[e]},f=function(c,h,t,e){switch(c){case D.KeySystems.WIDEVINE:return i(h,t,e);default:throw new Error("Unknown key-system: "+c)}},o=function(){function v(h){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=h,this._config=h.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var c=v.prototype;return c.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},c._registerListeners=function(){this.hls.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(b.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this)},c._unregisterListeners=function(){this.hls.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(b.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this)},c.getLicenseServerUrl=function(t){switch(t){case D.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},c._attemptKeySystemAccess=function(t,e,n){var r=this,l=f(t,e,n,this._drmSystemOptions);m.logger.log("Requesting encrypted media key-system access");var s=this.requestMediaKeySystemAccess(t,l);this.mediaKeysPromise=s.then(function(a){return r._onMediaKeySystemAccessObtained(t,a)}),s.catch(function(a){m.logger.error('Failed to obtain key-system "'+t+'" access:',a)})},c._onMediaKeySystemAccessObtained=function(t,e){var n=this;m.logger.log('Access for key-system "'+t+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(r);var l=Promise.resolve().then(function(){return e.createMediaKeys()}).then(function(s){return r.mediaKeys=s,m.logger.log('Media-keys created for key-system "'+t+'"'),n._onMediaKeysCreated(),s});return l.catch(function(s){m.logger.error("Failed to create media-keys:",s)}),l},c._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach(function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))})},c._onNewMediaKeySession=function(t){var e=this;m.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",function(n){e._onKeySessionMessage(t,n.message)},!1)},c._onKeySessionMessage=function(t,e){m.logger.log("Got EME message event, creating license request"),this._requestLicense(e,function(n){m.logger.log("Received license data (length: "+(n&&n.byteLength)+"), updating key-session"),t.update(n).catch(function(r){m.logger.warn("Updating key-session failed: "+r)})})},c.onMediaEncrypted=function(t){var e=this;if(m.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!this.mediaKeysPromise){m.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var n=function(l){!e._media||(e._attemptSetMediaKeys(l),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};this.mediaKeysPromise.then(n).catch(n)},c._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys){m.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}m.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},c._generateRequestWithPreferredKeySession=function(t,e){var n=this,r=this._mediaKeysList[0];if(!r){m.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(r.mediaKeysSessionInitialized){m.logger.warn("Key-Session already initialized but requested again");return}var l=r.mediaKeysSession;if(!l){m.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!e){m.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}m.logger.log('Generating key-session request for "'+t+'" init data type'),r.mediaKeysSessionInitialized=!0,l.generateRequest(t,e).then(function(){m.logger.debug("Key-session generation succeeded")}).catch(function(s){m.logger.error("Error generating key-session request:",s),n.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},c._createLicenseXhr=function(t,e,n){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,t,e,n);var l=this._licenseXhrSetup;if(l)try{l.call(this.hls,r,t),l=void 0}catch(s){m.logger.error(s)}try{r.readyState||r.open("POST",t,!0),l&&l.call(this.hls,r,t)}catch(s){throw new Error("issue setting up KeySystem license XHR "+s)}return r},c._onLicenseRequestReadyStageChange=function(t,e,n,r){switch(t.readyState){case 4:if(t.status===200){this._requestLicenseFailureCount=0,m.logger.log("License request succeeded");var l=t.response,s=this._licenseResponseCallback;if(s)try{l=s.call(this.hls,t,e)}catch(p){m.logger.error(p)}r(l)}else{if(m.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>d){this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var a=d-this._requestLicenseFailureCount+1;m.logger.warn("Retrying license request, "+a+" attempts left"),this._requestLicense(n,r)}break}},c._generateLicenseRequestChallenge=function(t,e){switch(t.mediaKeySystemDomain){case D.KeySystems.WIDEVINE:return e}throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},c._requestLicense=function(t,e){m.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n){m.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var r=this.getLicenseServerUrl(n.mediaKeySystemDomain),l=this._createLicenseXhr(r,t,e);m.logger.log("Sending license request to URL: "+r);var s=this._generateLicenseRequestChallenge(n,t);l.send(s)}catch(a){m.logger.error("Failure requesting DRM license: "+a),this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.KEY_SYSTEM_ERROR,details:u.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},c.onMediaAttached=function(t,e){if(!!this._emeEnabled){var n=e.media;this._media=n,n.addEventListener("encrypted",this._onMediaEncrypted)}},c.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;!t||(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map(function(n){if(n.mediaKeysSession)return n.mediaKeysSession.close().catch(function(){})})).then(function(){return t.setMediaKeys(null)}).catch(function(){}))},c.onManifestParsed=function(t,e){if(!!this._emeEnabled){var n=e.levels.map(function(l){return l.audioCodec}).filter(function(l){return!!l}),r=e.levels.map(function(l){return l.videoCodec}).filter(function(l){return!!l});this._attemptKeySystemAccess(D.KeySystems.WIDEVINE,n,r)}},g(v,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),v}();P.default=o},"./src/controller/fps-controller.ts":function(M,P,E){E.r(P);var b=E("./src/events.ts"),u=E("./src/utils/logger.ts"),m=function(){function D(g){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=g,this.registerListeners()}var S=D.prototype;return S.setStreamController=function(d){this.streamController=d},S.registerListeners=function(){this.hls.on(b.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},S.unregisterListeners=function(){this.hls.off(b.Events.MEDIA_ATTACHING,this.onMediaAttaching)},S.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},S.onMediaAttaching=function(d,i){var f=this.hls.config;if(f.capLevelOnFPSDrop){var o=i.media instanceof self.HTMLVideoElement?i.media:null;this.media=o,o&&typeof o.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),f.fpsDroppedMonitoringPeriod)}},S.checkFPS=function(d,i,f){var o=performance.now();if(i){if(this.lastTime){var v=o-this.lastTime,c=f-this.lastDroppedFrames,h=i-this.lastDecodedFrames,t=1e3*c/v,e=this.hls;if(e.trigger(b.Events.FPS_DROP,{currentDropped:c,currentDecoded:h,totalDroppedFrames:f}),t>0&&c>e.config.fpsDroppedMonitoringThreshold*h){var n=e.currentLevel;u.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+n),n>0&&(e.autoLevelCapping===-1||e.autoLevelCapping>=n)&&(n=n-1,e.trigger(b.Events.FPS_DROP_LEVEL_CAPPING,{level:n,droppedLevel:e.currentLevel}),e.autoLevelCapping=n,this.streamController.nextLevelSwitch())}}this.lastTime=o,this.lastDroppedFrames=f,this.lastDecodedFrames=i}},S.checkFPSInterval=function(){var d=this.media;if(d)if(this.isVideoPlaybackQualityAvailable){var i=d.getVideoPlaybackQuality();this.checkFPS(d,i.totalVideoFrames,i.droppedVideoFrames)}else this.checkFPS(d,d.webkitDecodedFrameCount,d.webkitDroppedFrameCount)},D}();P.default=m},"./src/controller/fragment-finders.ts":function(M,P,E){E.r(P),E.d(P,"findFragmentByPDT",function(){return m}),E.d(P,"findFragmentByPTS",function(){return D}),E.d(P,"fragmentWithinToleranceTest",function(){return S}),E.d(P,"pdtWithinToleranceTest",function(){return g}),E.d(P,"findFragWithCC",function(){return d});var b=E("./src/polyfills/number.ts"),u=E("./src/utils/binary-search.ts");function m(i,f,o){if(f===null||!Array.isArray(i)||!i.length||!Object(b.isFiniteNumber)(f))return null;var v=i[0].programDateTime;if(f<(v||0))return null;var c=i[i.length-1].endProgramDateTime;if(f>=(c||0))return null;o=o||0;for(var h=0;h<i.length;++h){var t=i[h];if(g(f,o,t))return t}return null}function D(i,f,o,v){o===void 0&&(o=0),v===void 0&&(v=0);var c=null;if(i?c=f[i.sn-f[0].sn+1]||null:o===0&&f[0].start===0&&(c=f[0]),c&&S(o,v,c)===0)return c;var h=u.default.search(f,S.bind(null,o,v));return h||c}function S(i,f,o){i===void 0&&(i=0),f===void 0&&(f=0);var v=Math.min(f,o.duration+(o.deltaPTS?o.deltaPTS:0));return o.start+o.duration-v<=i?1:o.start-v>i&&o.start?-1:0}function g(i,f,o){var v=Math.min(f,o.duration+(o.deltaPTS?o.deltaPTS:0))*1e3,c=o.endProgramDateTime||0;return c-v>i}function d(i,f){return u.default.search(i,function(o){return o.cc<f?1:o.cc>f?-1:0})}},"./src/controller/fragment-tracker.ts":function(M,P,E){E.r(P),E.d(P,"FragmentState",function(){return m}),E.d(P,"FragmentTracker",function(){return D});var b=E("./src/events.ts"),u=E("./src/types/loader.ts"),m;(function(d){d.NOT_LOADED="NOT_LOADED",d.APPENDING="APPENDING",d.PARTIAL="PARTIAL",d.OK="OK"})(m||(m={}));var D=function(){function d(f){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=f,this._registerListeners()}var i=d.prototype;return i._registerListeners=function(){var o=this.hls;o.on(b.Events.BUFFER_APPENDED,this.onBufferAppended,this),o.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.on(b.Events.FRAG_LOADED,this.onFragLoaded,this)},i._unregisterListeners=function(){var o=this.hls;o.off(b.Events.BUFFER_APPENDED,this.onBufferAppended,this),o.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this),o.off(b.Events.FRAG_LOADED,this.onFragLoaded,this)},i.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},i.getAppendedFrag=function(o,v){if(v===u.PlaylistLevelType.MAIN){var c=this.activeFragment,h=this.activeParts;if(!c)return null;if(h)for(var t=h.length;t--;){var e=h[t],n=e?e.end:c.appendedPTS;if(e.start<=o&&n!==void 0&&o<=n)return t>9&&(this.activeParts=h.slice(t-9)),e}else if(c.start<=o&&c.appendedPTS!==void 0&&o<=c.appendedPTS)return c}return this.getBufferedFrag(o,v)},i.getBufferedFrag=function(o,v){for(var c=this.fragments,h=Object.keys(c),t=h.length;t--;){var e=c[h[t]];if((e==null?void 0:e.body.type)===v&&e.buffered){var n=e.body;if(n.start<=o&&o<=n.end)return n}}return null},i.detectEvictedFragments=function(o,v,c){var h=this;Object.keys(this.fragments).forEach(function(t){var e=h.fragments[t];if(!!e){if(!e.buffered){e.body.type===c&&h.removeFragment(e.body);return}var n=e.range[o];!n||n.time.some(function(r){var l=!h.isTimeBuffered(r.startPTS,r.endPTS,v);return l&&h.removeFragment(e.body),l})}})},i.detectPartialFragments=function(o){var v=this,c=this.timeRanges,h=o.frag,t=o.part;if(!(!c||h.sn==="initSegment")){var e=g(h),n=this.fragments[e];!n||(Object.keys(c).forEach(function(r){var l=h.elementaryStreams[r];if(!!l){var s=c[r],a=t!==null||l.partial===!0;n.range[r]=v.getBufferedTimes(h,t,a,s)}}),n.loaded=null,Object.keys(n.range).length?n.buffered=!0:this.removeFragment(n.body))}},i.fragBuffered=function(o){var v=g(o),c=this.fragments[v];c&&(c.loaded=null,c.buffered=!0)},i.getBufferedTimes=function(o,v,c,h){for(var t={time:[],partial:c},e=v?v.start:o.start,n=v?v.end:o.end,r=o.minEndPTS||n,l=o.maxStartPTS||e,s=0;s<h.length;s++){var a=h.start(s)-this.bufferPadding,p=h.end(s)+this.bufferPadding;if(l>=a&&r<=p){t.time.push({startPTS:Math.max(e,h.start(s)),endPTS:Math.min(n,h.end(s))});break}else if(e<p&&n>a)t.partial=!0,t.time.push({startPTS:Math.max(e,h.start(s)),endPTS:Math.min(n,h.end(s))});else if(n<=a)break}return t},i.getPartialFragment=function(o){var v=null,c,h,t,e=0,n=this.bufferPadding,r=this.fragments;return Object.keys(r).forEach(function(l){var s=r[l];!s||S(s)&&(h=s.body.start-n,t=s.body.end+n,o>=h&&o<=t&&(c=Math.min(o-h,t-o),e<=c&&(v=s.body,e=c)))}),v},i.getState=function(o){var v=g(o),c=this.fragments[v];return c?c.buffered?S(c)?m.PARTIAL:m.OK:m.APPENDING:m.NOT_LOADED},i.isTimeBuffered=function(o,v,c){for(var h,t,e=0;e<c.length;e++){if(h=c.start(e)-this.bufferPadding,t=c.end(e)+this.bufferPadding,o>=h&&v<=t)return!0;if(v<=h)return!1}return!1},i.onFragLoaded=function(o,v){var c=v.frag,h=v.part;if(!(c.sn==="initSegment"||c.bitrateTest||h)){var t=g(c);this.fragments[t]={body:c,loaded:v,buffered:!1,range:Object.create(null)}}},i.onBufferAppended=function(o,v){var c=this,h=v.frag,t=v.part,e=v.timeRanges;if(h.type===u.PlaylistLevelType.MAIN)if(this.activeFragment=h,t){var n=this.activeParts;n||(this.activeParts=n=[]),n.push(t)}else this.activeParts=null;this.timeRanges=e,Object.keys(e).forEach(function(r){var l=e[r];if(c.detectEvictedFragments(r,l),!t)for(var s=0;s<l.length;s++)h.appendedPTS=Math.max(l.end(s),h.appendedPTS||0)})},i.onFragBuffered=function(o,v){this.detectPartialFragments(v)},i.hasFragment=function(o){var v=g(o);return!!this.fragments[v]},i.removeFragmentsInRange=function(o,v,c){var h=this;Object.keys(this.fragments).forEach(function(t){var e=h.fragments[t];if(!!e&&e.buffered){var n=e.body;n.type===c&&n.start<v&&n.end>o&&h.removeFragment(n)}})},i.removeFragment=function(o){var v=g(o);o.stats.loaded=0,o.clearElementaryStreamInfo(),delete this.fragments[v]},i.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},d}();function S(d){var i,f;return d.buffered&&(((i=d.range.video)===null||i===void 0?void 0:i.partial)||((f=d.range.audio)===null||f===void 0?void 0:f.partial))}function g(d){return d.type+"_"+d.level+"_"+d.urlId+"_"+d.sn}},"./src/controller/gap-controller.ts":function(M,P,E){E.r(P),E.d(P,"STALL_MINIMUM_DURATION_MS",function(){return S}),E.d(P,"MAX_START_GAP_JUMP",function(){return g}),E.d(P,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return d}),E.d(P,"SKIP_BUFFER_RANGE_START",function(){return i}),E.d(P,"default",function(){return f});var b=E("./src/utils/buffer-helper.ts"),u=E("./src/errors.ts"),m=E("./src/events.ts"),D=E("./src/utils/logger.ts"),S=250,g=2,d=.1,i=.05,f=function(){function o(c,h,t,e){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=c,this.media=h,this.fragmentTracker=t,this.hls=e}var v=o.prototype;return v.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},v.poll=function(h,t){var e=this.config,n=this.media,r=this.stalled;if(n!==null){var l=n.currentTime,s=n.seeking,a=this.seeking&&!s,p=!this.seeking&&s;if(this.seeking=s,l!==h){if(this.moved=!0,r!==null){if(this.stallReported){var A=self.performance.now()-r;D.logger.warn("playback not stuck anymore @"+l+", after "+Math.round(A)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((p||a)&&(this.stalled=null),!(n.paused&&!s||n.ended||n.playbackRate===0||!b.BufferHelper.getBuffered(n).length)){var _=b.BufferHelper.bufferInfo(n,l,0),y=_.len>0,L=_.nextStart||0;if(!(!y&&!L)){if(s){var x=_.len>g,T=!L||t&&t.start<=l||L-l>g&&!this.fragmentTracker.getPartialFragment(l);if(x||T)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var O,R=Math.max(L,_.start||0)-l,I=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,C=I==null||(O=I.details)===null||O===void 0?void 0:O.live,w=C?I.details.targetduration*2:g;if(R>0&&R<=w){this._trySkipBufferHole(null);return}}var F=self.performance.now();if(r===null){this.stalled=F;return}var B=F-r;if(!(!s&&B>=S&&(this._reportStall(_),!this.media))){var k=b.BufferHelper.bufferInfo(n,l,e.maxBufferHole);this._tryFixBufferStall(k,B)}}}}},v._tryFixBufferStall=function(h,t){var e=this.config,n=this.fragmentTracker,r=this.media;if(r!==null){var l=r.currentTime,s=n.getPartialFragment(l);if(s){var a=this._trySkipBufferHole(s);if(a||!this.media)return}h.len>e.maxBufferHole&&t>e.highBufferWatchdogPeriod*1e3&&(D.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},v._reportStall=function(h){var t=this.hls,e=this.media,n=this.stallReported;!n&&e&&(this.stallReported=!0,D.logger.warn("Playback stalling at @"+e.currentTime+" due to low buffer ("+JSON.stringify(h)+")"),t.trigger(m.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:h.len}))},v._trySkipBufferHole=function(h){var t=this.config,e=this.hls,n=this.media;if(n===null)return 0;for(var r=n.currentTime,l=0,s=b.BufferHelper.getBuffered(n),a=0;a<s.length;a++){var p=s.start(a);if(r+t.maxBufferHole>=l&&r<p){var A=Math.max(p+i,n.currentTime+d);return D.logger.warn("skipping hole, adjusting currentTime from "+r+" to "+A),this.moved=!0,this.stalled=null,n.currentTime=A,h&&e.trigger(m.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+r+" to "+A,frag:h}),A}l=s.end(a)}return 0},v._tryNudgeBuffer=function(){var h=this.config,t=this.hls,e=this.media,n=this.nudgeRetry;if(e!==null){var r=e.currentTime;if(this.nudgeRetry++,n<h.nudgeMaxRetry){var l=r+(n+1)*h.nudgeOffset;D.logger.warn("Nudging 'currentTime' from "+r+" to "+l),e.currentTime=l,t.trigger(m.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else D.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+h.nudgeMaxRetry+" nudges"),t.trigger(m.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},o}()},"./src/controller/id3-track-controller.ts":function(M,P,E){E.r(P);var b=E("./src/polyfills/number.ts"),u=E("./src/events.ts"),m=E("./src/utils/texttrack-utils.ts"),D=E("./src/demux/id3.ts"),S=E("./src/loader/date-range.ts"),g=E("./src/types/demuxer.ts"),d=.25;function i(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function f(c,h){return c.getTime()/1e3-h}function o(c){return Uint8Array.from(c.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var v=function(){function c(t){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=t,this._registerListeners()}var h=c.prototype;return h.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},h._registerListeners=function(){var e=this.hls;e.on(u.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(u.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},h._unregisterListeners=function(){var e=this.hls;e.off(u.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(u.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},h.onMediaAttached=function(e,n){this.media=n.media},h.onMediaDetaching=function(){!this.id3Track||(Object(m.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},h.onManifestLoading=function(){this.dateRangeCuesAppended={}},h.createTrack=function(e){var n=this.getID3Track(e.textTracks);return n.mode="hidden",n},h.getID3Track=function(e){if(!!this.media){for(var n=0;n<e.length;n++){var r=e[n];if(r.kind==="metadata"&&r.label==="id3")return Object(m.sendAddTrackEvent)(r,this.media),r}return this.media.addTextTrack("metadata","id3")}},h.onFragParsingMetadata=function(e,n){if(!!this.media){var r=this.hls.config,l=r.enableEmsgMetadataCues,s=r.enableID3MetadataCues;if(!(!l&&!s)){var a=n.frag,p=n.samples,A=n.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var _=A.edge||a.end,y=i(),L=!1,x={},T=0;T<p.length;T++){var O=p[T].type;if(!(O===g.MetadataSchema.emsg&&!l||!s)){var R=D.getID3Frames(p[T].data);if(R){var I=p[T].pts,C=_,w=C-I;w<=0&&(C=I+d);for(var F=0;F<R.length;F++){var B=R[F];if(!D.isTimeStampFrame(B)){var k=new y(I,C,"");k.value=B,O&&(k.type=O),this.id3Track.addCue(k),x[B.key]=null,L=!0}}}}}L&&this.updateId3CueEnds(x)}}},h.updateId3CueEnds=function(e){var n,r=(n=this.id3Track)===null||n===void 0?void 0:n.cues;if(r)for(var l=r.length;l--;){var s,a=r[l],p=(s=a.value)===null||s===void 0?void 0:s.key;if(p&&p in e){var A=e[p];A&&a.endTime!==A&&(a.endTime=A),e[p]=a.startTime}}},h.onBufferFlushing=function(e,n){var r=n.startOffset,l=n.endOffset,s=n.type,a=this.id3Track,p=this.hls;if(!!p){var A=p.config,_=A.enableEmsgMetadataCues,y=A.enableID3MetadataCues;if(a&&(_||y)){var L;s==="audio"?L=function(T){return T.type===g.MetadataSchema.audioId3&&y}:s==="video"?L=function(T){return T.type===g.MetadataSchema.emsg&&_}:L=function(T){return T.type===g.MetadataSchema.audioId3&&y||T.type===g.MetadataSchema.emsg&&_},Object(m.removeCuesInRange)(a,r,l,L)}}},h.onLevelUpdated=function(e,n){var r=this,l=n.details;if(!(!this.media||!l.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var s=this.dateRangeCuesAppended,a=this.id3Track,p=l.dateRanges,A=Object.keys(p);if(a)for(var _=Object.keys(s).filter(function(w){return!A.includes(w)}),y=function(F){var B=_[F];Object.keys(s[B].cues).forEach(function(k){a.removeCue(s[B].cues[k])}),delete s[B]},L=_.length;L--;)y(L);var x=l.fragments[l.fragments.length-1];if(!(A.length===0||!Object(b.isFiniteNumber)(x==null?void 0:x.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var T=x.programDateTime/1e3-x.start,O=l.edge||x.end,R=i(),I=function(F){var B=A[F],k=p[B],U=s[B],N=(U==null?void 0:U.cues)||{},j=(U==null?void 0:U.durationKnown)||!1,K=f(k.startDate,T),H=O,V=k.endDate;if(V)H=f(V,T),j=!0;else if(k.endOnNext&&!j){var G=A.reduce(function(ie,ae){var se=p[ae];return se.class===k.class&&se.id!==ae&&se.startDate>k.startDate&&ie.push(se),ie},[]).sort(function(ie,ae){return ie.startDate.getTime()-ae.startDate.getTime()})[0];G&&(H=f(G.startDate,T),j=!0)}for(var ee=Object.keys(k.attr),q=0;q<ee.length;q++){var z=ee[q];if(!(z===S.DateRangeAttribute.ID||z===S.DateRangeAttribute.CLASS||z===S.DateRangeAttribute.START_DATE||z===S.DateRangeAttribute.DURATION||z===S.DateRangeAttribute.END_DATE||z===S.DateRangeAttribute.END_ON_NEXT)){var X=N[z];if(X)j&&!U.durationKnown&&(X.endTime=H);else{var J=k.attr[z];X=new R(K,H,""),(z===S.DateRangeAttribute.SCTE35_OUT||z===S.DateRangeAttribute.SCTE35_IN)&&(J=o(J)),X.value={key:z,data:J},X.type=g.MetadataSchema.dateRange,r.id3Track.addCue(X),N[z]=X}}}s[B]={cues:N,dateRange:k,durationKnown:j}},C=0;C<A.length;C++)I(C)}}},c}();P.default=v},"./src/controller/latency-controller.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return g});var b=E("./src/errors.ts"),u=E("./src/events.ts"),m=E("./src/utils/logger.ts");function D(d,i){for(var f=0;f<i.length;f++){var o=i[f];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(d,o.key,o)}}function S(d,i,f){return i&&D(d.prototype,i),f&&D(d,f),Object.defineProperty(d,"prototype",{writable:!1}),d}var g=function(){function d(f){var o=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return o.timeupdate()},this.hls=f,this.config=f.config,this.registerListeners()}var i=d.prototype;return i.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},i.registerListeners=function(){this.hls.on(u.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(u.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(u.Events.ERROR,this.onError,this)},i.unregisterListeners=function(){this.hls.off(u.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(u.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(u.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(u.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(u.Events.ERROR,this.onError)},i.onMediaAttached=function(o,v){this.media=v.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},i.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},i.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},i.onLevelUpdated=function(o,v){var c=v.details;this.levelDetails=c,c.advanced&&this.timeupdate(),!c.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},i.onError=function(o,v){v.details===b.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,m.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},i.timeupdate=function(){var o=this.media,v=this.levelDetails;if(!(!o||!v)){this.currentTime=o.currentTime;var c=this.computeLatency();if(c!==null){this._latency=c;var h=this.config,t=h.lowLatencyMode,e=h.maxLiveSyncPlaybackRate;if(!(!t||e===1)){var n=this.targetLatency;if(n!==null){var r=c-n,l=Math.min(this.maxLatency,n+v.targetduration),s=r<l;if(v.live&&s&&r>.05&&this.forwardBufferLength>1){var a=Math.min(2,Math.max(1,e)),p=Math.round(2/(1+Math.exp(-.75*r-this.edgeStalled))*20)/20;o.playbackRate=Math.min(a,Math.max(1,p))}else o.playbackRate!==1&&o.playbackRate!==0&&(o.playbackRate=1)}}}}},i.estimateLiveEdge=function(){var o=this.levelDetails;return o===null?null:o.edge+o.age},i.computeLatency=function(){var o=this.estimateLiveEdge();return o===null?null:o-this.currentTime},S(d,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var o=this.config,v=this.levelDetails;return o.liveMaxLatencyDuration!==void 0?o.liveMaxLatencyDuration:v?o.liveMaxLatencyDurationCount*v.targetduration:0}},{key:"targetLatency",get:function(){var o=this.levelDetails;if(o===null)return null;var v=o.holdBack,c=o.partHoldBack,h=o.targetduration,t=this.config,e=t.liveSyncDuration,n=t.liveSyncDurationCount,r=t.lowLatencyMode,l=this.hls.userConfig,s=r&&c||v;(l.liveSyncDuration||l.liveSyncDurationCount||s===0)&&(s=e!==void 0?e:n*h);var a=h,p=1;return s+Math.min(this.stallCount*p,a)}},{key:"liveSyncPosition",get:function(){var o=this.estimateLiveEdge(),v=this.targetLatency,c=this.levelDetails;if(o===null||v===null||c===null)return null;var h=c.edge,t=o-v-this.edgeStalled,e=h-c.totalduration,n=h-(this.config.lowLatencyMode&&c.partTarget||c.targetduration);return Math.min(Math.max(e,t),n)}},{key:"drift",get:function(){var o=this.levelDetails;return o===null?1:o.drift}},{key:"edgeStalled",get:function(){var o=this.levelDetails;if(o===null)return 0;var v=(this.config.lowLatencyMode&&o.partTarget||o.targetduration)*3;return Math.max(o.age-v,0)}},{key:"forwardBufferLength",get:function(){var o=this.media,v=this.levelDetails;if(!o||!v)return 0;var c=o.buffered.length;return(c?o.buffered.end(c-1):v.edge)-this.currentTime}}]),d}()},"./src/controller/level-controller.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return t});var b=E("./src/types/level.ts"),u=E("./src/events.ts"),m=E("./src/errors.ts"),D=E("./src/utils/codecs.ts"),S=E("./src/controller/level-helper.ts"),g=E("./src/controller/base-playlist-controller.ts"),d=E("./src/types/loader.ts");function i(){return i=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var l in r)Object.prototype.hasOwnProperty.call(r,l)&&(e[l]=r[l])}return e},i.apply(this,arguments)}function f(e,n){for(var r=0;r<n.length;r++){var l=n[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function o(e,n,r){return n&&f(e.prototype,n),r&&f(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,c(e,n)}function c(e,n){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,s){return l.__proto__=s,l},c(e,n)}var h=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),t=function(e){v(n,e);function n(l){var s;return s=e.call(this,l,"[level-controller]")||this,s._levels=[],s._firstLevel=-1,s._startLevel=void 0,s.currentLevelIndex=-1,s.manualLevelIndex=-1,s.onParsedComplete=void 0,s._registerListeners(),s}var r=n.prototype;return r._registerListeners=function(){var s=this.hls;s.on(u.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.on(u.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.on(u.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.on(u.Events.FRAG_LOADED,this.onFragLoaded,this),s.on(u.Events.ERROR,this.onError,this)},r._unregisterListeners=function(){var s=this.hls;s.off(u.Events.MANIFEST_LOADED,this.onManifestLoaded,this),s.off(u.Events.LEVEL_LOADED,this.onLevelLoaded,this),s.off(u.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),s.off(u.Events.FRAG_LOADED,this.onFragLoaded,this),s.off(u.Events.ERROR,this.onError,this)},r.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,e.prototype.destroy.call(this)},r.startLoad=function(){var s=this._levels;s.forEach(function(a){a.loadError=0}),e.prototype.startLoad.call(this)},r.onManifestLoaded=function(s,a){var p=[],A=[],_=[],y,L={},x,T=!1,O=!1,R=!1;if(a.levels.forEach(function(F){var B=F.attrs;T=T||!!(F.width&&F.height),O=O||!!F.videoCodec,R=R||!!F.audioCodec,h&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0);var k=F.bitrate+"-"+F.attrs.RESOLUTION+"-"+F.attrs.CODECS;x=L[k],x?x.url.push(F.url):(x=new b.Level(F),L[k]=x,p.push(x)),B&&(B.AUDIO&&Object(S.addGroupId)(x,"audio",B.AUDIO),B.SUBTITLES&&Object(S.addGroupId)(x,"text",B.SUBTITLES))}),(T||O)&&R&&(p=p.filter(function(F){var B=F.videoCodec,k=F.width,U=F.height;return!!B||!!(k&&U)})),p=p.filter(function(F){var B=F.audioCodec,k=F.videoCodec;return(!B||Object(D.isCodecSupportedInMp4)(B,"audio"))&&(!k||Object(D.isCodecSupportedInMp4)(k,"video"))}),a.audioTracks&&(A=a.audioTracks.filter(function(F){return!F.audioCodec||Object(D.isCodecSupportedInMp4)(F.audioCodec,"audio")}),Object(S.assignTrackIdsByGroup)(A)),a.subtitles&&(_=a.subtitles,Object(S.assignTrackIdsByGroup)(_)),p.length>0){y=p[0].bitrate,p.sort(function(F,B){return F.bitrate-B.bitrate}),this._levels=p;for(var I=0;I<p.length;I++)if(p[I].bitrate===y){this._firstLevel=I,this.log("manifest loaded, "+p.length+" level(s) found, first bitrate: "+y);break}var C=R&&!O,w={levels:p,audioTracks:A,subtitleTracks:_,firstLevel:this._firstLevel,stats:a.stats,audio:R,video:O,altAudio:!C&&A.some(function(F){return!!F.url})};this.hls.trigger(u.Events.MANIFEST_PARSED,w),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(u.Events.ERROR,{type:m.ErrorTypes.MEDIA_ERROR,details:m.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})},r.onError=function(s,a){if(e.prototype.onError.call(this,s,a),!a.fatal){var p=a.context,A=this._levels[this.currentLevelIndex];if(p&&(p.type===d.PlaylistContextType.AUDIO_TRACK&&A.audioGroupIds&&p.groupId===A.audioGroupIds[A.urlId]||p.type===d.PlaylistContextType.SUBTITLE_TRACK&&A.textGroupIds&&p.groupId===A.textGroupIds[A.urlId])){this.redundantFailover(this.currentLevelIndex);return}var _=!1,y=!0,L;switch(a.details){case m.ErrorDetails.FRAG_LOAD_ERROR:case m.ErrorDetails.FRAG_LOAD_TIMEOUT:case m.ErrorDetails.KEY_LOAD_ERROR:case m.ErrorDetails.KEY_LOAD_TIMEOUT:if(a.frag){var x=this._levels[a.frag.level];x?(x.fragmentError++,x.fragmentError>this.hls.config.fragLoadingMaxRetry&&(L=a.frag.level)):L=a.frag.level}break;case m.ErrorDetails.LEVEL_LOAD_ERROR:case m.ErrorDetails.LEVEL_LOAD_TIMEOUT:p&&(p.deliveryDirectives&&(y=!1),L=p.level),_=!0;break;case m.ErrorDetails.REMUX_ALLOC_ERROR:L=a.level,_=!0;break}L!==void 0&&this.recoverLevel(a,L,_,y)}},r.recoverLevel=function(s,a,p,A){var _=s.details,y=this._levels[a];if(y.loadError++,p){var L=this.retryLoadingOrFail(s);if(L)s.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(A){var x=y.url.length;if(x>1&&y.loadError<x)s.levelRetry=!0,this.redundantFailover(a);else if(this.manualLevelIndex===-1){var T=a===0?this._levels.length-1:a-1;this.currentLevelIndex!==T&&this._levels[T].loadError===0&&(this.warn(_+": switch to "+T),s.levelRetry=!0,this.hls.nextAutoLevel=T)}}},r.redundantFailover=function(s){var a=this._levels[s],p=a.url.length;if(p>1){var A=(a.urlId+1)%p;this.warn("Switching to redundant URL-id "+A),this._levels.forEach(function(_){_.urlId=A}),this.level=s}},r.onFragLoaded=function(s,a){var p=a.frag;if(p!==void 0&&p.type===d.PlaylistLevelType.MAIN){var A=this._levels[p.level];A!==void 0&&(A.fragmentError=0,A.loadError=0)}},r.onLevelLoaded=function(s,a){var p,A=a.level,_=a.details,y=this._levels[A];if(!y){var L;this.warn("Invalid level index "+A),(L=a.deliveryDirectives)!==null&&L!==void 0&&L.skip&&(_.deltaUpdateFailed=!0);return}A===this.currentLevelIndex?(y.fragmentError===0&&(y.loadError=0,this.retryCount=0),this.playlistLoaded(A,a,y.details)):(p=a.deliveryDirectives)!==null&&p!==void 0&&p.skip&&(_.deltaUpdateFailed=!0)},r.onAudioTrackSwitched=function(s,a){var p=this.hls.levels[this.currentLevelIndex];if(!!p&&p.audioGroupIds){for(var A=-1,_=this.hls.audioTracks[a.id].groupId,y=0;y<p.audioGroupIds.length;y++)if(p.audioGroupIds[y]===_){A=y;break}A!==p.urlId&&(p.urlId=A,this.startLoad())}},r.loadPlaylist=function(s){var a=this.currentLevelIndex,p=this._levels[a];if(this.canLoad&&p&&p.url.length>0){var A=p.urlId,_=p.url[A];if(s)try{_=s.addDirectives(_)}catch(y){this.warn("Could not construct new URL with HLS Delivery Directives: "+y)}this.log("Attempt loading level index "+a+(s?" at sn "+s.msn+" part "+s.part:"")+" with URL-id "+A+" "+_),this.clearTimer(),this.hls.trigger(u.Events.LEVEL_LOADING,{url:_,level:a,id:A,deliveryDirectives:s||null})}},r.removeLevel=function(s,a){var p=function(y,L){return L!==a},A=this._levels.filter(function(_,y){return y!==s?!0:_.url.length>1&&a!==void 0?(_.url=_.url.filter(p),_.audioGroupIds&&(_.audioGroupIds=_.audioGroupIds.filter(p)),_.textGroupIds&&(_.textGroupIds=_.textGroupIds.filter(p)),_.urlId=0,!0):!1}).map(function(_,y){var L=_.details;return L!=null&&L.fragments&&L.fragments.forEach(function(x){x.level=y}),_});this._levels=A,this.hls.trigger(u.Events.LEVELS_UPDATED,{levels:A})},o(n,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(s){var a,p=this._levels;if(p.length!==0&&!(this.currentLevelIndex===s&&(a=p[s])!==null&&a!==void 0&&a.details)){if(s<0||s>=p.length){var A=s<0;if(this.hls.trigger(u.Events.ERROR,{type:m.ErrorTypes.OTHER_ERROR,details:m.ErrorDetails.LEVEL_SWITCH_ERROR,level:s,fatal:A,reason:"invalid level idx"}),A)return;s=Math.min(s,p.length-1)}this.clearTimer();var _=this.currentLevelIndex,y=p[_],L=p[s];this.log("switching to level "+s+" from "+_),this.currentLevelIndex=s;var x=i({},L,{level:s,maxBitrate:L.maxBitrate,uri:L.uri,urlId:L.urlId});delete x._urlId,this.hls.trigger(u.Events.LEVEL_SWITCHING,x);var T=L.details;if(!T||T.live){var O=this.switchParams(L.uri,y==null?void 0:y.details);this.loadPlaylist(O)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(s){this.manualLevelIndex=s,this._startLevel===void 0&&(this._startLevel=s),s!==-1&&(this.level=s)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(s){this._firstLevel=s}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var s=this.hls.config.startLevel;return s!==void 0?s:this._firstLevel}else return this._startLevel},set:function(s){this._startLevel=s}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(s){this.level=s,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=s)}}]),n}(g.default)},"./src/controller/level-helper.ts":function(M,P,E){E.r(P),E.d(P,"addGroupId",function(){return S}),E.d(P,"assignTrackIdsByGroup",function(){return g}),E.d(P,"updatePTS",function(){return d}),E.d(P,"updateFragPTSDTS",function(){return f}),E.d(P,"mergeDetails",function(){return o}),E.d(P,"mapPartIntersection",function(){return c}),E.d(P,"mapFragmentIntersection",function(){return h}),E.d(P,"adjustSliding",function(){return t}),E.d(P,"addSliding",function(){return e}),E.d(P,"computeReloadInterval",function(){return n}),E.d(P,"getFragmentWithSN",function(){return r}),E.d(P,"getPartWith",function(){return l});var b=E("./src/polyfills/number.ts"),u=E("./src/utils/logger.ts"),m=E("./src/loader/date-range.ts");function D(){return D=Object.assign?Object.assign.bind():function(s){for(var a=1;a<arguments.length;a++){var p=arguments[a];for(var A in p)Object.prototype.hasOwnProperty.call(p,A)&&(s[A]=p[A])}return s},D.apply(this,arguments)}function S(s,a,p){switch(a){case"audio":s.audioGroupIds||(s.audioGroupIds=[]),s.audioGroupIds.push(p);break;case"text":s.textGroupIds||(s.textGroupIds=[]),s.textGroupIds.push(p);break}}function g(s){var a={};s.forEach(function(p){var A=p.groupId||"";p.id=a[A]=a[A]||0,a[A]++})}function d(s,a,p){var A=s[a],_=s[p];i(A,_)}function i(s,a){var p=a.startPTS;if(Object(b.isFiniteNumber)(p)){var A=0,_;a.sn>s.sn?(A=p-s.start,_=s):(A=s.start-p,_=a),_.duration!==A&&(_.duration=A)}else if(a.sn>s.sn){var y=s.cc===a.cc;y&&s.minEndPTS?a.start=s.start+(s.minEndPTS-s.start):a.start=s.start+s.duration}else a.start=Math.max(s.start-a.duration,0)}function f(s,a,p,A,_,y){var L=A-p;L<=0&&(u.logger.warn("Fragment should have a positive duration",a),A=p+a.duration,y=_+a.duration);var x=p,T=A,O=a.startPTS,R=a.endPTS;if(Object(b.isFiniteNumber)(O)){var I=Math.abs(O-p);Object(b.isFiniteNumber)(a.deltaPTS)?a.deltaPTS=Math.max(I,a.deltaPTS):a.deltaPTS=I,x=Math.max(p,O),p=Math.min(p,O),_=Math.min(_,a.startDTS),T=Math.min(A,R),A=Math.max(A,R),y=Math.max(y,a.endDTS)}a.duration=A-p;var C=p-a.start;a.appendedPTS=A,a.start=a.startPTS=p,a.maxStartPTS=x,a.startDTS=_,a.endPTS=A,a.minEndPTS=T,a.endDTS=y;var w=a.sn;if(!s||w<s.startSN||w>s.endSN)return 0;var F,B=w-s.startSN,k=s.fragments;for(k[B]=a,F=B;F>0;F--)i(k[F],k[F-1]);for(F=B;F<k.length-1;F++)i(k[F],k[F+1]);return s.fragmentHint&&i(k[k.length-1],s.fragmentHint),s.PTSKnown=s.alignedSliding=!0,C}function o(s,a){for(var p=null,A=s.fragments,_=A.length-1;_>=0;_--){var y=A[_].initSegment;if(y){p=y;break}}s.fragmentHint&&delete s.fragmentHint.endPTS;var L=0,x;if(h(s,a,function(F,B){F.relurl&&(L=F.cc-B.cc),Object(b.isFiniteNumber)(F.startPTS)&&Object(b.isFiniteNumber)(F.endPTS)&&(B.start=B.startPTS=F.startPTS,B.startDTS=F.startDTS,B.appendedPTS=F.appendedPTS,B.maxStartPTS=F.maxStartPTS,B.endPTS=F.endPTS,B.endDTS=F.endDTS,B.minEndPTS=F.minEndPTS,B.duration=F.endPTS-F.startPTS,B.duration&&(x=B),a.PTSKnown=a.alignedSliding=!0),B.elementaryStreams=F.elementaryStreams,B.loader=F.loader,B.stats=F.stats,B.urlId=F.urlId,F.initSegment&&(B.initSegment=F.initSegment,p=F.initSegment)}),p){var T=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments;T.forEach(function(F){var B;(!F.initSegment||F.initSegment.relurl===((B=p)===null||B===void 0?void 0:B.relurl))&&(F.initSegment=p)})}if(a.skippedSegments)if(a.deltaUpdateFailed=a.fragments.some(function(F){return!F}),a.deltaUpdateFailed){u.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var O=a.skippedSegments;O--;)a.fragments.shift();a.startSN=a.fragments[0].sn,a.startCC=a.fragments[0].cc}else a.canSkipDateRanges&&(a.dateRanges=v(s.dateRanges,a.dateRanges,a.recentlyRemovedDateranges));var R=a.fragments;if(L){u.logger.warn("discontinuity sliding from playlist, take drift into account");for(var I=0;I<R.length;I++)R[I].cc+=L}a.skippedSegments&&(a.startCC=a.fragments[0].cc),c(s.partList,a.partList,function(F,B){B.elementaryStreams=F.elementaryStreams,B.stats=F.stats}),x?f(a,x,x.startPTS,x.endPTS,x.startDTS,x.endDTS):t(s,a),R.length&&(a.totalduration=a.edge-R[0].start),a.driftStartTime=s.driftStartTime,a.driftStart=s.driftStart;var C=a.advancedDateTime;if(a.advanced&&C){var w=a.edge;a.driftStart||(a.driftStartTime=C,a.driftStart=w),a.driftEndTime=C,a.driftEnd=w}else a.driftEndTime=s.driftEndTime,a.driftEnd=s.driftEnd,a.advancedDateTime=s.advancedDateTime}function v(s,a,p){var A=D({},s);return p&&p.forEach(function(_){delete A[_]}),Object.keys(a).forEach(function(_){var y=new m.DateRange(a[_].attr,A[_]);y.isValid?A[_]=y:u.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(a[_].attr)+'"')}),A}function c(s,a,p){if(s&&a)for(var A=0,_=0,y=s.length;_<=y;_++){var L=s[_],x=a[_+A];L&&x&&L.index===x.index&&L.fragment.sn===x.fragment.sn?p(L,x):A--}}function h(s,a,p){for(var A=a.skippedSegments,_=Math.max(s.startSN,a.startSN)-a.startSN,y=(s.fragmentHint?1:0)+(A?a.endSN:Math.min(s.endSN,a.endSN))-a.startSN,L=a.startSN-s.startSN,x=a.fragmentHint?a.fragments.concat(a.fragmentHint):a.fragments,T=s.fragmentHint?s.fragments.concat(s.fragmentHint):s.fragments,O=_;O<=y;O++){var R=T[L+O],I=x[O];A&&!I&&O<A&&(I=a.fragments[O]=R),R&&I&&p(R,I)}}function t(s,a){var p=a.startSN+a.skippedSegments-s.startSN,A=s.fragments;p<0||p>=A.length||e(a,A[p].start)}function e(s,a){if(a){for(var p=s.fragments,A=s.skippedSegments;A<p.length;A++)p[A].start+=a;s.fragmentHint&&(s.fragmentHint.start+=a)}}function n(s,a){var p=1e3*s.levelTargetDuration,A=p/2,_=s.age,y=_>0&&_<p*3,L=a.loading.end-a.loading.start,x,T=s.availabilityDelay;if(s.updated===!1)if(y){var O=333*s.misses;x=Math.max(Math.min(A,L*2),O),s.availabilityDelay=(s.availabilityDelay||0)+x}else x=A;else y?(T=Math.min(T||p/2,_),s.availabilityDelay=T,x=T+p-_):x=p-L;return Math.round(x)}function r(s,a,p){if(!s||!s.details)return null;var A=s.details,_=A.fragments[a-A.startSN];return _||(_=A.fragmentHint,_&&_.sn===a)?_:a<A.startSN&&p&&p.sn===a?p:null}function l(s,a,p){if(!s||!s.details)return null;var A=s.details.partList;if(A)for(var _=A.length;_--;){var y=A[_];if(y.index===p&&y.fragment.sn===a)return y}return null}},"./src/controller/stream-controller.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return l});var b=E("./src/polyfills/number.ts"),u=E("./src/controller/base-stream-controller.ts"),m=E("./src/is-supported.ts"),D=E("./src/events.ts"),S=E("./src/utils/buffer-helper.ts"),g=E("./src/controller/fragment-tracker.ts"),d=E("./src/types/loader.ts"),i=E("./src/loader/fragment.ts"),f=E("./src/demux/transmuxer-interface.ts"),o=E("./src/types/transmuxer.ts"),v=E("./src/controller/gap-controller.ts"),c=E("./src/errors.ts");function h(s,a){for(var p=0;p<a.length;p++){var A=a[p];A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(s,A.key,A)}}function t(s,a,p){return a&&h(s.prototype,a),p&&h(s,p),Object.defineProperty(s,"prototype",{writable:!1}),s}function e(s,a){s.prototype=Object.create(a.prototype),s.prototype.constructor=s,n(s,a)}function n(s,a){return n=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(A,_){return A.__proto__=_,A},n(s,a)}var r=100,l=function(s){e(a,s);function a(A,_){var y;return y=s.call(this,A,_,"[stream-controller]")||this,y.audioCodecSwap=!1,y.gapController=null,y.level=-1,y._forceStartLoad=!1,y.altAudio=!1,y.audioOnly=!1,y.fragPlaying=null,y.onvplaying=null,y.onvseeked=null,y.fragLastKbps=0,y.couldBacktrack=!1,y.backtrackFragment=null,y.audioCodecSwitch=!1,y.videoBuffer=null,y._registerListeners(),y}var p=a.prototype;return p._registerListeners=function(){var _=this.hls;_.on(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),_.on(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),_.on(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),_.on(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),_.on(D.Events.LEVEL_LOADING,this.onLevelLoading,this),_.on(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),_.on(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),_.on(D.Events.ERROR,this.onError,this),_.on(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),_.on(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),_.on(D.Events.BUFFER_CREATED,this.onBufferCreated,this),_.on(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),_.on(D.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),_.on(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p._unregisterListeners=function(){var _=this.hls;_.off(D.Events.MEDIA_ATTACHED,this.onMediaAttached,this),_.off(D.Events.MEDIA_DETACHING,this.onMediaDetaching,this),_.off(D.Events.MANIFEST_LOADING,this.onManifestLoading,this),_.off(D.Events.MANIFEST_PARSED,this.onManifestParsed,this),_.off(D.Events.LEVEL_LOADED,this.onLevelLoaded,this),_.off(D.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),_.off(D.Events.ERROR,this.onError,this),_.off(D.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),_.off(D.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),_.off(D.Events.BUFFER_CREATED,this.onBufferCreated,this),_.off(D.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),_.off(D.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),_.off(D.Events.FRAG_BUFFERED,this.onFragBuffered,this)},p.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},p.startLoad=function(_){if(this.levels){var y=this.lastCurrentTime,L=this.hls;if(this.stopLoad(),this.setInterval(r),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var x=L.startLevel;x===-1&&(L.config.testBandwidth?(x=0,this.bitrateTest=!0):x=L.nextAutoLevel),this.level=L.nextLoadLevel=x,this.loadedmetadata=!1}y>0&&_===-1&&(this.log("Override startPosition with lastCurrentTime @"+y.toFixed(3)),_=y),this.state=u.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=_,this.tick()}else this._forceStartLoad=!0,this.state=u.State.STOPPED},p.stopLoad=function(){this._forceStartLoad=!1,s.prototype.stopLoad.call(this)},p.doTick=function(){switch(this.state){case u.State.IDLE:this.doTickIdle();break;case u.State.WAITING_LEVEL:{var _,y=this.levels,L=this.level,x=y==null||(_=y[L])===null||_===void 0?void 0:_.details;if(x&&(!x.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(x))break;this.state=u.State.IDLE;break}break}case u.State.FRAG_LOADING_WAITING_RETRY:{var T,O=self.performance.now(),R=this.retryDate;(!R||O>=R||(T=this.media)!==null&&T!==void 0&&T.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=u.State.IDLE)}break}this.onTickEnd()},p.onTickEnd=function(){s.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},p.doTickIdle=function(){var _,y,L=this.hls,x=this.levelLastLoaded,T=this.levels,O=this.media,R=L.config,I=L.nextLoadLevel;if(!(x===null||!O&&(this.startFragRequested||!R.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!T||!T[I])){var C=T[I];this.level=L.nextLoadLevel=I;var w=C.details;if(!w||this.state===u.State.WAITING_LEVEL||w.live&&this.levelLastLoaded!==I){this.state=u.State.WAITING_LEVEL;return}var F=this.getMainFwdBufferInfo();if(F!==null){var B=F.len,k=this.getMaxBufferLength(C.maxBitrate);if(!(B>=k)){if(this._streamEnded(F,w)){var U={};this.altAudio&&(U.type="video"),this.hls.trigger(D.Events.BUFFER_EOS,U),this.state=u.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>F.end&&(this.backtrackFragment=null);var N=this.backtrackFragment?this.backtrackFragment.start:F.end,j=this.getNextFragment(N,w);if(this.couldBacktrack&&!this.fragPrevious&&j&&j.sn!=="initSegment"&&this.fragmentTracker.getState(j)!==g.FragmentState.OK){var K,H=((K=this.backtrackFragment)!=null?K:j).sn,V=H-w.startSN,G=w.fragments[V-1];G&&j.cc===G.cc&&(j=G,this.fragmentTracker.removeFragment(G))}else this.backtrackFragment&&F.len&&(this.backtrackFragment=null);if(j&&this.fragmentTracker.getState(j)===g.FragmentState.OK&&this.nextLoadPosition>N){var ee=this.audioOnly&&!this.altAudio?i.ElementaryStreamTypes.AUDIO:i.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(O,ee,d.PlaylistLevelType.MAIN),j=this.getNextFragment(this.nextLoadPosition,w)}!j||(j.initSegment&&!j.initSegment.data&&!this.bitrateTest&&(j=j.initSegment),((_=j.decryptdata)===null||_===void 0?void 0:_.keyFormat)==="identity"&&!((y=j.decryptdata)!==null&&y!==void 0&&y.key)?this.loadKey(j,w):this.loadFragment(j,w,N))}}}},p.loadFragment=function(_,y,L){var x,T=this.fragmentTracker.getState(_);this.fragCurrent=_,T===g.FragmentState.NOT_LOADED||T===g.FragmentState.PARTIAL?_.sn==="initSegment"?this._loadInitSegment(_):this.bitrateTest?(_.bitrateTest=!0,this.log("Fragment "+_.sn+" of level "+_.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(_)):(this.startFragRequested=!0,s.prototype.loadFragment.call(this,_,y,L)):T===g.FragmentState.APPENDING?this.reduceMaxBufferLength(_.duration)&&this.fragmentTracker.removeFragment(_):((x=this.media)===null||x===void 0?void 0:x.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},p.getAppendedFrag=function(_){var y=this.fragmentTracker.getAppendedFrag(_,d.PlaylistLevelType.MAIN);return y&&"fragment"in y?y.fragment:y},p.getBufferedFrag=function(_){return this.fragmentTracker.getBufferedFrag(_,d.PlaylistLevelType.MAIN)},p.followingBufferedFrag=function(_){return _?this.getBufferedFrag(_.end+.5):null},p.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},p.nextLevelSwitch=function(){var _=this.levels,y=this.media;if(y!=null&&y.readyState){var L,x=this.getAppendedFrag(y.currentTime);if(x&&x.start>1&&this.flushMainBuffer(0,x.start-1),!y.paused&&_){var T=this.hls.nextLoadLevel,O=_[T],R=this.fragLastKbps;R&&this.fragCurrent?L=this.fragCurrent.duration*O.maxBitrate/(1e3*R)+1:L=0}else L=0;var I=this.getBufferedFrag(y.currentTime+L);if(I){var C=this.followingBufferedFrag(I);if(C){this.abortCurrentFrag();var w=C.maxStartPTS?C.maxStartPTS:C.start,F=C.duration,B=Math.max(I.end,w+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,F*.5),F*.75));this.flushMainBuffer(B,Number.POSITIVE_INFINITY)}}}},p.abortCurrentFrag=function(){var _=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,_!=null&&_.loader&&_.loader.abort(),this.state){case u.State.KEY_LOADING:case u.State.FRAG_LOADING:case u.State.FRAG_LOADING_WAITING_RETRY:case u.State.PARSING:case u.State.PARSED:this.state=u.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},p.flushMainBuffer=function(_,y){s.prototype.flushMainBuffer.call(this,_,y,this.altAudio?"video":null)},p.onMediaAttached=function(_,y){s.prototype.onMediaAttached.call(this,_,y);var L=y.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),L.addEventListener("playing",this.onvplaying),L.addEventListener("seeked",this.onvseeked),this.gapController=new v.default(this.config,L,this.fragmentTracker,this.hls)},p.onMediaDetaching=function(){var _=this.media;_&&(_.removeEventListener("playing",this.onvplaying),_.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),s.prototype.onMediaDetaching.call(this)},p.onMediaPlaying=function(){this.tick()},p.onMediaSeeked=function(){var _=this.media,y=_?_.currentTime:null;Object(b.isFiniteNumber)(y)&&this.log("Media seeked to "+y.toFixed(3)),this.tick()},p.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(D.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},p.onManifestParsed=function(_,y){var L=!1,x=!1,T;y.levels.forEach(function(O){T=O.audioCodec,T&&(T.indexOf("mp4a.40.2")!==-1&&(L=!0),T.indexOf("mp4a.40.5")!==-1&&(x=!0))}),this.audioCodecSwitch=L&&x&&!Object(m.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=y.levels,this.startFragRequested=!1},p.onLevelLoading=function(_,y){var L=this.levels;if(!(!L||this.state!==u.State.IDLE)){var x=L[y.level];(!x.details||x.details.live&&this.levelLastLoaded!==y.level||this.waitForCdnTuneIn(x.details))&&(this.state=u.State.WAITING_LEVEL)}},p.onLevelLoaded=function(_,y){var L,x=this.levels,T=y.level,O=y.details,R=O.totalduration;if(!x){this.warn("Levels were reset while loading level "+T);return}this.log("Level "+T+" loaded ["+O.startSN+","+O.endSN+"], cc ["+O.startCC+", "+O.endCC+"] duration:"+R);var I=this.fragCurrent;I&&(this.state===u.State.FRAG_LOADING||this.state===u.State.FRAG_LOADING_WAITING_RETRY)&&I.level!==y.level&&I.loader&&(this.state=u.State.IDLE,this.backtrackFragment=null,I.loader.abort());var C=x[T],w=0;if(O.live||(L=C.details)!==null&&L!==void 0&&L.live){if(O.fragments[0]||(O.deltaUpdateFailed=!0),O.deltaUpdateFailed)return;w=this.alignPlaylists(O,C.details)}if(C.details=O,this.levelLastLoaded=T,this.hls.trigger(D.Events.LEVEL_UPDATED,{details:O,level:T}),this.state===u.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(O))return;this.state=u.State.IDLE}this.startFragRequested?O.live&&this.synchronizeToLiveEdge(O):this.setStartPosition(O,w),this.tick()},p._handleFragmentLoadProgress=function(_){var y,L=_.frag,x=_.part,T=_.payload,O=this.levels;if(!O){this.warn("Levels were reset while fragment load was in progress. Fragment "+L.sn+" of level "+L.level+" will not be buffered");return}var R=O[L.level],I=R.details;if(!I){this.warn("Dropping fragment "+L.sn+" of level "+L.level+" after level details were reset");return}var C=R.videoCodec,w=I.PTSKnown||!I.live,F=(y=L.initSegment)===null||y===void 0?void 0:y.data,B=this._getAudioCodec(R),k=this.transmuxer=this.transmuxer||new f.default(this.hls,d.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),U=x?x.index:-1,N=U!==-1,j=new o.ChunkMetadata(L.level,L.sn,L.stats.chunkCount,T.byteLength,U,N),K=this.initPTS[L.cc];k.push(T,F,B,C,L,x,I.totalduration,w,j,K)},p.onAudioTrackSwitching=function(_,y){var L=this.altAudio,x=!!y.url,T=y.id;if(!x){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var O=this.fragCurrent;O!=null&&O.loader&&(this.log("Switching to main audio track, cancel main fragment load"),O.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var R=this.hls;L&&R.trigger(D.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),R.trigger(D.Events.AUDIO_TRACK_SWITCHED,{id:T})}},p.onAudioTrackSwitched=function(_,y){var L=y.id,x=!!this.hls.audioTracks[L].url;if(x){var T=this.videoBuffer;T&&this.mediaBuffer!==T&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=T)}this.altAudio=x,this.tick()},p.onBufferCreated=function(_,y){var L=y.tracks,x,T,O=!1;for(var R in L){var I=L[R];if(I.id==="main"){if(T=R,x=I,R==="video"){var C=L[R];C&&(this.videoBuffer=C.buffer)}}else O=!0}O&&x?(this.log("Alternate track found, use "+T+".buffered to schedule main fragment loading"),this.mediaBuffer=x.buffer):this.mediaBuffer=this.media},p.onFragBuffered=function(_,y){var L=y.frag,x=y.part;if(!(L&&L.type!==d.PlaylistLevelType.MAIN)){if(this.fragContextChanged(L)){this.warn("Fragment "+L.sn+(x?" p: "+x.index:"")+" of level "+L.level+" finished buffering, but was aborted. state: "+this.state),this.state===u.State.PARSED&&(this.state=u.State.IDLE);return}var T=x?x.stats:L.stats;this.fragLastKbps=Math.round(8*T.total/(T.buffering.end-T.loading.first)),L.sn!=="initSegment"&&(this.fragPrevious=L),this.fragBufferedComplete(L,x)}},p.onError=function(_,y){switch(y.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(d.PlaylistLevelType.MAIN,y);break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==u.State.ERROR&&(y.fatal?(this.warn(""+y.details),this.state=u.State.ERROR):!y.levelRetry&&this.state===u.State.WAITING_LEVEL&&(this.state=u.State.IDLE));break;case c.ErrorDetails.BUFFER_FULL_ERROR:if(y.parent==="main"&&(this.state===u.State.PARSING||this.state===u.State.PARSED)){var L=!0,x=this.getFwdBufferInfo(this.media,d.PlaylistLevelType.MAIN);x&&x.len>.5&&(L=!this.reduceMaxBufferLength(x.len)),L&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},p.checkBuffer=function(){var _=this.media,y=this.gapController;if(!(!_||!y||!_.readyState)){var L=S.BufferHelper.getBuffered(_);if(!this.loadedmetadata&&L.length)this.loadedmetadata=!0,this.seekToStartPos();else{var x=this.state!==u.State.IDLE?this.fragCurrent:null;y.poll(this.lastCurrentTime,x)}this.lastCurrentTime=_.currentTime}},p.onFragLoadEmergencyAborted=function(){this.state=u.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},p.onBufferFlushed=function(_,y){var L=y.type;if(L!==i.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var x=(L===i.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(x,L,d.PlaylistLevelType.MAIN)}},p.onLevelsUpdated=function(_,y){this.levels=y.levels},p.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},p.seekToStartPos=function(){var _=this.media,y=_.currentTime,L=this.startPosition;if(L>=0&&y<L){if(_.seeking){this.log("could not seek to "+L+", already seeking at "+y);return}var x=S.BufferHelper.getBuffered(_),T=x.length?x.start(0):0,O=T-L;O>0&&(O<this.config.maxBufferHole||O<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+O+" to match buffer start"),L+=O,this.startPosition=L),this.log("seek to target start position "+L+" from current time "+y),_.currentTime=L}},p._getAudioCodec=function(_){var y=this.config.defaultAudioCodec||_.audioCodec;return this.audioCodecSwap&&y&&(this.log("Swapping audio codec"),y.indexOf("mp4a.40.5")!==-1?y="mp4a.40.2":y="mp4a.40.5"),y},p._loadBitrateTestFrag=function(_){var y=this;this._doFragLoad(_).then(function(L){var x=y.hls;if(!(!L||x.nextLoadLevel||y.fragContextChanged(_))){y.fragLoadError=0,y.state=u.State.IDLE,y.startFragRequested=!1,y.bitrateTest=!1;var T=_.stats;T.parsing.start=T.parsing.end=T.buffering.start=T.buffering.end=self.performance.now(),x.trigger(D.Events.FRAG_LOADED,L)}})},p._handleTransmuxComplete=function(_){var y,L="main",x=this.hls,T=_.remuxResult,O=_.chunkMeta,R=this.getCurrentContext(O);if(!R){this.warn("The loading context changed while buffering fragment "+O.sn+" of level "+O.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(O.level);return}var I=R.frag,C=R.part,w=R.level,F=T.video,B=T.text,k=T.id3,U=T.initSegment,N=w.details,j=this.altAudio?void 0:T.audio;if(!this.fragContextChanged(I)){if(this.state=u.State.PARSING,U){U.tracks&&(this._bufferInitSegment(w,U.tracks,I,O),x.trigger(D.Events.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:L,tracks:U.tracks}));var K=U.initPTS,H=U.timescale;Object(b.isFiniteNumber)(K)&&(this.initPTS[I.cc]=K,x.trigger(D.Events.INIT_PTS_FOUND,{frag:I,id:L,initPTS:K,timescale:H}))}if(F&&T.independent!==!1){if(N){var V=F.startPTS,G=F.endPTS,ee=F.startDTS,q=F.endDTS;if(C)C.elementaryStreams[F.type]={startPTS:V,endPTS:G,startDTS:ee,endDTS:q};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){var z=this.getMainFwdBufferInfo(),X=(z?z.end:this.getLoadPosition())+this.config.maxBufferHole,J=F.firstKeyFramePTS?F.firstKeyFramePTS:V;if(X<J-this.config.maxBufferHole){this.backtrack(I);return}I.setElementaryStreamInfo(F.type,I.start,G,I.start,q,!0)}I.setElementaryStreamInfo(F.type,V,G,ee,q),this.backtrackFragment&&(this.backtrackFragment=I),this.bufferFragmentData(F,I,C,O)}}else if(T.independent===!1){this.backtrack(I);return}if(j){var ie=j.startPTS,ae=j.endPTS,se=j.startDTS,le=j.endDTS;C&&(C.elementaryStreams[i.ElementaryStreamTypes.AUDIO]={startPTS:ie,endPTS:ae,startDTS:se,endDTS:le}),I.setElementaryStreamInfo(i.ElementaryStreamTypes.AUDIO,ie,ae,se,le),this.bufferFragmentData(j,I,C,O)}if(N&&k!==null&&k!==void 0&&(y=k.samples)!==null&&y!==void 0&&y.length){var ue={id:L,frag:I,details:N,samples:k.samples};x.trigger(D.Events.FRAG_PARSING_METADATA,ue)}if(N&&B){var Z={id:L,frag:I,details:N,samples:B.samples};x.trigger(D.Events.FRAG_PARSING_USERDATA,Z)}}},p._bufferInitSegment=function(_,y,L,x){var T=this;if(this.state===u.State.PARSING){this.audioOnly=!!y.audio&&!y.video,this.altAudio&&!this.audioOnly&&delete y.audio;var O=y.audio,R=y.video,I=y.audiovideo;if(O){var C=_.audioCodec,w=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(C&&(C.indexOf("mp4a.40.5")!==-1?C="mp4a.40.2":C="mp4a.40.5"),O.metadata.channelCount!==1&&w.indexOf("firefox")===-1&&(C="mp4a.40.5")),w.indexOf("android")!==-1&&O.container!=="audio/mpeg"&&(C="mp4a.40.2",this.log("Android: force audio codec to "+C)),_.audioCodec&&_.audioCodec!==C&&this.log('Swapping manifest audio codec "'+_.audioCodec+'" for "'+C+'"'),O.levelCodec=C,O.id="main",this.log("Init audio buffer, container:"+O.container+", codecs[selected/level/parsed]=["+(C||"")+"/"+(_.audioCodec||"")+"/"+O.codec+"]")}R&&(R.levelCodec=_.videoCodec,R.id="main",this.log("Init video buffer, container:"+R.container+", codecs[level/parsed]=["+(_.videoCodec||"")+"/"+R.codec+"]")),I&&this.log("Init audiovideo buffer, container:"+I.container+", codecs[level/parsed]=["+(_.attrs.CODECS||"")+"/"+I.codec+"]"),this.hls.trigger(D.Events.BUFFER_CODECS,y),Object.keys(y).forEach(function(F){var B=y[F],k=B.initSegment;k!=null&&k.byteLength&&T.hls.trigger(D.Events.BUFFER_APPENDING,{type:F,data:k,frag:L,part:null,chunkMeta:x,parent:L.type})}),this.tick()}},p.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,d.PlaylistLevelType.MAIN)},p.backtrack=function(_){this.couldBacktrack=!0,this.backtrackFragment=_,this.resetTransmuxer(),this.flushBufferGap(_),this.fragmentTracker.removeFragment(_),this.fragPrevious=null,this.nextLoadPosition=_.start,this.state=u.State.IDLE},p.checkFragmentChanged=function(){var _=this.media,y=null;if(_&&_.readyState>1&&_.seeking===!1){var L=_.currentTime;if(S.BufferHelper.isBuffered(_,L)?y=this.getAppendedFrag(L):S.BufferHelper.isBuffered(_,L+.1)&&(y=this.getAppendedFrag(L+.1)),y){this.backtrackFragment=null;var x=this.fragPlaying,T=y.level;(!x||y.sn!==x.sn||x.level!==T||y.urlId!==x.urlId)&&(this.hls.trigger(D.Events.FRAG_CHANGED,{frag:y}),(!x||x.level!==T)&&this.hls.trigger(D.Events.LEVEL_SWITCHED,{level:T}),this.fragPlaying=y)}}},t(a,[{key:"nextLevel",get:function(){var _=this.nextBufferedFrag;return _?_.level:-1}},{key:"currentFrag",get:function(){var _=this.media;return _?this.fragPlaying||this.getAppendedFrag(_.currentTime):null}},{key:"currentProgramDateTime",get:function(){var _=this.media;if(_){var y=_.currentTime,L=this.currentFrag;if(L&&Object(b.isFiniteNumber)(y)&&Object(b.isFiniteNumber)(L.programDateTime)){var x=L.programDateTime+(y-L.start)*1e3;return new Date(x)}}return null}},{key:"currentLevel",get:function(){var _=this.currentFrag;return _?_.level:-1}},{key:"nextBufferedFrag",get:function(){var _=this.currentFrag;return _?this.followingBufferedFrag(_):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),a}(u.default)},"./src/controller/subtitle-stream-controller.ts":function(M,P,E){E.r(P),E.d(P,"SubtitleStreamController",function(){return e});var b=E("./src/events.ts"),u=E("./src/utils/buffer-helper.ts"),m=E("./src/controller/fragment-finders.ts"),D=E("./src/utils/discontinuities.ts"),S=E("./src/controller/level-helper.ts"),g=E("./src/controller/fragment-tracker.ts"),d=E("./src/controller/base-stream-controller.ts"),i=E("./src/types/loader.ts"),f=E("./src/types/level.ts");function o(n,r){for(var l=0;l<r.length;l++){var s=r[l];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function v(n,r,l){return r&&o(n.prototype,r),l&&o(n,l),Object.defineProperty(n,"prototype",{writable:!1}),n}function c(n,r){n.prototype=Object.create(r.prototype),n.prototype.constructor=n,h(n,r)}function h(n,r){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,a){return s.__proto__=a,s},h(n,r)}var t=500,e=function(n){c(r,n);function r(s,a){var p;return p=n.call(this,s,a,"[subtitle-stream-controller]")||this,p.levels=[],p.currentTrackId=-1,p.tracksBuffered=[],p.mainDetails=null,p._registerListeners(),p}var l=r.prototype;return l.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},l._registerListeners=function(){var a=this.hls;a.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.on(b.Events.ERROR,this.onError,this),a.on(b.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.on(b.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.on(b.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.on(b.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.on(b.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l._unregisterListeners=function(){var a=this.hls;a.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),a.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),a.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),a.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),a.off(b.Events.ERROR,this.onError,this),a.off(b.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),a.off(b.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),a.off(b.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),a.off(b.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),a.off(b.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},l.startLoad=function(){this.stopLoad(),this.state=d.State.IDLE,this.setInterval(t),this.tick()},l.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},l.onLevelLoaded=function(a,p){this.mainDetails=p.details},l.onSubtitleFragProcessed=function(a,p){var A=p.frag,_=p.success;if(this.fragPrevious=A,this.state=d.State.IDLE,!!_){var y=this.tracksBuffered[this.currentTrackId];if(!!y){for(var L,x=A.start,T=0;T<y.length;T++)if(x>=y[T].start&&x<=y[T].end){L=y[T];break}var O=A.start+A.duration;L?L.end=O:(L={start:x,end:O},y.push(L)),this.fragmentTracker.fragBuffered(A)}}},l.onBufferFlushing=function(a,p){var A=p.startOffset,_=p.endOffset;if(A===0&&_!==Number.POSITIVE_INFINITY){var y=this.currentTrackId,L=this.levels;if(!L.length||!L[y]||!L[y].details)return;var x=L[y].details,T=x.targetduration,O=_-T;if(O<=0)return;p.endOffsetSubtitles=Math.max(0,O),this.tracksBuffered.forEach(function(R){for(var I=0;I<R.length;){if(R[I].end<=O){R.shift();continue}else if(R[I].start<O)R[I].start=O;else break;I++}}),this.fragmentTracker.removeFragmentsInRange(A,O,i.PlaylistLevelType.SUBTITLE)}},l.onError=function(a,p){var A,_=p.frag;!_||_.type!==i.PlaylistLevelType.SUBTITLE||((A=this.fragCurrent)!==null&&A!==void 0&&A.loader&&this.fragCurrent.loader.abort(),this.state=d.State.IDLE)},l.onSubtitleTracksUpdated=function(a,p){var A=this,_=p.subtitleTracks;this.tracksBuffered=[],this.levels=_.map(function(y){return new f.Level(y)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(y){A.tracksBuffered[y.id]=[]}),this.mediaBuffer=null},l.onSubtitleTrackSwitch=function(a,p){if(this.currentTrackId=p.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var A=this.levels[this.currentTrackId];A!=null&&A.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,A&&this.setInterval(t)},l.onSubtitleTrackLoaded=function(a,p){var A,_=p.details,y=p.id,L=this.currentTrackId,x=this.levels;if(!!x.length){var T=x[L];if(!(y>=x.length||y!==L||!T)){if(this.mediaBuffer=this.mediaBufferTimeRanges,_.live||(A=T.details)!==null&&A!==void 0&&A.live){var O=this.mainDetails;if(_.deltaUpdateFailed||!O)return;var R=O.fragments[0];if(!T.details)_.hasProgramDateTime&&O.hasProgramDateTime?Object(D.alignMediaPlaylistByPDT)(_,O):R&&Object(S.addSliding)(_,R.start);else{var I=this.alignPlaylists(_,T.details);I===0&&R&&Object(S.addSliding)(_,R.start)}}if(T.details=_,this.levelLastLoaded=y,this.tick(),_.live&&!this.fragCurrent&&this.media&&this.state===d.State.IDLE){var C=Object(m.findFragmentByPTS)(null,_.fragments,this.media.currentTime,0);C||(this.warn("Subtitle playlist not aligned with playback"),T.details=void 0)}}}},l._handleFragmentLoadComplete=function(a){var p=a.frag,A=a.payload,_=p.decryptdata,y=this.hls;if(!this.fragContextChanged(p)&&A&&A.byteLength>0&&_&&_.key&&_.iv&&_.method==="AES-128"){var L=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(A),_.key.buffer,_.iv.buffer).then(function(x){var T=performance.now();y.trigger(b.Events.FRAG_DECRYPTED,{frag:p,payload:x,stats:{tstart:L,tdecrypt:T}})})}},l.doTick=function(){if(!this.media){this.state=d.State.IDLE;return}if(this.state===d.State.IDLE){var a=this.currentTrackId,p=this.levels;if(!p.length||!p[a]||!p[a].details)return;var A=p[a].details,_=A.targetduration,y=this.config,L=this.media,x=u.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,L.currentTime-_,y.maxBufferHole),T=x.end,O=x.len,R=this.getMaxBufferLength()+_;if(O>R)return;console.assert(A,"Subtitle track details are defined on idle subtitle stream controller tick");var I=A.fragments,C=I.length,w=A.edge,F,B=this.fragPrevious;if(T<w){var k=y.maxFragLookUpTolerance;F=Object(m.findFragmentByPTS)(B,I,Math.max(I[0].start,T),k),!F&&B&&B.start<I[0].start&&(F=I[0])}else F=I[C-1];if(F=this.mapToInitFragWhenRequired(F),!F)return;F.encrypted?this.loadKey(F,A):this.fragmentTracker.getState(F)===g.FragmentState.NOT_LOADED&&this.loadFragment(F,A,T)}},l.loadFragment=function(a,p,A){this.fragCurrent=a,a.sn==="initSegment"?this._loadInitSegment(a):n.prototype.loadFragment.call(this,a,p,A)},v(r,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),r}(d.default)},"./src/controller/subtitle-track-controller.ts":function(M,P,E){E.r(P);var b=E("./src/events.ts"),u=E("./src/utils/texttrack-utils.ts"),m=E("./src/controller/base-playlist-controller.ts"),D=E("./src/types/loader.ts");function S(v,c){for(var h=0;h<c.length;h++){var t=c[h];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(v,t.key,t)}}function g(v,c,h){return c&&S(v.prototype,c),h&&S(v,h),Object.defineProperty(v,"prototype",{writable:!1}),v}function d(v,c){v.prototype=Object.create(c.prototype),v.prototype.constructor=v,i(v,c)}function i(v,c){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(v,c)}var f=function(v){d(c,v);function c(t){var e;return e=v.call(this,t,"[subtitle-track-controller]")||this,e.media=null,e.tracks=[],e.groupId=null,e.tracksInGroup=[],e.trackId=-1,e.selectDefaultTrack=!0,e.queuedDefaultTrack=-1,e.trackChangeListener=function(){return e.onTextTracksChanged()},e.asyncPollTrackChange=function(){return e.pollTrackChange(0)},e.useTextTrackPolling=!1,e.subtitlePollingInterval=-1,e._subtitleDisplay=!0,e.registerListeners(),e}var h=c.prototype;return h.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,v.prototype.destroy.call(this)},h.registerListeners=function(){var e=this.hls;e.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(b.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(b.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var e=this.hls;e.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),e.off(b.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(b.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(b.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(b.Events.ERROR,this.onError,this)},h.onMediaAttached=function(e,n){this.media=n.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},h.pollTrackChange=function(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,e)},h.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var e=o(this.media.textTracks);e.forEach(function(n){Object(u.clearCurrentCues)(n)}),this.subtitleTrack=-1,this.media=null}},h.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},h.onManifestParsed=function(e,n){this.tracks=n.subtitleTracks},h.onSubtitleTrackLoaded=function(e,n){var r=n.id,l=n.details,s=this.trackId,a=this.tracksInGroup[s];if(!a){this.warn("Invalid subtitle track id "+r);return}var p=a.details;a.details=n.details,this.log("subtitle track "+r+" loaded ["+l.startSN+"-"+l.endSN+"]"),r===this.trackId&&(this.retryCount=0,this.playlistLoaded(r,n,p))},h.onLevelLoading=function(e,n){this.switchLevel(n.level)},h.onLevelSwitching=function(e,n){this.switchLevel(n.level)},h.switchLevel=function(e){var n=this.hls.levels[e];if(!!(n!=null&&n.textGroupIds)){var r=n.textGroupIds[n.urlId];if(this.groupId!==r){var l=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter(function(A){return!r||A.groupId===r});this.tracksInGroup=s;var a=this.findTrackId(l==null?void 0:l.name)||this.findTrackId();this.groupId=r;var p={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+r+'" group-id'),this.hls.trigger(b.Events.SUBTITLE_TRACKS_UPDATED,p),a!==-1&&this.setSubtitleTrack(a,l)}}},h.findTrackId=function(e){for(var n=this.tracksInGroup,r=0;r<n.length;r++){var l=n[r];if((!this.selectDefaultTrack||l.default)&&(!e||e===l.name))return l.id}return-1},h.onError=function(e,n){v.prototype.onError.call(this,e,n),!(n.fatal||!n.context)&&n.context.type===D.PlaylistContextType.SUBTITLE_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},h.loadPlaylist=function(e){var n=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(n)){var r=n.id,l=n.groupId,s=n.url;if(e)try{s=e.addDirectives(s)}catch(a){this.warn("Could not construct new URL with HLS Delivery Directives: "+a)}this.log("Loading subtitle playlist for id "+r),this.hls.trigger(b.Events.SUBTITLE_TRACK_LOADING,{url:s,id:r,groupId:l,deliveryDirectives:e||null})}},h.toggleTrackModes=function(e){var n=this,r=this.media,l=this.trackId;if(!!r){var s=o(r.textTracks),a=s.filter(function(_){return _.groupId===n.groupId});if(e===-1)[].slice.call(s).forEach(function(_){_.mode="disabled"});else{var p=a[l];p&&(p.mode="disabled")}var A=a[e];A&&(A.mode=this.subtitleDisplay?"showing":"hidden")}},h.setSubtitleTrack=function(e,n){var r,l=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(this.trackId!==e&&this.toggleTrackModes(e),!(this.trackId===e&&(e===-1||(r=l[e])!==null&&r!==void 0&&r.details)||e<-1||e>=l.length)){this.clearTimer();var s=l[e];if(this.log("Switching to subtitle track "+e),this.trackId=e,s){var a=s.id,p=s.groupId,A=p===void 0?"":p,_=s.name,y=s.type,L=s.url;this.hls.trigger(b.Events.SUBTITLE_TRACK_SWITCH,{id:a,groupId:A,name:_,type:y,url:L});var x=this.switchParams(s.url,n==null?void 0:n.details);this.loadPlaylist(x)}else this.hls.trigger(b.Events.SUBTITLE_TRACK_SWITCH,{id:e})}},h.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var e=-1,n=o(this.media.textTracks),r=0;r<n.length;r++)if(n[r].mode==="hidden")e=r;else if(n[r].mode==="showing"){e=r;break}this.subtitleTrack!==e&&(this.subtitleTrack=e)}},g(c,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(e){this.selectDefaultTrack=!1;var n=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(e,n)}}]),c}(m.default);function o(v){for(var c=[],h=0;h<v.length;h++){var t=v[h];t.kind==="subtitles"&&t.label&&c.push(v[h])}return c}P.default=f},"./src/controller/timeline-controller.ts":function(M,P,E){E.r(P),E.d(P,"TimelineController",function(){return v});var b=E("./src/polyfills/number.ts"),u=E("./src/events.ts"),m=E("./src/utils/cea-608-parser.ts"),D=E("./src/utils/output-filter.ts"),S=E("./src/utils/webvtt-parser.ts"),g=E("./src/utils/texttrack-utils.ts"),d=E("./src/utils/imsc1-ttml-parser.ts"),i=E("./src/utils/mp4-tools.ts"),f=E("./src/types/loader.ts"),o=E("./src/utils/logger.ts"),v=function(){function e(r){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=t(),this.captionsProperties=void 0,this.hls=r,this.config=r.config,this.Cues=r.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var l=new D.default(this,"textTrack1"),s=new D.default(this,"textTrack2"),a=new D.default(this,"textTrack3"),p=new D.default(this,"textTrack4");this.cea608Parser1=new m.default(1,l,s),this.cea608Parser2=new m.default(3,a,p)}r.on(u.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),r.on(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),r.on(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),r.on(u.Events.MANIFEST_LOADED,this.onManifestLoaded,this),r.on(u.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),r.on(u.Events.FRAG_LOADING,this.onFragLoading,this),r.on(u.Events.FRAG_LOADED,this.onFragLoaded,this),r.on(u.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),r.on(u.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),r.on(u.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),r.on(u.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),r.on(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var n=e.prototype;return n.destroy=function(){var l=this.hls;l.off(u.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),l.off(u.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(u.Events.MANIFEST_LOADED,this.onManifestLoaded,this),l.off(u.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),l.off(u.Events.FRAG_LOADING,this.onFragLoading,this),l.off(u.Events.FRAG_LOADED,this.onFragLoaded,this),l.off(u.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),l.off(u.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),l.off(u.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),l.off(u.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),l.off(u.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},n.addCues=function(l,s,a,p,A){for(var _=!1,y=A.length;y--;){var L=A[y],x=h(L[0],L[1],s,a);if(x>=0&&(L[0]=Math.min(L[0],s),L[1]=Math.max(L[1],a),_=!0,x/(a-s)>.5))return}if(_||A.push([s,a]),this.config.renderTextTracksNatively){var T=this.captionsTracks[l];this.Cues.newCue(T,s,a,p)}else{var O=this.Cues.newCue(null,s,a,p);this.hls.trigger(u.Events.CUES_PARSED,{type:"captions",cues:O,track:l})}},n.onInitPtsFound=function(l,s){var a=this,p=s.frag,A=s.id,_=s.initPTS,y=s.timescale,L=this.unparsedVttFrags;A==="main"&&(this.initPTS[p.cc]=_,this.timescale[p.cc]=y),L.length&&(this.unparsedVttFrags=[],L.forEach(function(x){a.onFragLoaded(u.Events.FRAG_LOADED,x)}))},n.getExistingTrack=function(l){var s=this.media;if(s)for(var a=0;a<s.textTracks.length;a++){var p=s.textTracks[a];if(p[l])return p}return null},n.createCaptionsTrack=function(l){this.config.renderTextTracksNatively?this.createNativeTrack(l):this.createNonNativeTrack(l)},n.createNativeTrack=function(l){if(!this.captionsTracks[l]){var s=this.captionsProperties,a=this.captionsTracks,p=this.media,A=s[l],_=A.label,y=A.languageCode,L=this.getExistingTrack(l);if(L)a[l]=L,Object(g.clearCurrentCues)(a[l]),Object(g.sendAddTrackEvent)(a[l],p);else{var x=this.createTextTrack("captions",_,y);x&&(x[l]=!0,a[l]=x)}}},n.createNonNativeTrack=function(l){if(!this.nonNativeCaptionsTracks[l]){var s=this.captionsProperties[l];if(!!s){var a=s.label,p={_id:l,label:a,kind:"captions",default:s.media?!!s.media.default:!1,closedCaptions:s.media};this.nonNativeCaptionsTracks[l]=p,this.hls.trigger(u.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[p]})}}},n.createTextTrack=function(l,s,a){var p=this.media;if(!!p)return p.addTextTrack(l,s,a)},n.onMediaAttaching=function(l,s){this.media=s.media,this._cleanTracks()},n.onMediaDetaching=function(){var l=this.captionsTracks;Object.keys(l).forEach(function(s){Object(g.clearCurrentCues)(l[s]),delete l[s]}),this.nonNativeCaptionsTracks={}},n.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=t(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},n._cleanTracks=function(){var l=this.media;if(!!l){var s=l.textTracks;if(s)for(var a=0;a<s.length;a++)Object(g.clearCurrentCues)(s[a])}},n.onSubtitleTracksUpdated=function(l,s){var a=this;this.textTracks=[];var p=s.subtitleTracks||[],A=p.some(function(x){return x.textCodec===d.IMSC1_CODEC});if(this.config.enableWebVTT||A&&this.config.enableIMSC1){var _=this.tracks&&p&&this.tracks.length===p.length;if(this.tracks=p||[],this.config.renderTextTracksNatively){var y=this.media?this.media.textTracks:[];this.tracks.forEach(function(x,T){var O;if(T<y.length){for(var R=null,I=0;I<y.length;I++)if(c(y[I],x)){R=y[I];break}R&&(O=R)}if(O)Object(g.clearCurrentCues)(O);else{var C=a._captionsOrSubtitlesFromCharacteristics(x);O=a.createTextTrack(C,x.name,x.lang),O&&(O.mode="disabled")}O&&(O.groupId=x.groupId,a.textTracks.push(O))})}else if(!_&&this.tracks&&this.tracks.length){var L=this.tracks.map(function(x){return{label:x.name,kind:x.type.toLowerCase(),default:x.default,subtitleTrack:x}});this.hls.trigger(u.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:L})}}},n._captionsOrSubtitlesFromCharacteristics=function(l){var s;if((s=l.attrs)!==null&&s!==void 0&&s.CHARACTERISTICS){var a=/transcribes-spoken-dialog/gi.test(l.attrs.CHARACTERISTICS),p=/describes-music-and-sound/gi.test(l.attrs.CHARACTERISTICS);if(a&&p)return"captions"}return"subtitles"},n.onManifestLoaded=function(l,s){var a=this;this.config.enableCEA708Captions&&s.captions&&s.captions.forEach(function(p){var A=/(?:CC|SERVICE)([1-4])/.exec(p.instreamId);if(!!A){var _="textTrack"+A[1],y=a.captionsProperties[_];!y||(y.label=p.name,p.lang&&(y.languageCode=p.lang),y.media=p)}})},n.onFragLoading=function(l,s){var a=this.cea608Parser1,p=this.cea608Parser2,A=this.lastSn,_=this.lastPartIndex;if(!(!this.enabled||!(a&&p))&&s.frag.type===f.PlaylistLevelType.MAIN){var y,L,x=s.frag.sn,T=(y=s==null||(L=s.part)===null||L===void 0?void 0:L.index)!=null?y:-1;x===A+1||x===A&&T===_+1||(a.reset(),p.reset()),this.lastSn=x,this.lastPartIndex=T}},n.onFragLoaded=function(l,s){var a=s.frag,p=s.payload,A=this.initPTS,_=this.unparsedVttFrags;if(a.type===f.PlaylistLevelType.SUBTITLE)if(p.byteLength){if(!Object(b.isFiniteNumber)(A[a.cc])){_.push(s),A.length&&this.hls.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Missing initial subtitle PTS")});return}var y=a.decryptdata,L="stats"in s;if(y==null||y.key==null||y.method!=="AES-128"||L){var x=this.tracks[a.level],T=this.vttCCs;T[a.cc]||(T[a.cc]={start:a.start,prevCC:this.prevCC,new:!0},this.prevCC=a.cc),x&&x.textCodec===d.IMSC1_CODEC?this._parseIMSC1(a,p):this._parseVTTs(a,p,T)}}else this.hls.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:a,error:new Error("Empty subtitle payload")})},n._parseIMSC1=function(l,s){var a=this,p=this.hls;Object(d.parseIMSC1)(s,this.initPTS[l.cc],this.timescale[l.cc],function(A){a._appendCues(A,l.level),p.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:l})},function(A){o.logger.log("Failed to parse IMSC1: "+A),p.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:A})})},n._parseVTTs=function(l,s,a){var p,A=this,_=this.hls,y=(p=l.initSegment)!==null&&p!==void 0&&p.data?Object(i.appendUint8Array)(l.initSegment.data,new Uint8Array(s)):s;Object(S.parseWebVTT)(y,this.initPTS[l.cc],this.timescale[l.cc],a,l.cc,l.start,function(L){A._appendCues(L,l.level),_.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:l})},function(L){A._fallbackToIMSC1(l,s),o.logger.log("Failed to parse VTT cue: "+L),_.trigger(u.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l,error:L})})},n._fallbackToIMSC1=function(l,s){var a=this,p=this.tracks[l.level];p.textCodec||Object(d.parseIMSC1)(s,this.initPTS[l.cc],this.timescale[l.cc],function(){p.textCodec=d.IMSC1_CODEC,a._parseIMSC1(l,s)},function(){p.textCodec="wvtt"})},n._appendCues=function(l,s){var a=this.hls;if(this.config.renderTextTracksNatively){var p=this.textTracks[s];if(!p||p.mode==="disabled")return;l.forEach(function(y){return Object(g.addCueToTrack)(p,y)})}else{var A=this.tracks[s];if(!A)return;var _=A.default?"default":"subtitles"+s;a.trigger(u.Events.CUES_PARSED,{type:"subtitles",cues:l,track:_})}},n.onFragDecrypted=function(l,s){var a=s.frag;if(a.type===f.PlaylistLevelType.SUBTITLE){if(!Object(b.isFiniteNumber)(this.initPTS[a.cc])){this.unparsedVttFrags.push(s);return}this.onFragLoaded(u.Events.FRAG_LOADED,s)}},n.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},n.onFragParsingUserdata=function(l,s){var a=this.cea608Parser1,p=this.cea608Parser2;if(!(!this.enabled||!(a&&p)))for(var A=0;A<s.samples.length;A++){var _=s.samples[A].bytes;if(_){var y=this.extractCea608Data(_);a.addData(s.samples[A].pts,y[0]),p.addData(s.samples[A].pts,y[1])}}},n.onBufferFlushing=function(l,s){var a=s.startOffset,p=s.endOffset,A=s.endOffsetSubtitles,_=s.type,y=this.media;if(!(!y||y.currentTime<p)){if(!_||_==="video"){var L=this.captionsTracks;Object.keys(L).forEach(function(T){return Object(g.removeCuesInRange)(L[T],a,p)})}if(this.config.renderTextTracksNatively&&a===0&&A!==void 0){var x=this.textTracks;Object.keys(x).forEach(function(T){return Object(g.removeCuesInRange)(x[T],a,A)})}}},n.extractCea608Data=function(l){for(var s=[[],[]],a=l[0]&31,p=2,A=0;A<a;A++){var _=l[p++],y=127&l[p++],L=127&l[p++];if(!(y===0&&L===0)){var x=(4&_)!==0;if(x){var T=3&_;(T===0||T===1)&&(s[T].push(y),s[T].push(L))}}}return s},e}();function c(e,n){return e&&e.label===n.name&&!(e.textTrack1||e.textTrack2)}function h(e,n,r,l){return Math.min(n,l)-Math.max(e,r)}function t(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return b});var b=function(){function u(D,S){this.subtle=void 0,this.aesIV=void 0,this.subtle=D,this.aesIV=S}var m=u.prototype;return m.decrypt=function(S,g){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},g,S)},u}()},"./src/crypt/aes-decryptor.ts":function(M,P,E){E.r(P),E.d(P,"removePadding",function(){return u}),E.d(P,"default",function(){return m});var b=E("./src/utils/typed-array.ts");function u(D){var S=D.byteLength,g=S&&new DataView(D.buffer).getUint8(S-1);return g?Object(b.sliceUint8)(D,0,S-g):D}var m=function(){function D(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var S=D.prototype;return S.uint8ArrayToUint32Array_=function(d){for(var i=new DataView(d),f=new Uint32Array(4),o=0;o<4;o++)f[o]=i.getUint32(o*4);return f},S.initTable=function(){var d=this.sBox,i=this.invSBox,f=this.subMix,o=f[0],v=f[1],c=f[2],h=f[3],t=this.invSubMix,e=t[0],n=t[1],r=t[2],l=t[3],s=new Uint32Array(256),a=0,p=0,A=0;for(A=0;A<256;A++)A<128?s[A]=A<<1:s[A]=A<<1^283;for(A=0;A<256;A++){var _=p^p<<1^p<<2^p<<3^p<<4;_=_>>>8^_&255^99,d[a]=_,i[_]=a;var y=s[a],L=s[y],x=s[L],T=s[_]*257^_*16843008;o[a]=T<<24|T>>>8,v[a]=T<<16|T>>>16,c[a]=T<<8|T>>>24,h[a]=T,T=x*16843009^L*65537^y*257^a*16843008,e[_]=T<<24|T>>>8,n[_]=T<<16|T>>>16,r[_]=T<<8|T>>>24,l[_]=T,a?(a=y^s[s[s[x^y]]],p^=s[s[p]]):a=p=1}},S.expandKey=function(d){for(var i=this.uint8ArrayToUint32Array_(d),f=!0,o=0;o<i.length&&f;)f=i[o]===this.key[o],o++;if(!f){this.key=i;var v=this.keySize=i.length;if(v!==4&&v!==6&&v!==8)throw new Error("Invalid aes key size="+v);var c=this.ksRows=(v+6+1)*4,h,t,e=this.keySchedule=new Uint32Array(c),n=this.invKeySchedule=new Uint32Array(c),r=this.sBox,l=this.rcon,s=this.invSubMix,a=s[0],p=s[1],A=s[2],_=s[3],y,L;for(h=0;h<c;h++){if(h<v){y=e[h]=i[h];continue}L=y,h%v===0?(L=L<<8|L>>>24,L=r[L>>>24]<<24|r[L>>>16&255]<<16|r[L>>>8&255]<<8|r[L&255],L^=l[h/v|0]<<24):v>6&&h%v===4&&(L=r[L>>>24]<<24|r[L>>>16&255]<<16|r[L>>>8&255]<<8|r[L&255]),e[h]=y=(e[h-v]^L)>>>0}for(t=0;t<c;t++)h=c-t,t&3?L=e[h]:L=e[h-4],t<4||h<=4?n[t]=L:n[t]=a[r[L>>>24]]^p[r[L>>>16&255]]^A[r[L>>>8&255]]^_[r[L&255]],n[t]=n[t]>>>0}},S.networkToHostOrderSwap=function(d){return d<<24|(d&65280)<<8|(d&16711680)>>8|d>>>24},S.decrypt=function(d,i,f){for(var o=this.keySize+6,v=this.invKeySchedule,c=this.invSBox,h=this.invSubMix,t=h[0],e=h[1],n=h[2],r=h[3],l=this.uint8ArrayToUint32Array_(f),s=l[0],a=l[1],p=l[2],A=l[3],_=new Int32Array(d),y=new Int32Array(_.length),L,x,T,O,R,I,C,w,F,B,k,U,N,j,K=this.networkToHostOrderSwap;i<_.length;){for(F=K(_[i]),B=K(_[i+1]),k=K(_[i+2]),U=K(_[i+3]),R=F^v[0],I=U^v[1],C=k^v[2],w=B^v[3],N=4,j=1;j<o;j++)L=t[R>>>24]^e[I>>16&255]^n[C>>8&255]^r[w&255]^v[N],x=t[I>>>24]^e[C>>16&255]^n[w>>8&255]^r[R&255]^v[N+1],T=t[C>>>24]^e[w>>16&255]^n[R>>8&255]^r[I&255]^v[N+2],O=t[w>>>24]^e[R>>16&255]^n[I>>8&255]^r[C&255]^v[N+3],R=L,I=x,C=T,w=O,N=N+4;L=c[R>>>24]<<24^c[I>>16&255]<<16^c[C>>8&255]<<8^c[w&255]^v[N],x=c[I>>>24]<<24^c[C>>16&255]<<16^c[w>>8&255]<<8^c[R&255]^v[N+1],T=c[C>>>24]<<24^c[w>>16&255]<<16^c[R>>8&255]<<8^c[I&255]^v[N+2],O=c[w>>>24]<<24^c[R>>16&255]<<16^c[I>>8&255]<<8^c[C&255]^v[N+3],y[i]=K(L^s),y[i+1]=K(O^a),y[i+2]=K(T^p),y[i+3]=K(x^A),s=F,a=B,p=k,A=U,i=i+4}return y.buffer},D}()},"./src/crypt/decrypter.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return i});var b=E("./src/crypt/aes-crypto.ts"),u=E("./src/crypt/fast-aes-key.ts"),m=E("./src/crypt/aes-decryptor.ts"),D=E("./src/utils/logger.ts"),S=E("./src/utils/mp4-tools.ts"),g=E("./src/utils/typed-array.ts"),d=16,i=function(){function f(v,c,h){var t=h===void 0?{}:h,e=t.removePKCS7Padding,n=e===void 0?!0:e;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=v,this.config=c,this.removePKCS7Padding=n,n)try{var r=self.crypto;r&&(this.subtle=r.subtle||r.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var o=f.prototype;return o.destroy=function(){this.observer=null},o.isSync=function(){return this.config.enableSoftwareAES},o.flush=function(){var c=this.currentResult;if(!c){this.reset();return}var h=new Uint8Array(c);return this.reset(),this.removePKCS7Padding?Object(m.removePadding)(h):h},o.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},o.decrypt=function(c,h,t,e){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(c),h,t);var n=this.flush();n&&e(n.buffer)}else this.webCryptoDecrypt(new Uint8Array(c),h,t).then(e)},o.softwareDecrypt=function(c,h,t){var e=this.currentIV,n=this.currentResult,r=this.remainderData;this.logOnce("JS AES decrypt"),r&&(c=Object(S.appendUint8Array)(r,c),this.remainderData=null);var l=this.getValidChunk(c);if(!l.length)return null;e&&(t=e);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new m.default),s.expandKey(h);var a=n;return this.currentResult=s.decrypt(l.buffer,0,t),this.currentIV=Object(g.sliceUint8)(l,-16).buffer,a||null},o.webCryptoDecrypt=function(c,h,t){var e=this,n=this.subtle;return(this.key!==h||!this.fastAesKey)&&(this.key=h,this.fastAesKey=new u.default(n,h)),this.fastAesKey.expandKey().then(function(r){if(!n)return Promise.reject(new Error("web crypto not initialized"));var l=new b.default(n,t);return l.decrypt(c.buffer,r)}).catch(function(r){return e.onWebCryptoError(r,c,h,t)})},o.onWebCryptoError=function(c,h,t,e){return D.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",c),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(h,t,e)},o.getValidChunk=function(c){var h=c,t=c.length-c.length%d;return t!==c.length&&(h=Object(g.sliceUint8)(c,0,t),this.remainderData=Object(g.sliceUint8)(c,t)),h},o.logOnce=function(c){!this.logEnabled||(D.logger.log("[decrypter.ts]: "+c),this.logEnabled=!1)},f}()},"./src/crypt/fast-aes-key.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return b});var b=function(){function u(D,S){this.subtle=void 0,this.key=void 0,this.subtle=D,this.key=S}var m=u.prototype;return m.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},u}()},"./src/demux/aacdemuxer.ts":function(M,P,E){E.r(P);var b=E("./src/demux/base-audio-demuxer.ts"),u=E("./src/demux/adts.ts"),m=E("./src/utils/logger.ts"),D=E("./src/demux/id3.ts");function S(i,f){i.prototype=Object.create(f.prototype),i.prototype.constructor=i,g(i,f)}function g(i,f){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,c){return v.__proto__=c,v},g(i,f)}var d=function(i){S(f,i);function f(v,c){var h;return h=i.call(this)||this,h.observer=void 0,h.config=void 0,h.observer=v,h.config=c,h}var o=f.prototype;return o.resetInitSegment=function(c,h,t,e){i.prototype.resetInitSegment.call(this,c,h,t,e),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:h,duration:e,inputTimeScale:9e4,dropped:0}},f.probe=function(c){if(!c)return!1;for(var h=D.getID3Data(c,0)||[],t=h.length,e=c.length;t<e;t++)if(u.probe(c,t))return m.logger.log("ADTS sync word found !"),!0;return!1},o.canParse=function(c,h){return u.canParse(c,h)},o.appendFrame=function(c,h,t){u.initTrackConfig(c,this.observer,h,t,c.manifestCodec);var e=u.appendFrame(c,h,t,this.basePTS,this.frameIndex);if(e&&e.missing===0)return e},f}(b.default);d.minProbeByteLength=9,P.default=d},"./src/demux/adts.ts":function(M,P,E){E.r(P),E.d(P,"getAudioConfig",function(){return D}),E.d(P,"isHeaderPattern",function(){return S}),E.d(P,"getHeaderLength",function(){return g}),E.d(P,"getFullFrameLength",function(){return d}),E.d(P,"canGetFrameLength",function(){return i}),E.d(P,"isHeader",function(){return f}),E.d(P,"canParse",function(){return o}),E.d(P,"probe",function(){return v}),E.d(P,"initTrackConfig",function(){return c}),E.d(P,"getFrameDuration",function(){return h}),E.d(P,"parseFrameHeader",function(){return t}),E.d(P,"appendFrame",function(){return e});var b=E("./src/utils/logger.ts"),u=E("./src/errors.ts"),m=E("./src/events.ts");function D(n,r,l,s){var a,p,A,_,y=navigator.userAgent.toLowerCase(),L=s,x=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=((r[l+2]&192)>>>6)+1;var T=(r[l+2]&60)>>>2;if(T>x.length-1){n.trigger(m.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+T});return}return A=(r[l+2]&1)<<2,A|=(r[l+3]&192)>>>6,b.logger.log("manifest codec:"+s+", ADTS type:"+a+", samplingIndex:"+T),/firefox/i.test(y)?T>=6?(a=5,_=new Array(4),p=T-3):(a=2,_=new Array(2),p=T):y.indexOf("android")!==-1?(a=2,_=new Array(2),p=T):(a=5,_=new Array(4),s&&(s.indexOf("mp4a.40.29")!==-1||s.indexOf("mp4a.40.5")!==-1)||!s&&T>=6?p=T-3:((s&&s.indexOf("mp4a.40.2")!==-1&&(T>=6&&A===1||/vivaldi/i.test(y))||!s&&A===1)&&(a=2,_=new Array(2)),p=T)),_[0]=a<<3,_[0]|=(T&14)>>1,_[1]|=(T&1)<<7,_[1]|=A<<3,a===5&&(_[1]|=(p&14)>>1,_[2]=(p&1)<<7,_[2]|=2<<2,_[3]=0),{config:_,samplerate:x[T],channelCount:A,codec:"mp4a.40."+a,manifestCodec:L}}function S(n,r){return n[r]===255&&(n[r+1]&246)===240}function g(n,r){return n[r+1]&1?7:9}function d(n,r){return(n[r+3]&3)<<11|n[r+4]<<3|(n[r+5]&224)>>>5}function i(n,r){return r+5<n.length}function f(n,r){return r+1<n.length&&S(n,r)}function o(n,r){return i(n,r)&&S(n,r)&&d(n,r)<=n.length-r}function v(n,r){if(f(n,r)){var l=g(n,r);if(r+l>=n.length)return!1;var s=d(n,r);if(s<=l)return!1;var a=r+s;return a===n.length||f(n,a)}return!1}function c(n,r,l,s,a){if(!n.samplerate){var p=D(r,l,s,a);if(!p)return;n.config=p.config,n.samplerate=p.samplerate,n.channelCount=p.channelCount,n.codec=p.codec,n.manifestCodec=p.manifestCodec,b.logger.log("parsed codec:"+n.codec+", rate:"+p.samplerate+", channels:"+p.channelCount)}}function h(n){return 1024*9e4/n}function t(n,r){var l=g(n,r);if(r+l<=n.length){var s=d(n,r)-l;if(s>0)return{headerLength:l,frameLength:s}}}function e(n,r,l,s,a){var p=h(n.samplerate),A=s+a*p,_=t(r,l),y;if(_){var L=_.frameLength,x=_.headerLength,T=x+L,O=Math.max(0,l+T-r.length);O?(y=new Uint8Array(T-x),y.set(r.subarray(l+x,r.length),0)):y=r.subarray(l+x,l+T);var R={unit:y,pts:A};return O||n.samples.push(R),{sample:R,length:T,missing:O}}var I=r.length-l;y=new Uint8Array(I),y.set(r.subarray(l,r.length),0);var C={unit:y,pts:A};return{sample:C,length:I,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(M,P,E){E.r(P),E.d(P,"initPTSFn",function(){return i});var b=E("./src/polyfills/number.ts"),u=E("./src/demux/id3.ts"),m=E("./src/types/demuxer.ts"),D=E("./src/demux/dummy-demuxed-track.ts"),S=E("./src/utils/mp4-tools.ts"),g=E("./src/utils/typed-array.ts"),d=function(){function f(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var o=f.prototype;return o.resetInitSegment=function(c,h,t,e){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},o.resetTimeStamp=function(c){this.initPTS=c,this.resetContiguity()},o.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},o.canParse=function(c,h){return!1},o.appendFrame=function(c,h,t){},o.demux=function(c,h){this.cachedData&&(c=Object(S.appendUint8Array)(this.cachedData,c),this.cachedData=null);var t=u.getID3Data(c,0),e=t?t.length:0,n,r,l=this._audioTrack,s=this._id3Track,a=t?u.getTimeStamp(t):void 0,p=c.length;for((this.basePTS===null||this.frameIndex===0&&Object(b.isFiniteNumber)(a))&&(this.basePTS=i(a,h,this.initPTS)),t&&t.length>0&&s.samples.push({pts:this.basePTS,dts:this.basePTS,data:t,type:m.MetadataSchema.audioId3}),r=this.basePTS;e<p;){if(this.canParse(c,e)){var A=this.appendFrame(l,c,e);A?(this.frameIndex++,r=A.sample.pts,e+=A.length,n=e):e=p}else u.canParse(c,e)?(t=u.getID3Data(c,e),s.samples.push({pts:r,dts:r,data:t,type:m.MetadataSchema.audioId3}),e+=t.length,n=e):e++;if(e===p&&n!==p){var _=Object(g.sliceUint8)(c,n);this.cachedData?this.cachedData=Object(S.appendUint8Array)(this.cachedData,_):this.cachedData=_}}return{audioTrack:l,videoTrack:Object(D.dummyTrack)(),id3Track:s,textTrack:Object(D.dummyTrack)()}},o.demuxSampleAes=function(c,h,t){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},o.flush=function(c){var h=this.cachedData;return h&&(this.cachedData=null,this.demux(h,0)),{audioTrack:this._audioTrack,videoTrack:Object(D.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(D.dummyTrack)()}},o.destroy=function(){},f}(),i=function(o,v,c){return Object(b.isFiniteNumber)(o)?o*90:v*9e4+(c||0)};P.default=d},"./src/demux/chunk-cache.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return b});var b=function(){function m(){this.chunks=[],this.dataLength=0}var D=m.prototype;return D.push=function(g){this.chunks.push(g),this.dataLength+=g.length},D.flush=function(){var g=this.chunks,d=this.dataLength,i;if(g.length)g.length===1?i=g[0]:i=u(g,d);else return new Uint8Array(0);return this.reset(),i},D.reset=function(){this.chunks.length=0,this.dataLength=0},m}();function u(m,D){for(var S=new Uint8Array(D),g=0,d=0;d<m.length;d++){var i=m[d];S.set(i,g),g+=i.length}return S}},"./src/demux/dummy-demuxed-track.ts":function(M,P,E){E.r(P),E.d(P,"dummyTrack",function(){return b});function b(u,m){return u===void 0&&(u=""),m===void 0&&(m=9e4),{type:u,id:-1,pid:-1,inputTimeScale:m,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(M,P,E){E.r(P);var b=E("./src/utils/logger.ts"),u=function(){function m(S){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=S,this.bytesAvailable=S.byteLength,this.word=0,this.bitsAvailable=0}var D=m.prototype;return D.loadWord=function(){var g=this.data,d=this.bytesAvailable,i=g.byteLength-d,f=new Uint8Array(4),o=Math.min(4,d);if(o===0)throw new Error("no bytes available");f.set(g.subarray(i,i+o)),this.word=new DataView(f.buffer).getUint32(0),this.bitsAvailable=o*8,this.bytesAvailable-=o},D.skipBits=function(g){var d;this.bitsAvailable>g?(this.word<<=g,this.bitsAvailable-=g):(g-=this.bitsAvailable,d=g>>3,g-=d>>3,this.bytesAvailable-=d,this.loadWord(),this.word<<=g,this.bitsAvailable-=g)},D.readBits=function(g){var d=Math.min(this.bitsAvailable,g),i=this.word>>>32-d;return g>32&&b.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=d,this.bitsAvailable>0?this.word<<=d:this.bytesAvailable>0&&this.loadWord(),d=g-d,d>0&&this.bitsAvailable?i<<d|this.readBits(d):i},D.skipLZ=function(){var g;for(g=0;g<this.bitsAvailable;++g)if((this.word&2147483648>>>g)!==0)return this.word<<=g,this.bitsAvailable-=g,g;return this.loadWord(),g+this.skipLZ()},D.skipUEG=function(){this.skipBits(1+this.skipLZ())},D.skipEG=function(){this.skipBits(1+this.skipLZ())},D.readUEG=function(){var g=this.skipLZ();return this.readBits(g+1)-1},D.readEG=function(){var g=this.readUEG();return 1&g?1+g>>>1:-1*(g>>>1)},D.readBoolean=function(){return this.readBits(1)===1},D.readUByte=function(){return this.readBits(8)},D.readUShort=function(){return this.readBits(16)},D.readUInt=function(){return this.readBits(32)},D.skipScalingList=function(g){for(var d=8,i=8,f,o=0;o<g;o++)i!==0&&(f=this.readEG(),i=(d+f+256)%256),d=i===0?d:i},D.readSPS=function(){var g=0,d=0,i=0,f=0,o,v,c,h=this.readUByte.bind(this),t=this.readBits.bind(this),e=this.readUEG.bind(this),n=this.readBoolean.bind(this),r=this.skipBits.bind(this),l=this.skipEG.bind(this),s=this.skipUEG.bind(this),a=this.skipScalingList.bind(this);h();var p=h();if(t(5),r(3),h(),s(),p===100||p===110||p===122||p===244||p===44||p===83||p===86||p===118||p===128){var A=e();if(A===3&&r(1),s(),s(),r(1),n())for(v=A!==3?8:12,c=0;c<v;c++)n()&&(c<6?a(16):a(64))}s();var _=e();if(_===0)e();else if(_===1)for(r(1),l(),l(),o=e(),c=0;c<o;c++)l();s(),r(1);var y=e(),L=e(),x=t(1);x===0&&r(1),r(1),n()&&(g=e(),d=e(),i=e(),f=e());var T=[1,1];if(n()&&n()){var O=h();switch(O){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:{T=[h()<<8|h(),h()<<8|h()];break}}}return{width:Math.ceil((y+1)*16-g*2-d*2),height:(2-x)*(L+1)*16-(x?2:4)*(i+f),pixelRatio:T}},D.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},m}();P.default=u},"./src/demux/id3.ts":function(M,P,E){E.r(P),E.d(P,"isHeader",function(){return b}),E.d(P,"isFooter",function(){return u}),E.d(P,"getID3Data",function(){return m}),E.d(P,"canParse",function(){return S}),E.d(P,"getTimeStamp",function(){return g}),E.d(P,"isTimeStampFrame",function(){return d}),E.d(P,"getID3Frames",function(){return f}),E.d(P,"decodeFrame",function(){return o}),E.d(P,"utf8ArrayToStr",function(){return e}),E.d(P,"testables",function(){return n});var b=function(a,p){return p+10<=a.length&&a[p]===73&&a[p+1]===68&&a[p+2]===51&&a[p+3]<255&&a[p+4]<255&&a[p+6]<128&&a[p+7]<128&&a[p+8]<128&&a[p+9]<128},u=function(a,p){return p+10<=a.length&&a[p]===51&&a[p+1]===68&&a[p+2]===73&&a[p+3]<255&&a[p+4]<255&&a[p+6]<128&&a[p+7]<128&&a[p+8]<128&&a[p+9]<128},m=function(a,p){for(var A=p,_=0;b(a,p);){_+=10;var y=D(a,p+6);_+=y,u(a,p+10)&&(_+=10),p+=_}if(_>0)return a.subarray(A,A+_)},D=function(a,p){var A=0;return A=(a[p]&127)<<21,A|=(a[p+1]&127)<<14,A|=(a[p+2]&127)<<7,A|=a[p+3]&127,A},S=function(a,p){return b(a,p)&&D(a,p+6)+10<=a.length-p},g=function(a){for(var p=f(a),A=0;A<p.length;A++){var _=p[A];if(d(_))return t(_)}},d=function(a){return a&&a.key==="PRIV"&&a.info==="com.apple.streaming.transportStreamTimestamp"},i=function(a){var p=String.fromCharCode(a[0],a[1],a[2],a[3]),A=D(a,4),_=10;return{type:p,size:A,data:a.subarray(_,_+A)}},f=function(a){for(var p=0,A=[];b(a,p);){var _=D(a,p+6);p+=10;for(var y=p+_;p+8<y;){var L=i(a.subarray(p)),x=o(L);x&&A.push(x),p+=L.size+10}u(a,p)&&(p+=10)}return A},o=function(a){return a.type==="PRIV"?v(a):a.type[0]==="W"?h(a):c(a)},v=function(a){if(!(a.size<2)){var p=e(a.data,!0),A=new Uint8Array(a.data.subarray(p.length+1));return{key:a.type,info:p,data:A.buffer}}},c=function(a){if(!(a.size<2)){if(a.type==="TXXX"){var p=1,A=e(a.data.subarray(p),!0);p+=A.length+1;var _=e(a.data.subarray(p));return{key:a.type,info:A,data:_}}var y=e(a.data.subarray(1));return{key:a.type,data:y}}},h=function(a){if(a.type==="WXXX"){if(a.size<2)return;var p=1,A=e(a.data.subarray(p),!0);p+=A.length+1;var _=e(a.data.subarray(p));return{key:a.type,info:A,data:_}}var y=e(a.data);return{key:a.type,data:y}},t=function(a){if(a.data.byteLength===8){var p=new Uint8Array(a.data),A=p[3]&1,_=(p[4]<<23)+(p[5]<<15)+(p[6]<<7)+p[7];return _/=45,A&&(_+=4772185884e-2),Math.round(_)}},e=function(a,p){p===void 0&&(p=!1);var A=l();if(A){var _=A.decode(a);if(p){var y=_.indexOf("\0");return y!==-1?_.substring(0,y):_}return _.replace(/\0/g,"")}for(var L=a.length,x,T,O,R="",I=0;I<L;){if(x=a[I++],x===0&&p)return R;if(x===0||x===3)continue;switch(x>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:R+=String.fromCharCode(x);break;case 12:case 13:T=a[I++],R+=String.fromCharCode((x&31)<<6|T&63);break;case 14:T=a[I++],O=a[I++],R+=String.fromCharCode((x&15)<<12|(T&63)<<6|(O&63)<<0);break}}return R},n={decodeTextFrame:c},r;function l(){return!r&&typeof self.TextDecoder<"u"&&(r=new self.TextDecoder("utf-8")),r}},"./src/demux/mp3demuxer.ts":function(M,P,E){E.r(P);var b=E("./src/demux/base-audio-demuxer.ts"),u=E("./src/demux/id3.ts"),m=E("./src/utils/logger.ts"),D=E("./src/demux/mpegaudio.ts");function S(i,f){i.prototype=Object.create(f.prototype),i.prototype.constructor=i,g(i,f)}function g(i,f){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,c){return v.__proto__=c,v},g(i,f)}var d=function(i){S(f,i);function f(){return i.apply(this,arguments)||this}var o=f.prototype;return o.resetInitSegment=function(c,h,t,e){i.prototype.resetInitSegment.call(this,c,h,t,e),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:h,duration:e,inputTimeScale:9e4,dropped:0}},f.probe=function(c){if(!c)return!1;for(var h=u.getID3Data(c,0)||[],t=h.length,e=c.length;t<e;t++)if(D.probe(c,t))return m.logger.log("MPEG Audio sync word found !"),!0;return!1},o.canParse=function(c,h){return D.canParse(c,h)},o.appendFrame=function(c,h,t){if(this.basePTS!==null)return D.appendFrame(c,h,t,this.basePTS,this.frameIndex)},f}(b.default);d.minProbeByteLength=4,P.default=d},"./src/demux/mp4demuxer.ts":function(M,P,E){E.r(P);var b=E("./src/polyfills/number.ts"),u=E("./src/types/demuxer.ts"),m=E("./src/utils/mp4-tools.ts"),D=E("./src/demux/dummy-demuxed-track.ts"),S=/\/emsg[-/]ID3/i,g=function(){function d(f,o){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=o}var i=d.prototype;return i.resetTimeStamp=function(){},i.resetInitSegment=function(o,v,c,h){var t=Object(m.parseInitSegment)(o),e=this.videoTrack=Object(D.dummyTrack)("video",1),n=this.audioTrack=Object(D.dummyTrack)("audio",1),r=this.txtTrack=Object(D.dummyTrack)("text",1);if(this.id3Track=Object(D.dummyTrack)("id3",1),this.timeOffset=0,t.video){var l=t.video,s=l.id,a=l.timescale,p=l.codec;e.id=s,e.timescale=r.timescale=a,e.codec=p}if(t.audio){var A=t.audio,_=A.id,y=A.timescale,L=A.codec;n.id=_,n.timescale=y,n.codec=L}r.id=m.RemuxerTrackIdConfig.text,e.sampleDuration=0,e.duration=n.duration=h},i.resetContiguity=function(){},d.probe=function(o){return o=o.length>16384?o.subarray(0,16384):o,Object(m.findBox)(o,["moof"]).length>0},i.demux=function(o,v){this.timeOffset=v;var c=o,h=this.videoTrack,t=this.txtTrack;if(this.config.progressive){this.remainderData&&(c=Object(m.appendUint8Array)(this.remainderData,o));var e=Object(m.segmentValidRange)(c);this.remainderData=e.remainder,h.samples=e.valid||new Uint8Array}else h.samples=c;var n=this.extractID3Track(h,v);return t.samples=Object(m.parseSamples)(v,h),{videoTrack:h,audioTrack:this.audioTrack,id3Track:n,textTrack:this.txtTrack}},i.flush=function(){var o=this.timeOffset,v=this.videoTrack,c=this.txtTrack;v.samples=this.remainderData||new Uint8Array,this.remainderData=null;var h=this.extractID3Track(v,this.timeOffset);return c.samples=Object(m.parseSamples)(o,v),{videoTrack:v,audioTrack:Object(D.dummyTrack)(),id3Track:h,textTrack:Object(D.dummyTrack)()}},i.extractID3Track=function(o,v){var c=this.id3Track;if(o.samples.length){var h=Object(m.findBox)(o.samples,["emsg"]);h&&h.forEach(function(t){var e=Object(m.parseEmsg)(t);if(S.test(e.schemeIdUri)){var n=Object(b.isFiniteNumber)(e.presentationTime)?e.presentationTime/e.timeScale:v+e.presentationTimeDelta/e.timeScale,r=e.payload;c.samples.push({data:r,len:r.byteLength,dts:n,pts:n,type:u.MetadataSchema.emsg})}})}return c},i.demuxSampleAes=function(o,v,c){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},i.destroy=function(){},d}();g.minProbeByteLength=1024,P.default=g},"./src/demux/mpegaudio.ts":function(M,P,E){E.r(P),E.d(P,"appendFrame",function(){return g}),E.d(P,"parseHeader",function(){return d}),E.d(P,"isHeaderPattern",function(){return i}),E.d(P,"isHeader",function(){return f}),E.d(P,"canParse",function(){return o}),E.d(P,"probe",function(){return v});var b=null,u=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],m=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],D=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],S=[0,1,1,4];function g(c,h,t,e,n){if(!(t+24>h.length)){var r=d(h,t);if(r&&t+r.frameLength<=h.length){var l=r.samplesPerFrame*9e4/r.sampleRate,s=e+n*l,a={unit:h.subarray(t,t+r.frameLength),pts:s,dts:s};return c.config=[],c.channelCount=r.channelCount,c.samplerate=r.sampleRate,c.samples.push(a),{sample:a,length:r.frameLength,missing:0}}}}function d(c,h){var t=c[h+1]>>3&3,e=c[h+1]>>1&3,n=c[h+2]>>4&15,r=c[h+2]>>2&3;if(t!==1&&n!==0&&n!==15&&r!==3){var l=c[h+2]>>1&1,s=c[h+3]>>6,a=t===3?3-e:e===3?3:4,p=u[a*14+n-1]*1e3,A=t===3?0:t===2?1:2,_=m[A*3+r],y=s===3?1:2,L=D[t][e],x=S[e],T=L*8*x,O=Math.floor(L*p/_+l)*x;if(b===null){var R=navigator.userAgent||"",I=R.match(/Chrome\/(\d+)/i);b=I?parseInt(I[1]):0}var C=!!b&&b<=87;return C&&e===2&&p>=224e3&&s===0&&(c[h+3]=c[h+3]|128),{sampleRate:_,channelCount:y,frameLength:O,samplesPerFrame:T}}}function i(c,h){return c[h]===255&&(c[h+1]&224)===224&&(c[h+1]&6)!==0}function f(c,h){return h+1<c.length&&i(c,h)}function o(c,h){var t=4;return i(c,h)&&t<=c.length-h}function v(c,h){if(h+1<c.length&&i(c,h)){var t=4,e=d(c,h),n=t;e!=null&&e.frameLength&&(n=e.frameLength);var r=h+n;return r===c.length||f(c,r)}return!1}},"./src/demux/sample-aes.ts":function(M,P,E){E.r(P);var b=E("./src/crypt/decrypter.ts"),u=E("./src/demux/tsdemuxer.ts"),m=function(){function D(g,d,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new b.default(g,d,{removePKCS7Padding:!1})}var S=D.prototype;return S.decryptBuffer=function(d,i){this.decrypter.decrypt(d,this.keyData.key.buffer,this.keyData.iv.buffer,i)},S.decryptAacSample=function(d,i,f,o){var v=d[i].unit;if(!(v.length<=16)){var c=v.subarray(16,v.length-v.length%16),h=c.buffer.slice(c.byteOffset,c.byteOffset+c.length),t=this;this.decryptBuffer(h,function(e){var n=new Uint8Array(e);v.set(n,16),o||t.decryptAacSamples(d,i+1,f)})}},S.decryptAacSamples=function(d,i,f){for(;;i++){if(i>=d.length){f();return}if(!(d[i].unit.length<32)){var o=this.decrypter.isSync();if(this.decryptAacSample(d,i,f,o),!o)return}}},S.getAvcEncryptedData=function(d){for(var i=Math.floor((d.length-48)/160)*16+16,f=new Int8Array(i),o=0,v=32;v<d.length-16;v+=160,o+=16)f.set(d.subarray(v,v+16),o);return f},S.getAvcDecryptedUnit=function(d,i){for(var f=new Uint8Array(i),o=0,v=32;v<d.length-16;v+=160,o+=16)d.set(f.subarray(o,o+16),v);return d},S.decryptAvcSample=function(d,i,f,o,v,c){var h=Object(u.discardEPB)(v.data),t=this.getAvcEncryptedData(h),e=this;this.decryptBuffer(t.buffer,function(n){v.data=e.getAvcDecryptedUnit(h,n),c||e.decryptAvcSamples(d,i,f+1,o)})},S.decryptAvcSamples=function(d,i,f,o){if(d instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;i++,f=0){if(i>=d.length){o();return}for(var v=d[i].units;!(f>=v.length);f++){var c=v[f];if(!(c.data.length<=48||c.type!==1&&c.type!==5)){var h=this.decrypter.isSync();if(this.decryptAvcSample(d,i,f,o,c,h),!h)return}}}},D}();P.default=m},"./src/demux/transmuxer-interface.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return f});var b=E("./node_modules/webworkify-webpack/index.js"),u=E("./src/events.ts"),m=E("./src/demux/transmuxer.ts"),D=E("./src/utils/logger.ts"),S=E("./src/errors.ts"),g=E("./src/utils/mediasource-helper.ts"),d=E("./node_modules/eventemitter3/index.js"),i=Object(g.getMediaSource)()||{isTypeSupported:function(){return!1}},f=function(){function o(c,h,t,e){var n=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=c,this.id=h,this.onTransmuxComplete=t,this.onFlush=e;var r=c.config,l=function(_,y){y=y||{},y.frag=n.frag,y.id=n.id,c.trigger(_,y)};this.observer=new d.EventEmitter,this.observer.on(u.Events.FRAG_DECRYPTED,l),this.observer.on(u.Events.ERROR,l);var s={mp4:i.isTypeSupported("video/mp4"),mpeg:i.isTypeSupported("audio/mpeg"),mp3:i.isTypeSupported('audio/mp4; codecs="mp3"')},a=navigator.vendor;if(r.enableWorker&&typeof Worker<"u"){D.logger.log("demuxing in webworker");var p;try{p=this.worker=b("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),p.addEventListener("message",this.onwmsg),p.onerror=function(A){c.trigger(u.Events.ERROR,{type:S.ErrorTypes.OTHER_ERROR,details:S.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(A.message+"  ("+A.filename+":"+A.lineno+")")})},p.postMessage({cmd:"init",typeSupported:s,vendor:a,id:h,config:JSON.stringify(r)})}catch(A){D.logger.warn("Error in worker:",A),D.logger.error("Error while initializing DemuxerWorker, fallback to inline"),p&&self.URL.revokeObjectURL(p.objectURL),this.transmuxer=new m.default(this.observer,s,r,a,h),this.worker=null}}else this.transmuxer=new m.default(this.observer,s,r,a,h)}var v=o.prototype;return v.destroy=function(){var h=this.worker;if(h)h.removeEventListener("message",this.onwmsg),h.terminate(),this.worker=null,this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},v.push=function(h,t,e,n,r,l,s,a,p,A){var _,y,L=this;p.transmuxing.start=self.performance.now();var x=this.transmuxer,T=this.worker,O=l?l.start:r.start,R=r.decryptdata,I=this.frag,C=!(I&&r.cc===I.cc),w=!(I&&p.level===I.level),F=I?p.sn-I.sn:-1,B=this.part?p.part-this.part.index:-1,k=F===0&&p.id>1&&p.id===(I==null?void 0:I.stats.chunkCount),U=!w&&(F===1||F===0&&(B===1||k&&B<=0)),N=self.performance.now();(w||F||r.stats.parsing.start===0)&&(r.stats.parsing.start=N),l&&(B||!U)&&(l.stats.parsing.start=N);var j=!(I&&((_=r.initSegment)===null||_===void 0?void 0:_.url)===((y=I.initSegment)===null||y===void 0?void 0:y.url)),K=new m.TransmuxState(C,U,a,w,O,j);if(!U||C||j){D.logger.log("[transmuxer-interface, "+r.type+"]: Starting new transmux session for sn: "+p.sn+" p: "+p.part+" level: "+p.level+" id: "+p.id+`
        discontinuity: `+C+`
        trackSwitch: `+w+`
        contiguous: `+U+`
        accurateTimeOffset: `+a+`
        timeOffset: `+O+`
        initSegmentChange: `+j);var H=new m.TransmuxConfig(e,n,t,s,A);this.configureTransmuxer(H)}if(this.frag=r,this.part=l,T)T.postMessage({cmd:"demux",data:h,decryptdata:R,chunkMeta:p,state:K},h instanceof ArrayBuffer?[h]:[]);else if(x){var V=x.push(h,R,p,K);Object(m.isPromise)(V)?V.then(function(G){L.handleTransmuxComplete(G)}):this.handleTransmuxComplete(V)}},v.flush=function(h){var t=this;h.transmuxing.start=self.performance.now();var e=this.transmuxer,n=this.worker;if(n)n.postMessage({cmd:"flush",chunkMeta:h});else if(e){var r=e.flush(h);Object(m.isPromise)(r)?r.then(function(l){t.handleFlushResult(l,h)}):this.handleFlushResult(r,h)}},v.handleFlushResult=function(h,t){var e=this;h.forEach(function(n){e.handleTransmuxComplete(n)}),this.onFlush(t)},v.onWorkerMessage=function(h){var t=h.data,e=this.hls;switch(t.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(t.data);break}case"flush":{this.onFlush(t.data);break}case"workerLog":D.logger[t.data.logType]&&D.logger[t.data.logType](t.data.message);break;default:{t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,e.trigger(t.event,t.data);break}}},v.configureTransmuxer=function(h){var t=this.worker,e=this.transmuxer;t?t.postMessage({cmd:"configure",config:h}):e&&e.configure(h)},v.handleTransmuxComplete=function(h){h.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(h)},o}()},"./src/demux/transmuxer-worker.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return S});var b=E("./src/demux/transmuxer.ts"),u=E("./src/events.ts"),m=E("./src/utils/logger.ts"),D=E("./node_modules/eventemitter3/index.js");function S(o){var v=new D.EventEmitter,c=function(e,n){o.postMessage({event:e,data:n})};v.on(u.Events.FRAG_DECRYPTED,c),v.on(u.Events.ERROR,c);var h=function(){var e=function(l){var s=function(p){c("workerLog",{logType:l,message:p})};m.logger[l]=s};for(var n in m.logger)e(n)};o.addEventListener("message",function(t){var e=t.data;switch(e.cmd){case"init":{var n=JSON.parse(e.config);o.transmuxer=new b.default(v,e.typeSupported,n,e.vendor,e.id),Object(m.enableLogs)(n.debug),h(),c("init",null);break}case"configure":{o.transmuxer.configure(e.config);break}case"demux":{var r=o.transmuxer.push(e.data,e.decryptdata,e.chunkMeta,e.state);Object(b.isPromise)(r)?r.then(function(a){g(o,a)}):g(o,r);break}case"flush":{var l=e.chunkMeta,s=o.transmuxer.flush(l);Object(b.isPromise)(s)?s.then(function(a){i(o,a,l)}):i(o,s,l);break}}})}function g(o,v){if(f(v.remuxResult))return!1;var c=[],h=v.remuxResult,t=h.audio,e=h.video;return t&&d(c,t),e&&d(c,e),o.postMessage({event:"transmuxComplete",data:v},c),!0}function d(o,v){v.data1&&o.push(v.data1.buffer),v.data2&&o.push(v.data2.buffer)}function i(o,v,c){var h=v.reduce(function(t,e){return g(o,e)||t},!1);h||o.postMessage({event:"transmuxComplete",data:v[0]}),o.postMessage({event:"flush",data:c})}function f(o){return!o.audio&&!o.video&&!o.text&&!o.id3&&!o.initSegment}},"./src/demux/transmuxer.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return n}),E.d(P,"isPromise",function(){return s}),E.d(P,"TransmuxConfig",function(){return a}),E.d(P,"TransmuxState",function(){return p});var b=E("./src/events.ts"),u=E("./src/errors.ts"),m=E("./src/crypt/decrypter.ts"),D=E("./src/demux/aacdemuxer.ts"),S=E("./src/demux/mp4demuxer.ts"),g=E("./src/demux/tsdemuxer.ts"),d=E("./src/demux/mp3demuxer.ts"),i=E("./src/remux/mp4-remuxer.ts"),f=E("./src/remux/passthrough-remuxer.ts"),o=E("./src/demux/chunk-cache.ts"),v=E("./src/utils/mp4-tools.ts"),c=E("./src/utils/logger.ts"),h;try{h=self.performance.now.bind(self.performance)}catch{c.logger.debug("Unable to use Performance API on this environment"),h=self.Date.now}var t=[{demux:g.default,remux:i.default},{demux:S.default,remux:f.default},{demux:D.default,remux:i.default},{demux:d.default,remux:i.default}],e=1024;t.forEach(function(A){var _=A.demux;e=Math.max(e,_.minProbeByteLength)});var n=function(){function A(y,L,x,T,O){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new o.default,this.observer=y,this.typeSupported=L,this.config=x,this.vendor=T,this.id=O}var _=A.prototype;return _.configure=function(L){this.transmuxConfig=L,this.decrypter&&this.decrypter.reset()},_.push=function(L,x,T,O){var R=this,I=T.transmuxing;I.executeStart=h();var C=new Uint8Array(L),w=this.cache,F=this.config,B=this.currentTransmuxState,k=this.transmuxConfig;O&&(this.currentTransmuxState=O);var U=r(C,x);if(U&&U.method==="AES-128"){var N=this.getDecrypter();if(F.enableSoftwareAES){var j=N.softwareDecrypt(C,U.key.buffer,U.iv.buffer);if(!j)return I.executeEnd=h(),l(T);C=new Uint8Array(j)}else return this.decryptionPromise=N.webCryptoDecrypt(C,U.key.buffer,U.iv.buffer).then(function(oe){var de=R.push(oe,null,T);return R.decryptionPromise=null,de}),this.decryptionPromise}var K=O||B,H=K.contiguous,V=K.discontinuity,G=K.trackSwitch,ee=K.accurateTimeOffset,q=K.timeOffset,z=K.initSegmentChange,X=k.audioCodec,J=k.videoCodec,ie=k.defaultInitPts,ae=k.duration,se=k.initSegmentData;if((V||G||z)&&this.resetInitSegment(se,X,J,ae),(V||z)&&this.resetInitialTimestamp(ie),H||this.resetContiguity(),this.needsProbing(C,V,G)){if(w.dataLength){var le=w.flush();C=Object(v.appendUint8Array)(le,C)}this.configureTransmuxer(C,k)}var ue=this.transmux(C,U,q,ee,T),Z=this.currentTransmuxState;return Z.contiguous=!0,Z.discontinuity=!1,Z.trackSwitch=!1,I.executeEnd=h(),ue},_.flush=function(L){var x=this,T=L.transmuxing;T.executeStart=h();var O=this.decrypter,R=this.cache,I=this.currentTransmuxState,C=this.decryptionPromise;if(C)return C.then(function(){return x.flush(L)});var w=[],F=I.timeOffset;if(O){var B=O.flush();B&&w.push(this.push(B,null,L))}var k=R.dataLength;R.reset();var U=this.demuxer,N=this.remuxer;if(!U||!N)return k>=e&&this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),T.executeEnd=h(),[l(L)];var j=U.flush(F);return s(j)?j.then(function(K){return x.flushRemux(w,K,L),w}):(this.flushRemux(w,j,L),w)},_.flushRemux=function(L,x,T){var O=x.audioTrack,R=x.videoTrack,I=x.id3Track,C=x.textTrack,w=this.currentTransmuxState,F=w.accurateTimeOffset,B=w.timeOffset;c.logger.log("[transmuxer.ts]: Flushed fragment "+T.sn+(T.part>-1?" p: "+T.part:"")+" of level "+T.level);var k=this.remuxer.remux(O,R,I,C,B,F,!0,this.id);L.push({remuxResult:k,chunkMeta:T}),T.transmuxing.executeEnd=h()},_.resetInitialTimestamp=function(L){var x=this.demuxer,T=this.remuxer;!x||!T||(x.resetTimeStamp(L),T.resetTimeStamp(L))},_.resetContiguity=function(){var L=this.demuxer,x=this.remuxer;!L||!x||(L.resetContiguity(),x.resetNextTimestamp())},_.resetInitSegment=function(L,x,T,O){var R=this.demuxer,I=this.remuxer;!R||!I||(R.resetInitSegment(L,x,T,O),I.resetInitSegment(L,x,T))},_.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},_.transmux=function(L,x,T,O,R){var I;return x&&x.method==="SAMPLE-AES"?I=this.transmuxSampleAes(L,x,T,O,R):I=this.transmuxUnencrypted(L,T,O,R),I},_.transmuxUnencrypted=function(L,x,T,O){var R=this.demuxer.demux(L,x,!1,!this.config.progressive),I=R.audioTrack,C=R.videoTrack,w=R.id3Track,F=R.textTrack,B=this.remuxer.remux(I,C,w,F,x,T,!1,this.id);return{remuxResult:B,chunkMeta:O}},_.transmuxSampleAes=function(L,x,T,O,R){var I=this;return this.demuxer.demuxSampleAes(L,x,T).then(function(C){var w=I.remuxer.remux(C.audioTrack,C.videoTrack,C.id3Track,C.textTrack,T,O,!1,I.id);return{remuxResult:w,chunkMeta:R}})},_.configureTransmuxer=function(L,x){for(var T=this.config,O=this.observer,R=this.typeSupported,I=this.vendor,C=x.audioCodec,w=x.defaultInitPts,F=x.duration,B=x.initSegmentData,k=x.videoCodec,U,N=0,j=t.length;N<j;N++)if(t[N].demux.probe(L)){U=t[N];break}U||(c.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),U={demux:S.default,remux:f.default});var K=this.demuxer,H=this.remuxer,V=U.remux,G=U.demux;(!H||!(H instanceof V))&&(this.remuxer=new V(O,T,R,I)),(!K||!(K instanceof G))&&(this.demuxer=new G(O,T,R),this.probe=G.probe),this.resetInitSegment(B,C,k,F),this.resetInitialTimestamp(w)},_.needsProbing=function(L,x,T){return!this.demuxer||!this.remuxer||x||T},_.getDecrypter=function(){var L=this.decrypter;return L||(L=this.decrypter=new m.default(this.observer,this.config)),L},A}();function r(A,_){var y=null;return A.byteLength>0&&_!=null&&_.key!=null&&_.iv!==null&&_.method!=null&&(y=_),y}var l=function(_){return{remuxResult:{},chunkMeta:_}};function s(A){return"then"in A&&A.then instanceof Function}var a=function(_,y,L,x,T){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=_,this.videoCodec=y,this.initSegmentData=L,this.duration=x,this.defaultInitPts=T},p=function(_,y,L,x,T,O){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=_,this.contiguous=y,this.accurateTimeOffset=L,this.trackSwitch=x,this.timeOffset=T,this.initSegmentChange=O}},"./src/demux/tsdemuxer.ts":function(M,P,E){E.r(P),E.d(P,"discardEPB",function(){return r});var b=E("./src/demux/adts.ts"),u=E("./src/demux/mpegaudio.ts"),m=E("./src/demux/exp-golomb.ts"),D=E("./src/demux/sample-aes.ts"),S=E("./src/events.ts"),g=E("./src/utils/mp4-tools.ts"),d=E("./src/utils/logger.ts"),i=E("./src/errors.ts"),f=E("./src/types/demuxer.ts");function o(){return o=Object.assign?Object.assign.bind():function(l){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var p in a)Object.prototype.hasOwnProperty.call(a,p)&&(l[p]=a[p])}return l},o.apply(this,arguments)}var v=function(){function l(a,p,A){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=a,this.config=p,this.typeSupported=A}l.probe=function(p){var A=l.syncOffset(p);return A<0?!1:(A&&d.logger.warn("MPEG2-TS detected but first sync word found @ offset "+A+", junk ahead ?"),!0)},l.syncOffset=function(p){for(var A=Math.min(1e3,p.length-564),_=0;_<A;){if(p[_]===71&&p[_+188]===71&&p[_+2*188]===71)return _;_++}return-1},l.createTrack=function(p,A){return{container:p==="video"||p==="audio"?"video/mp2t":void 0,type:p,id:g.RemuxerTrackIdConfig[p],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:p==="audio"?A:void 0}};var s=l.prototype;return s.resetInitSegment=function(p,A,_,y){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=l.createTrack("video"),this._audioTrack=l.createTrack("audio",y),this._id3Track=l.createTrack("id3"),this._txtTrack=l.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.audioCodec=A,this.videoCodec=_,this._duration=y},s.resetTimeStamp=function(){},s.resetContiguity=function(){var p=this._audioTrack,A=this._avcTrack,_=this._id3Track;p&&(p.pesData=null),A&&(A.pesData=null),_&&(_.pesData=null),this.aacOverFlow=null},s.demux=function(p,A,_,y){_===void 0&&(_=!1),y===void 0&&(y=!1),_||(this.sampleAes=null);var L,x=this._avcTrack,T=this._audioTrack,O=this._id3Track,R=this._txtTrack,I=x.pid,C=x.pesData,w=T.pid,F=O.pid,B=T.pesData,k=O.pesData,U=!1,N=this.pmtParsed,j=this._pmtId,K=p.length;if(this.remainderData&&(p=Object(g.appendUint8Array)(this.remainderData,p),K=p.length,this.remainderData=null),K<188&&!y)return this.remainderData=p,{audioTrack:T,videoTrack:x,id3Track:O,textTrack:R};var H=Math.max(0,l.syncOffset(p));K-=(K+H)%188,K<p.byteLength&&!y&&(this.remainderData=new Uint8Array(p.buffer,K,p.buffer.byteLength-K));for(var V=0,G=H;G<K;G+=188)if(p[G]===71){var ee=!!(p[G+1]&64),q=((p[G+1]&31)<<8)+p[G+2],z=(p[G+3]&48)>>4,X=void 0;if(z>1){if(X=G+5+p[G+4],X===G+188)continue}else X=G+4;switch(q){case I:ee&&(C&&(L=e(C))&&this.parseAVCPES(x,R,L,!1),C={data:[],size:0}),C&&(C.data.push(p.subarray(X,G+188)),C.size+=G+188-X);break;case w:if(ee){if(B&&(L=e(B)))switch(T.segmentCodec){case"aac":this.parseAACPES(T,L);break;case"mp3":this.parseMPEGPES(T,L);break}B={data:[],size:0}}B&&(B.data.push(p.subarray(X,G+188)),B.size+=G+188-X);break;case F:ee&&(k&&(L=e(k))&&this.parseID3PES(O,L),k={data:[],size:0}),k&&(k.data.push(p.subarray(X,G+188)),k.size+=G+188-X);break;case 0:ee&&(X+=p[X]+1),j=this._pmtId=h(p,X);break;case j:{ee&&(X+=p[X]+1);var J=t(p,X,this.typeSupported,_);I=J.avc,I>0&&(x.pid=I),w=J.audio,w>0&&(T.pid=w,T.segmentCodec=J.segmentCodec),F=J.id3,F>0&&(O.pid=F),U&&!N&&(d.logger.log("reparse from beginning"),U=!1,G=H-188),N=this.pmtParsed=!0;break}case 17:case 8191:break;default:U=!0;break}}else V++;V>0&&this.observer.emit(S.Events.ERROR,S.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+V+" TS packet/s that do not start with 0x47"}),x.pesData=C,T.pesData=B,O.pesData=k;var ie={audioTrack:T,videoTrack:x,id3Track:O,textTrack:R};return y&&this.extractRemainingSamples(ie),ie},s.flush=function(){var p=this.remainderData;this.remainderData=null;var A;return p?A=this.demux(p,-1,!1,!0):A={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(A),this.sampleAes?this.decrypt(A,this.sampleAes):A},s.extractRemainingSamples=function(p){var A=p.audioTrack,_=p.videoTrack,y=p.id3Track,L=p.textTrack,x=_.pesData,T=A.pesData,O=y.pesData,R;if(x&&(R=e(x))?(this.parseAVCPES(_,L,R,!0),_.pesData=null):_.pesData=x,T&&(R=e(T))){switch(A.segmentCodec){case"aac":this.parseAACPES(A,R);break;case"mp3":this.parseMPEGPES(A,R);break}A.pesData=null}else T!=null&&T.size&&d.logger.log("last AAC PES packet truncated,might overlap between fragments"),A.pesData=T;O&&(R=e(O))?(this.parseID3PES(y,R),y.pesData=null):y.pesData=O},s.demuxSampleAes=function(p,A,_){var y=this.demux(p,_,!0,!this.config.progressive),L=this.sampleAes=new D.default(this.observer,this.config,A);return this.decrypt(y,L)},s.decrypt=function(p,A){return new Promise(function(_){var y=p.audioTrack,L=p.videoTrack;y.samples&&y.segmentCodec==="aac"?A.decryptAacSamples(y.samples,0,function(){L.samples?A.decryptAvcSamples(L.samples,0,0,function(){_(p)}):_(p)}):L.samples&&A.decryptAvcSamples(L.samples,0,0,function(){_(p)})})},s.destroy=function(){this._duration=0},s.parseAVCPES=function(p,A,_,y){var L=this,x=this.parseAVCNALu(p,_.data),T=this.avcSample,O,R=!1;_.data=null,T&&x.length&&!p.audFound&&(n(T,p),T=this.avcSample=c(!1,_.pts,_.dts,"")),x.forEach(function(I){switch(I.type){case 1:{O=!0,T||(T=L.avcSample=c(!0,_.pts,_.dts,"")),T.frame=!0;var C=I.data;if(R&&C.length>4){var w=new m.default(C).readSliceType();(w===2||w===4||w===7||w===9)&&(T.key=!0)}break}case 5:O=!0,T||(T=L.avcSample=c(!0,_.pts,_.dts,"")),T.key=!0,T.frame=!0;break;case 6:{O=!0,Object(g.parseSEIMessageFromNALu)(r(I.data),_.pts,A.samples);break}case 7:if(O=!0,R=!0,!p.sps){var F=new m.default(I.data),B=F.readSPS();p.width=B.width,p.height=B.height,p.pixelRatio=B.pixelRatio,p.sps=[I.data],p.duration=L._duration;for(var k=I.data.subarray(1,4),U="avc1.",N=0;N<3;N++){var j=k[N].toString(16);j.length<2&&(j="0"+j),U+=j}p.codec=U}break;case 8:O=!0,p.pps||(p.pps=[I.data]);break;case 9:O=!1,p.audFound=!0,T&&n(T,p),T=L.avcSample=c(!1,_.pts,_.dts,"");break;case 12:O=!0;break;default:O=!1,T&&(T.debug+="unknown NAL "+I.type+" ");break}if(T&&O){var K=T.units;K.push(I)}}),y&&T&&(n(T,p),this.avcSample=null)},s.getLastNalUnit=function(p){var A,_=this.avcSample,y;if((!_||_.units.length===0)&&(_=p[p.length-1]),(A=_)!==null&&A!==void 0&&A.units){var L=_.units;y=L[L.length-1]}return y},s.parseAVCNALu=function(p,A){var _=A.byteLength,y=p.naluState||0,L=y,x=[],T=0,O,R,I,C=-1,w=0;for(y===-1&&(C=0,w=A[0]&31,y=0,T=1);T<_;){if(O=A[T++],!y){y=O?0:1;continue}if(y===1){y=O?0:2;continue}if(!O)y=3;else if(O===1){if(C>=0){var F={data:A.subarray(C,T-y-1),type:w};x.push(F)}else{var B=this.getLastNalUnit(p.samples);if(B&&(L&&T<=4-L&&B.state&&(B.data=B.data.subarray(0,B.data.byteLength-L)),R=T-y-1,R>0)){var k=new Uint8Array(B.data.byteLength+R);k.set(B.data,0),k.set(A.subarray(0,R),B.data.byteLength),B.data=k,B.state=0}}T<_?(I=A[T]&31,C=T,w=I,y=0):y=-1}else y=0}if(C>=0&&y>=0){var U={data:A.subarray(C,_),type:w,state:y};x.push(U)}if(x.length===0){var N=this.getLastNalUnit(p.samples);if(N){var j=new Uint8Array(N.data.byteLength+A.byteLength);j.set(N.data,0),j.set(A,N.data.byteLength),N.data=j}}return p.naluState=y,x},s.parseAACPES=function(p,A){var _=0,y=this.aacOverFlow,L=A.data;if(y){this.aacOverFlow=null;var x=y.missing,T=y.sample.unit.byteLength;if(x===-1){var O=new Uint8Array(T+L.byteLength);O.set(y.sample.unit,0),O.set(L,T),L=O}else{var R=T-x;y.sample.unit.set(L.subarray(0,x),R),p.samples.push(y.sample),_=y.missing}}var I,C;for(I=_,C=L.length;I<C-1&&!b.isHeader(L,I);I++);if(I!==_){var w,F;if(I<C-1?(w="AAC PES did not start with ADTS header,offset:"+I,F=!1):(w="no ADTS header found in AAC PES",F=!0),d.logger.warn("parsing error:"+w),this.observer.emit(S.Events.ERROR,S.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:F,reason:w}),F)return}b.initTrackConfig(p,this.observer,L,I,this.audioCodec);var B;if(A.pts!==void 0)B=A.pts;else if(y){var k=b.getFrameDuration(p.samplerate);B=y.sample.pts+k}else{d.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var U=0,N;I<C;)if(N=b.appendFrame(p,L,I,B,U),I+=N.length,N.missing){this.aacOverFlow=N;break}else for(U++;I<C-1&&!b.isHeader(L,I);I++);},s.parseMPEGPES=function(p,A){var _=A.data,y=_.length,L=0,x=0,T=A.pts;if(T===void 0){d.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;x<y;)if(u.isHeader(_,x)){var O=u.appendFrame(p,_,x,T,L);if(O)x+=O.length,L++;else break}else x++},s.parseID3PES=function(p,A){if(A.pts===void 0){d.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var _=o({},A,{type:this._avcTrack?f.MetadataSchema.emsg:f.MetadataSchema.audioId3});p.samples.push(_)},l}();v.minProbeByteLength=188;function c(l,s,a,p){return{key:l,frame:!1,pts:s,dts:a,units:[],debug:p,length:0}}function h(l,s){return(l[s+10]&31)<<8|l[s+11]}function t(l,s,a,p){var A={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},_=(l[s+1]&15)<<8|l[s+2],y=s+3+_-4,L=(l[s+10]&15)<<8|l[s+11];for(s+=12+L;s<y;){var x=(l[s+1]&31)<<8|l[s+2];switch(l[s]){case 207:if(!p){d.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:A.audio===-1&&(A.audio=x);break;case 21:A.id3===-1&&(A.id3=x);break;case 219:if(!p){d.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:A.avc===-1&&(A.avc=x);break;case 3:case 4:a.mpeg!==!0&&a.mp3!==!0?d.logger.log("MPEG audio found, not supported in this browser"):A.audio===-1&&(A.audio=x,A.segmentCodec="mp3");break;case 36:d.logger.warn("Unsupported HEVC stream type found");break}s+=((l[s+3]&15)<<8|l[s+4])+5}return A}function e(l){var s=0,a,p,A,_,y,L=l.data;if(!l||l.size===0)return null;for(;L[0].length<19&&L.length>1;){var x=new Uint8Array(L[0].length+L[1].length);x.set(L[0]),x.set(L[1],L[0].length),L[0]=x,L.splice(1,1)}a=L[0];var T=(a[0]<<16)+(a[1]<<8)+a[2];if(T===1){if(p=(a[4]<<8)+a[5],p&&p>l.size-6)return null;var O=a[7];O&192&&(_=(a[9]&14)*536870912+(a[10]&255)*4194304+(a[11]&254)*16384+(a[12]&255)*128+(a[13]&254)/2,O&64?(y=(a[14]&14)*536870912+(a[15]&255)*4194304+(a[16]&254)*16384+(a[17]&255)*128+(a[18]&254)/2,_-y>60*9e4&&(d.logger.warn(Math.round((_-y)/9e4)+"s delta between PTS and DTS, align them"),_=y)):y=_),A=a[8];var R=A+9;if(l.size<=R)return null;l.size-=R;for(var I=new Uint8Array(l.size),C=0,w=L.length;C<w;C++){a=L[C];var F=a.byteLength;if(R)if(R>F){R-=F;continue}else a=a.subarray(R),F-=R,R=0;I.set(a,s),s+=F}return p&&(p-=A+3),{data:I,pts:_,dts:y,len:p}}return null}function n(l,s){if(l.units.length&&l.frame){if(l.pts===void 0){var a=s.samples,p=a.length;if(p){var A=a[p-1];l.pts=A.pts,l.dts=A.dts}else{s.dropped++;return}}s.samples.push(l)}l.debug.length&&d.logger.log(l.pts+"/"+l.dts+":"+l.debug)}function r(l){for(var s=l.byteLength,a=[],p=1;p<s-2;)l[p]===0&&l[p+1]===0&&l[p+2]===3?(a.push(p+2),p+=2):p++;if(a.length===0)return l;var A=s-a.length,_=new Uint8Array(A),y=0;for(p=0;p<A;y++,p++)y===a[0]&&(y++,a.shift()),_[p]=l[y];return _}P.default=v},"./src/errors.ts":function(M,P,E){E.r(P),E.d(P,"ErrorTypes",function(){return b}),E.d(P,"ErrorDetails",function(){return u});var b;(function(m){m.NETWORK_ERROR="networkError",m.MEDIA_ERROR="mediaError",m.KEY_SYSTEM_ERROR="keySystemError",m.MUX_ERROR="muxError",m.OTHER_ERROR="otherError"})(b||(b={}));var u;(function(m){m.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",m.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",m.KEY_SYSTEM_NO_SESSION="keySystemNoSession",m.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",m.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",m.MANIFEST_LOAD_ERROR="manifestLoadError",m.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",m.MANIFEST_PARSING_ERROR="manifestParsingError",m.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",m.LEVEL_EMPTY_ERROR="levelEmptyError",m.LEVEL_LOAD_ERROR="levelLoadError",m.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",m.LEVEL_SWITCH_ERROR="levelSwitchError",m.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",m.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",m.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",m.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",m.FRAG_LOAD_ERROR="fragLoadError",m.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",m.FRAG_DECRYPT_ERROR="fragDecryptError",m.FRAG_PARSING_ERROR="fragParsingError",m.REMUX_ALLOC_ERROR="remuxAllocError",m.KEY_LOAD_ERROR="keyLoadError",m.KEY_LOAD_TIMEOUT="keyLoadTimeOut",m.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",m.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",m.BUFFER_APPEND_ERROR="bufferAppendError",m.BUFFER_APPENDING_ERROR="bufferAppendingError",m.BUFFER_STALLED_ERROR="bufferStalledError",m.BUFFER_FULL_ERROR="bufferFullError",m.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",m.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",m.INTERNAL_EXCEPTION="internalException",m.INTERNAL_ABORTED="aborted",m.UNKNOWN="unknown"})(u||(u={}))},"./src/events.ts":function(M,P,E){E.r(P),E.d(P,"Events",function(){return b});var b;(function(u){u.MEDIA_ATTACHING="hlsMediaAttaching",u.MEDIA_ATTACHED="hlsMediaAttached",u.MEDIA_DETACHING="hlsMediaDetaching",u.MEDIA_DETACHED="hlsMediaDetached",u.BUFFER_RESET="hlsBufferReset",u.BUFFER_CODECS="hlsBufferCodecs",u.BUFFER_CREATED="hlsBufferCreated",u.BUFFER_APPENDING="hlsBufferAppending",u.BUFFER_APPENDED="hlsBufferAppended",u.BUFFER_EOS="hlsBufferEos",u.BUFFER_FLUSHING="hlsBufferFlushing",u.BUFFER_FLUSHED="hlsBufferFlushed",u.MANIFEST_LOADING="hlsManifestLoading",u.MANIFEST_LOADED="hlsManifestLoaded",u.MANIFEST_PARSED="hlsManifestParsed",u.LEVEL_SWITCHING="hlsLevelSwitching",u.LEVEL_SWITCHED="hlsLevelSwitched",u.LEVEL_LOADING="hlsLevelLoading",u.LEVEL_LOADED="hlsLevelLoaded",u.LEVEL_UPDATED="hlsLevelUpdated",u.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",u.LEVELS_UPDATED="hlsLevelsUpdated",u.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",u.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",u.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",u.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",u.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",u.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",u.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",u.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",u.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",u.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",u.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",u.CUES_PARSED="hlsCuesParsed",u.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",u.INIT_PTS_FOUND="hlsInitPtsFound",u.FRAG_LOADING="hlsFragLoading",u.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",u.FRAG_LOADED="hlsFragLoaded",u.FRAG_DECRYPTED="hlsFragDecrypted",u.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",u.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",u.FRAG_PARSING_METADATA="hlsFragParsingMetadata",u.FRAG_PARSED="hlsFragParsed",u.FRAG_BUFFERED="hlsFragBuffered",u.FRAG_CHANGED="hlsFragChanged",u.FPS_DROP="hlsFpsDrop",u.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",u.ERROR="hlsError",u.DESTROYING="hlsDestroying",u.KEY_LOADING="hlsKeyLoading",u.KEY_LOADED="hlsKeyLoaded",u.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",u.BACK_BUFFER_REACHED="hlsBackBufferReached"})(b||(b={}))},"./src/hls.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return r});var b=E("./node_modules/url-toolkit/src/url-toolkit.js"),u=E("./src/loader/playlist-loader.ts"),m=E("./src/loader/key-loader.ts"),D=E("./src/controller/id3-track-controller.ts"),S=E("./src/controller/latency-controller.ts"),g=E("./src/controller/level-controller.ts"),d=E("./src/controller/fragment-tracker.ts"),i=E("./src/controller/stream-controller.ts"),f=E("./src/is-supported.ts"),o=E("./src/utils/logger.ts"),v=E("./src/config.ts"),c=E("./node_modules/eventemitter3/index.js"),h=E("./src/events.ts"),t=E("./src/errors.ts");function e(l,s){for(var a=0;a<s.length;a++){var p=s[a];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(l,p.key,p)}}function n(l,s,a){return s&&e(l.prototype,s),a&&e(l,a),Object.defineProperty(l,"prototype",{writable:!1}),l}var r=function(){l.isSupported=function(){return Object(f.isSupported)()};function l(a){a===void 0&&(a={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new c.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var p=this.config=Object(v.mergeConfig)(l.DefaultConfig,a);this.userConfig=a,Object(o.enableLogs)(p.debug),this._autoLevelCapping=-1,p.progressive&&Object(v.enableStreamingMode)(p);var A=p.abrController,_=p.bufferController,y=p.capLevelController,L=p.fpsController,x=this.abrController=new A(this),T=this.bufferController=new _(this),O=this.capLevelController=new y(this),R=new L(this),I=new u.default(this),C=new m.default(this),w=new D.default(this),F=this.levelController=new g.default(this),B=new d.FragmentTracker(this),k=this.streamController=new i.default(this,B);O.setStreamController(k),R.setStreamController(k);var U=[F,k];this.networkControllers=U;var N=[I,C,x,T,O,R,w,B];this.audioTrackController=this.createController(p.audioTrackController,null,U),this.createController(p.audioStreamController,B,U),this.subtitleTrackController=this.createController(p.subtitleTrackController,null,U),this.createController(p.subtitleStreamController,B,U),this.createController(p.timelineController,null,N),this.emeController=this.createController(p.emeController,null,N),this.cmcdController=this.createController(p.cmcdController,null,N),this.latencyController=this.createController(S.default,null,N),this.coreComponents=N}var s=l.prototype;return s.createController=function(p,A,_){if(p){var y=A?new p(this,A):new p(this);return _&&_.push(y),y}return null},s.on=function(p,A,_){_===void 0&&(_=this),this._emitter.on(p,A,_)},s.once=function(p,A,_){_===void 0&&(_=this),this._emitter.once(p,A,_)},s.removeAllListeners=function(p){this._emitter.removeAllListeners(p)},s.off=function(p,A,_,y){_===void 0&&(_=this),this._emitter.off(p,A,_,y)},s.listeners=function(p){return this._emitter.listeners(p)},s.emit=function(p,A,_){return this._emitter.emit(p,A,_)},s.trigger=function(p,A){if(this.config.debug)return this.emit(p,p,A);try{return this.emit(p,p,A)}catch(_){o.logger.error("An internal error happened while handling event "+p+'. Error message: "'+_.message+'". Here is a stacktrace:',_),this.trigger(h.Events.ERROR,{type:t.ErrorTypes.OTHER_ERROR,details:t.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:p,error:_})}return!1},s.listenerCount=function(p){return this._emitter.listenerCount(p)},s.destroy=function(){o.logger.log("destroy"),this.trigger(h.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(p){return p.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(p){return p.destroy()}),this.coreComponents.length=0},s.attachMedia=function(p){o.logger.log("attachMedia"),this._media=p,this.trigger(h.Events.MEDIA_ATTACHING,{media:p})},s.detachMedia=function(){o.logger.log("detachMedia"),this.trigger(h.Events.MEDIA_DETACHING,void 0),this._media=null},s.loadSource=function(p){this.stopLoad();var A=this.media,_=this.url,y=this.url=b.buildAbsoluteURL(self.location.href,p,{alwaysNormalize:!0});o.logger.log("loadSource:"+y),A&&_&&_!==y&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(A)),this.trigger(h.Events.MANIFEST_LOADING,{url:p})},s.startLoad=function(p){p===void 0&&(p=-1),o.logger.log("startLoad("+p+")"),this.networkControllers.forEach(function(A){A.startLoad(p)})},s.stopLoad=function(){o.logger.log("stopLoad"),this.networkControllers.forEach(function(p){p.stopLoad()})},s.swapAudioCodec=function(){o.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},s.recoverMediaError=function(){o.logger.log("recoverMediaError");var p=this._media;this.detachMedia(),p&&this.attachMedia(p)},s.removeLevel=function(p,A){A===void 0&&(A=0),this.levelController.removeLevel(p,A)},n(l,[{key:"levels",get:function(){var p=this.levelController.levels;return p||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(p){o.logger.log("set currentLevel:"+p),this.loadLevel=p,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(p){o.logger.log("set nextLevel:"+p),this.levelController.manualLevel=p,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(p){o.logger.log("set loadLevel:"+p),this.levelController.manualLevel=p}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(p){this.levelController.nextLoadLevel=p}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(p){o.logger.log("set firstLevel:"+p),this.levelController.firstLevel=p}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(p){o.logger.log("set startLevel:"+p),p!==-1&&(p=Math.max(p,this.minAutoLevel)),this.levelController.startLevel=p}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(p){var A=!!p;A!==this.config.capLevelToPlayerSize&&(A?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=A)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(p){this._autoLevelCapping!==p&&(o.logger.log("set autoLevelCapping:"+p),this._autoLevelCapping=p)}},{key:"bandwidthEstimate",get:function(){var p=this.abrController.bwEstimator;return p?p.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var p=this.levels,A=this.config.minAutoBitrate;if(!p)return 0;for(var _=p.length,y=0;y<_;y++)if(p[y].maxBitrate>=A)return y;return 0}},{key:"maxAutoLevel",get:function(){var p=this.levels,A=this.autoLevelCapping,_;return A===-1&&p&&p.length?_=p.length-1:_=A,_}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(p){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,p)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var p=this.audioTrackController;return p?p.audioTracks:[]}},{key:"audioTrack",get:function(){var p=this.audioTrackController;return p?p.audioTrack:-1},set:function(p){var A=this.audioTrackController;A&&(A.audioTrack=p)}},{key:"subtitleTracks",get:function(){var p=this.subtitleTrackController;return p?p.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var p=this.subtitleTrackController;return p?p.subtitleTrack:-1},set:function(p){var A=this.subtitleTrackController;A&&(A.subtitleTrack=p)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var p=this.subtitleTrackController;return p?p.subtitleDisplay:!1},set:function(p){var A=this.subtitleTrackController;A&&(A.subtitleDisplay=p)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(p){this.config.lowLatencyMode=p}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.1"}},{key:"Events",get:function(){return h.Events}},{key:"ErrorTypes",get:function(){return t.ErrorTypes}},{key:"ErrorDetails",get:function(){return t.ErrorDetails}},{key:"DefaultConfig",get:function(){return l.defaultConfig?l.defaultConfig:v.hlsDefaultConfig},set:function(p){l.defaultConfig=p}}]),l}();r.defaultConfig=void 0},"./src/is-supported.ts":function(M,P,E){E.r(P),E.d(P,"isSupported",function(){return m}),E.d(P,"changeTypeSupported",function(){return D});var b=E("./src/utils/mediasource-helper.ts");function u(){return self.SourceBuffer||self.WebKitSourceBuffer}function m(){var S=Object(b.getMediaSource)();if(!S)return!1;var g=u(),d=S&&typeof S.isTypeSupported=="function"&&S.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!g||g.prototype&&typeof g.prototype.appendBuffer=="function"&&typeof g.prototype.remove=="function";return!!d&&!!i}function D(){var S,g=u();return typeof(g==null||(S=g.prototype)===null||S===void 0?void 0:S.changeType)=="function"}},"./src/loader/date-range.ts":function(M,P,E){E.r(P),E.d(P,"DateRangeAttribute",function(){return d}),E.d(P,"DateRange",function(){return i});var b=E("./src/polyfills/number.ts"),u=E("./src/utils/attr-list.ts"),m=E("./src/utils/logger.ts");function D(){return D=Object.assign?Object.assign.bind():function(f){for(var o=1;o<arguments.length;o++){var v=arguments[o];for(var c in v)Object.prototype.hasOwnProperty.call(v,c)&&(f[c]=v[c])}return f},D.apply(this,arguments)}function S(f,o){for(var v=0;v<o.length;v++){var c=o[v];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(f,c.key,c)}}function g(f,o,v){return o&&S(f.prototype,o),v&&S(f,v),Object.defineProperty(f,"prototype",{writable:!1}),f}var d;(function(f){f.ID="ID",f.CLASS="CLASS",f.START_DATE="START-DATE",f.DURATION="DURATION",f.END_DATE="END-DATE",f.END_ON_NEXT="END-ON-NEXT",f.PLANNED_DURATION="PLANNED-DURATION",f.SCTE35_OUT="SCTE35-OUT",f.SCTE35_IN="SCTE35-IN"})(d||(d={}));var i=function(){function f(o,v){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,v){var c=v.attr;for(var h in c)if(Object.prototype.hasOwnProperty.call(o,h)&&o[h]!==c[h]){m.logger.warn('DATERANGE tag attribute: "'+h+'" does not match for tags with ID: "'+o.ID+'"'),this._badValueForSameId=h;break}o=D(new u.AttrList({}),c,o)}if(this.attr=o,this._startDate=new Date(o[d.START_DATE]),d.END_DATE in this.attr){var t=new Date(this.attr[d.END_DATE]);Object(b.isFiniteNumber)(t.getTime())&&(this._endDate=t)}}return g(f,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var v=this.duration;return v!==null?new Date(this._startDate.getTime()+v*1e3):null}},{key:"duration",get:function(){if(d.DURATION in this.attr){var v=this.attr.decimalFloatingPoint(d.DURATION);if(Object(b.isFiniteNumber)(v))return v}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return d.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(d.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(d.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(b.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),f}()},"./src/loader/fragment-loader.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return v}),E.d(P,"LoadError",function(){return h});var b=E("./src/polyfills/number.ts"),u=E("./src/errors.ts");function m(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,i(t,e)}function D(t){var e=typeof Map=="function"?new Map:void 0;return D=function(r){if(r===null||!d(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,l)}function l(){return S(r,arguments,f(this).constructor)}return l.prototype=Object.create(r.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),i(l,r)},D(t)}function S(t,e,n){return g()?S=Reflect.construct.bind():S=function(l,s,a){var p=[null];p.push.apply(p,s);var A=Function.bind.apply(l,p),_=new A;return a&&i(_,a.prototype),_},S.apply(null,arguments)}function g(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function d(t){return Function.toString.call(t).indexOf("[native code]")!==-1}function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r},i(t,e)}function f(t){return f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},f(t)}var o=Math.pow(2,17),v=function(){function t(n){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=n}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(r,l){var s=this,a=r.url;if(!a)return Promise.reject(new h({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,networkDetails:null},"Fragment does not have a "+(a?"part list":"url")));this.abort();var p=this.config,A=p.fLoader,_=p.loader;return new Promise(function(y,L){s.loader&&s.loader.destroy();var x=s.loader=r.loader=A?new A(p):new _(p),T=c(r),O={timeout:p.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:p.fragLoadingMaxRetryTimeout,highWaterMark:r.sn==="initSegment"?1/0:o};r.stats=x.stats,x.load(T,O,{onSuccess:function(I,C,w,F){s.resetLoader(r,x),y({frag:r,part:null,payload:I.data,networkDetails:F})},onError:function(I,C,w){s.resetLoader(r,x),L(new h({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,response:I,networkDetails:w}))},onAbort:function(I,C,w){s.resetLoader(r,x),L(new h({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:r,networkDetails:w}))},onTimeout:function(I,C,w){s.resetLoader(r,x),L(new h({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,networkDetails:w}))},onProgress:function(I,C,w,F){l&&l({frag:r,part:null,payload:w,networkDetails:F})}})})},e.loadPart=function(r,l,s){var a=this;this.abort();var p=this.config,A=p.fLoader,_=p.loader;return new Promise(function(y,L){a.loader&&a.loader.destroy();var x=a.loader=r.loader=A?new A(p):new _(p),T=c(r,l),O={timeout:p.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:p.fragLoadingMaxRetryTimeout,highWaterMark:o};l.stats=x.stats,x.load(T,O,{onSuccess:function(I,C,w,F){a.resetLoader(r,x),a.updateStatsFromPart(r,l);var B={frag:r,part:l,payload:I.data,networkDetails:F};s(B),y(B)},onError:function(I,C,w){a.resetLoader(r,x),L(new h({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r,part:l,response:I,networkDetails:w}))},onAbort:function(I,C,w){r.stats.aborted=l.stats.aborted,a.resetLoader(r,x),L(new h({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:r,part:l,networkDetails:w}))},onTimeout:function(I,C,w){a.resetLoader(r,x),L(new h({type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r,part:l,networkDetails:w}))}})})},e.updateStatsFromPart=function(r,l){var s=r.stats,a=l.stats,p=a.total;if(s.loaded+=a.loaded,p){var A=Math.round(r.duration/l.duration),_=Math.min(Math.round(s.loaded/p),A),y=A-_,L=y*Math.round(s.loaded/_);s.total=s.loaded+L}else s.total=Math.max(s.loaded,s.total);var x=s.loading,T=a.loading;x.start?x.first+=T.first-T.start:(x.start=T.start,x.first=T.first),x.end=T.end},e.resetLoader=function(r,l){r.loader=null,this.loader===l&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),l.destroy()},t}();function c(t,e){e===void 0&&(e=null);var n=e||t,r={frag:t,part:e,responseType:"arraybuffer",url:n.url,headers:{},rangeStart:0,rangeEnd:0},l=n.byteRangeStartOffset,s=n.byteRangeEndOffset;return Object(b.isFiniteNumber)(l)&&Object(b.isFiniteNumber)(s)&&(r.rangeStart=l,r.rangeEnd=s),r}var h=function(t){m(e,t);function e(n){for(var r,l=arguments.length,s=new Array(l>1?l-1:0),a=1;a<l;a++)s[a-1]=arguments[a];return r=t.call.apply(t,[this].concat(s))||this,r.data=void 0,r.data=n,r}return e}(D(Error))},"./src/loader/fragment.ts":function(M,P,E){E.r(P),E.d(P,"ElementaryStreamTypes",function(){return o}),E.d(P,"BaseSegment",function(){return v}),E.d(P,"Fragment",function(){return c}),E.d(P,"Part",function(){return h});var b=E("./src/polyfills/number.ts"),u=E("./node_modules/url-toolkit/src/url-toolkit.js"),m=E("./src/utils/logger.ts"),D=E("./src/loader/level-key.ts"),S=E("./src/loader/load-stats.ts");function g(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,d(t,e)}function d(t,e){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,l){return r.__proto__=l,r},d(t,e)}function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var o;(function(t){t.AUDIO="audio",t.VIDEO="video",t.AUDIOVIDEO="audiovideo"})(o||(o={}));var v=function(){function t(n){var r;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(r={},r[o.AUDIO]=null,r[o.VIDEO]=null,r[o.AUDIOVIDEO]=null,r),this.baseurl=n}var e=t.prototype;return e.setByteRange=function(r,l){var s=r.split("@",2),a=[];s.length===1?a[0]=l?l.byteRangeEndOffset:0:a[0]=parseInt(s[1]),a[1]=parseInt(s[0])+a[0],this._byteRange=a},f(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(u.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(r){this._url=r}}]),t}(),c=function(t){g(e,t);function e(r,l){var s;return s=t.call(this,l)||this,s._decryptdata=null,s.rawProgramDateTime=null,s.programDateTime=null,s.tagList=[],s.duration=0,s.sn=0,s.levelkey=void 0,s.type=void 0,s.loader=null,s.level=-1,s.cc=0,s.startPTS=void 0,s.endPTS=void 0,s.appendedPTS=void 0,s.startDTS=void 0,s.endDTS=void 0,s.start=0,s.deltaPTS=void 0,s.maxStartPTS=void 0,s.minEndPTS=void 0,s.stats=new S.LoadStats,s.urlId=0,s.data=void 0,s.bitrateTest=!1,s.title=null,s.initSegment=null,s.type=r,s}var n=e.prototype;return n.createInitializationVector=function(l){for(var s=new Uint8Array(16),a=12;a<16;a++)s[a]=l>>8*(15-a)&255;return s},n.setDecryptDataFromLevelKey=function(l,s){var a=l;return(l==null?void 0:l.method)==="AES-128"&&l.uri&&!l.iv&&(a=D.LevelKey.fromURI(l.uri),a.method=l.method,a.iv=this.createInitializationVector(s),a.keyFormat="identity"),a},n.setElementaryStreamInfo=function(l,s,a,p,A,_){_===void 0&&(_=!1);var y=this.elementaryStreams,L=y[l];if(!L){y[l]={startPTS:s,endPTS:a,startDTS:p,endDTS:A,partial:_};return}L.startPTS=Math.min(L.startPTS,s),L.endPTS=Math.max(L.endPTS,a),L.startDTS=Math.min(L.startDTS,p),L.endDTS=Math.max(L.endDTS,A)},n.clearElementaryStreamInfo=function(){var l=this.elementaryStreams;l[o.AUDIO]=null,l[o.VIDEO]=null,l[o.AUDIOVIDEO]=null},f(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var l=this.sn;typeof l!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&m.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),l=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,l)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(b.isFiniteNumber)(this.programDateTime))return null;var l=Object(b.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+l*1e3}},{key:"encrypted",get:function(){var l;return!!((l=this.decryptdata)!==null&&l!==void 0&&l.keyFormat&&this.decryptdata.uri)}}]),e}(v),h=function(t){g(e,t);function e(n,r,l,s,a){var p;p=t.call(this,l)||this,p.fragOffset=0,p.duration=0,p.gap=!1,p.independent=!1,p.relurl=void 0,p.fragment=void 0,p.index=void 0,p.stats=new S.LoadStats,p.duration=n.decimalFloatingPoint("DURATION"),p.gap=n.bool("GAP"),p.independent=n.bool("INDEPENDENT"),p.relurl=n.enumeratedString("URI"),p.fragment=r,p.index=s;var A=n.enumeratedString("BYTERANGE");return A&&p.setByteRange(A,a),a&&(p.fragOffset=a.fragOffset+a.duration),p}return f(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var r=this.elementaryStreams;return!!(r.audio||r.video||r.audiovideo)}}]),e}(v)},"./src/loader/key-loader.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return D});var b=E("./src/events.ts"),u=E("./src/errors.ts"),m=E("./src/utils/logger.ts"),D=function(){function S(d){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=d,this._registerListeners()}var g=S.prototype;return g._registerListeners=function(){this.hls.on(b.Events.KEY_LOADING,this.onKeyLoading,this)},g._unregisterListeners=function(){this.hls.off(b.Events.KEY_LOADING,this.onKeyLoading)},g.destroy=function(){this._unregisterListeners();for(var i in this.loaders){var f=this.loaders[i];f&&f.destroy()}this.loaders={}},g.onKeyLoading=function(i,f){var o=f.frag,v=o.type,c=this.loaders[v];if(!o.decryptdata){m.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var h=o.decryptdata.uri;if(h!==this.decrypturl||this.decryptkey===null){var t=this.hls.config;if(c&&(m.logger.warn("abort previous key loader for type:"+v),c.abort()),!h){m.logger.warn("key uri is falsy");return}var e=t.loader,n=o.loader=this.loaders[v]=new e(t);this.decrypturl=h,this.decryptkey=null;var r={url:h,frag:o,responseType:"arraybuffer"},l={timeout:t.fragLoadingTimeOut,maxRetry:0,retryDelay:t.fragLoadingRetryDelay,maxRetryDelay:t.fragLoadingMaxRetryTimeout,highWaterMark:0},s={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};n.load(r,l,s)}else this.decryptkey&&(o.decryptdata.key=this.decryptkey,this.hls.trigger(b.Events.KEY_LOADED,{frag:o}))},g.loadsuccess=function(i,f,o){var v=o.frag;if(!v.decryptdata){m.logger.error("after key load, decryptdata unset");return}this.decryptkey=v.decryptdata.key=new Uint8Array(i.data),v.loader=null,delete this.loaders[v.type],this.hls.trigger(b.Events.KEY_LOADED,{frag:v})},g.loaderror=function(i,f){var o=f.frag,v=o.loader;v&&v.abort(),delete this.loaders[o.type],this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:o,response:i})},g.loadtimeout=function(i,f){var o=f.frag,v=o.loader;v&&v.abort(),delete this.loaders[o.type],this.hls.trigger(b.Events.ERROR,{type:u.ErrorTypes.NETWORK_ERROR,details:u.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:o})},S}()},"./src/loader/level-details.ts":function(M,P,E){E.r(P),E.d(P,"LevelDetails",function(){return S});var b=E("./src/polyfills/number.ts");function u(g,d){for(var i=0;i<d.length;i++){var f=d[i];f.enumerable=f.enumerable||!1,f.configurable=!0,"value"in f&&(f.writable=!0),Object.defineProperty(g,f.key,f)}}function m(g,d,i){return d&&u(g.prototype,d),i&&u(g,i),Object.defineProperty(g,"prototype",{writable:!1}),g}var D=10,S=function(){function g(i){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=i}var d=g.prototype;return d.reloaded=function(f){if(!f){this.advanced=!0,this.updated=!0;return}var o=this.lastPartSn-f.lastPartSn,v=this.lastPartIndex-f.lastPartIndex;this.updated=this.endSN!==f.endSN||!!v||!!o,this.advanced=this.endSN>f.endSN||o>0||o===0&&v>0,this.updated||this.advanced?this.misses=Math.floor(f.misses*.6):this.misses=f.misses+1,this.availabilityDelay=f.availabilityDelay},m(g,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(b.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||D}},{key:"drift",get:function(){var f=this.driftEndTime-this.driftStartTime;if(f>0){var o=this.driftEnd-this.driftStart;return o*1e3/f}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var f;return(f=this.partList)!==null&&f!==void 0&&f.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var f;return(f=this.fragments)!==null&&f!==void 0&&f.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var f;return(f=this.partList)!==null&&f!==void 0&&f.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var f;return(f=this.partList)!==null&&f!==void 0&&f.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),g}()},"./src/loader/level-key.ts":function(M,P,E){E.r(P),E.d(P,"LevelKey",function(){return D});var b=E("./node_modules/url-toolkit/src/url-toolkit.js");function u(S,g){for(var d=0;d<g.length;d++){var i=g[d];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(S,i.key,i)}}function m(S,g,d){return g&&u(S.prototype,g),d&&u(S,d),Object.defineProperty(S,"prototype",{writable:!1}),S}var D=function(){S.fromURL=function(d,i){return new S(d,i)},S.fromURI=function(d){return new S(d)};function S(g,d){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,d?this._uri=Object(b.buildAbsoluteURL)(g,d,{alwaysNormalize:!0}):this._uri=g}return m(S,[{key:"uri",get:function(){return this._uri}}]),S}()},"./src/loader/load-stats.ts":function(M,P,E){E.r(P),E.d(P,"LoadStats",function(){return b});var b=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return n});var b=E("./src/polyfills/number.ts"),u=E("./node_modules/url-toolkit/src/url-toolkit.js"),m=E("./src/loader/date-range.ts"),D=E("./src/loader/fragment.ts"),S=E("./src/loader/level-details.ts"),g=E("./src/loader/level-key.ts"),d=E("./src/utils/attr-list.ts"),i=E("./src/utils/logger.ts"),f=E("./src/utils/codecs.ts"),o=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,v=/#EXT-X-MEDIA:(.*)/g,c=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),h=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),t=/\.(mp4|m4s|m4v|m4a)$/i;function e(A){var _,y;return t.test((_=(y=u.parseURL(A))===null||y===void 0?void 0:y.path)!=null?_:"")}var n=function(){function A(){}return A.findGroup=function(y,L){for(var x=0;x<y.length;x++){var T=y[x];if(T.id===L)return T}},A.convertAVC1ToAVCOTI=function(y){var L=y.split(".");if(L.length>2){var x=L.shift()+".";return x+=parseInt(L.shift()).toString(16),x+=("000"+parseInt(L.shift()).toString(16)).slice(-4),x}return y},A.resolve=function(y,L){return u.buildAbsoluteURL(L,y,{alwaysNormalize:!0})},A.parseMasterPlaylist=function(y,L){var x=[],T={},O=!1;o.lastIndex=0;for(var R;(R=o.exec(y))!=null;)if(R[1]){var I=new d.AttrList(R[1]),C={attrs:I,bitrate:I.decimalInteger("AVERAGE-BANDWIDTH")||I.decimalInteger("BANDWIDTH"),name:I.NAME,url:A.resolve(R[2],L)},w=I.decimalResolution("RESOLUTION");w&&(C.width=w.width,C.height=w.height),r((I.CODECS||"").split(/[ ,]+/).filter(function(B){return B}),C),C.videoCodec&&C.videoCodec.indexOf("avc1")!==-1&&(C.videoCodec=A.convertAVC1ToAVCOTI(C.videoCodec)),x.push(C)}else if(R[3]){var F=new d.AttrList(R[3]);F["DATA-ID"]&&(O=!0,T[F["DATA-ID"]]=F)}return{levels:x,sessionData:O?T:null}},A.parseMasterPlaylistMedia=function(y,L,x,T){T===void 0&&(T=[]);var O,R=[],I=0;for(v.lastIndex=0;(O=v.exec(y))!==null;){var C=new d.AttrList(O[1]);if(C.TYPE===x){var w={attrs:C,bitrate:0,id:I++,groupId:C["GROUP-ID"],instreamId:C["INSTREAM-ID"],name:C.NAME||C.LANGUAGE||"",type:x,default:C.bool("DEFAULT"),autoselect:C.bool("AUTOSELECT"),forced:C.bool("FORCED"),lang:C.LANGUAGE,url:C.URI?A.resolve(C.URI,L):""};if(T.length){var F=A.findGroup(T,w.groupId)||T[0];l(w,F,"audioCodec"),l(w,F,"textCodec")}R.push(w)}}return R},A.parseLevelPlaylist=function(y,L,x,T,O){var R=new S.LevelDetails(L),I=R.fragments,C=null,w=0,F=0,B=0,k=0,U=null,N=new D.Fragment(T,L),j,K,H,V=-1,G=!1;for(c.lastIndex=0,R.m3u8=y;(j=c.exec(y))!==null;){G&&(G=!1,N=new D.Fragment(T,L),N.start=B,N.sn=w,N.cc=k,N.level=x,C&&(N.initSegment=C,N.rawProgramDateTime=C.rawProgramDateTime,C.rawProgramDateTime=null));var ee=j[1];if(ee){N.duration=parseFloat(ee);var q=(" "+j[2]).slice(1);N.title=q||null,N.tagList.push(q?["INF",ee,q]:["INF",ee])}else if(j[3])Object(b.isFiniteNumber)(N.duration)&&(N.start=B,H&&(N.levelkey=H),N.sn=w,N.level=x,N.cc=k,N.urlId=O,I.push(N),N.relurl=(" "+j[3]).slice(1),a(N,U),U=N,B+=N.duration,w++,F=0,G=!0);else if(j[4]){var z=(" "+j[4]).slice(1);U?N.setByteRange(z,U):N.setByteRange(z)}else if(j[5])N.rawProgramDateTime=(" "+j[5]).slice(1),N.tagList.push(["PROGRAM-DATE-TIME",N.rawProgramDateTime]),V===-1&&(V=I.length);else{if(j=j[0].match(h),!j){i.logger.warn("No matches on slow regex match for level playlist!");continue}for(K=1;K<j.length&&!(typeof j[K]<"u");K++);var X=(" "+j[K]).slice(1),J=(" "+j[K+1]).slice(1),ie=j[K+2]?(" "+j[K+2]).slice(1):"";switch(X){case"PLAYLIST-TYPE":R.type=J.toUpperCase();break;case"MEDIA-SEQUENCE":w=R.startSN=parseInt(J);break;case"SKIP":{var ae=new d.AttrList(J),se=ae.decimalInteger("SKIPPED-SEGMENTS");if(Object(b.isFiniteNumber)(se)){R.skippedSegments=se;for(var le=se;le--;)I.unshift(null);w+=se}var ue=ae.enumeratedString("RECENTLY-REMOVED-DATERANGES");ue&&(R.recentlyRemovedDateranges=ue.split("	"));break}case"TARGETDURATION":R.targetduration=parseFloat(J);break;case"VERSION":R.version=parseInt(J);break;case"EXTM3U":break;case"ENDLIST":R.live=!1;break;case"#":(J||ie)&&N.tagList.push(ie?[J,ie]:[J]);break;case"DISCONTINUITY":k++,N.tagList.push(["DIS"]);break;case"GAP":N.tagList.push([X]);break;case"BITRATE":N.tagList.push([X,J]);break;case"DATERANGE":{var Z=new d.AttrList(J),oe=new m.DateRange(Z,R.dateRanges[Z.ID]);oe.isValid||R.skippedSegments?R.dateRanges[oe.id]=oe:i.logger.warn('Ignoring invalid DATERANGE tag: "'+J+'"'),N.tagList.push(["EXT-X-DATERANGE",J]);break}case"DISCONTINUITY-SEQUENCE":k=parseInt(J);break;case"KEY":{var de,ce=new d.AttrList(J),ve=ce.enumeratedString("METHOD"),he=ce.URI,ye=ce.hexadecimalInteger("IV"),fe=ce.enumeratedString("KEYFORMATVERSIONS"),me=ce.enumeratedString("KEYID"),W=(de=ce.enumeratedString("KEYFORMAT"))!=null?de:"identity",Y=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(Y.indexOf(W)>-1){i.logger.warn("Keyformat "+W+" is not supported from the manifest");continue}else if(W!=="identity")continue;ve&&(H=g.LevelKey.fromURL(L,he),he&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ve)>=0&&(H.method=ve,H.keyFormat=W,me&&(H.keyID=me),fe&&(H.keyFormatVersions=fe),H.iv=ye));break}case"START":{var $=new d.AttrList(J),Q=$.decimalFloatingPoint("TIME-OFFSET");Object(b.isFiniteNumber)(Q)&&(R.startTimeOffset=Q);break}case"MAP":{var re=new d.AttrList(J);if(N.duration){var ne=new D.Fragment(T,L);p(ne,re,x,H),C=ne,N.initSegment=C,C.rawProgramDateTime&&!N.rawProgramDateTime&&(N.rawProgramDateTime=C.rawProgramDateTime)}else p(N,re,x,H),C=N,G=!0;break}case"SERVER-CONTROL":{var te=new d.AttrList(J);R.canBlockReload=te.bool("CAN-BLOCK-RELOAD"),R.canSkipUntil=te.optionalFloat("CAN-SKIP-UNTIL",0),R.canSkipDateRanges=R.canSkipUntil>0&&te.bool("CAN-SKIP-DATERANGES"),R.partHoldBack=te.optionalFloat("PART-HOLD-BACK",0),R.holdBack=te.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Ee=new d.AttrList(J);R.partTarget=Ee.decimalFloatingPoint("PART-TARGET");break}case"PART":{var pe=R.partList;pe||(pe=R.partList=[]);var ge=F>0?pe[pe.length-1]:void 0,_e=F++,be=new D.Part(new d.AttrList(J),N,L,_e,ge);pe.push(be),N.duration+=be.duration;break}case"PRELOAD-HINT":{var Le=new d.AttrList(J);R.preloadHint=Le;break}case"RENDITION-REPORT":{var Se=new d.AttrList(J);R.renditionReports=R.renditionReports||[],R.renditionReports.push(Se);break}default:i.logger.warn("line parsed but not handled: "+j);break}}}U&&!U.relurl?(I.pop(),B-=U.duration,R.partList&&(R.fragmentHint=U)):R.partList&&(a(N,U),N.cc=k,R.fragmentHint=N);var Re=I.length,Ie=I[0],Ae=I[Re-1];if(B+=R.skippedSegments*R.targetduration,B>0&&Re&&Ae){R.averagetargetduration=B/Re;var Me=Ae.sn;R.endSN=Me!=="initSegment"?Me:0,Ie&&(R.startCC=Ie.cc,Ie.initSegment||R.fragments.every(function(De){return De.relurl&&e(De.relurl)})&&(i.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),N=new D.Fragment(T,L),N.relurl=Ae.relurl,N.level=x,N.sn="initSegment",Ie.initSegment=N,R.needSidxRanges=!0))}else R.endSN=0,R.startCC=0;return R.fragmentHint&&(B+=R.fragmentHint.duration),R.totalduration=B,R.endCC=k,V>0&&s(I,V),R},A}();function r(A,_){["video","audio","text"].forEach(function(y){var L=A.filter(function(T){return Object(f.isCodecType)(T,y)});if(L.length){var x=L.filter(function(T){return T.lastIndexOf("avc1",0)===0||T.lastIndexOf("mp4a",0)===0});_[y+"Codec"]=x.length>0?x[0]:L[0],A=A.filter(function(T){return L.indexOf(T)===-1})}}),_.unknownCodecs=A}function l(A,_,y){var L=_[y];L&&(A[y]=L)}function s(A,_){for(var y=A[_],L=_;L--;){var x=A[L];if(!x)return;x.programDateTime=y.programDateTime-x.duration*1e3,y=x}}function a(A,_){A.rawProgramDateTime?A.programDateTime=Date.parse(A.rawProgramDateTime):_!=null&&_.programDateTime&&(A.programDateTime=_.endProgramDateTime),Object(b.isFiniteNumber)(A.programDateTime)||(A.programDateTime=null,A.rawProgramDateTime=null)}function p(A,_,y,L){A.relurl=_.URI,_.BYTERANGE&&A.setByteRange(_.BYTERANGE),A.level=y,A.sn="initSegment",L&&(A.levelkey=L),A.initSegment=null}},"./src/loader/playlist-loader.ts":function(M,P,E){E.r(P);var b=E("./src/polyfills/number.ts"),u=E("./src/events.ts"),m=E("./src/errors.ts"),D=E("./src/utils/logger.ts"),S=E("./src/utils/mp4-tools.ts"),g=E("./src/loader/m3u8-parser.ts"),d=E("./src/types/loader.ts"),i=E("./src/utils/attr-list.ts");function f(c){var h=c.type;switch(h){case d.PlaylistContextType.AUDIO_TRACK:return d.PlaylistLevelType.AUDIO;case d.PlaylistContextType.SUBTITLE_TRACK:return d.PlaylistLevelType.SUBTITLE;default:return d.PlaylistLevelType.MAIN}}function o(c,h){var t=c.url;return(t===void 0||t.indexOf("data:")===0)&&(t=h.url),t}var v=function(){function c(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var h=c.prototype;return h.registerListeners=function(){var e=this.hls;e.on(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(u.Events.LEVEL_LOADING,this.onLevelLoading,this),e.on(u.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(u.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},h.unregisterListeners=function(){var e=this.hls;e.off(u.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(u.Events.LEVEL_LOADING,this.onLevelLoading,this),e.off(u.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(u.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},h.createInternalLoader=function(e){var n=this.hls.config,r=n.pLoader,l=n.loader,s=r||l,a=new s(n);return e.loader=a,this.loaders[e.type]=a,a},h.getInternalLoader=function(e){return this.loaders[e.type]},h.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},h.destroyInternalLoaders=function(){for(var e in this.loaders){var n=this.loaders[e];n&&n.destroy(),this.resetInternalLoader(e)}},h.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},h.onManifestLoading=function(e,n){var r=n.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:d.PlaylistContextType.MANIFEST,url:r,deliveryDirectives:null})},h.onLevelLoading=function(e,n){var r=n.id,l=n.level,s=n.url,a=n.deliveryDirectives;this.load({id:r,groupId:null,level:l,responseType:"text",type:d.PlaylistContextType.LEVEL,url:s,deliveryDirectives:a})},h.onAudioTrackLoading=function(e,n){var r=n.id,l=n.groupId,s=n.url,a=n.deliveryDirectives;this.load({id:r,groupId:l,level:null,responseType:"text",type:d.PlaylistContextType.AUDIO_TRACK,url:s,deliveryDirectives:a})},h.onSubtitleTrackLoading=function(e,n){var r=n.id,l=n.groupId,s=n.url,a=n.deliveryDirectives;this.load({id:r,groupId:l,level:null,responseType:"text",type:d.PlaylistContextType.SUBTITLE_TRACK,url:s,deliveryDirectives:a})},h.load=function(e){var n,r=this.hls.config,l=this.getInternalLoader(e);if(l){var s=l.context;if(s&&s.url===e.url){D.logger.trace("[playlist-loader]: playlist request ongoing");return}D.logger.log("[playlist-loader]: aborting previous loader for type: "+e.type),l.abort()}var a,p,A,_;switch(e.type){case d.PlaylistContextType.MANIFEST:a=r.manifestLoadingMaxRetry,p=r.manifestLoadingTimeOut,A=r.manifestLoadingRetryDelay,_=r.manifestLoadingMaxRetryTimeout;break;case d.PlaylistContextType.LEVEL:case d.PlaylistContextType.AUDIO_TRACK:case d.PlaylistContextType.SUBTITLE_TRACK:a=0,p=r.levelLoadingTimeOut;break;default:a=r.levelLoadingMaxRetry,p=r.levelLoadingTimeOut,A=r.levelLoadingRetryDelay,_=r.levelLoadingMaxRetryTimeout;break}if(l=this.createInternalLoader(e),(n=e.deliveryDirectives)!==null&&n!==void 0&&n.part){var y;if(e.type===d.PlaylistContextType.LEVEL&&e.level!==null?y=this.hls.levels[e.level].details:e.type===d.PlaylistContextType.AUDIO_TRACK&&e.id!==null?y=this.hls.audioTracks[e.id].details:e.type===d.PlaylistContextType.SUBTITLE_TRACK&&e.id!==null&&(y=this.hls.subtitleTracks[e.id].details),y){var L=y.partTarget,x=y.targetduration;L&&x&&(p=Math.min(Math.max(L*3,x*.8)*1e3,p))}}var T={timeout:p,maxRetry:a,retryDelay:A,maxRetryDelay:_,highWaterMark:0},O={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};l.load(e,T,O)},h.loadsuccess=function(e,n,r,l){if(l===void 0&&(l=null),r.isSidxRequest){this.handleSidxRequest(e,r),this.handlePlaylistLoaded(e,n,r,l);return}this.resetInternalLoader(r.type);var s=e.data;if(s.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(e,r,"no EXTM3U delimiter",l);return}n.parsing.start=performance.now(),s.indexOf("#EXTINF:")>0||s.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(e,n,r,l):this.handleMasterPlaylist(e,n,r,l)},h.loaderror=function(e,n,r){r===void 0&&(r=null),this.handleNetworkError(n,r,!1,e)},h.loadtimeout=function(e,n,r){r===void 0&&(r=null),this.handleNetworkError(n,r,!0)},h.handleMasterPlaylist=function(e,n,r,l){var s=this.hls,a=e.data,p=o(e,r),A=g.default.parseMasterPlaylist(a,p),_=A.levels,y=A.sessionData;if(!_.length){this.handleManifestParsingError(e,r,"no level found in manifest",l);return}var L=_.map(function(C){return{id:C.attrs.AUDIO,audioCodec:C.audioCodec}}),x=_.map(function(C){return{id:C.attrs.SUBTITLES,textCodec:C.textCodec}}),T=g.default.parseMasterPlaylistMedia(a,p,"AUDIO",L),O=g.default.parseMasterPlaylistMedia(a,p,"SUBTITLES",x),R=g.default.parseMasterPlaylistMedia(a,p,"CLOSED-CAPTIONS");if(T.length){var I=T.some(function(C){return!C.url});!I&&_[0].audioCodec&&!_[0].attrs.AUDIO&&(D.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new i.AttrList({}),bitrate:0,url:""}))}s.trigger(u.Events.MANIFEST_LOADED,{levels:_,audioTracks:T,subtitles:O,captions:R,url:p,stats:n,networkDetails:l,sessionData:y})},h.handleTrackOrLevelPlaylist=function(e,n,r,l){var s=this.hls,a=r.id,p=r.level,A=r.type,_=o(e,r),y=Object(b.isFiniteNumber)(a)?a:0,L=Object(b.isFiniteNumber)(p)?p:y,x=f(r),T=g.default.parseLevelPlaylist(e.data,_,L,x,y);if(!T.fragments.length){s.trigger(u.Events.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:_,reason:"no fragments found in level",level:typeof r.level=="number"?r.level:void 0});return}if(A===d.PlaylistContextType.MANIFEST){var O={attrs:new i.AttrList({}),bitrate:0,details:T,name:"",url:_};s.trigger(u.Events.MANIFEST_LOADED,{levels:[O],audioTracks:[],url:_,stats:n,networkDetails:l,sessionData:null})}if(n.parsing.end=performance.now(),T.needSidxRanges){var R,I=(R=T.fragments[0].initSegment)===null||R===void 0?void 0:R.url;this.load({url:I,isSidxRequest:!0,type:A,level:p,levelDetails:T,id:a,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}r.levelDetails=T,this.handlePlaylistLoaded(e,n,r,l)},h.handleSidxRequest=function(e,n){var r=new Uint8Array(e.data),l=Object(S.findBox)(r,["sidx"])[0];if(!!l){var s=Object(S.parseSegmentIndex)(l);if(!!s){var a=s.references,p=n.levelDetails;a.forEach(function(A,_){var y=A.info,L=p.fragments[_];if(L.byteRange.length===0&&L.setByteRange(String(1+y.end-y.start)+"@"+String(y.start)),L.initSegment){var x=Object(S.findBox)(r,["moov"])[0],T=x?x.length:null;L.initSegment.setByteRange(String(T)+"@0")}})}}},h.handleManifestParsingError=function(e,n,r,l){this.hls.trigger(u.Events.ERROR,{type:m.ErrorTypes.NETWORK_ERROR,details:m.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:n.type===d.PlaylistContextType.MANIFEST,url:e.url,reason:r,response:e,context:n,networkDetails:l})},h.handleNetworkError=function(e,n,r,l){r===void 0&&(r=!1),D.logger.warn("[playlist-loader]: A network "+(r?"timeout":"error")+" occurred while loading "+e.type+" level: "+e.level+" id: "+e.id+' group-id: "'+e.groupId+'"');var s=m.ErrorDetails.UNKNOWN,a=!1,p=this.getInternalLoader(e);switch(e.type){case d.PlaylistContextType.MANIFEST:s=r?m.ErrorDetails.MANIFEST_LOAD_TIMEOUT:m.ErrorDetails.MANIFEST_LOAD_ERROR,a=!0;break;case d.PlaylistContextType.LEVEL:s=r?m.ErrorDetails.LEVEL_LOAD_TIMEOUT:m.ErrorDetails.LEVEL_LOAD_ERROR,a=!1;break;case d.PlaylistContextType.AUDIO_TRACK:s=r?m.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:m.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,a=!1;break;case d.PlaylistContextType.SUBTITLE_TRACK:s=r?m.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:m.ErrorDetails.SUBTITLE_LOAD_ERROR,a=!1;break}p&&this.resetInternalLoader(e.type);var A={type:m.ErrorTypes.NETWORK_ERROR,details:s,fatal:a,url:e.url,loader:p,context:e,networkDetails:n};l&&(A.response=l),this.hls.trigger(u.Events.ERROR,A)},h.handlePlaylistLoaded=function(e,n,r,l){var s=r.type,a=r.level,p=r.id,A=r.groupId,_=r.loader,y=r.levelDetails,L=r.deliveryDirectives;if(!(y!=null&&y.targetduration)){this.handleManifestParsingError(e,r,"invalid target duration",l);return}if(!!_)switch(y.live&&(_.getCacheAge&&(y.ageHeader=_.getCacheAge()||0),(!_.getCacheAge||isNaN(y.ageHeader))&&(y.ageHeader=0)),s){case d.PlaylistContextType.MANIFEST:case d.PlaylistContextType.LEVEL:this.hls.trigger(u.Events.LEVEL_LOADED,{details:y,level:a||0,id:p||0,stats:n,networkDetails:l,deliveryDirectives:L});break;case d.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(u.Events.AUDIO_TRACK_LOADED,{details:y,id:p||0,groupId:A||"",stats:n,networkDetails:l,deliveryDirectives:L});break;case d.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(u.Events.SUBTITLE_TRACK_LOADED,{details:y,id:p||0,groupId:A||"",stats:n,networkDetails:l,deliveryDirectives:L});break}},c}();P.default=v},"./src/polyfills/number.ts":function(M,P,E){E.r(P),E.d(P,"isFiniteNumber",function(){return b}),E.d(P,"MAX_SAFE_INTEGER",function(){return u});var b=Number.isFinite||function(m){return typeof m=="number"&&isFinite(m)},u=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(M,P,E){E.r(P);var b=function(){function u(){}return u.getSilentFrame=function(D,S){switch(D){case"mp4a.40.2":if(S===1)return new Uint8Array([0,200,0,128,35,128]);if(S===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(S===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(S===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(S===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(S===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(S===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(S===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},u}();P.default=b},"./src/remux/mp4-generator.ts":function(M,P,E){E.r(P);var b=Math.pow(2,32)-1,u=function(){function m(){}return m.init=function(){m.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var S;for(S in m.types)m.types.hasOwnProperty(S)&&(m.types[S]=[S.charCodeAt(0),S.charCodeAt(1),S.charCodeAt(2),S.charCodeAt(3)]);var g=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),d=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);m.HDLR_TYPES={video:g,audio:d};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),f=new Uint8Array([0,0,0,0,0,0,0,0]);m.STTS=m.STSC=m.STCO=f,m.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),m.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),m.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),m.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),v=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);m.FTYP=m.box(m.types.ftyp,o,c,o,v),m.DINF=m.box(m.types.dinf,m.box(m.types.dref,i))},m.box=function(S){for(var g=8,d=arguments.length,i=new Array(d>1?d-1:0),f=1;f<d;f++)i[f-1]=arguments[f];for(var o=i.length,v=o;o--;)g+=i[o].byteLength;var c=new Uint8Array(g);for(c[0]=g>>24&255,c[1]=g>>16&255,c[2]=g>>8&255,c[3]=g&255,c.set(S,4),o=0,g=8;o<v;o++)c.set(i[o],g),g+=i[o].byteLength;return c},m.hdlr=function(S){return m.box(m.types.hdlr,m.HDLR_TYPES[S])},m.mdat=function(S){return m.box(m.types.mdat,S)},m.mdhd=function(S,g){g*=S;var d=Math.floor(g/(b+1)),i=Math.floor(g%(b+1));return m.box(m.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,S>>24&255,S>>16&255,S>>8&255,S&255,d>>24,d>>16&255,d>>8&255,d&255,i>>24,i>>16&255,i>>8&255,i&255,85,196,0,0]))},m.mdia=function(S){return m.box(m.types.mdia,m.mdhd(S.timescale,S.duration),m.hdlr(S.type),m.minf(S))},m.mfhd=function(S){return m.box(m.types.mfhd,new Uint8Array([0,0,0,0,S>>24,S>>16&255,S>>8&255,S&255]))},m.minf=function(S){return S.type==="audio"?m.box(m.types.minf,m.box(m.types.smhd,m.SMHD),m.DINF,m.stbl(S)):m.box(m.types.minf,m.box(m.types.vmhd,m.VMHD),m.DINF,m.stbl(S))},m.moof=function(S,g,d){return m.box(m.types.moof,m.mfhd(S),m.traf(d,g))},m.moov=function(S){for(var g=S.length,d=[];g--;)d[g]=m.trak(S[g]);return m.box.apply(null,[m.types.moov,m.mvhd(S[0].timescale,S[0].duration)].concat(d).concat(m.mvex(S)))},m.mvex=function(S){for(var g=S.length,d=[];g--;)d[g]=m.trex(S[g]);return m.box.apply(null,[m.types.mvex].concat(d))},m.mvhd=function(S,g){g*=S;var d=Math.floor(g/(b+1)),i=Math.floor(g%(b+1)),f=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,S>>24&255,S>>16&255,S>>8&255,S&255,d>>24,d>>16&255,d>>8&255,d&255,i>>24,i>>16&255,i>>8&255,i&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return m.box(m.types.mvhd,f)},m.sdtp=function(S){var g=S.samples||[],d=new Uint8Array(4+g.length),i,f;for(i=0;i<g.length;i++)f=g[i].flags,d[i+4]=f.dependsOn<<4|f.isDependedOn<<2|f.hasRedundancy;return m.box(m.types.sdtp,d)},m.stbl=function(S){return m.box(m.types.stbl,m.stsd(S),m.box(m.types.stts,m.STTS),m.box(m.types.stsc,m.STSC),m.box(m.types.stsz,m.STSZ),m.box(m.types.stco,m.STCO))},m.avc1=function(S){var g=[],d=[],i,f,o;for(i=0;i<S.sps.length;i++)f=S.sps[i],o=f.byteLength,g.push(o>>>8&255),g.push(o&255),g=g.concat(Array.prototype.slice.call(f));for(i=0;i<S.pps.length;i++)f=S.pps[i],o=f.byteLength,d.push(o>>>8&255),d.push(o&255),d=d.concat(Array.prototype.slice.call(f));var v=m.box(m.types.avcC,new Uint8Array([1,g[3],g[4],g[5],255,224|S.sps.length].concat(g).concat([S.pps.length]).concat(d))),c=S.width,h=S.height,t=S.pixelRatio[0],e=S.pixelRatio[1];return m.box(m.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,h>>8&255,h&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),v,m.box(m.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),m.box(m.types.pasp,new Uint8Array([t>>24,t>>16&255,t>>8&255,t&255,e>>24,e>>16&255,e>>8&255,e&255])))},m.esds=function(S){var g=S.config.length;return new Uint8Array([0,0,0,0,3,23+g,0,1,0,4,15+g,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([g]).concat(S.config).concat([6,1,2]))},m.mp4a=function(S){var g=S.samplerate;return m.box(m.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S.channelCount,0,16,0,0,0,0,g>>8&255,g&255,0,0]),m.box(m.types.esds,m.esds(S)))},m.mp3=function(S){var g=S.samplerate;return m.box(m.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,S.channelCount,0,16,0,0,0,0,g>>8&255,g&255,0,0]))},m.stsd=function(S){return S.type==="audio"?S.segmentCodec==="mp3"&&S.codec==="mp3"?m.box(m.types.stsd,m.STSD,m.mp3(S)):m.box(m.types.stsd,m.STSD,m.mp4a(S)):m.box(m.types.stsd,m.STSD,m.avc1(S))},m.tkhd=function(S){var g=S.id,d=S.duration*S.timescale,i=S.width,f=S.height,o=Math.floor(d/(b+1)),v=Math.floor(d%(b+1));return m.box(m.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,g>>24&255,g>>16&255,g>>8&255,g&255,0,0,0,0,o>>24,o>>16&255,o>>8&255,o&255,v>>24,v>>16&255,v>>8&255,v&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,i>>8&255,i&255,0,0,f>>8&255,f&255,0,0]))},m.traf=function(S,g){var d=m.sdtp(S),i=S.id,f=Math.floor(g/(b+1)),o=Math.floor(g%(b+1));return m.box(m.types.traf,m.box(m.types.tfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255])),m.box(m.types.tfdt,new Uint8Array([1,0,0,0,f>>24,f>>16&255,f>>8&255,f&255,o>>24,o>>16&255,o>>8&255,o&255])),m.trun(S,d.length+16+20+8+16+8+8),d)},m.trak=function(S){return S.duration=S.duration||4294967295,m.box(m.types.trak,m.tkhd(S),m.mdia(S))},m.trex=function(S){var g=S.id;return m.box(m.types.trex,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},m.trun=function(S,g){var d=S.samples||[],i=d.length,f=12+16*i,o=new Uint8Array(f),v,c,h,t,e,n;for(g+=8+f,o.set([0,0,15,1,i>>>24&255,i>>>16&255,i>>>8&255,i&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255],0),v=0;v<i;v++)c=d[v],h=c.duration,t=c.size,e=c.flags,n=c.cts,o.set([h>>>24&255,h>>>16&255,h>>>8&255,h&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,e.isLeading<<2|e.dependsOn,e.isDependedOn<<6|e.hasRedundancy<<4|e.paddingValue<<1|e.isNonSync,e.degradPrio&240<<8,e.degradPrio&15,n>>>24&255,n>>>16&255,n>>>8&255,n&255],12+16*v);return m.box(m.types.trun,o)},m.initSegment=function(S){m.types||m.init();var g=m.moov(S),d=new Uint8Array(m.FTYP.byteLength+g.byteLength);return d.set(m.FTYP),d.set(g,m.FTYP.byteLength),d},m}();u.types=void 0,u.HDLR_TYPES=void 0,u.STTS=void 0,u.STSC=void 0,u.STCO=void 0,u.STSZ=void 0,u.VMHD=void 0,u.SMHD=void 0,u.STSD=void 0,u.FTYP=void 0,u.DINF=void 0,P.default=u},"./src/remux/mp4-remuxer.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return n}),E.d(P,"normalizePts",function(){return r}),E.d(P,"flushTextTrackMetadataCueSamples",function(){return s}),E.d(P,"flushTextTrackUserdataCueSamples",function(){return a});var b=E("./src/polyfills/number.ts"),u=E("./src/remux/aac-helper.ts"),m=E("./src/remux/mp4-generator.ts"),D=E("./src/events.ts"),S=E("./src/errors.ts"),g=E("./src/utils/logger.ts"),d=E("./src/types/loader.ts"),i=E("./src/utils/timescale-conversion.ts");function f(){return f=Object.assign?Object.assign.bind():function(_){for(var y=1;y<arguments.length;y++){var L=arguments[y];for(var x in L)Object.prototype.hasOwnProperty.call(L,x)&&(_[x]=L[x])}return _},f.apply(this,arguments)}var o=10*1e3,v=1024,c=1152,h=null,t=null,e=!1,n=function(){function _(L,x,T,O){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=L,this.config=x,this.typeSupported=T,this.ISGenerated=!1,h===null){var R=navigator.userAgent||"",I=R.match(/Chrome\/(\d+)/i);h=I?parseInt(I[1]):0}if(t===null){var C=navigator.userAgent.match(/Safari\/(\d+)/i);t=C?parseInt(C[1]):0}e=!(!!h&&h>=75||!!t&&t>=600)}var y=_.prototype;return y.destroy=function(){},y.resetTimeStamp=function(x){g.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=x},y.resetNextTimestamp=function(){g.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},y.resetInitSegment=function(){g.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},y.getVideoStartPts=function(x){var T=!1,O=x.reduce(function(R,I){var C=I.pts-R;return C<-4294967296?(T=!0,r(R,I.pts)):C>0?R:I.pts},x[0].pts);return T&&g.logger.debug("PTS rollover detected"),O},y.remux=function(x,T,O,R,I,C,w,F){var B,k,U,N,j,K,H=I,V=I,G=x.pid>-1,ee=T.pid>-1,q=T.samples.length,z=x.samples.length>0,X=w&&q>0||q>1,J=(!G||z)&&(!ee||X)||this.ISGenerated||w;if(J){this.ISGenerated||(U=this.generateIS(x,T,I));var ie=this.isVideoContiguous,ae=-1,se;if(X&&(ae=l(T.samples),!ie&&this.config.forceKeyFrameOnDiscontinuity))if(K=!0,ae>0){g.logger.warn("[mp4-remuxer]: Dropped "+ae+" out of "+q+" video samples due to a missing keyframe");var le=this.getVideoStartPts(T.samples);T.samples=T.samples.slice(ae),T.dropped+=ae,V+=(T.samples[0].pts-le)/T.inputTimeScale,se=V}else ae===-1&&(g.logger.warn("[mp4-remuxer]: No keyframe found out of "+q+" video samples"),K=!1);if(this.ISGenerated){if(z&&X){var ue=this.getVideoStartPts(T.samples),Z=r(x.samples[0].pts,ue)-ue,oe=Z/T.inputTimeScale;H+=Math.max(0,oe),V+=Math.max(0,-oe)}if(z){if(x.samplerate||(g.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),U=this.generateIS(x,T,I)),k=this.remuxAudio(x,H,this.isAudioContiguous,C,ee||X||F===d.PlaylistLevelType.AUDIO?V:void 0),X){var de=k?k.endPTS-k.startPTS:0;T.inputTimeScale||(g.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),U=this.generateIS(x,T,I)),B=this.remuxVideo(T,V,ie,de)}}else X&&(B=this.remuxVideo(T,V,ie,0));B&&(B.firstKeyFrame=ae,B.independent=ae!==-1,B.firstKeyFramePTS=se)}}return this.ISGenerated&&(O.samples.length&&(j=s(O,I,this._initPTS,this._initDTS)),R.samples.length&&(N=a(R,I,this._initPTS))),{audio:k,video:B,initSegment:U,independent:K,text:N,id3:j}},y.generateIS=function(x,T,O){var R=x.samples,I=T.samples,C=this.typeSupported,w={},F=!Object(b.isFiniteNumber)(this._initPTS),B="audio/mp4",k,U,N;if(F&&(k=U=1/0),x.config&&R.length){switch(x.timescale=x.samplerate,x.segmentCodec){case"mp3":C.mpeg?(B="audio/mpeg",x.codec=""):C.mp3&&(x.codec="mp3");break}w.audio={id:"audio",container:B,codec:x.codec,initSegment:x.segmentCodec==="mp3"&&C.mpeg?new Uint8Array(0):m.default.initSegment([x]),metadata:{channelCount:x.channelCount}},F&&(N=x.inputTimeScale,k=U=R[0].pts-Math.round(N*O))}if(T.sps&&T.pps&&I.length&&(T.timescale=T.inputTimeScale,w.video={id:"main",container:"video/mp4",codec:T.codec,initSegment:m.default.initSegment([T]),metadata:{width:T.width,height:T.height}},F)){N=T.inputTimeScale;var j=this.getVideoStartPts(I),K=Math.round(N*O);U=Math.min(U,r(I[0].dts,j)-K),k=Math.min(k,j-K)}if(Object.keys(w).length)return this.ISGenerated=!0,F&&(this._initPTS=k,this._initDTS=U),{tracks:w,initPTS:k,timescale:N}},y.remuxVideo=function(x,T,O,R){var I=x.inputTimeScale,C=x.samples,w=[],F=C.length,B=this._initPTS,k=this.nextAvcDts,U=8,N=this.videoSampleDuration,j,K,H=Number.POSITIVE_INFINITY,V=Number.NEGATIVE_INFINITY,G=0,ee=!1;if(!O||k===null){var q=T*I,z=C[0].pts-r(C[0].dts,C[0].pts);k=q-z}for(var X=0;X<F;X++){var J=C[X];if(J.pts=r(J.pts-B,k),J.dts=r(J.dts-B,k),J.dts>J.pts){var ie=18e3;G=Math.max(Math.min(G,J.pts-J.dts),-1*ie)}J.dts<C[X>0?X-1:X].dts&&(ee=!0)}ee&&C.sort(function(we,Ne){var Qe=we.dts-Ne.dts,Ze=we.pts-Ne.pts;return Qe||Ze}),j=C[0].dts,K=C[C.length-1].dts;var ae=K-j,se=ae?Math.round(ae/(F-1)):N||x.inputTimeScale/30;if(G<0){if(G<se*-2){g.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(i.toMsFromMpegTsClock)(-se,!0)+" ms");for(var le=G,ue=0;ue<F;ue++)C[ue].dts=le=Math.max(le,C[ue].pts-se),C[ue].pts=Math.max(le,C[ue].pts)}else{g.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(i.toMsFromMpegTsClock)(G,!0)+" ms to overcome this issue");for(var Z=0;Z<F;Z++)C[Z].dts=C[Z].dts+G}j=C[0].dts}if(O){var oe=j-k,de=oe>se,ce=oe<-1;if(de||ce){de?g.logger.warn("AVC: "+Object(i.toMsFromMpegTsClock)(oe,!0)+" ms ("+oe+"dts) hole between fragments detected, filling it"):g.logger.warn("AVC: "+Object(i.toMsFromMpegTsClock)(-oe,!0)+" ms ("+oe+"dts) overlapping between fragments detected"),j=k;var ve=C[0].pts-oe;C[0].dts=j,C[0].pts=ve,g.logger.log("Video: First PTS/DTS adjusted: "+Object(i.toMsFromMpegTsClock)(ve,!0)+"/"+Object(i.toMsFromMpegTsClock)(j,!0)+", delta: "+Object(i.toMsFromMpegTsClock)(oe,!0)+" ms")}}e&&(j=Math.max(0,j));for(var he=0,ye=0,fe=0;fe<F;fe++){for(var me=C[fe],W=me.units,Y=W.length,$=0,Q=0;Q<Y;Q++)$+=W[Q].data.length;ye+=$,he+=Y,me.length=$,me.dts=Math.max(me.dts,j),me.pts=Math.max(me.pts,me.dts,0),H=Math.min(me.pts,H),V=Math.max(me.pts,V)}K=C[F-1].dts;var re=ye+4*he+8,ne;try{ne=new Uint8Array(re)}catch{this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:S.ErrorTypes.MUX_ERROR,details:S.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:re,reason:"fail allocating video mdat "+re});return}var te=new DataView(ne.buffer);te.setUint32(0,re),ne.set(m.default.types.mdat,4);for(var Ee=!1,pe=0;pe<F;pe++){for(var ge=C[pe],_e=ge.units,be=0,Le=0,Se=_e.length;Le<Se;Le++){var Re=_e[Le],Ie=Re.data,Ae=Re.data.byteLength;te.setUint32(U,Ae),U+=4,ne.set(Ie,U),U+=Ae,be+=4+Ae}if(pe<F-1)N=C[pe+1].dts-ge.dts;else{var Me=this.config,De=pe>0?ge.dts-C[pe-1].dts:se;if(Me.stretchShortVideoTrack&&this.nextAudioPts!==null){var ze=Math.floor(Me.maxBufferHole*I),Fe=(R?H+R*I:this.nextAudioPts)-ge.pts;Fe>ze?(N=Fe-De,N<0?N=De:Ee=!0,g.logger.log("[mp4-remuxer]: It is approximately "+Fe/90+" ms to the next segment; using duration "+N/90+" ms for the last video frame.")):N=De}else N=De}var Ye=Math.round(ge.pts-ge.dts);w.push(new p(ge.key,N,be,Ye))}if(w.length&&h&&h<70){var Ue=w[0].flags;Ue.dependsOn=2,Ue.isNonSync=0}console.assert(N!==null,"mp4SampleDuration must be computed"),N=Ee||!N?se:N,this.nextAvcDts=k=K+N,this.videoSampleDuration=N,this.isVideoContiguous=!0;var $e=m.default.moof(x.sequenceNumber++,j,f({},x,{samples:w})),Xe="video",Je={data1:$e,data2:ne,startPTS:H/I,endPTS:(V+N)/I,startDTS:j/I,endDTS:k/I,type:Xe,hasAudio:!1,hasVideo:!0,nb:w.length,dropped:x.dropped};return x.samples=[],x.dropped=0,console.assert(ne.length,"MDAT length must not be zero"),Je},y.remuxAudio=function(x,T,O,R,I){var C=x.inputTimeScale,w=x.samplerate?x.samplerate:C,F=C/w,B=x.segmentCodec==="aac"?v:c,k=B*F,U=this._initPTS,N=x.segmentCodec==="mp3"&&this.typeSupported.mpeg,j=[],K=I!==void 0,H=x.samples,V=N?0:8,G=this.nextAudioPts||-1,ee=T*C;if(this.isAudioContiguous=O=O||H.length&&G>0&&(R&&Math.abs(ee-G)<9e3||Math.abs(r(H[0].pts-U,ee)-G)<20*k),H.forEach(function(Se){Se.pts=r(Se.pts-U,ee)}),!O||G<0){if(H=H.filter(function(Se){return Se.pts>=0}),!H.length)return;I===0?G=0:R&&!K?G=Math.max(0,ee):G=H[0].pts}if(x.segmentCodec==="aac")for(var q=this.config.maxAudioFramesDrift,z=0,X=G;z<H.length;z++){var J=H[z],ie=J.pts,ae=ie-X,se=Math.abs(1e3*ae/C);if(ae<=-q*k&&K)z===0&&(g.logger.warn("Audio frame @ "+(ie/C).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*ae/C)+" ms."),this.nextAudioPts=G=X=ie);else if(ae>=q*k&&se<o&&K){var le=Math.round(ae/k);X=ie-le*k,X<0&&(le--,X+=k),z===0&&(this.nextAudioPts=G=X),g.logger.warn("[mp4-remuxer]: Injecting "+le+" audio frame @ "+(X/C).toFixed(3)+"s due to "+Math.round(1e3*ae/C)+" ms gap.");for(var ue=0;ue<le;ue++){var Z=Math.max(X,0),oe=u.default.getSilentFrame(x.manifestCodec||x.codec,x.channelCount);oe||(g.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),oe=J.unit.subarray()),H.splice(z,0,{unit:oe,pts:Z}),X+=k,z++}}J.pts=X,X+=k}for(var de=null,ce=null,ve,he=0,ye=H.length;ye--;)he+=H[ye].unit.byteLength;for(var fe=0,me=H.length;fe<me;fe++){var W=H[fe],Y=W.unit,$=W.pts;if(ce!==null){var Q=j[fe-1];Q.duration=Math.round(($-ce)/F)}else if(O&&x.segmentCodec==="aac"&&($=G),de=$,he>0){he+=V;try{ve=new Uint8Array(he)}catch{this.observer.emit(D.Events.ERROR,D.Events.ERROR,{type:S.ErrorTypes.MUX_ERROR,details:S.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:he,reason:"fail allocating audio mdat "+he});return}if(!N){var re=new DataView(ve.buffer);re.setUint32(0,he),ve.set(m.default.types.mdat,4)}}else return;ve.set(Y,V);var ne=Y.byteLength;V+=ne,j.push(new p(!0,B,ne,0)),ce=$}var te=j.length;if(!!te){var Ee=j[j.length-1];this.nextAudioPts=G=ce+F*Ee.duration;var pe=N?new Uint8Array(0):m.default.moof(x.sequenceNumber++,de/F,f({},x,{samples:j}));x.samples=[];var ge=de/C,_e=G/C,be="audio",Le={data1:pe,data2:ve,startPTS:ge,endPTS:_e,startDTS:ge,endDTS:_e,type:be,hasAudio:!0,hasVideo:!1,nb:te};return this.isAudioContiguous=!0,console.assert(ve.length,"MDAT length must not be zero"),Le}},y.remuxEmptyAudio=function(x,T,O,R){var I=x.inputTimeScale,C=x.samplerate?x.samplerate:I,w=I/C,F=this.nextAudioPts,B=(F!==null?F:R.startDTS*I)+this._initDTS,k=R.endDTS*I+this._initDTS,U=w*v,N=Math.ceil((k-B)/U),j=u.default.getSilentFrame(x.manifestCodec||x.codec,x.channelCount);if(g.logger.warn("[mp4-remuxer]: remux empty Audio"),!j){g.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var K=[],H=0;H<N;H++){var V=B+H*U;K.push({unit:j,pts:V,dts:V})}return x.samples=K,this.remuxAudio(x,T,O,!1)},_}();function r(_,y){var L;if(y===null)return _;for(y<_?L=-8589934592:L=8589934592;Math.abs(_-y)>4294967296;)_+=L;return _}function l(_){for(var y=0;y<_.length;y++)if(_[y].key)return y;return-1}function s(_,y,L,x){var T=_.samples.length;if(!!T){for(var O=_.inputTimeScale,R=0;R<T;R++){var I=_.samples[R];I.pts=r(I.pts-L,y*O)/O,I.dts=r(I.dts-x,y*O)/O}var C=_.samples;return _.samples=[],{samples:C}}}function a(_,y,L){var x=_.samples.length;if(!!x){for(var T=_.inputTimeScale,O=0;O<x;O++){var R=_.samples[O];R.pts=r(R.pts-L,y*T)/T}_.samples.sort(function(C,w){return C.pts-w.pts});var I=_.samples;return _.samples=[],{samples:I}}}var p=function(y,L,x,T){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=L,this.size=x,this.cts=T,this.flags=new A(y)},A=function(y){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=y?2:1,this.isNonSync=y?0:1}},"./src/remux/passthrough-remuxer.ts":function(M,P,E){E.r(P);var b=E("./src/polyfills/number.ts"),u=E("./src/remux/mp4-remuxer.ts"),m=E("./src/utils/mp4-tools.ts"),D=E("./src/loader/fragment.ts"),S=E("./src/utils/logger.ts"),g=function(){function f(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var o=f.prototype;return o.destroy=function(){},o.resetTimeStamp=function(c){this.initPTS=c,this.lastEndDTS=null},o.resetNextTimestamp=function(){this.lastEndDTS=null},o.resetInitSegment=function(c,h,t){this.audioCodec=h,this.videoCodec=t,this.generateInitSegment(c),this.emitInitSegment=!0},o.generateInitSegment=function(c){var h=this.audioCodec,t=this.videoCodec;if(!c||!c.byteLength){this.initTracks=void 0,this.initData=void 0;return}var e=this.initData=Object(m.parseInitSegment)(c);h||(h=i(e.audio,D.ElementaryStreamTypes.AUDIO)),t||(t=i(e.video,D.ElementaryStreamTypes.VIDEO));var n={};e.audio&&e.video?n.audiovideo={container:"video/mp4",codec:h+","+t,initSegment:c,id:"main"}:e.audio?n.audio={container:"audio/mp4",codec:h,initSegment:c,id:"audio"}:e.video?n.video={container:"video/mp4",codec:t,initSegment:c,id:"main"}:S.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=n},o.remux=function(c,h,t,e,n){var r,l=this.initPTS,s=this.lastEndDTS,a={audio:void 0,video:void 0,text:e,id3:t,initSegment:void 0};Object(b.isFiniteNumber)(s)||(s=this.lastEndDTS=n||0);var p=h.samples;if(!p||!p.length)return a;var A={initPTS:void 0,timescale:1},_=this.initData;if((!_||!_.length)&&(this.generateInitSegment(p),_=this.initData),!_||!_.length)return S.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),a;this.emitInitSegment&&(A.tracks=this.initTracks,this.emitInitSegment=!1),Object(b.isFiniteNumber)(l)||(this.initPTS=A.initPTS=l=d(_,p,s));var y=Object(m.getDuration)(p,_),L=s,x=y+L;Object(m.offsetStartDTS)(_,p,l),y>0?this.lastEndDTS=x:(S.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var T=!!_.audio,O=!!_.video,R="";T&&(R+="audio"),O&&(R+="video");var I={data1:p,startPTS:L,startDTS:L,endPTS:x,endDTS:x,type:R,hasAudio:T,hasVideo:O,nb:1,dropped:0};a.audio=I.type==="audio"?I:void 0,a.video=I.type!=="audio"?I:void 0,a.initSegment=A;var C=(r=this.initPTS)!=null?r:0;return a.id3=Object(u.flushTextTrackMetadataCueSamples)(t,n,C,C),e.samples.length&&(a.text=Object(u.flushTextTrackUserdataCueSamples)(e,n,C)),a},f}(),d=function(o,v,c){return Object(m.getStartDTS)(o,v)-c};function i(f,o){var v=f==null?void 0:f.codec;return v&&v.length>4?v:v==="hvc1"||v==="hev1"?"hvc1.1.c.L120.90":v==="av01"?"av01.0.04M.08":v==="avc1"||o===D.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}P.default=g},"./src/task-loop.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return b});var b=function(){function u(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var m=u.prototype;return m.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},m.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},m.onHandlerDestroyed=function(){},m.hasInterval=function(){return!!this._tickInterval},m.hasNextTick=function(){return!!this._tickTimer},m.setInterval=function(S){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,S),!0)},m.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},m.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},m.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},m.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},m.doTick=function(){},u}()},"./src/types/cmcd.ts":function(M,P,E){E.r(P),E.d(P,"CMCDVersion",function(){return b}),E.d(P,"CMCDObjectType",function(){return u}),E.d(P,"CMCDStreamingFormat",function(){return m}),E.d(P,"CMCDStreamType",function(){return D});var b=1,u;(function(S){S.MANIFEST="m",S.AUDIO="a",S.VIDEO="v",S.MUXED="av",S.INIT="i",S.CAPTION="c",S.TIMED_TEXT="tt",S.KEY="k",S.OTHER="o"})(u||(u={}));var m;(function(S){S.DASH="d",S.HLS="h",S.SMOOTH="s",S.OTHER="o"})(m||(m={}));var D;(function(S){S.VOD="v",S.LIVE="l"})(D||(D={}))},"./src/types/demuxer.ts":function(M,P,E){E.r(P),E.d(P,"MetadataSchema",function(){return b});var b;(function(u){u.audioId3="org.id3",u.dateRange="com.apple.quicktime.HLS",u.emsg="https://aomedia.org/emsg/ID3"})(b||(b={}))},"./src/types/level.ts":function(M,P,E){E.r(P),E.d(P,"HlsSkip",function(){return m}),E.d(P,"getSkipValue",function(){return D}),E.d(P,"HlsUrlParameters",function(){return S}),E.d(P,"Level",function(){return g});function b(d,i){for(var f=0;f<i.length;f++){var o=i[f];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(d,o.key,o)}}function u(d,i,f){return i&&b(d.prototype,i),f&&b(d,f),Object.defineProperty(d,"prototype",{writable:!1}),d}var m;(function(d){d.No="",d.Yes="YES",d.v2="v2"})(m||(m={}));function D(d,i){var f=d.canSkipUntil,o=d.canSkipDateRanges,v=d.endSN,c=i!==void 0?i-v:0;return f&&c<f?o?m.v2:m.Yes:m.No}var S=function(){function d(f,o,v){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=f,this.part=o,this.skip=v}var i=d.prototype;return i.addDirectives=function(o){var v=new self.URL(o);return this.msn!==void 0&&v.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&v.searchParams.set("_HLS_part",this.part.toString()),this.skip&&v.searchParams.set("_HLS_skip",this.skip),v.toString()},d}(),g=function(){function d(i){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[i.url],this.attrs=i.attrs,this.bitrate=i.bitrate,i.details&&(this.details=i.details),this.id=i.id||0,this.name=i.name,this.width=i.width||0,this.height=i.height||0,this.audioCodec=i.audioCodec,this.videoCodec=i.videoCodec,this.unknownCodecs=i.unknownCodecs,this.codecSet=[i.videoCodec,i.audioCodec].filter(function(f){return f}).join(",").replace(/\.[^.,]+/g,"")}return u(d,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(f){var o=f%this.url.length;this._urlId!==o&&(this.details=void 0,this._urlId=o)}}]),d}()},"./src/types/loader.ts":function(M,P,E){E.r(P),E.d(P,"PlaylistContextType",function(){return b}),E.d(P,"PlaylistLevelType",function(){return u});var b;(function(m){m.MANIFEST="manifest",m.LEVEL="level",m.AUDIO_TRACK="audioTrack",m.SUBTITLE_TRACK="subtitleTrack"})(b||(b={}));var u;(function(m){m.MAIN="main",m.AUDIO="audio",m.SUBTITLE="subtitle"})(u||(u={}))},"./src/types/transmuxer.ts":function(M,P,E){E.r(P),E.d(P,"ChunkMetadata",function(){return b});var b=function(D,S,g,d,i,f){d===void 0&&(d=0),i===void 0&&(i=-1),f===void 0&&(f=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=u(),this.buffering={audio:u(),video:u(),audiovideo:u()},this.level=D,this.sn=S,this.id=g,this.size=d,this.part=i,this.partial=f};function u(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(M,P,E){E.r(P),E.d(P,"AttrList",function(){return m});var b=/^(\d+)x(\d+)$/,u=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,m=function(){function D(g){typeof g=="string"&&(g=D.parseAttrList(g));for(var d in g)g.hasOwnProperty(d)&&(this[d]=g[d])}var S=D.prototype;return S.decimalInteger=function(d){var i=parseInt(this[d],10);return i>Number.MAX_SAFE_INTEGER?1/0:i},S.hexadecimalInteger=function(d){if(this[d]){var i=(this[d]||"0x").slice(2);i=(i.length&1?"0":"")+i;for(var f=new Uint8Array(i.length/2),o=0;o<i.length/2;o++)f[o]=parseInt(i.slice(o*2,o*2+2),16);return f}else return null},S.hexadecimalIntegerAsNumber=function(d){var i=parseInt(this[d],16);return i>Number.MAX_SAFE_INTEGER?1/0:i},S.decimalFloatingPoint=function(d){return parseFloat(this[d])},S.optionalFloat=function(d,i){var f=this[d];return f?parseFloat(f):i},S.enumeratedString=function(d){return this[d]},S.bool=function(d){return this[d]==="YES"},S.decimalResolution=function(d){var i=b.exec(this[d]);if(i!==null)return{width:parseInt(i[1],10),height:parseInt(i[2],10)}},D.parseAttrList=function(d){var i,f={},o='"';for(u.lastIndex=0;(i=u.exec(d))!==null;){var v=i[2];v.indexOf(o)===0&&v.lastIndexOf(o)===v.length-1&&(v=v.slice(1,-1)),f[i[1]]=v}return f},D}()},"./src/utils/binary-search.ts":function(M,P,E){E.r(P);var b={search:function(m,D){for(var S=0,g=m.length-1,d=null,i=null;S<=g;){d=(S+g)/2|0,i=m[d];var f=D(i);if(f>0)S=d+1;else if(f<0)g=d-1;else return i}return null}};P.default=b},"./src/utils/buffer-helper.ts":function(M,P,E){E.r(P),E.d(P,"BufferHelper",function(){return m});var b=E("./src/utils/logger.ts"),u={length:0,start:function(){return 0},end:function(){return 0}},m=function(){function D(){}return D.isBuffered=function(g,d){try{if(g){for(var i=D.getBuffered(g),f=0;f<i.length;f++)if(d>=i.start(f)&&d<=i.end(f))return!0}}catch{}return!1},D.bufferInfo=function(g,d,i){try{if(g){var f=D.getBuffered(g),o=[],v;for(v=0;v<f.length;v++)o.push({start:f.start(v),end:f.end(v)});return this.bufferedInfo(o,d,i)}}catch{}return{len:0,start:d,end:d,nextStart:void 0}},D.bufferedInfo=function(g,d,i){d=Math.max(0,d),g.sort(function(a,p){var A=a.start-p.start;return A||p.end-a.end});var f=[];if(i)for(var o=0;o<g.length;o++){var v=f.length;if(v){var c=f[v-1].end;g[o].start-c<i?g[o].end>c&&(f[v-1].end=g[o].end):f.push(g[o])}else f.push(g[o])}else f=g;for(var h=0,t,e=d,n=d,r=0;r<f.length;r++){var l=f[r].start,s=f[r].end;if(d+i>=l&&d<s)e=l,n=s,h=n-d;else if(d+i<l){t=l;break}}return{len:h,start:e||0,end:n||0,nextStart:t}},D.getBuffered=function(g){try{return g.buffered}catch(d){return b.logger.log("failed to get media.buffered",d),u}},D}()},"./src/utils/cea-608-parser.ts":function(M,P,E){E.r(P),E.d(P,"Row",function(){return n}),E.d(P,"CaptionScreen",function(){return r});var b=E("./src/utils/logger.ts"),u={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},m=function(y){var L=y;return u.hasOwnProperty(y)&&(L=u[y]),String.fromCharCode(L)},D=15,S=100,g={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},d={17:2,18:4,21:6,22:8,23:10,19:13,20:15},i={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},o=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],v;(function(_){_[_.ERROR=0]="ERROR",_[_.TEXT=1]="TEXT",_[_.WARNING=2]="WARNING",_[_.INFO=2]="INFO",_[_.DEBUG=3]="DEBUG",_[_.DATA=3]="DATA"})(v||(v={}));var c=function(){function _(){this.time=null,this.verboseLevel=v.ERROR}var y=_.prototype;return y.log=function(x,T){this.verboseLevel>=x&&b.logger.log(this.time+" ["+x+"] "+T)},_}(),h=function(y){for(var L=[],x=0;x<y.length;x++)L.push(y[x].toString(16));return L},t=function(){function _(L,x,T,O,R){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=L||"white",this.underline=x||!1,this.italics=T||!1,this.background=O||"black",this.flash=R||!1}var y=_.prototype;return y.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},y.setStyles=function(x){for(var T=["foreground","underline","italics","background","flash"],O=0;O<T.length;O++){var R=T[O];x.hasOwnProperty(R)&&(this[R]=x[R])}},y.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},y.equals=function(x){return this.foreground===x.foreground&&this.underline===x.underline&&this.italics===x.italics&&this.background===x.background&&this.flash===x.flash},y.copy=function(x){this.foreground=x.foreground,this.underline=x.underline,this.italics=x.italics,this.background=x.background,this.flash=x.flash},y.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},_}(),e=function(){function _(L,x,T,O,R,I){this.uchar=void 0,this.penState=void 0,this.uchar=L||" ",this.penState=new t(x,T,O,R,I)}var y=_.prototype;return y.reset=function(){this.uchar=" ",this.penState.reset()},y.setChar=function(x,T){this.uchar=x,this.penState.copy(T)},y.setPenState=function(x){this.penState.copy(x)},y.equals=function(x){return this.uchar===x.uchar&&this.penState.equals(x.penState)},y.copy=function(x){this.uchar=x.uchar,this.penState.copy(x.penState)},y.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},_}(),n=function(){function _(L){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var x=0;x<S;x++)this.chars.push(new e);this.logger=L,this.pos=0,this.currPenState=new t}var y=_.prototype;return y.equals=function(x){for(var T=!0,O=0;O<S;O++)if(!this.chars[O].equals(x.chars[O])){T=!1;break}return T},y.copy=function(x){for(var T=0;T<S;T++)this.chars[T].copy(x.chars[T])},y.isEmpty=function(){for(var x=!0,T=0;T<S;T++)if(!this.chars[T].isEmpty()){x=!1;break}return x},y.setCursor=function(x){this.pos!==x&&(this.pos=x),this.pos<0?(this.logger.log(v.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>S&&(this.logger.log(v.DEBUG,"Too large cursor position "+this.pos),this.pos=S)},y.moveCursor=function(x){var T=this.pos+x;if(x>1)for(var O=this.pos+1;O<T+1;O++)this.chars[O].setPenState(this.currPenState);this.setCursor(T)},y.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},y.insertChar=function(x){x>=144&&this.backSpace();var T=m(x);if(this.pos>=S){this.logger.log(v.ERROR,"Cannot insert "+x.toString(16)+" ("+T+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(T,this.currPenState),this.moveCursor(1)},y.clearFromPos=function(x){var T;for(T=x;T<S;T++)this.chars[T].reset()},y.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},y.clearToEndOfRow=function(){this.clearFromPos(this.pos)},y.getTextString=function(){for(var x=[],T=!0,O=0;O<S;O++){var R=this.chars[O].uchar;R!==" "&&(T=!1),x.push(R)}return T?"":x.join("")},y.setPenStyles=function(x){this.currPenState.setStyles(x);var T=this.chars[this.pos];T.setPenState(this.currPenState)},_}(),r=function(){function _(L){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var x=0;x<D;x++)this.rows.push(new n(L));this.logger=L,this.currRow=D-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var y=_.prototype;return y.reset=function(){for(var x=0;x<D;x++)this.rows[x].clear();this.currRow=D-1},y.equals=function(x){for(var T=!0,O=0;O<D;O++)if(!this.rows[O].equals(x.rows[O])){T=!1;break}return T},y.copy=function(x){for(var T=0;T<D;T++)this.rows[T].copy(x.rows[T])},y.isEmpty=function(){for(var x=!0,T=0;T<D;T++)if(!this.rows[T].isEmpty()){x=!1;break}return x},y.backSpace=function(){var x=this.rows[this.currRow];x.backSpace()},y.clearToEndOfRow=function(){var x=this.rows[this.currRow];x.clearToEndOfRow()},y.insertChar=function(x){var T=this.rows[this.currRow];T.insertChar(x)},y.setPen=function(x){var T=this.rows[this.currRow];T.setPenStyles(x)},y.moveCursor=function(x){var T=this.rows[this.currRow];T.moveCursor(x)},y.setCursor=function(x){this.logger.log(v.INFO,"setCursor: "+x);var T=this.rows[this.currRow];T.setCursor(x)},y.setPAC=function(x){this.logger.log(v.INFO,"pacData = "+JSON.stringify(x));var T=x.row-1;if(this.nrRollUpRows&&T<this.nrRollUpRows-1&&(T=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==T){for(var O=0;O<D;O++)this.rows[O].clear();var R=this.currRow+1-this.nrRollUpRows,I=this.lastOutputScreen;if(I){var C=I.rows[R].cueStartTime,w=this.logger.time;if(C&&w!==null&&C<w)for(var F=0;F<this.nrRollUpRows;F++)this.rows[T-this.nrRollUpRows+F+1].copy(I.rows[R+F])}}this.currRow=T;var B=this.rows[this.currRow];if(x.indent!==null){var k=x.indent,U=Math.max(k-1,0);B.setCursor(x.indent),x.color=B.chars[U].penState.foreground}var N={foreground:x.color,underline:x.underline,italics:x.italics,background:"black",flash:!1};this.setPen(N)},y.setBkgData=function(x){this.logger.log(v.INFO,"bkgData = "+JSON.stringify(x)),this.backSpace(),this.setPen(x),this.insertChar(32)},y.setRollUpRows=function(x){this.nrRollUpRows=x},y.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(v.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(v.TEXT,this.getDisplayText());var x=this.currRow+1-this.nrRollUpRows,T=this.rows.splice(x,1)[0];T.clear(),this.rows.splice(this.currRow,0,T),this.logger.log(v.INFO,"Rolling up")},y.getDisplayText=function(x){x=x||!1;for(var T=[],O="",R=-1,I=0;I<D;I++){var C=this.rows[I].getTextString();C&&(R=I+1,x?T.push("Row "+R+": '"+C+"'"):T.push(C.trim()))}return T.length>0&&(x?O="["+T.join(" | ")+"]":O=T.join(`
`)),O},y.getTextAndFormat=function(){return this.rows},_}(),l=function(){function _(L,x,T){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=L,this.outputFilter=x,this.mode=null,this.verbose=0,this.displayedMemory=new r(T),this.nonDisplayedMemory=new r(T),this.lastOutputScreen=new r(T),this.currRollUpRow=this.displayedMemory.rows[D-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=T}var y=_.prototype;return y.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[D-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},y.getHandler=function(){return this.outputFilter},y.setHandler=function(x){this.outputFilter=x},y.setPAC=function(x){this.writeScreen.setPAC(x)},y.setBkgData=function(x){this.writeScreen.setBkgData(x)},y.setMode=function(x){x!==this.mode&&(this.mode=x,this.logger.log(v.INFO,"MODE="+x),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=x)},y.insertChars=function(x){for(var T=0;T<x.length;T++)this.writeScreen.insertChar(x[T]);var O=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(v.INFO,O+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(v.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},y.ccRCL=function(){this.logger.log(v.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},y.ccBS=function(){this.logger.log(v.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},y.ccAOF=function(){},y.ccAON=function(){},y.ccDER=function(){this.logger.log(v.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},y.ccRU=function(x){this.logger.log(v.INFO,"RU("+x+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(x)},y.ccFON=function(){this.logger.log(v.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},y.ccRDC=function(){this.logger.log(v.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},y.ccTR=function(){this.logger.log(v.INFO,"TR"),this.setMode("MODE_TEXT")},y.ccRTD=function(){this.logger.log(v.INFO,"RTD"),this.setMode("MODE_TEXT")},y.ccEDM=function(){this.logger.log(v.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},y.ccCR=function(){this.logger.log(v.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},y.ccENM=function(){this.logger.log(v.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},y.ccEOC=function(){if(this.logger.log(v.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var x=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=x,this.writeScreen=this.nonDisplayedMemory,this.logger.log(v.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},y.ccTO=function(x){this.logger.log(v.INFO,"TO("+x+") - Tab Offset"),this.writeScreen.moveCursor(x)},y.ccMIDROW=function(x){var T={flash:!1};if(T.underline=x%2===1,T.italics=x>=46,T.italics)T.foreground="white";else{var O=Math.floor(x/2)-16,R=["white","green","blue","cyan","red","yellow","magenta"];T.foreground=R[O]}this.logger.log(v.INFO,"MIDROW: "+JSON.stringify(T)),this.writeScreen.setPen(T)},y.outputDataUpdate=function(x){x===void 0&&(x=!1);var T=this.logger.time;T!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=T:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,T,this.lastOutputScreen),x&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:T),this.lastOutputScreen.copy(this.displayedMemory))},y.cueSplitAtTime=function(x){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,x,this.displayedMemory),this.cueStartTime=x))},_}(),s=function(){function _(L,x,T){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var O=new c;this.channels=[null,new l(L,x,O),new l(L+1,T,O)],this.cmdHistory=A(),this.logger=O}var y=_.prototype;return y.getHandler=function(x){return this.channels[x].getHandler()},y.setHandler=function(x,T){this.channels[x].setHandler(T)},y.addData=function(x,T){var O,R,I,C=!1;this.logger.time=x;for(var w=0;w<T.length;w+=2)if(R=T[w]&127,I=T[w+1]&127,!(R===0&&I===0)){if(this.logger.log(v.DATA,"["+h([T[w],T[w+1]])+"] -> ("+h([R,I])+")"),O=this.parseCmd(R,I),O||(O=this.parseMidrow(R,I)),O||(O=this.parsePAC(R,I)),O||(O=this.parseBackgroundAttributes(R,I)),!O&&(C=this.parseChars(R,I),C)){var F=this.currentChannel;if(F&&F>0){var B=this.channels[F];B.insertChars(C)}else this.logger.log(v.WARNING,"No channel found yet. TEXT-MODE?")}!O&&!C&&this.logger.log(v.WARNING,"Couldn't parse cleaned data "+h([R,I])+" orig: "+h([T[w],T[w+1]]))}},y.parseCmd=function(x,T){var O=this.cmdHistory,R=(x===20||x===28||x===21||x===29)&&T>=32&&T<=47,I=(x===23||x===31)&&T>=33&&T<=35;if(!(R||I))return!1;if(p(x,T,O))return a(null,null,O),this.logger.log(v.DEBUG,"Repeated command ("+h([x,T])+") is dropped"),!0;var C=x===20||x===21||x===23?1:2,w=this.channels[C];return x===20||x===21||x===28||x===29?T===32?w.ccRCL():T===33?w.ccBS():T===34?w.ccAOF():T===35?w.ccAON():T===36?w.ccDER():T===37?w.ccRU(2):T===38?w.ccRU(3):T===39?w.ccRU(4):T===40?w.ccFON():T===41?w.ccRDC():T===42?w.ccTR():T===43?w.ccRTD():T===44?w.ccEDM():T===45?w.ccCR():T===46?w.ccENM():T===47&&w.ccEOC():w.ccTO(T-32),a(x,T,O),this.currentChannel=C,!0},y.parseMidrow=function(x,T){var O=0;if((x===17||x===25)&&T>=32&&T<=47){if(x===17?O=1:O=2,O!==this.currentChannel)return this.logger.log(v.ERROR,"Mismatch channel in midrow parsing"),!1;var R=this.channels[O];return R?(R.ccMIDROW(T),this.logger.log(v.DEBUG,"MIDROW ("+h([x,T])+")"),!0):!1}return!1},y.parsePAC=function(x,T){var O,R=this.cmdHistory,I=(x>=17&&x<=23||x>=25&&x<=31)&&T>=64&&T<=127,C=(x===16||x===24)&&T>=64&&T<=95;if(!(I||C))return!1;if(p(x,T,R))return a(null,null,R),!0;var w=x<=23?1:2;T>=64&&T<=95?O=w===1?g[x]:i[x]:O=w===1?d[x]:f[x];var F=this.channels[w];return F?(F.setPAC(this.interpretPAC(O,T)),a(x,T,R),this.currentChannel=w,!0):!1},y.interpretPAC=function(x,T){var O,R={color:null,italics:!1,indent:null,underline:!1,row:x};return T>95?O=T-96:O=T-64,R.underline=(O&1)===1,O<=13?R.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(O/2)]:O<=15?(R.italics=!0,R.color="white"):R.indent=Math.floor((O-16)/2)*4,R},y.parseChars=function(x,T){var O,R=null,I=null;if(x>=25?(O=2,I=x-8):(O=1,I=x),I>=17&&I<=19){var C;I===17?C=T+80:I===18?C=T+112:C=T+144,this.logger.log(v.INFO,"Special char '"+m(C)+"' in channel "+O),R=[C]}else x>=32&&x<=127&&(R=T===0?[x]:[x,T]);if(R){var w=h(R);this.logger.log(v.DEBUG,"Char codes =  "+w.join(",")),a(x,T,this.cmdHistory)}return R},y.parseBackgroundAttributes=function(x,T){var O=(x===16||x===24)&&T>=32&&T<=47,R=(x===23||x===31)&&T>=45&&T<=47;if(!(O||R))return!1;var I,C={};x===16||x===24?(I=Math.floor((T-32)/2),C.background=o[I],T%2===1&&(C.background=C.background+"_semi")):T===45?C.background="transparent":(C.foreground="black",T===47&&(C.underline=!0));var w=x<=23?1:2,F=this.channels[w];return F.setBkgData(C),a(x,T,this.cmdHistory),!0},y.reset=function(){for(var x=0;x<Object.keys(this.channels).length;x++){var T=this.channels[x];T&&T.reset()}this.cmdHistory=A()},y.cueSplitAtTime=function(x){for(var T=0;T<this.channels.length;T++){var O=this.channels[T];O&&O.cueSplitAtTime(x)}},_}();function a(_,y,L){L.a=_,L.b=y}function p(_,y,L){return L.a===_&&L.b===y}function A(){return{a:null,b:null}}P.default=s},"./src/utils/codecs.ts":function(M,P,E){E.r(P),E.d(P,"isCodecType",function(){return u}),E.d(P,"isCodecSupportedInMp4",function(){return m});var b={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function u(D,S){var g=b[S];return!!g&&g[D.slice(0,4)]===!0}function m(D,S){return MediaSource.isTypeSupported((S||"video")+'/mp4;codecs="'+D+'"')}},"./src/utils/cues.ts":function(M,P,E){E.r(P);var b=E("./src/utils/vttparser.ts"),u=E("./src/utils/webvtt-parser.ts"),m=E("./src/utils/texttrack-utils.ts"),D=/\s/,S={newCue:function(d,i,f,o){for(var v=[],c,h,t,e,n,r=self.VTTCue||self.TextTrackCue,l=0;l<o.rows.length;l++)if(c=o.rows[l],t=!0,e=0,n="",!c.isEmpty()){for(var s=0;s<c.chars.length;s++)D.test(c.chars[s].uchar)&&t?e++:(n+=c.chars[s].uchar,t=!1);c.cueStartTime=i,i===f&&(f+=1e-4),e>=16?e--:e++;var a=Object(b.fixLineBreaks)(n.trim()),p=Object(u.generateCueId)(i,f,a);(!d||!d.cues||!d.cues.getCueById(p))&&(h=new r(i,f,a),h.id=p,h.line=l+1,h.align="left",h.position=10+Math.min(80,Math.floor(e*8/32)*10),v.push(h))}return d&&v.length&&(v.sort(function(A,_){return A.line==="auto"||_.line==="auto"?0:A.line>8&&_.line>8?_.line-A.line:A.line-_.line}),v.forEach(function(A){return Object(m.addCueToTrack)(d,A)})),v}};P.default=S},"./src/utils/discontinuities.ts":function(M,P,E){E.r(P),E.d(P,"findFirstFragWithCC",function(){return D}),E.d(P,"shouldAlignOnDiscontinuities",function(){return S}),E.d(P,"findDiscontinuousReferenceFrag",function(){return g}),E.d(P,"adjustSlidingStart",function(){return i}),E.d(P,"alignStream",function(){return f}),E.d(P,"alignPDT",function(){return v}),E.d(P,"alignFragmentByPDTDelta",function(){return c}),E.d(P,"alignMediaPlaylistByPDT",function(){return h});var b=E("./src/polyfills/number.ts"),u=E("./src/utils/logger.ts"),m=E("./src/controller/level-helper.ts");function D(t,e){for(var n=null,r=0,l=t.length;r<l;r++){var s=t[r];if(s&&s.cc===e){n=s;break}}return n}function S(t,e,n){return!!(e.details&&(n.endCC>n.startCC||t&&t.cc<n.startCC))}function g(t,e){var n=t.fragments,r=e.fragments;if(!r.length||!n.length){u.logger.log("No fragments to align");return}var l=D(n,r[0].cc);if(!l||l&&!l.startPTS){u.logger.log("No frag in previous level to align on");return}return l}function d(t,e){if(t){var n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}}function i(t,e){for(var n=e.fragments,r=0,l=n.length;r<l;r++)d(n[r],t);e.fragmentHint&&d(e.fragmentHint,t),e.alignedSliding=!0}function f(t,e,n){!e||(o(t,n,e),!n.alignedSliding&&e.details&&v(n,e.details),!n.alignedSliding&&e.details&&!n.skippedSegments&&Object(m.adjustSliding)(e.details,n))}function o(t,e,n){if(S(t,n,e)){var r=g(n.details,e);r&&Object(b.isFiniteNumber)(r.start)&&(u.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),i(r.start,e))}}function v(t,e){if(!(!e.fragments.length||!t.hasProgramDateTime||!e.hasProgramDateTime)){var n=e.fragments[0].programDateTime,r=t.fragments[0].programDateTime,l=(r-n)/1e3+e.fragments[0].start;l&&Object(b.isFiniteNumber)(l)&&(u.logger.log("Adjusting PTS using programDateTime delta "+(r-n)+"ms, sliding:"+l.toFixed(3)+" "+t.url+" "),i(l,t))}}function c(t,e){var n=t.programDateTime;if(!!n){var r=(n-e)/1e3;t.start=t.startPTS=r,t.endPTS=r+t.duration}}function h(t,e){if(!(!e.fragments.length||!t.hasProgramDateTime||!e.hasProgramDateTime)){var n=e.fragments[0].programDateTime,r=e.fragments[0].start,l=n-r*1e3;t.fragments.forEach(function(s){c(s,l)}),t.fragmentHint&&c(t.fragmentHint,l),t.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(M,P,E){E.r(P);var b=E("./src/utils/ewma.ts"),u=function(){function m(S,g,d){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=d,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new b.default(S),this.fast_=new b.default(g)}var D=m.prototype;return D.update=function(g,d){var i=this.slow_,f=this.fast_;this.slow_.halfLife!==g&&(this.slow_=new b.default(g,i.getEstimate(),i.getTotalWeight())),this.fast_.halfLife!==d&&(this.fast_=new b.default(d,f.getEstimate(),f.getTotalWeight()))},D.sample=function(g,d){g=Math.max(g,this.minDelayMs_);var i=8*d,f=g/1e3,o=i/f;this.fast_.sample(f,o),this.slow_.sample(f,o)},D.canEstimate=function(){var g=this.fast_;return g&&g.getTotalWeight()>=this.minWeight_},D.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},D.destroy=function(){},m}();P.default=u},"./src/utils/ewma.ts":function(M,P,E){E.r(P);var b=function(){function u(D,S,g){S===void 0&&(S=0),g===void 0&&(g=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=D,this.alpha_=D?Math.exp(Math.log(.5)/D):0,this.estimate_=S,this.totalWeight_=g}var m=u.prototype;return m.sample=function(S,g){var d=Math.pow(this.alpha_,S);this.estimate_=g*(1-d)+d*this.estimate_,this.totalWeight_+=S},m.getTotalWeight=function(){return this.totalWeight_},m.getEstimate=function(){if(this.alpha_){var S=1-Math.pow(this.alpha_,this.totalWeight_);if(S)return this.estimate_/S}return this.estimate_},u}();P.default=b},"./src/utils/fetch-loader.ts":function(M,P,E){E.r(P),E.d(P,"fetchSupported",function(){return c});var b=E("./src/polyfills/number.ts"),u=E("./src/loader/load-stats.ts"),m=E("./src/demux/chunk-cache.ts");function D(r,l){r.prototype=Object.create(l.prototype),r.prototype.constructor=r,f(r,l)}function S(r){var l=typeof Map=="function"?new Map:void 0;return S=function(a){if(a===null||!i(a))return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(typeof l<"u"){if(l.has(a))return l.get(a);l.set(a,p)}function p(){return g(a,arguments,o(this).constructor)}return p.prototype=Object.create(a.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),f(p,a)},S(r)}function g(r,l,s){return d()?g=Reflect.construct.bind():g=function(p,A,_){var y=[null];y.push.apply(y,A);var L=Function.bind.apply(p,y),x=new L;return _&&f(x,_.prototype),x},g.apply(null,arguments)}function d(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function i(r){return Function.toString.call(r).indexOf("[native code]")!==-1}function f(r,l){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(a,p){return a.__proto__=p,a},f(r,l)}function o(r){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(s){return s.__proto__||Object.getPrototypeOf(s)},o(r)}function v(){return v=Object.assign?Object.assign.bind():function(r){for(var l=1;l<arguments.length;l++){var s=arguments[l];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(r[a]=s[a])}return r},v.apply(this,arguments)}function c(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var h=function(){function r(s){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=s.fetchSetup||e,this.controller=new self.AbortController,this.stats=new u.LoadStats}var l=r.prototype;return l.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},l.abortInternal=function(){var a=this.response;(!a||!a.ok)&&(this.stats.aborted=!0,this.controller.abort())},l.abort=function(){var a;this.abortInternal(),(a=this.callbacks)!==null&&a!==void 0&&a.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},l.load=function(a,p,A){var _=this,y=this.stats;if(y.loading.start)throw new Error("Loader can only be used once.");y.loading.start=self.performance.now();var L=t(a,this.controller.signal),x=A.onProgress,T=a.responseType==="arraybuffer",O=T?"byteLength":"length";this.context=a,this.config=p,this.callbacks=A,this.request=this.fetchSetup(a,L),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){_.abortInternal(),A.onTimeout(y,a,_.response)},p.timeout),self.fetch(this.request).then(function(R){if(_.response=_.loader=R,!R.ok){var I=R.status,C=R.statusText;throw new n(C||"fetch, bad network response",I,R)}return y.loading.first=Math.max(self.performance.now(),y.loading.start),y.total=parseInt(R.headers.get("Content-Length")||"0"),x&&Object(b.isFiniteNumber)(p.highWaterMark)?_.loadProgressively(R,y,a,p.highWaterMark,x):T?R.arrayBuffer():R.text()}).then(function(R){var I=_.response;self.clearTimeout(_.requestTimeout),y.loading.end=Math.max(self.performance.now(),y.loading.first),y.loaded=y.total=R[O];var C={url:I.url,data:R};x&&!Object(b.isFiniteNumber)(p.highWaterMark)&&x(y,a,R,I),A.onSuccess(C,y,a,I)}).catch(function(R){if(self.clearTimeout(_.requestTimeout),!y.aborted){var I=R&&R.code||0,C=R?R.message:null;A.onError({code:I,text:C},a,R?R.details:null)}})},l.getCacheAge=function(){var a=null;if(this.response){var p=this.response.headers.get("age");a=p?parseFloat(p):null}return a},l.loadProgressively=function(a,p,A,_,y){_===void 0&&(_=0);var L=new m.default,x=a.body.getReader(),T=function O(){return x.read().then(function(R){if(R.done)return L.dataLength&&y(p,A,L.flush(),a),Promise.resolve(new ArrayBuffer(0));var I=R.value,C=I.length;return p.loaded+=C,C<_||L.dataLength?(L.push(I),L.dataLength>=_&&y(p,A,L.flush(),a)):y(p,A,I,a),O()}).catch(function(){return Promise.reject()})};return T()},r}();function t(r,l){var s={method:"GET",mode:"cors",credentials:"same-origin",signal:l,headers:new self.Headers(v({},r.headers))};return r.rangeEnd&&s.headers.set("Range","bytes="+r.rangeStart+"-"+String(r.rangeEnd-1)),s}function e(r,l){return new self.Request(r.url,l)}var n=function(r){D(l,r);function l(s,a,p){var A;return A=r.call(this,s)||this,A.code=void 0,A.details=void 0,A.code=a,A.details=p,A}return l}(S(Error));P.default=h},"./src/utils/imsc1-ttml-parser.ts":function(M,P,E){E.r(P),E.d(P,"IMSC1_CODEC",function(){return i}),E.d(P,"parseIMSC1",function(){return c});var b=E("./src/utils/mp4-tools.ts"),u=E("./src/utils/vttparser.ts"),m=E("./src/utils/vttcue.ts"),D=E("./src/demux/id3.ts"),S=E("./src/utils/timescale-conversion.ts"),g=E("./src/utils/webvtt-parser.ts");function d(){return d=Object.assign?Object.assign.bind():function(_){for(var y=1;y<arguments.length;y++){var L=arguments[y];for(var x in L)Object.prototype.hasOwnProperty.call(L,x)&&(_[x]=L[x])}return _},d.apply(this,arguments)}var i="stpp.ttml.im1t",f=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,o=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,v={left:"start",center:"center",right:"end",start:"start",end:"end"};function c(_,y,L,x,T){var O=Object(b.findBox)(new Uint8Array(_),["mdat"]);if(O.length===0){T(new Error("Could not parse IMSC1 mdat"));return}var R=O.map(function(C){return Object(D.utf8ArrayToStr)(C)}),I=Object(S.toTimescaleFromScale)(y,1,L);try{R.forEach(function(C){return x(h(C,I))})}catch(C){T(C)}}function h(_,y){var L=new DOMParser,x=L.parseFromString(_,"text/xml"),T=x.getElementsByTagName("tt")[0];if(!T)throw new Error("Invalid ttml");var O={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},R=Object.keys(O).reduce(function(B,k){return B[k]=T.getAttribute("ttp:"+k)||O[k],B},{}),I=T.getAttribute("xml:space")!=="preserve",C=e(t(T,"styling","style")),w=e(t(T,"layout","region")),F=t(T,"body","[begin]");return[].map.call(F,function(B){var k=n(B,I);if(!k||!B.hasAttribute("begin"))return null;var U=a(B.getAttribute("begin"),R),N=a(B.getAttribute("dur"),R),j=a(B.getAttribute("end"),R);if(U===null)throw s(B);if(j===null){if(N===null)throw s(B);j=U+N}var K=new m.default(U-y,j-y,k);K.id=Object(g.generateCueId)(K.startTime,K.endTime,K.text);var H=w[B.getAttribute("region")],V=C[B.getAttribute("style")];K.position=10,K.size=80;var G=r(H,V,C),ee=G.textAlign;if(ee){var q=v[ee];q&&(K.lineAlign=q),K.align=ee}return d(K,G),K}).filter(function(B){return B!==null})}function t(_,y,L){var x=_.getElementsByTagName(y)[0];return x?[].slice.call(x.querySelectorAll(L)):[]}function e(_){return _.reduce(function(y,L){var x=L.getAttribute("xml:id");return x&&(y[x]=L),y},{})}function n(_,y){return[].slice.call(_.childNodes).reduce(function(L,x,T){var O;return x.nodeName==="br"&&T?L+`
`:(O=x.childNodes)!==null&&O!==void 0&&O.length?n(x,y):y?L+x.textContent.trim().replace(/\s+/g," "):L+x.textContent},"")}function r(_,y,L){var x="http://www.w3.org/ns/ttml#styling",T=null,O=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],R=_!=null&&_.hasAttribute("style")?_.getAttribute("style"):null;return R&&L.hasOwnProperty(R)&&(T=L[R]),O.reduce(function(I,C){var w=l(y,x,C)||l(_,x,C)||l(T,x,C);return w&&(I[C]=w),I},{})}function l(_,y,L){return _&&_.hasAttributeNS(y,L)?_.getAttributeNS(y,L):null}function s(_){return new Error("Could not parse ttml timestamp "+_)}function a(_,y){if(!_)return null;var L=Object(u.parseTimeStamp)(_);return L===null&&(f.test(_)?L=p(_,y):o.test(_)&&(L=A(_,y))),L}function p(_,y){var L=f.exec(_),x=(L[4]|0)+(L[5]|0)/y.subFrameRate;return(L[1]|0)*3600+(L[2]|0)*60+(L[3]|0)+x/y.frameRate}function A(_,y){var L=o.exec(_),x=Number(L[1]),T=L[2];switch(T){case"h":return x*3600;case"m":return x*60;case"ms":return x*1e3;case"f":return x/y.frameRate;case"t":return x/y.tickRate}return x}},"./src/utils/logger.ts":function(M,P,E){E.r(P),E.d(P,"enableLogs",function(){return g}),E.d(P,"logger",function(){return d});var b=function(){},u={trace:b,debug:b,log:b,warn:b,info:b,error:b},m=u;function D(i){var f=self.console[i];return f?f.bind(self.console,"["+i+"] >"):b}function S(i){for(var f=arguments.length,o=new Array(f>1?f-1:0),v=1;v<f;v++)o[v-1]=arguments[v];o.forEach(function(c){m[c]=i[c]?i[c].bind(i):D(c)})}function g(i){if(self.console&&i===!0||typeof i=="object"){S(i,"debug","log","info","warn","error");try{m.log()}catch{m=u}}else m=u}var d=m},"./src/utils/mediakeys-helper.ts":function(M,P,E){E.r(P),E.d(P,"KeySystems",function(){return b}),E.d(P,"requestMediaKeySystemAccess",function(){return u});var b;(function(m){m.WIDEVINE="com.widevine.alpha",m.PLAYREADY="com.microsoft.playready"})(b||(b={}));var u=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(M,P,E){E.r(P),E.d(P,"getMediaSource",function(){return b});function b(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(M,P,E){E.r(P),E.d(P,"RemuxerTrackIdConfig",function(){return g}),E.d(P,"bin2str",function(){return d}),E.d(P,"readUint16",function(){return i}),E.d(P,"readUint32",function(){return f}),E.d(P,"readSint32",function(){return o}),E.d(P,"writeUint32",function(){return v}),E.d(P,"findBox",function(){return c}),E.d(P,"parseSegmentIndex",function(){return h}),E.d(P,"parseInitSegment",function(){return t}),E.d(P,"getStartDTS",function(){return e}),E.d(P,"getDuration",function(){return n}),E.d(P,"computeRawDurationFromSamples",function(){return r}),E.d(P,"offsetStartDTS",function(){return l}),E.d(P,"segmentValidRange",function(){return s}),E.d(P,"appendUint8Array",function(){return a}),E.d(P,"parseSamples",function(){return p}),E.d(P,"parseSEIMessageFromNALu",function(){return y}),E.d(P,"parseEmsg",function(){return x});var b=E("./src/utils/typed-array.ts"),u=E("./src/loader/fragment.ts"),m=E("./src/demux/id3.ts"),D=Math.pow(2,32)-1,S=[].push,g={video:1,audio:2,id3:3,text:4};function d(T){return String.fromCharCode.apply(null,T)}function i(T,O){var R=T[O]<<8|T[O+1];return R<0?65536+R:R}function f(T,O){var R=o(T,O);return R<0?4294967296+R:R}function o(T,O){return T[O]<<24|T[O+1]<<16|T[O+2]<<8|T[O+3]}function v(T,O,R){T[O]=R>>24,T[O+1]=R>>16&255,T[O+2]=R>>8&255,T[O+3]=R&255}function c(T,O){var R=[];if(!O.length)return R;for(var I=T.byteLength,C=0;C<I;){var w=f(T,C),F=d(T.subarray(C+4,C+8)),B=w>1?C+w:I;if(F===O[0])if(O.length===1)R.push(T.subarray(C+8,B));else{var k=c(T.subarray(C+8,B),O.slice(1));k.length&&S.apply(R,k)}C=B}return R}function h(T){var O=[],R=T[0],I=8,C=f(T,I);I+=4;var w=0,F=0;R===0?I+=8:I+=16,I+=2;var B=T.length+F,k=i(T,I);I+=2;for(var U=0;U<k;U++){var N=I,j=f(T,N);N+=4;var K=j&2147483647,H=(j&2147483648)>>>31;if(H===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var V=f(T,N);N+=4,O.push({referenceSize:K,subsegmentDuration:V,info:{duration:V/C,start:B,end:B+K-1}}),B+=K,N+=4,I=N}return{earliestPresentationTime:w,timescale:C,version:R,referencesCount:k,references:O}}function t(T){for(var O=[],R=c(T,["moov","trak"]),I=0;I<R.length;I++){var C=R[I],w=c(C,["tkhd"])[0];if(w){var F=w[0],B=F===0?12:20,k=f(w,B),U=c(C,["mdia","mdhd"])[0];if(U){F=U[0],B=F===0?12:20;var N=f(U,B),j=c(C,["mdia","hdlr"])[0];if(j){var K=d(j.subarray(8,12)),H={soun:u.ElementaryStreamTypes.AUDIO,vide:u.ElementaryStreamTypes.VIDEO}[K];if(H){var V=c(C,["mdia","minf","stbl","stsd"])[0],G=void 0;V&&(G=d(V.subarray(12,16))),O[k]={timescale:N,type:H},O[H]={timescale:N,id:k,codec:G}}}}}}var ee=c(T,["moov","mvex","trex"]);return ee.forEach(function(q){var z=f(q,4),X=O[z];X&&(X.default={duration:f(q,12),flags:f(q,20)})}),O}function e(T,O){return c(O,["moof","traf"]).reduce(function(R,I){var C=c(I,["tfdt"])[0],w=C[0],F=c(I,["tfhd"]).reduce(function(B,k){var U=f(k,4),N=T[U];if(N){var j=f(C,4);w===1&&(j*=Math.pow(2,32),j+=f(C,8));var K=N.timescale||9e4,H=j/K;if(isFinite(H)&&(B===null||H<B))return H}return B},null);return F!==null&&isFinite(F)&&(R===null||F<R)?F:R},null)||0}function n(T,O){for(var R=0,I=0,C=0,w=c(T,["moof","traf"]),F=0;F<w.length;F++){var B=w[F],k=c(B,["tfhd"])[0],U=f(k,4),N=O[U];if(!!N){var j=N.default,K=f(k,0)|(j==null?void 0:j.flags),H=j==null?void 0:j.duration;K&8&&(K&2?H=f(k,12):H=f(k,8));for(var V=N.timescale||9e4,G=c(B,["trun"]),ee=0;ee<G.length;ee++){if(R=r(G[ee]),!R&&H){var q=f(G[ee],4);R=H*q}N.type===u.ElementaryStreamTypes.VIDEO?I+=R/V:N.type===u.ElementaryStreamTypes.AUDIO&&(C+=R/V)}}}if(I===0&&C===0){for(var z=0,X=c(T,["sidx"]),J=0;J<X.length;J++){var ie=h(X[J]);ie!=null&&ie.references&&(z+=ie.references.reduce(function(ae,se){return ae+se.info.duration||0},0))}return z}return I||C}function r(T){var O=f(T,0),R=8;O&1&&(R+=4),O&4&&(R+=4);for(var I=0,C=f(T,4),w=0;w<C;w++){if(O&256){var F=f(T,R);I+=F,R+=4}O&512&&(R+=4),O&1024&&(R+=4),O&2048&&(R+=4)}return I}function l(T,O,R){c(O,["moof","traf"]).forEach(function(I){c(I,["tfhd"]).forEach(function(C){var w=f(C,4),F=T[w];if(!!F){var B=F.timescale||9e4;c(I,["tfdt"]).forEach(function(k){var U=k[0],N=f(k,4);if(U===0)N-=R*B,N=Math.max(N,0),v(k,4,N);else{N*=Math.pow(2,32),N+=f(k,8),N-=R*B,N=Math.max(N,0);var j=Math.floor(N/(D+1)),K=Math.floor(N%(D+1));v(k,4,j),v(k,8,K)}})}})})}function s(T){var O={valid:null,remainder:null},R=c(T,["moof"]);if(R){if(R.length<2)return O.remainder=T,O}else return O;var I=R[R.length-1];return O.valid=Object(b.sliceUint8)(T,0,I.byteOffset-8),O.remainder=Object(b.sliceUint8)(T,I.byteOffset-8),O}function a(T,O){var R=new Uint8Array(T.length+O.length);return R.set(T),R.set(O,T.length),R}function p(T,O){var R=[],I=O.samples,C=O.timescale,w=O.id,F=!1,B=c(I,["moof"]);return B.map(function(k){var U=k.byteOffset-8,N=c(k,["traf"]);N.map(function(j){var K=c(j,["tfdt"]).map(function(H){var V=H[0],G=f(H,4);return V===1&&(G*=Math.pow(2,32),G+=f(H,8)),G/C})[0];return K!==void 0&&(T=K),c(j,["tfhd"]).map(function(H){var V=f(H,4),G=f(H,0)&16777215,ee=(G&1)!==0,q=(G&2)!==0,z=(G&8)!==0,X=0,J=(G&16)!==0,ie=0,ae=(G&32)!==0,se=8;V===w&&(ee&&(se+=8),q&&(se+=4),z&&(X=f(H,se),se+=4),J&&(ie=f(H,se),se+=4),ae&&(se+=4),O.type==="video"&&(F=A(O.codec)),c(j,["trun"]).map(function(le){var ue=le[0],Z=f(le,0)&16777215,oe=(Z&1)!==0,de=0,ce=(Z&4)!==0,ve=(Z&256)!==0,he=0,ye=(Z&512)!==0,fe=0,me=(Z&1024)!==0,W=(Z&2048)!==0,Y=0,$=f(le,4),Q=8;oe&&(de=f(le,Q),Q+=4),ce&&(Q+=4);for(var re=de+U,ne=0;ne<$;ne++){if(ve?(he=f(le,Q),Q+=4):he=X,ye?(fe=f(le,Q),Q+=4):fe=ie,me&&(Q+=4),W&&(ue===0?Y=f(le,Q):Y=o(le,Q),Q+=4),O.type===u.ElementaryStreamTypes.VIDEO)for(var te=0;te<fe;){var Ee=f(I,re);re+=4;var pe=I[re]&31;if(_(F,pe)){var ge=I.subarray(re,re+Ee);y(ge,T+Y/C,R)}re+=Ee,te+=Ee+4}T+=he/C}}))})})}),R}function A(T){if(!T)return!1;var O=T.indexOf("."),R=O<0?T:T.substring(0,O);return R==="hvc1"||R==="hev1"||R==="dvh1"||R==="dvhe"}function _(T,O){return T?O===39||O===40:O===6}function y(T,O,R){var I=L(T),C=0;C++;for(var w=0,F=0,B=!1,k=0;C<I.length;){w=0;do{if(C>=I.length)break;k=I[C++],w+=k}while(k===255);F=0;do{if(C>=I.length)break;k=I[C++],F+=k}while(k===255);var U=I.length-C;if(!B&&w===4&&C<I.length){B=!0;var N=I[C++];if(N===181){var j=i(I,C);if(C+=2,j===49){var K=f(I,C);if(C+=4,K===1195456820){var H=I[C++];if(H===3){var V=I[C++],G=31&V,ee=64&V,q=ee?2+G*3:0,z=new Uint8Array(q);if(ee){z[0]=V;for(var X=1;X<q;X++)z[X]=I[C++]}R.push({type:H,payloadType:w,pts:O,bytes:z})}}}}}else if(w===5&&F<U){if(B=!0,F>16){for(var J=[],ie=0;ie<16;ie++){var ae=I[C++].toString(16);J.push(ae.length==1?"0"+ae:ae),(ie===3||ie===5||ie===7||ie===9)&&J.push("-")}for(var se=F-16,le=new Uint8Array(se),ue=0;ue<se;ue++)le[ue]=I[C++];R.push({payloadType:w,pts:O,uuid:J.join(""),userData:Object(m.utf8ArrayToStr)(le),userDataBytes:le})}}else if(F<U)C+=F;else if(F>U)break}}function L(T){for(var O=T.byteLength,R=[],I=1;I<O-2;)T[I]===0&&T[I+1]===0&&T[I+2]===3?(R.push(I+2),I+=2):I++;if(R.length===0)return T;var C=O-R.length,w=new Uint8Array(C),F=0;for(I=0;I<C;F++,I++)F===R[0]&&(F++,R.shift()),w[I]=T[F];return w}function x(T){var O=T[0],R="",I="",C=0,w=0,F=0,B=0,k=0,U=0;if(O===0){for(;d(T.subarray(U,U+1))!=="\0";)R+=d(T.subarray(U,U+1)),U+=1;for(R+=d(T.subarray(U,U+1)),U+=1;d(T.subarray(U,U+1))!=="\0";)I+=d(T.subarray(U,U+1)),U+=1;I+=d(T.subarray(U,U+1)),U+=1,C=f(T,12),w=f(T,16),B=f(T,20),k=f(T,24),U=28}else if(O===1){U+=4,C=f(T,U),U+=4;var N=f(T,U);U+=4;var j=f(T,U);for(U+=4,F=Math.pow(2,32)*N+j,Number.isSafeInteger(F)||(F=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),B=f(T,U),U+=4,k=f(T,U),U+=4;d(T.subarray(U,U+1))!=="\0";)R+=d(T.subarray(U,U+1)),U+=1;for(R+=d(T.subarray(U,U+1)),U+=1;d(T.subarray(U,U+1))!=="\0";)I+=d(T.subarray(U,U+1)),U+=1;I+=d(T.subarray(U,U+1)),U+=1}var K=T.subarray(U,T.byteLength);return{schemeIdUri:R,value:I,timeScale:C,presentationTime:F,presentationTimeDelta:w,eventDuration:B,id:k,payload:K}}},"./src/utils/output-filter.ts":function(M,P,E){E.r(P),E.d(P,"default",function(){return b});var b=function(){function u(D,S){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=D,this.trackName=S}var m=u.prototype;return m.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},m.newCue=function(S,g,d){(this.startTime===null||this.startTime>S)&&(this.startTime=S),this.endTime=g,this.screen=d,this.timelineController.createCaptionsTrack(this.trackName)},m.reset=function(){this.cueRanges=[],this.startTime=null},u}()},"./src/utils/texttrack-utils.ts":function(M,P,E){E.r(P),E.d(P,"sendAddTrackEvent",function(){return u}),E.d(P,"addCueToTrack",function(){return m}),E.d(P,"clearCurrentCues",function(){return D}),E.d(P,"removeCuesInRange",function(){return S}),E.d(P,"getCuesInRange",function(){return d});var b=E("./src/utils/logger.ts");function u(i,f){var o;try{o=new Event("addtrack")}catch{o=document.createEvent("Event"),o.initEvent("addtrack",!1,!1)}o.track=i,f.dispatchEvent(o)}function m(i,f){var o=i.mode;if(o==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(f.id))try{if(i.addCue(f),!i.cues.getCueById(f.id))throw new Error("addCue is failed for: "+f)}catch(c){b.logger.debug("[texttrack-utils]: "+c);var v=new self.TextTrackCue(f.startTime,f.endTime,f.text);v.id=f.id,i.addCue(v)}o==="disabled"&&(i.mode=o)}function D(i){var f=i.mode;if(f==="disabled"&&(i.mode="hidden"),i.cues)for(var o=i.cues.length;o--;)i.removeCue(i.cues[o]);f==="disabled"&&(i.mode=f)}function S(i,f,o,v){var c=i.mode;if(c==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0)for(var h=d(i.cues,f,o),t=0;t<h.length;t++)(!v||v(h[t]))&&i.removeCue(h[t]);c==="disabled"&&(i.mode=c)}function g(i,f){if(f<i[0].startTime)return 0;var o=i.length-1;if(f>i[o].endTime)return-1;for(var v=0,c=o;v<=c;){var h=Math.floor((c+v)/2);if(f<i[h].startTime)c=h-1;else if(f>i[h].startTime&&v<o)v=h+1;else return h}return i[v].startTime-f<f-i[c].startTime?v:c}function d(i,f,o){var v=[],c=g(i,f);if(c>-1)for(var h=c,t=i.length;h<t;h++){var e=i[h];if(e.startTime>=f&&e.endTime<=o)v.push(e);else if(e.startTime>o)return v}return v}},"./src/utils/time-ranges.ts":function(M,P,E){E.r(P);var b={toString:function(m){for(var D="",S=m.length,g=0;g<S;g++)D+="["+m.start(g).toFixed(3)+","+m.end(g).toFixed(3)+"]";return D}};P.default=b},"./src/utils/timescale-conversion.ts":function(M,P,E){E.r(P),E.d(P,"toTimescaleFromBase",function(){return u}),E.d(P,"toTimescaleFromScale",function(){return m}),E.d(P,"toMsFromMpegTsClock",function(){return D}),E.d(P,"toMpegTsClockFromTimescale",function(){return S});var b=9e4;function u(g,d,i,f){i===void 0&&(i=1),f===void 0&&(f=!1);var o=g*d*i;return f?Math.round(o):o}function m(g,d,i,f){return i===void 0&&(i=1),f===void 0&&(f=!1),u(g,d,1/i,f)}function D(g,d){return d===void 0&&(d=!1),u(g,1e3,1/b,d)}function S(g,d){return d===void 0&&(d=1),u(g,b,1/d)}},"./src/utils/typed-array.ts":function(M,P,E){E.r(P),E.d(P,"sliceUint8",function(){return b});function b(u,m,D){return Uint8Array.prototype.slice?u.slice(m,D):new Uint8Array(Array.prototype.slice.call(u,m,D))}},"./src/utils/vttcue.ts":function(M,P,E){E.r(P),P.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var b=["","lr","rl"],u=["start","middle","end","left","right"];function m(i,f){if(typeof f!="string"||!Array.isArray(i))return!1;var o=f.toLowerCase();return~i.indexOf(o)?o:!1}function D(i){return m(b,i)}function S(i){return m(u,i)}function g(i){for(var f=arguments.length,o=new Array(f>1?f-1:0),v=1;v<f;v++)o[v-1]=arguments[v];for(var c=1;c<arguments.length;c++){var h=arguments[c];for(var t in h)i[t]=h[t]}return i}function d(i,f,o){var v=this,c={enumerable:!0};v.hasBeenReset=!1;var h="",t=!1,e=i,n=f,r=o,l=null,s="",a=!0,p="auto",A="start",_=50,y="middle",L=50,x="middle";Object.defineProperty(v,"id",g({},c,{get:function(){return h},set:function(O){h=""+O}})),Object.defineProperty(v,"pauseOnExit",g({},c,{get:function(){return t},set:function(O){t=!!O}})),Object.defineProperty(v,"startTime",g({},c,{get:function(){return e},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");e=O,this.hasBeenReset=!0}})),Object.defineProperty(v,"endTime",g({},c,{get:function(){return n},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");n=O,this.hasBeenReset=!0}})),Object.defineProperty(v,"text",g({},c,{get:function(){return r},set:function(O){r=""+O,this.hasBeenReset=!0}})),Object.defineProperty(v,"region",g({},c,{get:function(){return l},set:function(O){l=O,this.hasBeenReset=!0}})),Object.defineProperty(v,"vertical",g({},c,{get:function(){return s},set:function(O){var R=D(O);if(R===!1)throw new SyntaxError("An invalid or illegal string was specified.");s=R,this.hasBeenReset=!0}})),Object.defineProperty(v,"snapToLines",g({},c,{get:function(){return a},set:function(O){a=!!O,this.hasBeenReset=!0}})),Object.defineProperty(v,"line",g({},c,{get:function(){return p},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");p=O,this.hasBeenReset=!0}})),Object.defineProperty(v,"lineAlign",g({},c,{get:function(){return A},set:function(O){var R=S(O);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");A=R,this.hasBeenReset=!0}})),Object.defineProperty(v,"position",g({},c,{get:function(){return _},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");_=O,this.hasBeenReset=!0}})),Object.defineProperty(v,"positionAlign",g({},c,{get:function(){return y},set:function(O){var R=S(O);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");y=R,this.hasBeenReset=!0}})),Object.defineProperty(v,"size",g({},c,{get:function(){return L},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");L=O,this.hasBeenReset=!0}})),Object.defineProperty(v,"align",g({},c,{get:function(){return x},set:function(O){var R=S(O);if(!R)throw new SyntaxError("An invalid or illegal string was specified.");x=R,this.hasBeenReset=!0}})),v.displayState=void 0}return d.prototype.getCueAsHTML=function(){var i=self.WebVTT;return i.convertCueToDOMTree(self,this.text)},d}()},"./src/utils/vttparser.ts":function(M,P,E){E.r(P),E.d(P,"parseTimeStamp",function(){return m}),E.d(P,"fixLineBreaks",function(){return f}),E.d(P,"VTTParser",function(){return o});var b=E("./src/utils/vttcue.ts"),u=function(){function v(){}var c=v.prototype;return c.decode=function(t,e){if(!t)return"";if(typeof t!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},v}();function m(v){function c(t,e,n,r){return(t|0)*3600+(e|0)*60+(n|0)+parseFloat(r||0)}var h=v.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return h?parseFloat(h[2])>59?c(h[2],h[3],0,h[4]):c(h[1],h[2],h[3],h[4]):null}var D=function(){function v(){this.values=Object.create(null)}var c=v.prototype;return c.set=function(t,e){!this.get(t)&&e!==""&&(this.values[t]=e)},c.get=function(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e},c.has=function(t){return t in this.values},c.alt=function(t,e,n){for(var r=0;r<n.length;++r)if(e===n[r]){this.set(t,e);break}},c.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},c.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var n=parseFloat(e);if(n>=0&&n<=100)return this.set(t,n),!0}return!1},v}();function S(v,c,h,t){var e=t?v.split(t):[v];for(var n in e)if(typeof e[n]=="string"){var r=e[n].split(h);if(r.length===2){var l=r[0],s=r[1];c(l,s)}}}var g=new b.default(0,0,""),d=g.align==="middle"?"middle":"center";function i(v,c,h){var t=v;function e(){var l=m(v);if(l===null)throw new Error("Malformed timestamp: "+t);return v=v.replace(/^[^\sa-zA-Z-]+/,""),l}function n(l,s){var a=new D;S(l,function(_,y){var L;switch(_){case"region":for(var x=h.length-1;x>=0;x--)if(h[x].id===y){a.set(_,h[x].region);break}break;case"vertical":a.alt(_,y,["rl","lr"]);break;case"line":L=y.split(","),a.integer(_,L[0]),a.percent(_,L[0])&&a.set("snapToLines",!1),a.alt(_,L[0],["auto"]),L.length===2&&a.alt("lineAlign",L[1],["start",d,"end"]);break;case"position":L=y.split(","),a.percent(_,L[0]),L.length===2&&a.alt("positionAlign",L[1],["start",d,"end","line-left","line-right","auto"]);break;case"size":a.percent(_,y);break;case"align":a.alt(_,y,["start",d,"end","left","right"]);break}},/:/,/\s/),s.region=a.get("region",null),s.vertical=a.get("vertical","");var p=a.get("line","auto");p==="auto"&&g.line===-1&&(p=-1),s.line=p,s.lineAlign=a.get("lineAlign","start"),s.snapToLines=a.get("snapToLines",!0),s.size=a.get("size",100),s.align=a.get("align",d);var A=a.get("position","auto");A==="auto"&&g.position===50&&(A=s.align==="start"||s.align==="left"?0:s.align==="end"||s.align==="right"?100:50),s.position=A}function r(){v=v.replace(/^\s+/,"")}if(r(),c.startTime=e(),r(),v.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+t);v=v.slice(3),r(),c.endTime=e(),r(),n(v,c)}function f(v){return v.replace(/<br(?: \/)?>/gi,`
`)}var o=function(){function v(){this.state="INITIAL",this.buffer="",this.decoder=new u,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var c=v.prototype;return c.parse=function(t){var e=this;t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));function n(){var A=e.buffer,_=0;for(A=f(A);_<A.length&&A[_]!=="\r"&&A[_]!==`
`;)++_;var y=A.slice(0,_);return A[_]==="\r"&&++_,A[_]===`
`&&++_,e.buffer=A.slice(_),y}function r(A){S(A,function(_,y){},/:/)}try{var l="";if(e.state==="INITIAL"){if(!/\r\n|\n/.test(e.buffer))return this;l=n();var s=l.match(/^()?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var a=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(a?a=!1:l=n(),e.state){case"HEADER":/:/.test(l)?r(l):l||(e.state="ID");continue;case"NOTE":l||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(l)){e.state="NOTE";break}if(!l)continue;if(e.cue=new b.default(0,0,""),e.state="CUE",l.indexOf("-->")===-1){e.cue.id=l;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{i(l,e.cue,e.regionList)}catch{e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":{var p=l.indexOf("-->")!==-1;if(!l||p&&(a=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(e.cue===null)continue;e.cue.text&&(e.cue.text+=`
`),e.cue.text+=l}continue;case"BADCUE":l||(e.state="ID")}}}catch{e.state==="CUETEXT"&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state=e.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},c.flush=function(){var t=this;try{if((t.cue||t.state==="HEADER")&&(t.buffer+=`

`,t.parse()),t.state==="INITIAL"||t.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this},v}()},"./src/utils/webvtt-parser.ts":function(M,P,E){E.r(P),E.d(P,"generateCueId",function(){return o}),E.d(P,"parseWebVTT",function(){return c});var b=E("./src/polyfills/number.ts"),u=E("./src/utils/vttparser.ts"),m=E("./src/demux/id3.ts"),D=E("./src/utils/timescale-conversion.ts"),S=E("./src/remux/mp4-remuxer.ts"),g=/\r\n|\n\r|\n|\r/g,d=function(t,e,n){return n===void 0&&(n=0),t.slice(n,n+e.length)===e},i=function(t){var e=parseInt(t.slice(-3)),n=parseInt(t.slice(-6,-4)),r=parseInt(t.slice(-9,-7)),l=t.length>9?parseInt(t.substring(0,t.indexOf(":"))):0;if(!Object(b.isFiniteNumber)(e)||!Object(b.isFiniteNumber)(n)||!Object(b.isFiniteNumber)(r)||!Object(b.isFiniteNumber)(l))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*n,e+=60*1e3*r,e+=60*60*1e3*l,e},f=function(t){for(var e=5381,n=t.length;n;)e=e*33^t.charCodeAt(--n);return(e>>>0).toString()};function o(h,t,e){return f(h.toString())+f(t.toString())+f(e)}var v=function(t,e,n){var r=t[e],l=t[r.prevCC];if(!l||!l.new&&r.new){t.ccOffset=t.presentationOffset=r.start,r.new=!1;return}for(;(s=l)!==null&&s!==void 0&&s.new;){var s;t.ccOffset+=r.start-l.start,r.new=!1,r=l,l=t[r.prevCC]}t.presentationOffset=n};function c(h,t,e,n,r,l,s,a){var p=new u.VTTParser,A=Object(m.utf8ArrayToStr)(new Uint8Array(h)).trim().replace(g,`
`).split(`
`),_=[],y=Object(D.toMpegTsClockFromTimescale)(t,e),L="00:00.000",x=0,T=0,O,R=!0;p.oncue=function(I){var C=n[r],w=n.ccOffset,F=(x-y)/9e4;C!=null&&C.new&&(T!==void 0?w=n.ccOffset=C.start:v(n,r,F)),F&&(w=F-n.presentationOffset);var B=I.endTime-I.startTime,k=Object(S.normalizePts)((I.startTime+w-T)*9e4,l*9e4)/9e4;I.startTime=Math.max(k,0),I.endTime=Math.max(k+B,0);var U=I.text.trim();I.text=decodeURIComponent(encodeURIComponent(U)),I.id||(I.id=o(I.startTime,I.endTime,U)),I.endTime>0&&_.push(I)},p.onparsingerror=function(I){O=I},p.onflush=function(){if(O){a(O);return}s(_)},A.forEach(function(I){if(R)if(d(I,"X-TIMESTAMP-MAP=")){R=!1,I.slice(16).split(",").forEach(function(C){d(C,"LOCAL:")?L=C.slice(6):d(C,"MPEGTS:")&&(x=parseInt(C.slice(7)))});try{T=i(L)/1e3}catch(C){O=C}return}else I===""&&(R=!1);p.parse(I+`
`)}),p.flush()}},"./src/utils/xhr-loader.ts":function(M,P,E){E.r(P);var b=E("./src/utils/logger.ts"),u=E("./src/loader/load-stats.ts"),m=/^age:\s*[\d.]+\s*$/m,D=function(){function S(d){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=d?d.xhrSetup:null,this.stats=new u.LoadStats,this.retryDelay=0}var g=S.prototype;return g.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},g.abortInternal=function(){var i=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),i&&(i.onreadystatechange=null,i.onprogress=null,i.readyState!==4&&(this.stats.aborted=!0,i.abort()))},g.abort=function(){var i;this.abortInternal(),(i=this.callbacks)!==null&&i!==void 0&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},g.load=function(i,f,o){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=i,this.config=f,this.callbacks=o,this.retryDelay=f.retryDelay,this.loadInternal()},g.loadInternal=function(){var i=this.config,f=this.context;if(!!i){var o=this.loader=new self.XMLHttpRequest,v=this.stats;v.loading.first=0,v.loaded=0;var c=this.xhrSetup;try{if(c)try{c(o,f.url)}catch{o.open("GET",f.url,!0),c(o,f.url)}o.readyState||o.open("GET",f.url,!0);var h=this.context.headers;if(h)for(var t in h)o.setRequestHeader(t,h[t])}catch(e){this.callbacks.onError({code:o.status,text:e.message},f,o);return}f.rangeEnd&&o.setRequestHeader("Range","bytes="+f.rangeStart+"-"+(f.rangeEnd-1)),o.onreadystatechange=this.readystatechange.bind(this),o.onprogress=this.loadprogress.bind(this),o.responseType=f.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),o.send()}},g.readystatechange=function(){var i=this.context,f=this.loader,o=this.stats;if(!(!i||!f)){var v=f.readyState,c=this.config;if(!o.aborted&&v>=2)if(self.clearTimeout(this.requestTimeout),o.loading.first===0&&(o.loading.first=Math.max(self.performance.now(),o.loading.start)),v===4){f.onreadystatechange=null,f.onprogress=null;var h=f.status;if(h>=200&&h<300){o.loading.end=Math.max(self.performance.now(),o.loading.first);var t,e;if(i.responseType==="arraybuffer"?(t=f.response,e=t.byteLength):(t=f.responseText,e=t.length),o.loaded=o.total=e,!this.callbacks)return;var n=this.callbacks.onProgress;if(n&&n(o,i,t,f),!this.callbacks)return;var r={url:f.responseURL,data:t};this.callbacks.onSuccess(r,o,i,f)}else o.retry>=c.maxRetry||h>=400&&h<499?(b.logger.error(h+" while loading "+i.url),this.callbacks.onError({code:h,text:f.statusText},i,f)):(b.logger.warn(h+" while loading "+i.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,c.maxRetryDelay),o.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),c.timeout)}},g.loadtimeout=function(){b.logger.warn("timeout while loading "+this.context.url);var i=this.callbacks;i&&(this.abortInternal(),i.onTimeout(this.stats,this.context,this.loader))},g.loadprogress=function(i){var f=this.stats;f.loaded=i.loaded,i.lengthComputable&&(f.total=i.total)},g.getCacheAge=function(){var i=null;if(this.loader&&m.test(this.loader.getAllResponseHeaders())){var f=this.loader.getResponseHeader("age");i=f?parseFloat(f):null}return i},S}();P.default=D}}).default})})(Ve);const pt=ke(Ve.exports),Ce=typeof window<"u"?window.navigator.userAgent:"",mt=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(Ce);/^((?!chrome|android).)*safari/i.test(Ce);/MicroMessenger/i.test(Ce);/MSIE|Trident/i.test(Ce);const gt=[{icon:"iina",scheme:"iina://weblink?url=$url"},{icon:"potplayer",scheme:"potplayer://$e_url"},{icon:"vlc",scheme:"vlc://$url"},{icon:"nplayer",scheme:"nplayer-$url"},{icon:"mxplayer",scheme:"intent:$url#Intent;package=com.mxtech.videoplayer.ad;S.title=$name;end"},{icon:"mxplayer-pro",scheme:"intent:$url#Intent;package=com.mxtech.videoplayer.pro;S.title=$name;end"}],St=()=>{const{replace:xe}=qe(),{proxyLink:Pe}=dt();let M=Te.objs.filter(u=>u.type===ct.VIDEO);M.length===0&&(M=[Te.obj]);let P,E={id:"player",container:"#video-player",url:Te.raw_url,title:Te.obj.name,volume:.5,autoplay:et("video_autoplay"),autoSize:!1,autoMini:!0,loop:!1,flip:!0,playbackRate:!0,aspectRatio:!0,setting:!0,hotkey:!0,pip:!0,mutex:!0,fullscreen:!0,fullscreenWeb:!0,subtitleOffset:!0,miniProgressBar:!1,playsInline:!0,quality:[],plugins:[],whitelist:[],moreVideoAttr:{"webkit-playsinline":!0,playsInline:!0},type:je(Te.obj.name),customType:{flv:function(u,m){const D=vt.createPlayer({type:"flv",url:m},{referrerPolicy:"same-origin"});D.attachMediaElement(u),D.load()},m3u8:function(u,m){var D=new pt;D.loadSource(m),D.attachMedia(u)}},lang:["en","zh-cn","zh-tw"].includes(Ke().toLowerCase())?Ke().toLowerCase():"en",lock:!0,fastForward:!0,autoPlayback:!0,autoOrientation:!0,airplay:!0};mt&&(E.moreVideoAttr.controls=!0);const b=Te.related.find(u=>{for(const m of[".srt",".ass",".vtt"])if(u.name.endsWith(m))return!0;return!1});return b&&(E.subtitle={url:Pe(b,!0),type:je(b.name)}),tt(()=>{P=new ht(E),P.on("video:ended",()=>{const u=M.findIndex(m=>m.name===Te.obj.name);u<M.length-1&&xe(M[u+1].name)})}),rt(()=>{P==null||P.destroy()}),Oe(ft,{w:"$full",spacing:"$2",get children(){return[Oe(it,{w:"$full",h:"60vh",id:"video-player"}),Oe(nt,{onChange:u=>{xe(u)},get value(){return Te.obj.name},get options(){return M.map(u=>({value:u.name}))}}),Oe(at,{wrap:"wrap",gap:"$2",justifyContent:"center",get children(){return Oe(st,{each:gt,children:u=>Oe(ot,{get href(){return lt(u.scheme,Te.raw_url,Te.obj.name)},get children(){return Oe(ut,{boxSize:"$8",get src(){return`/images/${u.icon}.webp`}})}})})}})]}})};export{St as default};
