import{b as L,d as U,be as F,bv as d,B as m,A as x,q as D,e3 as f,x as e,av as u,Q as l,ao as H,dD as I,dE as O,dF as p,W as g,dG as b,dH as W,dI as o,S as X,cX as $,bw as i,n as w,ai as j,e1 as q}from"./index-6ba85c96.js";import{b as A}from"./useTitle-40d456c9.js";import{D as E}from"./DeletePopover-aa282cb2.js";import{W as G}from"./Wether-bb61a51f.js";const P=r=>{const a=s=>{switch(s){case 1:return"neutral";case 2:return"success";default:return"info"}};return e(u,{spacing:"$1",get children(){return e(g,{get each(){return r.role},children:s=>e($,{get colorScheme(){return a(s)},get children(){return r.roleMap[s]??s}})})}})},K=()=>{const r=L();A("manage.sidemenu.users");const{to:a}=U(),[s,k]=F(()=>d.get("/admin/user/list")),[y,S]=m([]),c=async()=>{const t=await k();i(t,n=>S(n.content))},[T,C]=m([]),h=x(()=>{const t={};for(const n of T())t[n.id]=n.name;return t}),_=async()=>{const t=await q();i(t,n=>C(n.content))};D(()=>{_(),c()});const[v,M]=f(t=>d.post(`/admin/user/delete?id=${t}`)),[R,B]=f(t=>d.post(`/admin/user/cancel_2fa?id=${t}`));return e(j,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[e(u,{spacing:"$2",get children(){return[e(l,{colorScheme:"accent",get loading(){return s()},onClick:c,get children(){return r("global.refresh")}}),e(l,{onClick:()=>{a("/@manage/users/add")},get children(){return r("global.add")}})]}}),e(H,{w:"$full",overflowX:"auto",get children(){return e(I,{highlightOnHover:!0,dense:!0,get children(){return[e(O,{get children(){return e(p,{get children(){return[e(g,{each:["username","role","available"],children:t=>e(b,{get children(){return r(`users.${t}`)}})}),e(b,{get children(){return r("global.operations")}})]}})}}),e(W,{get children(){return e(g,{get each(){return y()},children:t=>e(p,{get children(){return[e(o,{get children(){return t.username}}),e(o,{get children(){return e(X,{get when(){return Object.keys(h()).length>0},get fallback(){return e($,{children:"..."})},get children(){return e(P,{get role(){return t.role},get roleMap(){return h()}})}})}}),e(o,{get children(){return e(G,{get yes(){return!t.disabled}})}}),e(o,{get children(){return e(u,{spacing:"$2",get children(){return[e(l,{onClick:()=>{a(`/@manage/users/edit/${t.id}`)},get children(){return r("global.edit")}}),e(E,{get name(){return t.username},get loading(){return v()===t.id},onClick:async()=>{const n=await M(t.id);i(n,()=>{w.success(r("global.delete_success")),c()})}}),e(l,{colorScheme:"accent",get loading(){return R()===t.id},onClick:async()=>{const n=await B(t.id);i(n,()=>{w.success(r("users.cancel_2fa_success")),c()})},get children(){return r("users.cancel_2fa")}})]}})}})]}})})}})]}})}})]}})};export{K as default};
