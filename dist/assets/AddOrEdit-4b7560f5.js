import{b as W,d as A,B as b,cP as E,bb as g,dG as J,bs as m,x as e,bY as K,ap as M,ai as w,S as $,bT as o,bG as c,L as x,bI as S,bJ as y,bL as N,bN as k,bO as v,W as h,bP as C,bQ as I,bR as Y,ao as j,bK as X,d_ as Z,d$ as ee,e0 as re,av as te,bd as _,Q as ne,n as L,bt as d,e1 as se}from"./index-e047d5a8.js";const le=()=>{const s=W(),{params:R,back:T}=A(),{id:i}=R,[p,D]=b([]),[O,P]=b([]),[t,l]=E({id:0,username:"",password:"",base_path:"",role:[],permission:0,disabled:!1,sso_id:"",role_info:[],permissions:[]}),[q,F]=g(()=>J()),[B,z]=g(()=>m.get(`/admin/user/get?id=${i}`)),H=async()=>{const r=await F();if(d(r,n=>{D(n.content)}),i){const n=await z();d(n,a=>{l(a),G(a.role)})}else l("base_path","/")},G=async r=>{const n=new Set;n.add("/");for(const a of r){const u=await se(a);d(u,V=>{for(const f of V.permission_scopes||[])f.path&&n.add(f.path)})}P([...n].map(a=>a.toString()))};H();const[Q,U]=g(()=>m.post(`/admin/user/${i?"update":"create"}`,t));return e(w,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[e(K,{get children(){return s(i?"global.edit":"global.add")}}),e(M,{get loading(){return B()||q()},get children(){return e(w,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[e($,{get when(){return!i||!(t.role_info||[]).includes(1)},get children(){return[e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{for:"username",display:"flex",alignItems:"center",get children(){return s("users.username")}}),e(x,{id:"username",get value(){return t.username},onInput:r=>l("username",r.currentTarget.value)})]}}),e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{for:"password",display:"flex",alignItems:"center",get children(){return s("users.password")}}),e(x,{id:"password",type:"password",placeholder:"********",get value(){return t.password},onInput:r=>l("password",r.currentTarget.value)})]}})]}}),e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{for:"base_path",display:"flex",alignItems:"center",get children(){return s("users.base_path")}}),e(S,{get value(){return t.base_path},onChange:r=>l("base_path",r),get children(){return[e(y,{get children(){return e(N,{})}}),e(k,{get children(){return e(v,{get children(){return e(h,{get each(){return O()},children:r=>e(C,{value:r,get children(){return[e(I,{children:r}),e(Y,{})]}})})}})}})]}})]}}),e(o,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{display:"flex",alignItems:"center",get children(){return s("users.role")}}),e(S,{get value(){return t.role},onChange:r=>l("role",r),get children(){return[e(y,{get children(){return e(j,{display:"flex",flexWrap:"wrap",gap:"$2",pr:"$6",py:"$2",minH:"40px",alignItems:"center",get children(){return e($,{get when(){return t.role.length>0},get fallback(){return e(X,{get children(){return s("home.selected")}})},get children(){return e(h,{get each(){return t.role},children:r=>{const n=p().find(a=>a.id===r);return e(Z,{size:"lg",variant:"subtle",bgColor:"$neutral2",rounded:"$sm",px:"$3",py:"$1",get children(){return[e(ee,{get children(){return(n==null?void 0:n.name)||`ID: ${r}`}}),e(re,{onClick:a=>{a.stopPropagation(),l("role",t.role.filter(u=>u!==r))}})]}})}})}})}})}}),e(k,{get children(){return e(v,{get children(){return e(h,{get each(){return p()},children:r=>e(C,{get value(){return r.id},onClick:()=>{const n=t.role.includes(r.id)?t.role.filter(a=>a!==r.id):[r.id];l("role",n)},get children(){return e(te,{spacing:"$2",w:"$full",pl:"$4",fontSize:"$lg",get children(){return[e(_,{get checked(){return t.role.includes(r.id)},readOnly:!0}),e(I,{get children(){return r.name}})]}})}})})}})}})]}})]}}),e(o,{w:"fit-content",display:"flex",get children(){return e(_,{css:{whiteSpace:"nowrap"},id:"disabled",onChange:r=>l("disabled",r.currentTarget.checked),color:"$neutral10",fontSize:"$sm",get checked(){return t.disabled},get children(){return s("users.disabled")}})}}),e(ne,{get loading(){return Q()},onClick:async()=>{if(!t.role||t.role.length===0){L.error(s("users.role")+" "+s("global.required"));return}const r=await U();d(r,()=>{L.success(s("global.save_success")),T()})},get children(){return s("global.save")}})]}})}})]}})};export{le as default};
