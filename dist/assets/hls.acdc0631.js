import{ce as Ut,c9 as bt}from"./index.afc5cbef.js";import{c as Bt}from"./video_box.6c50e108.js";var kt={exports:{}};/*!
 * artplayer-plugin-danmuku.js v4.4.11
 * Github: https://github.com/zhw2590582/ArtPlayer
 * (c) 2017-2022 Harvey Zack
 * Released under the MIT License.
 */(function(Pt,wt){(function(K,M,S,C,O){var A=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof bt<"u"?bt:{},b=typeof A.parcelRequire93cf=="function"&&A.parcelRequire93cf,P=b.cache||{},R=typeof Bt=="function"&&Bt.bind(Pt);function x(p,E){if(!P[p]){if(!K[p]){var c=typeof A.parcelRequire93cf=="function"&&A.parcelRequire93cf;if(!E&&c)return c(p,!0);if(b)return b(p,!0);if(R&&typeof p=="string")return R(p);var v=new Error("Cannot find module '"+p+"'");throw v.code="MODULE_NOT_FOUND",v}t.resolve=function(o){var u=K[p][1][o];return u!=null?u:o},t.cache={};var i=P[p]=new x.Module(p);K[p][0].call(i.exports,t,i,i.exports,this)}return P[p].exports;function t(o){var u=t.resolve(o);return u===!1?{}:x(u)}}x.isParcelRequire=!0,x.Module=function(p){this.id=p,this.bundle=x,this.exports={}},x.modules=K,x.cache=P,x.parent=b,x.register=function(p,E){K[p]=[function(c,v){v.exports=E},{}]},Object.defineProperty(x,"root",{get:function(){return A.parcelRequire93cf}}),A.parcelRequire93cf=x;for(var g=0;g<M.length;g++)x(M[g]);var T=x(S);Pt.exports=T})({E13ST:[function(K,M,S){var C=K("@parcel/transformer-js/src/esmodule-helpers.js");C.defineInteropFlag(S);var O=K("./danmuku"),A=C.interopDefault(O),b=K("./setting"),P=C.interopDefault(b);function R(x){return g=>{(function(p){const{version:E,utils:{errorHandle:c}}=p.constructor,v=E.split(".").map(Number);c(v[0]+v[1]/100>=4.04,`Artplayer.js@${E} \u4E0D\u517C\u5BB9\u8BE5\u5F39\u5E55\u5E93\uFF0C\u8BF7\u66F4\u65B0\u5230 4.4.x \u7248\u672C\u4EE5\u4E0A`)})(g);const T=new A.default(g,x);return(0,P.default)(g,T),{name:"artplayerPluginDanmuku",emit:T.emit.bind(T),load:T.load.bind(T),config:T.config.bind(T),hide:T.hide.bind(T),show:T.show.bind(T),reset:T.reset.bind(T),get option(){return T.option},get isHide(){return T.isHide},get isStop(){return T.isStop}}}}S.default=R,R.env="production",R.version="4.4.11",R.build="2022-10-11 10:47:51",typeof window<"u"&&(window.artplayerPluginDanmuku=R)},{"./danmuku":"8Gtnh","./setting":"jAkJm","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],"8Gtnh":[function(K,M,S){var C=K("@parcel/transformer-js/src/esmodule-helpers.js");C.defineInteropFlag(S);var O=K("./bilibili"),A=K("./getDanmuTop"),b=C.interopDefault(A);class P{constructor(x,g){const{constructor:T,template:p}=x;if(this.utils=T.utils,this.validator=T.validator,this.$danmuku=p.$danmuku,this.$player=p.$player,this.art=x,this.queue=[],this.option={},this.$refs=[],this.isStop=!1,this.isHide=!1,this.timer=null,this.config(g),this.option.useWorker)try{this.worker=new Worker(K("27c3930ee158179a"))}catch{}this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.reset=this.reset.bind(this),this.destroy=this.destroy.bind(this),x.on("video:play",this.start),x.on("video:playing",this.start),x.on("video:pause",this.stop),x.on("video:waiting",this.stop),x.on("fullscreen",this.reset),x.on("fullscreenWeb",this.reset),x.on("destroy",this.destroy),this.load()}static get option(){return{danmuku:[],speed:5,margin:["2%","25%"],opacity:1,color:"#FFFFFF",mode:0,fontSize:25,filter:()=>!0,antiOverlap:!0,useWorker:!0,synchronousPlayback:!1,lockTime:5,maxLength:100,minWidth:200,maxWidth:400,mount:void 0,theme:"dark",beforeEmit:()=>!0}}static get scheme(){return{danmuku:"array|function|string",speed:"number",margin:"array",opacity:"number",color:"string",mode:"number",fontSize:"number|string",filter:"function",antiOverlap:"boolean",useWorker:"boolean",synchronousPlayback:"boolean",lockTime:"number",maxLength:"number",minWidth:"number",maxWidth:"number",mount:"undefined|htmldivelement",theme:"string",beforeEmit:"function"}}get isRotate(){return this.art.plugins.autoOrientation&&this.art.plugins.autoOrientation.state}get marginTop(){const{clamp:x}=this.utils,g=this.option.margin[0],{clientHeight:T}=this.$player;return typeof g=="number"?x(g,0,T):typeof g=="string"&&g.endsWith("%")?x(T*(parseFloat(g)/100),0,T):P.option.margin[0]}get marginBottom(){const{clamp:x}=this.utils,g=this.option.margin[1],{clientHeight:T}=this.$player;return typeof g=="number"?x(g,0,T):typeof g=="string"&&g.endsWith("%")?x(T*(parseFloat(g)/100),0,T):P.option.margin[1]}filter(x,g){return this.queue.filter(T=>T.$state===x).map(g)}getLeft(x){const g=x.getBoundingClientRect();return this.isRotate?g.top:g.left}getRef(){const x=this.$refs.pop();if(x)return x;const g=document.createElement("div");return g.style.cssText=`
            user-select: none;
            position: absolute;
            white-space: pre;
            pointer-events: none;
            perspective: 500px;
            display: inline-block;
            will-change: transform;
            font-weight: normal;
            line-height: 1.125;
            visibility: hidden;
            font-family: SimHei, "Microsoft JhengHei", Arial, Helvetica, sans-serif;
            text-shadow: rgb(0, 0, 0) 1px 0px 1px, rgb(0, 0, 0) 0px 1px 1px, rgb(0, 0, 0) 0px -1px 1px, rgb(0, 0, 0) -1px 0px 1px;
        `,g}getReady(){const{currentTime:x}=this.art;return this.queue.filter(g=>g.$state==="ready"||g.$state==="wait"&&x+.1>=g.time&&g.time>=x-.1)}getEmits(){const x=[],{clientWidth:g}=this.$player,T=this.getLeft(this.$player);return this.filter("emit",p=>{const E=p.$ref.offsetTop,c=this.getLeft(p.$ref)-T,v=p.$ref.clientHeight,i=p.$ref.clientWidth,t=c+i,o=g-t,u=t/p.$restTime,d={};d.top=E,d.left=c,d.height=v,d.width=i,d.right=o,d.speed=u,d.distance=t,d.time=p.$restTime,d.mode=p.mode,x.push(d)}),x}getFontSize(x){const{clamp:g}=this.utils,{clientHeight:T}=this.$player;return typeof x=="number"?g(x,12,T):typeof x=="string"&&x.endsWith("%")?g(T*(parseFloat(x)/100),12,T):P.option.fontSize}postMessage(x={}){return new Promise(g=>{if(this.option.useWorker&&this.worker&&this.worker.postMessage)x.id=Date.now(),this.worker.postMessage(x),this.worker.onmessage=T=>{const{data:p}=T;p.id===x.id&&g(p)};else{const T=(0,b.default)(x);g({top:T})}})}async load(){try{let x=[];x=typeof this.option.danmuku=="function"?await this.option.danmuku():typeof this.option.danmuku.then=="function"?await this.option.danmuku:typeof this.option.danmuku=="string"?await(0,O.bilibiliDanmuParseFromUrl)(this.option.danmuku):this.option.danmuku,this.utils.errorHandle(Array.isArray(x),"Danmuku need return an array as result"),this.art.emit("artplayerPluginDanmuku:loaded",x),this.queue=[],this.$danmuku.innerText="",x.forEach(g=>this.emit(g))}catch(x){throw this.art.emit("artplayerPluginDanmuku:error",x),x}return this}config(x){const{clamp:g}=this.utils;return this.option=Object.assign({},P.option,this.option,x),this.validator(this.option,P.scheme),this.option.speed=g(this.option.speed,1,10),this.option.opacity=g(this.option.opacity,0,1),this.option.lockTime=g(Math.floor(this.option.lockTime),0,60),this.option.maxLength=g(this.option.maxLength,0,500),this.option.minWidth=g(this.option.minWidth,0,500),this.option.maxWidth=g(this.option.maxWidth,0,1/0),x.fontSize&&(this.option.fontSize=this.getFontSize(this.option.fontSize),this.reset()),this.art.emit("artplayerPluginDanmuku:config",this.option),this}makeWait(x){x.$state="wait",x.$ref&&(x.$ref.style.visibility="hidden",x.$ref.style.marginLeft="0px",x.$ref.style.transform="translateX(0px)",x.$ref.style.transition="transform 0s linear 0s",this.$refs.push(x.$ref),x.$ref=null)}continue(){const{clientWidth:x}=this.$player;return this.filter("stop",g=>{switch(g.$state="emit",g.$lastStartTime=Date.now(),g.mode){case 0:{const T=x+g.$ref.clientWidth;g.$ref.style.transform=`translateX(${-T}px)`,g.$ref.style.transition=`transform ${g.$restTime}s linear 0s`;break}}}),this}suspend(){const{clientWidth:x}=this.$player;return this.filter("emit",g=>{switch(g.$state="stop",g.mode){case 0:{const T=x-(this.getLeft(g.$ref)-this.getLeft(this.$player));g.$ref.style.transform=`translateX(${-T}px)`,g.$ref.style.transition="transform 0s linear 0s";break}}}),this}reset(){return this.queue.forEach(x=>this.makeWait(x)),this}update(){return this.timer=window.requestAnimationFrame(async()=>{if(this.art.playing&&!this.isHide){this.filter("emit",p=>{const E=(Date.now()-p.$lastStartTime)/1e3;p.$restTime-=E,p.$lastStartTime=Date.now(),p.$restTime<=0&&this.makeWait(p)});const x=this.getReady(),{clientWidth:g,clientHeight:T}=this.$player;for(let p=0;p<x.length;p++){const E=x[p];E.$ref=this.getRef(),E.$ref.innerText=E.text,this.$danmuku.appendChild(E.$ref),E.$ref.style.left=`${g}px`,E.$ref.style.opacity=this.option.opacity,E.$ref.style.fontSize=`${this.option.fontSize}px`,E.$ref.style.color=E.color,E.$ref.style.border=E.border?`1px solid ${E.color}`:null,E.$ref.style.backgroundColor=E.border?"rgb(0 0 0 / 50%)":null,E.$ref.style.marginLeft="0px",E.$lastStartTime=Date.now(),E.$restTime=this.option.synchronousPlayback&&this.art.playbackRate?this.option.speed/Number(this.art.playbackRate):this.option.speed;const c={mode:E.mode,height:E.$ref.clientHeight,speed:(g+E.$ref.clientWidth)/E.$restTime},{top:v}=await this.postMessage({target:c,emits:this.getEmits(),antiOverlap:this.option.antiOverlap,clientWidth:g,clientHeight:T,marginBottom:this.marginBottom,marginTop:this.marginTop});if(E.$ref)if(this.isStop||v===void 0)E.$state="ready",this.$refs.push(E.$ref),E.$ref=null;else switch(E.$state="emit",E.$ref.style.visibility="visible",E.mode){case 0:{E.$ref.style.top=`${v}px`;const i=g+E.$ref.clientWidth;E.$ref.style.transform=`translateX(${-i}px)`,E.$ref.style.transition=`transform ${E.$restTime}s linear 0s`;break}case 1:E.$ref.style.left="50%",E.$ref.style.top=`${v}px`,E.$ref.style.marginLeft=`-${E.$ref.clientWidth/2}px`}}}this.isStop||this.update()}),this}stop(){return this.isStop=!0,this.suspend(),window.cancelAnimationFrame(this.timer),this.art.emit("artplayerPluginDanmuku:stop"),this}start(){return this.isStop=!1,this.continue(),this.update(),this.art.emit("artplayerPluginDanmuku:start"),this}show(){return this.isHide=!1,this.start(),this.$danmuku.style.display="block",this.art.emit("artplayerPluginDanmuku:show"),this}hide(){return this.isHide=!0,this.stop(),this.queue.forEach(x=>this.makeWait(x)),this.$danmuku.style.display="none",this.art.emit("artplayerPluginDanmuku:hide"),this}emit(x){return this.validator(x,{text:"string",mode:"number|undefined",color:"string|undefined",time:"number|undefined",border:"boolean|undefined"}),x.text.trim()&&this.option.filter(x)?(x.time?x.time=this.utils.clamp(x.time,0,1/0):x.time=this.art.currentTime+.5,x.mode===void 0&&(x.mode=this.option.mode),x.color===void 0&&(x.color=this.option.color),this.queue.push({...x,$state:"wait",$ref:null,$restTime:0,$lastStartTime:0}),this):this}destroy(){this.stop(),this.worker&&this.worker.terminate&&this.worker.terminate(),this.art.off("video:play",this.start),this.art.off("video:playing",this.start),this.art.off("video:pause",this.stop),this.art.off("video:waiting",this.stop),this.art.off("fullscreen",this.reset),this.art.off("fullscreenWeb",this.reset),this.art.off("destroy",this.destroy),this.art.emit("artplayerPluginDanmuku:destroy")}}S.default=P},{"./bilibili":"KnwDr","./getDanmuTop":"2Abxf","27c3930ee158179a":"anHwN","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],KnwDr:[function(K,M,S){var C=K("@parcel/transformer-js/src/esmodule-helpers.js");function O(P){switch(P){case 1:case 2:case 3:default:return 0;case 4:case 5:return 1}}function A(P){if(typeof P!="string")return[];const R=P.matchAll(/<d (?:.*? )??p="(?<p>.+?)"(?: .*?)?>(?<text>.+?)<\/d>/gs);return Array.from(R).map(x=>{const g=x.groups.p.split(",");return g.length>=8?{text:x.groups.text.trim().replaceAll("&quot;",'"').replaceAll("&apos;","'").replaceAll("&lt;","<").replaceAll("&gt;",">").replaceAll("&amp;","&"),time:Number(g[0]),mode:O(Number(g[1])),fontSize:Number(g[2]),color:`#${Number(g[3]).toString(16)}`,timestamp:Number(g[4]),pool:Number(g[5]),userID:g[6],rowID:Number(g[7])}:null}).filter(Boolean)}function b(P){return fetch(P).then(R=>R.text()).then(R=>A(R))}C.defineInteropFlag(S),C.export(S,"getMode",()=>O),C.export(S,"bilibiliDanmuParseFromXml",()=>A),C.export(S,"bilibiliDanmuParseFromUrl",()=>b)},{"@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],"9v6Cv":[function(K,M,S){S.interopDefault=function(C){return C&&C.__esModule?C:{default:C}},S.defineInteropFlag=function(C){Object.defineProperty(C,"__esModule",{value:!0})},S.exportAll=function(C,O){return Object.keys(C).forEach(function(A){A==="default"||A==="__esModule"||O.hasOwnProperty(A)||Object.defineProperty(O,A,{enumerable:!0,get:function(){return C[A]}})}),O},S.export=function(C,O,A){Object.defineProperty(C,O,{enumerable:!0,get:A})}},{}],"2Abxf":[function(K,M,S){K("@parcel/transformer-js/src/esmodule-helpers.js").defineInteropFlag(S),S.default=function({target:C,emits:O,clientWidth:A,clientHeight:b,marginBottom:P,marginTop:R,antiOverlap:x}){const g=O.filter(p=>p.mode===C.mode&&p.top<=b-P).sort((p,E)=>p.top-E.top);if(g.length===0)return R;g.unshift({top:0,left:0,right:0,height:R,width:A,speed:0,distance:A}),g.push({top:b-P,left:0,right:0,height:P,width:A,speed:0,distance:A});for(let p=1;p<g.length;p+=1){const E=g[p],c=g[p-1],v=c.top+c.height;if(E.top-v>=C.height)return v}const T=[];for(let p=1;p<g.length-1;p+=1){const E=g[p];if(T.length){const c=T[T.length-1];c[0].top===E.top?c.push(E):T.push([E])}else T.push([E])}if(!x){switch(C.mode){case 0:T.sort((p,E)=>{const c=Math.min(...E.map(i=>i.right)),v=Math.min(...p.map(i=>i.right));return c*E.length-v*p.length});break;case 1:T.sort((p,E)=>{const c=Math.max(...E.map(v=>v.width));return Math.max(...p.map(v=>v.width))*p.length-c*E.length})}return T[0][0].top}switch(C.mode){case 0:{const p=T.find(E=>E.every(c=>A<c.distance?!1:C.speed<c.speed?!0:c.right/(C.speed-c.speed)>c.time));return p&&p[0]?p[0].top:void 0}case 1:return}}},{"@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],anHwN:[function(K,M,S){M.exports="data:application/javascript,function%20getDanmuTop%28%7Btarget%3At%2Cemits%3Ae%2CclientWidth%3An%2CclientHeight%3Ai%2CmarginBottom%3As%2CmarginTop%3Ah%2CantiOverlap%3Ao%7D%29%7Bconst%20r%3De.filter%28%28e%3D%3Ee.mode%3D%3D%3Dt.mode%26%26e.top%3C%3Di-s%29%29.sort%28%28%28t%2Ce%29%3D%3Et.top-e.top%29%29%3Bif%280%3D%3D%3Dr.length%29return%20h%3Br.unshift%28%7Btop%3A0%2Cleft%3A0%2Cright%3A0%2Cheight%3Ah%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%2Cr.push%28%7Btop%3Ai-s%2Cleft%3A0%2Cright%3A0%2Cheight%3As%2Cwidth%3An%2Cspeed%3A0%2Cdistance%3An%7D%29%3Bfor%28let%20e%3D1%3Be%3Cr.length%3Be%2B%3D1%29%7Bconst%20n%3Dr%5Be%5D%2Ci%3Dr%5Be-1%5D%2Cs%3Di.top%2Bi.height%3Bif%28n.top-s%3E%3Dt.height%29return%20s%7Dconst%20p%3D%5B%5D%3Bfor%28let%20t%3D1%3Bt%3Cr.length-1%3Bt%2B%3D1%29%7Bconst%20e%3Dr%5Bt%5D%3Bif%28p.length%29%7Bconst%20t%3Dp%5Bp.length-1%5D%3Bt%5B0%5D.top%3D%3D%3De.top%3Ft.push%28e%29%3Ap.push%28%5Be%5D%29%7Delse%20p.push%28%5Be%5D%29%7Dif%28%21o%29%7Bswitch%28t.mode%29%7Bcase%200%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.min%28...e.map%28%28t%3D%3Et.right%29%29%29%2Ci%3DMath.min%28...t.map%28%28t%3D%3Et.right%29%29%29%3Breturn%20n%2ae.length-i%2at.length%7D%29%29%3Bbreak%3Bcase%201%3Ap.sort%28%28%28t%2Ce%29%3D%3E%7Bconst%20n%3DMath.max%28...e.map%28%28t%3D%3Et.width%29%29%29%3Breturn%20Math.max%28...t.map%28%28t%3D%3Et.width%29%29%29%2at.length-n%2ae.length%7D%29%29%7Dreturn%20p%5B0%5D%5B0%5D.top%7Dswitch%28t.mode%29%7Bcase%200%3A%7Bconst%20e%3Dp.find%28%28e%3D%3Ee.every%28%28e%3D%3E%7Bif%28n%3Ce.distance%29return%211%3Bif%28t.speed%3Ce.speed%29return%210%3Breturn%20e.right%2F%28t.speed-e.speed%29%3Ee.time%7D%29%29%29%29%3Breturn%20e%26%26e%5B0%5D%3Fe%5B0%5D.top%3Avoid%200%7Dcase%201%3Areturn%7D%7Donmessage%3Dt%3D%3E%7Bconst%7Bdata%3Ae%7D%3Dt%2Cn%3DgetDanmuTop%28e%29%3Bself.postMessage%28%7Btop%3An%2Cid%3Ae.id%7D%29%7D%3B"},{}],jAkJm:[function(K,M,S){var C=K("@parcel/transformer-js/src/esmodule-helpers.js");C.defineInteropFlag(S);var O=K("bundle-text:./style.less"),A=C.interopDefault(O),b=K("bundle-text:./img/danmu-on.svg"),P=C.interopDefault(b),R=K("bundle-text:./img/danmu-off.svg"),x=C.interopDefault(R),g=K("bundle-text:./img/danmu-config.svg"),T=C.interopDefault(g),p=K("bundle-text:./img/danmu-style.svg"),E=C.interopDefault(p);if(S.default=function(c,v){const{option:i}=v,{template:{$controlsCenter:t,$player:o},constructor:{utils:{removeClass:u,addClass:d,append:n,setStyle:e,tooltip:r,query:m,inverseClass:l}}}=c;function f(D,L){const I=document.createElement("i");return n(I,D),d(I,"art-icon"),d(I,`art-icon-${L}`),I}const h=f(P.default,"danmu-on"),a=f(x.default,"danmu-off"),s=f(T.default,"danmu-config"),y=f(E.default,"danmu-style");(function(){const D=["#FE0302","#FF7204","#FFAA02","#FFD302","#FFFF00","#A0EE00","#00CD00","#019899","#4266BE","#89D5FF","#CC0273","#222222","#9B9B9B","#FFFFFF"].map(z=>`<div class="art-danmuku-style-panel-color${i.color===z?" art-current":""}" data-color="${z}" style="background-color:${z}"></div>`),L=n(t,`<div class="art-danmuku-emitter" style="max-width: ${i.maxWidth?`${i.maxWidth}px`:"100%"}"><div class="art-danmuku-left"><div class="art-danmuku-style"><div class="art-danmuku-style-panel"><div class="art-danmuku-style-panel-inner"><div class="art-danmuku-style-panel-title">\u6A21\u5F0F</div><div class="art-danmuku-style-panel-modes"><div class="art-danmuku-style-panel-mode art-current" data-mode="0">\u6EDA\u52A8</div><div class="art-danmuku-style-panel-mode" data-mode="1">\u9759\u6B62</div></div><div class="art-danmuku-style-panel-title">\u989C\u8272</div><div class="art-danmuku-style-panel-colors">${D.join("")}</div></div></div></div><input class="art-danmuku-input" maxlength="${i.maxLength}" placeholder="\u53D1\u4E2A\u5F39\u5E55\u89C1\u8BC1\u5F53\u4E0B" /></div><div class="art-danmuku-send">\u53D1\u9001</div></div>`),I=m(".art-danmuku-style",L),_=m(".art-danmuku-input",L),F=m(".art-danmuku-send",L),B=m(".art-danmuku-style-panel-inner",L),U=m(".art-danmuku-style-panel-modes",L),N=m(".art-danmuku-style-panel-colors",L),k=i.mount||n(o,'<div class="art-layer-danmuku-emitter"></div>');c.option.backdrop&&d(B,"art-backdrop-filter"),i.theme&&d(L,`art-danmuku-theme-${i.theme}`);let w=null,W=i.mode,j=i.color;function H(z){z<=0?(w=null,F.innerText="\u53D1\u9001",u(F,"art-disabled")):(F.innerText=z,w=setTimeout(()=>H(z-1),1e3))}function G(){const z={mode:W,color:j,border:!0,text:_.value.trim()};w===null&&i.beforeEmit(z)&&(_.value="",v.emit(z),d(F,"art-disabled"),H(i.lockTime),c.emit("artplayerPluginDanmuku:emit",z))}function $(){t.clientWidth<i.minWidth?(n(k,L),e(k,"display","flex"),d(L,"art-danmuku-mount"),i.mount||e(o,"marginBottom","40px")):(n(t,L),e(k,"display","none"),u(L,"art-danmuku-mount"),i.mount||e(o,"marginBottom",null))}n(I,y),c.proxy(F,"click",G),c.proxy(_,"keypress",z=>{z.key==="Enter"&&(z.preventDefault(),G())}),c.proxy(U,"click",z=>{const{dataset:X}=z.target;X.mode&&(W=Number(X.mode),l(z.target,"art-current"))}),c.proxy(N,"click",z=>{const{dataset:X}=z.target;X.color&&(j=X.color,l(z.target,"art-current"))}),$(),c.on("resize",()=>{c.isInput||$()}),c.on("destroy",()=>{i.mount&&L.parentElement===i.mount&&i.mount.removeChild(L)})})(),c.controls.add({position:"right",name:"danmuku",click:function(){v.isHide?(v.show(),c.notice.show="\u5F39\u5E55\u663E\u793A",e(h,"display",null),e(a,"display","none")):(v.hide(),c.notice.show="\u5F39\u5E55\u9690\u85CF",e(h,"display","none"),e(a,"display",null))},mounted(D){n(D,h),n(D,a),r(D,"\u5F39\u5E55\u5F00\u5173"),e(a,"display","none")}}),c.setting.add({name:"danmuku",html:"\u5F39\u5E55\u8BBE\u7F6E",tooltip:"\u66F4\u591A",icon:s,selector:[{width:200,html:"\u64AD\u653E\u901F\u5EA6",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u6162",time:10},{html:"\u8F83\u6162",time:7.5},{default:!0,html:"\u9002\u4E2D",time:5},{html:"\u8F83\u5FEB",time:2.5},{html:"\u6781\u5FEB",time:1}],onSelect:function(D){return v.config({speed:D.time}),D.html}},{width:200,html:"\u5B57\u4F53\u5927\u5C0F",icon:"",tooltip:"\u9002\u4E2D",selector:[{html:"\u6781\u5C0F",fontSize:"4%"},{html:"\u8F83\u5C0F",fontSize:"5%"},{default:!0,html:"\u9002\u4E2D",fontSize:"6%"},{html:"\u8F83\u5927",fontSize:"7%"},{html:"\u6781\u5927",fontSize:"8%"}],onSelect:function(D){return v.config({fontSize:D.fontSize}),D.html}},{width:200,html:"\u4E0D\u900F\u660E\u5EA6",icon:"",tooltip:"100%",selector:[{default:!0,opacity:1,html:"100%"},{opacity:.75,html:"75%"},{opacity:.5,html:"50%"},{opacity:.25,html:"25%"},{opacity:0,html:"0%"}],onSelect:function(D){return v.config({opacity:D.opacity}),D.html}},{width:200,html:"\u663E\u793A\u8303\u56F4",icon:"",tooltip:"3/4",selector:[{html:"1/4",margin:[10,"75%"]},{html:"\u534A\u5C4F",margin:[10,"50%"]},{default:!0,html:"3/4",margin:[10,"25%"]},{html:"\u6EE1\u5C4F",margin:[10,10]}],onSelect:function(D){return v.config({margin:D.margin}),D.html}},{html:"\u5F39\u5E55\u9632\u91CD\u53E0",icon:"",tooltip:i.antiOverlap?"\u5F00\u542F":"\u5173\u95ED",switch:i.antiOverlap,onSwitch:D=>(v.config({antiOverlap:!D.switch}),D.tooltip=D.switch?"\u5173\u95ED":"\u5F00\u542F",!D.switch)},{html:"\u540C\u6B65\u89C6\u9891\u901F\u5EA6",icon:"",tooltip:i.synchronousPlayback?"\u5F00\u542F":"\u5173\u95ED",switch:i.synchronousPlayback,onSwitch:D=>(v.config({synchronousPlayback:!D.switch}),D.tooltip=D.switch?"\u5173\u95ED":"\u5F00\u542F",!D.switch)}]})},typeof document<"u"&&!document.getElementById("artplayer-plugin-danmuku")){const c=document.createElement("style");c.id="artplayer-plugin-danmuku",c.textContent=A.default,document.head.appendChild(c)}},{"bundle-text:./style.less":"chNhY","bundle-text:./img/danmu-on.svg":"j5M2a","bundle-text:./img/danmu-off.svg":"d9WLf","bundle-text:./img/danmu-config.svg":"8Y3Ij","bundle-text:./img/danmu-style.svg":"hltwt","@parcel/transformer-js/src/esmodule-helpers.js":"9v6Cv"}],chNhY:[function(K,M,S){M.exports='.art-danmuku-emitter{height:32px;width:100%;max-width:100%;color:#fff;-webkit-tap-highlight-color:#0000;touch-action:manipulation;-ms-high-contrast-adjust:none;background-color:#ffffff4d;border-radius:3px;font-family:Roboto,Arial,Helvetica,sans-serif;font-size:12px;line-height:1;display:flex;position:relative}.art-danmuku-emitter *,.art-danmuku-emitter :before,.art-danmuku-emitter :after{box-sizing:border-box;margin:0;padding:0}.art-danmuku-emitter .art-icon{justify-content:center;align-items:center;line-height:1.5;display:inline-flex}.art-danmuku-emitter .art-icon svg{fill:#fff}@supports ((-webkit-backdrop-filter: initial) or (backdrop-filter: initial)){.art-danmuku-emitter .art-backdrop-filter{-webkit-backdrop-filter:saturate(180%)blur(20px);backdrop-filter:saturate(180%)blur(20px);background-color:#000000b3!important}}.art-danmuku-emitter .art-danmuku-left{border-radius:3px 0 0 3px;flex:1;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style{width:32px;justify-content:center;align-items:center;display:flex;position:relative}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{z-index:999;width:200px;padding-bottom:10px;display:none;position:absolute;bottom:30px;left:-85px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner{background-color:#000000e6;border-radius:3px;flex-direction:column;padding:10px 10px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-title{margin-bottom:10px;font-size:13px}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes{justify-content:space-between;margin-bottom:15px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode{width:47%;cursor:pointer;color:#fff;border:1px solid #fff;justify-content:center;padding:5px 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-modes .art-danmuku-style-panel-mode.art-current{background-color:#00a1d6;border:1px solid #00a1d6}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors{flex-wrap:wrap;justify-content:space-between;gap:5px;margin-bottom:10px;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color{cursor:pointer;width:20px;height:20px;border:1px solid #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current{position:relative;box-shadow:0 0 2px #fff}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel .art-danmuku-style-panel-inner .art-danmuku-style-panel-colors .art-danmuku-style-panel-color.art-current:before{content:"";width:100%;height:100%;border:2px solid #000;position:absolute;inset:0}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style:hover .art-danmuku-style-panel{display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon{opacity:.75;cursor:pointer}.art-danmuku-emitter .art-danmuku-left .art-danmuku-style .art-icon:hover{opacity:1}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input{width:100%;color:#fff;background-color:#0000;border:none;outline:none;flex:1;padding:0 10px 0 0;display:flex}.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#ffffff80}.art-danmuku-emitter .art-danmuku-send{width:50px;cursor:pointer;background-color:#00a1d6;border-radius:0 3px 3px 0;justify-content:center;align-items:center;display:flex}.art-danmuku-emitter .art-danmuku-send:hover{background-color:#00b5e5}.art-danmuku-emitter .art-danmuku-send.art-disabled{opacity:.5;pointer-events:none}.art-danmuku-emitter.art-danmuku-mount{height:34px;max-width:100%!important}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-left .art-danmuku-style .art-danmuku-style-panel{left:0}.art-danmuku-emitter.art-danmuku-mount .art-danmuku-send{width:60px}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left{background:#f4f4f4;border:1px solid #dadada}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-style .art-icon svg{fill:#666}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input{color:#000}.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::placeholder,.art-danmuku-emitter.art-danmuku-mount.art-danmuku-theme-light .art-danmuku-left .art-danmuku-input::-webkit-input-placeholder{color:#00000080}.art-layer-danmuku-emitter{z-index:99;width:100%;position:absolute;bottom:-40px;left:0;right:0}'},{}],j5M2a:[function(K,M,S){M.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.467 661.333c0 4.267-4.267 8.534-8.534 12.8 0 4.267 0 4.267-4.266 8.534h-12.8c-4.267 0-8.534-4.267-17.067-8.534-8.533-8.533-17.067-8.533-25.6-8.533-8.533 0-12.8 4.267-17.067 12.8-4.266 12.8-8.533 21.333-4.266 29.867 4.266 8.533 12.8 17.066 25.6 21.333 17.066 8.533 34.133 17.067 46.933 17.067 12.8 0 21.333-4.267 34.133-8.534 8.534-4.266 17.067-17.066 25.6-29.866 8.534-12.8 12.8-34.134 17.067-55.467 4.267-21.333 4.267-51.2 4.267-85.333 0-12.8 0-21.334-4.267-29.867 0-8.533-4.267-12.8-8.533-17.067-4.267-4.266-8.534-8.533-12.8-8.533-4.267 0-12.8-4.267-21.334-4.267h-55.466s-4.267-4.266 0-8.533l4.266-38.4c0-4.267 0-8.533 4.267-8.533h46.933c17.067 0 25.6-4.267 34.134-12.8 8.533-8.534 12.8-21.334 12.8-42.667v-72.533c0-17.067-4.267-34.134-8.534-42.667-12.8-12.8-25.6-17.067-42.666-17.067H243.2c-8.533 0-17.067 0-21.333 4.267-4.267 8.533-4.267 12.8-4.267 25.6 0 8.533 0 17.067 4.267 21.333 4.266 4.267 12.8 8.534 21.333 8.534h64c4.267 0 8.533 0 8.533 4.266v34.134c0 8.533 0 12.8-4.266 12.8 0 0-4.267 4.266-8.534 4.266H268.8c-8.533 0-12.8 0-21.333 4.267-4.267 0-8.534 4.267-8.534 4.267-4.266 4.266-8.533 12.8-8.533 17.066 0 8.534-4.267 17.067-4.267 25.6l-8.533 72.534v29.866c0 8.534 4.267 12.8 8.533 17.067 4.267 4.267 8.534 4.267 17.067 8.533h68.267c4.266 0 8.533 0 8.533 4.267s4.267 8.533 4.267 17.067c0 21.333 0 42.666-4.267 55.466 0 8.534-4.267 21.334-8.533 25.6zM896 486.4c-93.867 0-174.933 51.2-217.6 123.733H571.733V576H640c21.333 0 34.133-4.267 42.667-12.8 8.533-8.533 12.8-21.333 12.8-42.667V358.4c0-21.333-4.267-34.133-12.8-42.667-8.534-8.533-21.334-12.8-42.667-12.8 0-4.266 4.267-4.266 4.267-8.533-4.267 0-4.267-4.267-4.267-4.267 4.267-12.8 8.533-21.333 4.267-25.6 0-8.533-4.267-12.8-12.8-21.333-8.534-4.267-17.067-4.267-21.334-4.267-8.533 4.267-12.8 8.534-21.333 21.334-4.267 8.533-8.533 12.8-12.8 21.333-4.267 8.533-8.533 12.8-12.8 21.333H512c-4.267-8.533-8.533-17.066-8.533-21.333-4.267-8.533-8.534-12.8-12.8-21.333-4.267-12.8-12.8-17.067-21.334-17.067s-17.066 0-25.6 8.533c-8.533 8.534-12.8 12.8-12.8 21.334s0 17.066 8.534 25.6l4.266 4.266L448 307.2c-17.067 0-29.867 4.267-38.4 12.8-8.533 4.267-12.8 21.333-12.8 38.4v157.867c0 21.333 4.267 34.133 12.8 42.666 8.533 8.534 21.333 12.8 42.667 12.8H512v34.134h-98.133c-12.8 0-21.334 0-25.6 4.266-4.267 4.267-8.534 8.534-8.534 21.334v17.066c0 4.267 4.267 8.534 4.267 8.534 4.267 0 4.267 4.266 8.533 4.266H512V716.8c0 12.8 4.267 21.333 8.533 25.6 4.267 4.267 12.8 8.533 21.334 8.533 12.8 0 21.333-4.266 25.6-8.533 4.266-4.267 4.266-12.8 4.266-25.6v-55.467H652.8c-8.533 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.533-128h55.466c4.267 0 4.267 0 4.267 4.267V409.6h-59.733v-51.2zm0 102.4H627.2V512h-55.467v-51.2zM512 516.267h-55.467v-51.2H512v51.2zm0-102.4h-59.733V362.667H512v51.2zm384 499.2c-93.867 0-170.667-76.8-170.667-170.667S802.133 571.733 896 571.733s170.667 76.8 170.667 170.667S989.867 913.067 896 913.067z"/><path fill="#fff" d="M951.467 669.867 878.933 742.4l-29.866-25.6C832 699.733 806.4 704 789.333 721.067c-17.066 17.066-12.8 42.666 4.267 59.733l59.733 51.2c8.534 8.533 17.067 8.533 29.867 8.533s21.333-4.266 29.867-12.8l102.4-102.4c17.066-17.066 17.066-42.666 0-59.733-21.334-12.8-46.934-12.8-64 4.267zm-371.2 209.066H213.333c-72.533 0-128-55.466-128-119.466V230.4c0-64 55.467-119.467 128-119.467h512c72.534 0 128 55.467 128 119.467v140.8c0 25.6 17.067 42.667 42.667 42.667s42.667-17.067 42.667-42.667V230.4c0-115.2-93.867-204.8-213.334-204.8h-512C93.867 25.6 0 119.467 0 230.4v529.067c0 115.2 93.867 204.8 213.333 204.8h366.934c25.6 0 42.666-17.067 42.666-42.667s-21.333-42.667-42.666-42.667z"/></svg>'},{}],d9WLf:[function(K,M,S){M.exports='<svg viewBox="0 0 1152 1024" width="22" height="22" xmlns="http://www.w3.org/2000/svg"><path fill="#fff" d="M311.296 661.504c0 4.096-4.096 8.704-8.704 12.8 0 4.096 0 4.096-4.096 8.704h-12.8c-4.096 0-8.704-4.096-16.896-8.704-8.704-8.704-16.896-8.704-25.6-8.704s-12.8 4.096-16.896 12.8c-4.096 12.8-8.704 21.504-4.096 29.696 4.096 8.704 12.8 16.896 25.6 21.504 16.896 8.704 34.304 16.896 47.104 16.896 12.8 0 21.504-4.096 34.304-8.704 8.704-4.096 16.896-16.896 25.6-29.696s12.8-34.304 16.896-55.296c4.096-21.504 4.096-51.2 4.096-85.504 0-12.8 0-21.504-4.096-29.696 0-8.704-4.096-12.8-8.704-16.896-4.096-4.096-8.704-8.704-12.8-8.704s-12.8-4.096-21.504-4.096h-55.808s-4.096-4.096 0-8.704l4.096-38.4c0-4.096 0-8.704 4.096-8.704h47.104c16.896 0 25.6-4.096 34.304-12.8s12.8-21.504 12.8-42.496v-72.704c0-16.896-4.096-34.304-8.704-42.496-12.8-12.8-25.6-16.896-42.496-16.896H243.2c-8.704 0-16.896 0-21.504 4.096-4.096 8.704-4.096 12.8-4.096 25.6 0 8.704 0 16.896 4.096 21.504 4.096 4.096 12.8 8.704 21.504 8.704h64c4.096 0 8.704 0 8.704 4.096v34.304c0 8.704 0 12.8-4.096 12.8 0 0-4.096 4.096-8.704 4.096H268.8c-8.704 0-12.8 0-21.504 4.096-4.096 0-8.704 4.096-8.704 4.096-4.096 4.096-8.704 12.8-8.704 16.896 0 8.704-4.096 16.896-4.096 25.6l-8.704 72.704v29.696c0 8.704 4.096 12.8 8.704 16.896s8.704 4.096 16.896 8.704h68.096c4.096 0 8.704 0 8.704 4.096s4.096 8.704 4.096 16.896c0 21.504 0 42.496-4.096 55.296.512 9.216-3.584 22.016-8.192 26.624zM896 486.4c-93.696 0-175.104 51.2-217.6 123.904H571.904V576H640c21.504 0 34.304-4.096 42.496-12.8 8.704-8.704 12.8-21.504 12.8-42.496V358.4c0-21.504-4.096-34.304-12.8-42.496-8.704-8.704-21.504-12.8-42.496-12.8 0-4.096 4.096-4.096 4.096-8.704-4.096 0-4.096-4.096-4.096-4.096 4.096-12.8 8.704-21.504 4.096-25.6 0-8.704-4.096-12.8-12.8-21.504-8.704-4.096-16.896-4.096-21.504-4.096-8.704 4.096-12.8 8.704-21.504 21.504-4.096 8.704-8.704 12.8-12.8 21.504s-8.704 12.8-12.8 21.504h-51.2c-4.096-8.704-8.704-16.896-8.704-21.504-4.096-8.704-8.704-12.8-12.8-21.504-4.096-12.8-12.8-16.896-21.504-16.896s-16.896 0-25.6 8.704-12.8 12.8-12.8 21.504 0 16.896 8.704 25.6l4.096 4.096 4.096 4.096c-16.896 0-29.696 4.096-38.4 12.8-8.704 4.096-12.8 21.504-12.8 38.4v157.696c0 21.504 4.096 34.304 12.8 42.496 8.704 8.704 21.504 12.8 42.496 12.8H512v34.304h-98.304c-12.8 0-21.504 0-25.6 4.096s-8.704 8.704-8.704 21.504v16.896c0 4.096 4.096 8.704 4.096 8.704 4.096 0 4.096 4.096 8.704 4.096H512V716.8c0 12.8 4.096 21.504 8.704 25.6 4.096 4.096 12.8 8.704 21.504 8.704 12.8 0 21.504-4.096 25.6-8.704 4.096-4.096 4.096-12.8 4.096-25.6v-55.296H652.8c-8.704 25.6-12.8 51.2-12.8 76.8 0 140.8 115.2 256 256 256s256-115.2 256-256S1036.8 486.4 896 486.4zm-328.704-128h55.296c4.096 0 4.096 0 4.096 4.096V409.6h-59.904v-51.2zm0 102.4H627.2V512h-55.296v-51.2h-4.608zM512 516.096h-55.296v-51.2H512v51.2zm0-102.4h-59.904v-51.2H512v51.2zm384 499.2c-93.696 0-170.496-76.8-170.496-170.496S802.304 571.904 896 571.904s170.496 76.8 170.496 170.496S989.696 912.896 896 912.896z"/><path fill="#fff" d="M580.096 879.104H213.504c-72.704 0-128-55.296-128-119.296V230.4c0-64 55.296-119.296 128-119.296h512c72.704 0 128 55.296 128 119.296v140.8c0 25.6 16.896 42.496 42.496 42.496s42.496-16.896 42.496-42.496V230.4c0-115.2-93.696-204.8-213.504-204.8h-512C93.696 25.6 0 119.296 0 230.4v528.896c0 115.2 93.696 204.8 213.504 204.8h367.104c25.6 0 42.496-16.896 42.496-42.496s-21.504-42.496-43.008-42.496zm171.52 10.752c-15.36-15.36-15.36-40.96 0-56.32l237.568-237.568c15.36-15.36 40.96-15.36 56.32 0s15.36 40.96 0 56.32L807.936 889.856c-15.36 15.36-40.448 15.36-56.32 0z"/></svg>'},{}],"8Y3Ij":[function(K,M,S){M.exports='<svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"><path d="M16.5 8c1.289 0 2.49.375 3.5 1.022V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h7.022A6.5 6.5 0 0 1 16.5 8zM7 13H5a1 1 0 0 1 0-2h2a1 1 0 0 1 0 2zm2-4H5a1 1 0 0 1 0-2h4a1 1 0 0 1 0 2z"/><path d="m20.587 13.696-.787-.131a3.503 3.503 0 0 0-.593-1.051l.301-.804a.46.46 0 0 0-.21-.56l-1.005-.581a.52.52 0 0 0-.656.113l-.499.607a3.53 3.53 0 0 0-1.276 0l-.499-.607a.52.52 0 0 0-.656-.113l-1.005.581a.46.46 0 0 0-.21.56l.301.804c-.254.31-.456.665-.593 1.051l-.787.131a.48.48 0 0 0-.413.465v1.209a.48.48 0 0 0 .413.465l.811.135c.144.382.353.733.614 1.038l-.292.78a.46.46 0 0 0 .21.56l1.005.581a.52.52 0 0 0 .656-.113l.515-.626a3.549 3.549 0 0 0 1.136 0l.515.626a.52.52 0 0 0 .656.113l1.005-.581a.46.46 0 0 0 .21-.56l-.292-.78c.261-.305.47-.656.614-1.038l.811-.135A.48.48 0 0 0 21 15.37v-1.209a.48.48 0 0 0-.413-.465zM16.5 16.057a1.29 1.29 0 1 1 .002-2.582 1.29 1.29 0 0 1-.002 2.582z"/></svg>'},{}],hltwt:[function(K,M,S){M.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22" width="24" height="24"><path d="M17 16H5c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1zM6.96 15c.39 0 .74-.24.89-.6l.65-1.6h5l.66 1.6c.15.36.5.6.89.6.69 0 1.15-.71.88-1.34l-3.88-8.97C11.87 4.27 11.46 4 11 4s-.87.27-1.05.69l-3.88 8.97c-.27.63.2 1.34.89 1.34zM11 5.98 12.87 11H9.13L11 5.98z"/></svg>'},{}]},["E13ST"],"E13ST")})(kt);const Xt=Ut(kt.exports);var Nt={exports:{}};(function(Pt,wt){typeof window<"u"&&function(M,S){Pt.exports=S()}(bt,function(){return function(K){var M={};function S(C){if(M[C])return M[C].exports;var O=M[C]={i:C,l:!1,exports:{}};return K[C].call(O.exports,O,O.exports,S),O.l=!0,O.exports}return S.m=K,S.c=M,S.d=function(C,O,A){S.o(C,O)||Object.defineProperty(C,O,{enumerable:!0,get:A})},S.r=function(C){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(C,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(C,"__esModule",{value:!0})},S.t=function(C,O){if(O&1&&(C=S(C)),O&8||O&4&&typeof C=="object"&&C&&C.__esModule)return C;var A=Object.create(null);if(S.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:C}),O&2&&typeof C!="string")for(var b in C)S.d(A,b,function(P){return C[P]}.bind(null,b));return A},S.n=function(C){var O=C&&C.__esModule?function(){return C.default}:function(){return C};return S.d(O,"a",O),O},S.o=function(C,O){return Object.prototype.hasOwnProperty.call(C,O)},S.p="/dist/",S(S.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(K,M,S){var C=Object.prototype.hasOwnProperty,O="~";function A(){}Object.create&&(A.prototype=Object.create(null),new A().__proto__||(O=!1));function b(g,T,p){this.fn=g,this.context=T,this.once=p||!1}function P(g,T,p,E,c){if(typeof p!="function")throw new TypeError("The listener must be a function");var v=new b(p,E||g,c),i=O?O+T:T;return g._events[i]?g._events[i].fn?g._events[i]=[g._events[i],v]:g._events[i].push(v):(g._events[i]=v,g._eventsCount++),g}function R(g,T){--g._eventsCount===0?g._events=new A:delete g._events[T]}function x(){this._events=new A,this._eventsCount=0}x.prototype.eventNames=function(){var T=[],p,E;if(this._eventsCount===0)return T;for(E in p=this._events)C.call(p,E)&&T.push(O?E.slice(1):E);return Object.getOwnPropertySymbols?T.concat(Object.getOwnPropertySymbols(p)):T},x.prototype.listeners=function(T){var p=O?O+T:T,E=this._events[p];if(!E)return[];if(E.fn)return[E.fn];for(var c=0,v=E.length,i=new Array(v);c<v;c++)i[c]=E[c].fn;return i},x.prototype.listenerCount=function(T){var p=O?O+T:T,E=this._events[p];return E?E.fn?1:E.length:0},x.prototype.emit=function(T,p,E,c,v,i){var t=O?O+T:T;if(!this._events[t])return!1;var o=this._events[t],u=arguments.length,d,n;if(o.fn){switch(o.once&&this.removeListener(T,o.fn,void 0,!0),u){case 1:return o.fn.call(o.context),!0;case 2:return o.fn.call(o.context,p),!0;case 3:return o.fn.call(o.context,p,E),!0;case 4:return o.fn.call(o.context,p,E,c),!0;case 5:return o.fn.call(o.context,p,E,c,v),!0;case 6:return o.fn.call(o.context,p,E,c,v,i),!0}for(n=1,d=new Array(u-1);n<u;n++)d[n-1]=arguments[n];o.fn.apply(o.context,d)}else{var e=o.length,r;for(n=0;n<e;n++)switch(o[n].once&&this.removeListener(T,o[n].fn,void 0,!0),u){case 1:o[n].fn.call(o[n].context);break;case 2:o[n].fn.call(o[n].context,p);break;case 3:o[n].fn.call(o[n].context,p,E);break;case 4:o[n].fn.call(o[n].context,p,E,c);break;default:if(!d)for(r=1,d=new Array(u-1);r<u;r++)d[r-1]=arguments[r];o[n].fn.apply(o[n].context,d)}}return!0},x.prototype.on=function(T,p,E){return P(this,T,p,E,!1)},x.prototype.once=function(T,p,E){return P(this,T,p,E,!0)},x.prototype.removeListener=function(T,p,E,c){var v=O?O+T:T;if(!this._events[v])return this;if(!p)return R(this,v),this;var i=this._events[v];if(i.fn)i.fn===p&&(!c||i.once)&&(!E||i.context===E)&&R(this,v);else{for(var t=0,o=[],u=i.length;t<u;t++)(i[t].fn!==p||c&&!i[t].once||E&&i[t].context!==E)&&o.push(i[t]);o.length?this._events[v]=o.length===1?o[0]:o:R(this,v)}return this},x.prototype.removeAllListeners=function(T){var p;return T?(p=O?O+T:T,this._events[p]&&R(this,p)):(this._events=new A,this._eventsCount=0),this},x.prototype.off=x.prototype.removeListener,x.prototype.addListener=x.prototype.on,x.prefixed=O,x.EventEmitter=x,K.exports=x},"./node_modules/url-toolkit/src/url-toolkit.js":function(K,M,S){(function(C){var O=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,A=/^(?=([^\/?#]*))\1([^]*)$/,b=/(?:\/|^)\.(?=\/)/g,P=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,R={buildAbsoluteURL:function(x,g,T){if(T=T||{},x=x.trim(),g=g.trim(),!g){if(!T.alwaysNormalize)return x;var p=R.parseURL(x);if(!p)throw new Error("Error trying to parse base URL.");return p.path=R.normalizePath(p.path),R.buildURLFromParts(p)}var E=R.parseURL(g);if(!E)throw new Error("Error trying to parse relative URL.");if(E.scheme)return T.alwaysNormalize?(E.path=R.normalizePath(E.path),R.buildURLFromParts(E)):g;var c=R.parseURL(x);if(!c)throw new Error("Error trying to parse base URL.");if(!c.netLoc&&c.path&&c.path[0]!=="/"){var v=A.exec(c.path);c.netLoc=v[1],c.path=v[2]}c.netLoc&&!c.path&&(c.path="/");var i={scheme:c.scheme,netLoc:E.netLoc,path:null,params:E.params,query:E.query,fragment:E.fragment};if(!E.netLoc&&(i.netLoc=c.netLoc,E.path[0]!=="/"))if(!E.path)i.path=c.path,E.params||(i.params=c.params,E.query||(i.query=c.query));else{var t=c.path,o=t.substring(0,t.lastIndexOf("/")+1)+E.path;i.path=R.normalizePath(o)}return i.path===null&&(i.path=T.alwaysNormalize?R.normalizePath(E.path):E.path),R.buildURLFromParts(i)},parseURL:function(x){var g=O.exec(x);return g?{scheme:g[1]||"",netLoc:g[2]||"",path:g[3]||"",params:g[4]||"",query:g[5]||"",fragment:g[6]||""}:null},normalizePath:function(x){for(x=x.split("").reverse().join("").replace(b,"");x.length!==(x=x.replace(P,"")).length;);return x.split("").reverse().join("")},buildURLFromParts:function(x){return x.scheme+x.netLoc+x.path+x.params+x.query+x.fragment}};K.exports=R})()},"./node_modules/webworkify-webpack/index.js":function(K,M,S){function C(T){var p={};function E(v){if(p[v])return p[v].exports;var i=p[v]={i:v,l:!1,exports:{}};return T[v].call(i.exports,i,i.exports,E),i.l=!0,i.exports}E.m=T,E.c=p,E.i=function(v){return v},E.d=function(v,i,t){E.o(v,i)||Object.defineProperty(v,i,{configurable:!1,enumerable:!0,get:t})},E.r=function(v){Object.defineProperty(v,"__esModule",{value:!0})},E.n=function(v){var i=v&&v.__esModule?function(){return v.default}:function(){return v};return E.d(i,"a",i),i},E.o=function(v,i){return Object.prototype.hasOwnProperty.call(v,i)},E.p="/",E.oe=function(v){throw console.error(v),v};var c=E(E.s=ENTRY_MODULE);return c.default||c}var O="[\\.|\\-|\\+|\\w|/|@]+",A="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+O+").*?\\)";function b(T){return(T+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function P(T){return!isNaN(1*T)}function R(T,p,E){var c={};c[E]=[];var v=p.toString(),i=v.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!i)return c;for(var t=i[1],o=new RegExp("(\\\\n|\\W)"+b(t)+A,"g"),u;u=o.exec(v);)u[3]!=="dll-reference"&&c[E].push(u[3]);for(o=new RegExp("\\("+b(t)+'\\("(dll-reference\\s('+O+'))"\\)\\)'+A,"g");u=o.exec(v);)T[u[2]]||(c[E].push(u[1]),T[u[2]]=S(u[1]).m),c[u[2]]=c[u[2]]||[],c[u[2]].push(u[4]);for(var d=Object.keys(c),n=0;n<d.length;n++)for(var e=0;e<c[d[n]].length;e++)P(c[d[n]][e])&&(c[d[n]][e]=1*c[d[n]][e]);return c}function x(T){var p=Object.keys(T);return p.reduce(function(E,c){return E||T[c].length>0},!1)}function g(T,p){for(var E={main:[p]},c={main:[]},v={main:{}};x(E);)for(var i=Object.keys(E),t=0;t<i.length;t++){var o=i[t],u=E[o],d=u.pop();if(v[o]=v[o]||{},!(v[o][d]||!T[o][d])){v[o][d]=!0,c[o]=c[o]||[],c[o].push(d);for(var n=R(T,T[o][d],o),e=Object.keys(n),r=0;r<e.length;r++)E[e[r]]=E[e[r]]||[],E[e[r]]=E[e[r]].concat(n[e[r]])}}return c}K.exports=function(T,p){p=p||{};var E={main:S.m},c=p.all?{main:Object.keys(E.main)}:g(E,T),v="";Object.keys(c).filter(function(d){return d!=="main"}).forEach(function(d){for(var n=0;c[d][n];)n++;c[d].push(n),E[d][n]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",v=v+"var "+d+" = ("+C.toString().replace("ENTRY_MODULE",JSON.stringify(n))+")({"+c[d].map(function(e){return""+JSON.stringify(e)+": "+E[d][e].toString()}).join(",")+`});
`}),v=v+"new (("+C.toString().replace("ENTRY_MODULE",JSON.stringify(T))+")({"+c.main.map(function(d){return""+JSON.stringify(d)+": "+E.main[d].toString()}).join(",")+"}))(self);";var i=new window.Blob([v],{type:"text/javascript"});if(p.bare)return i;var t=window.URL||window.webkitURL||window.mozURL||window.msURL,o=t.createObjectURL(i),u=new window.Worker(o);return u.objectURL=o,u}},"./src/config.ts":function(K,M,S){S.r(M),S.d(M,"hlsDefaultConfig",function(){return r}),S.d(M,"mergeConfig",function(){return l}),S.d(M,"enableStreamingMode",function(){return f});var C=S("./src/controller/abr-controller.ts"),O=S("./src/controller/audio-stream-controller.ts"),A=S("./src/controller/audio-track-controller.ts"),b=S("./src/controller/subtitle-stream-controller.ts"),P=S("./src/controller/subtitle-track-controller.ts"),R=S("./src/controller/buffer-controller.ts"),x=S("./src/controller/timeline-controller.ts"),g=S("./src/controller/cap-level-controller.ts"),T=S("./src/controller/fps-controller.ts"),p=S("./src/controller/eme-controller.ts"),E=S("./src/controller/cmcd-controller.ts"),c=S("./src/utils/xhr-loader.ts"),v=S("./src/utils/fetch-loader.ts"),i=S("./src/utils/cues.ts"),t=S("./src/utils/mediakeys-helper.ts"),o=S("./src/utils/logger.ts");function u(){return u=Object.assign?Object.assign.bind():function(h){for(var a=1;a<arguments.length;a++){var s=arguments[a];for(var y in s)Object.prototype.hasOwnProperty.call(s,y)&&(h[y]=s[y])}return h},u.apply(this,arguments)}function d(h,a){var s=Object.keys(h);if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(h);a&&(y=y.filter(function(D){return Object.getOwnPropertyDescriptor(h,D).enumerable})),s.push.apply(s,y)}return s}function n(h){for(var a=1;a<arguments.length;a++){var s=arguments[a]!=null?arguments[a]:{};a%2?d(Object(s),!0).forEach(function(y){e(h,y,s[y])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach(function(y){Object.defineProperty(h,y,Object.getOwnPropertyDescriptor(s,y))})}return h}function e(h,a,s){return a in h?Object.defineProperty(h,a,{value:s,enumerable:!0,configurable:!0,writable:!0}):h[a]=s,h}var r=n(n({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:c.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:C.default,bufferController:R.default,capLevelController:g.default,fpsController:T.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:t.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0},m()),{},{subtitleStreamController:b.SubtitleStreamController,subtitleTrackController:P.default,timelineController:x.TimelineController,audioStreamController:O.default,audioTrackController:A.default,emeController:p.default,cmcdController:E.default});function m(){return{cueHandler:i.default,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function l(h,a){if((a.liveSyncDurationCount||a.liveMaxLatencyDurationCount)&&(a.liveSyncDuration||a.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(a.liveMaxLatencyDurationCount!==void 0&&(a.liveSyncDurationCount===void 0||a.liveMaxLatencyDurationCount<=a.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(a.liveMaxLatencyDuration!==void 0&&(a.liveSyncDuration===void 0||a.liveMaxLatencyDuration<=a.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return u({},h,a)}function f(h){var a=h.loader;if(a!==v.default&&a!==c.default)o.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),h.progressive=!1;else{var s=Object(v.fetchSupported)();s&&(h.loader=v.default,h.progressive=!0,h.enableSoftwareAES=!0,o.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}}},"./src/controller/abr-controller.ts":function(K,M,S){S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/utils/ewma-bandwidth-estimator.ts"),A=S("./src/events.ts"),b=S("./src/utils/buffer-helper.ts"),P=S("./src/errors.ts"),R=S("./src/types/loader.ts"),x=S("./src/utils/logger.ts");function g(E,c){for(var v=0;v<c.length;v++){var i=c[v];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(E,i.key,i)}}function T(E,c,v){return c&&g(E.prototype,c),v&&g(E,v),Object.defineProperty(E,"prototype",{writable:!1}),E}var p=function(){function E(v){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=v;var i=v.config;this.bwEstimator=new O.default(i.abrEwmaSlowVoD,i.abrEwmaFastVoD,i.abrEwmaDefaultEstimate),this.registerListeners()}var c=E.prototype;return c.registerListeners=function(){var i=this.hls;i.on(A.Events.FRAG_LOADING,this.onFragLoading,this),i.on(A.Events.FRAG_LOADED,this.onFragLoaded,this),i.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(A.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var i=this.hls;i.off(A.Events.FRAG_LOADING,this.onFragLoading,this),i.off(A.Events.FRAG_LOADED,this.onFragLoaded,this),i.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(A.Events.ERROR,this.onError,this)},c.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},c.onFragLoading=function(i,t){var o=t.frag;if(o.type===R.PlaylistLevelType.MAIN&&!this.timer){var u;this.fragCurrent=o,this.partCurrent=(u=t.part)!=null?u:null,this.timer=self.setInterval(this.onCheck,100)}},c.onLevelLoaded=function(i,t){var o=this.hls.config;t.details.live?this.bwEstimator.update(o.abrEwmaSlowLive,o.abrEwmaFastLive):this.bwEstimator.update(o.abrEwmaSlowVoD,o.abrEwmaFastVoD)},c._abandonRulesCheck=function(){var i=this.fragCurrent,t=this.partCurrent,o=this.hls,u=o.autoLevelEnabled,d=o.config,n=o.media;if(!(!i||!n)){var e=t?t.stats:i.stats,r=t?t.duration:i.duration;if(e.aborted){x.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),this._nextAutoLevel=-1;return}if(!(!u||n.paused||!n.playbackRate||!n.readyState)){var m=performance.now()-e.loading.start,l=Math.abs(n.playbackRate);if(!(m<=500*r/l)){var f=o.levels,h=o.minAutoLevel,a=f[i.level],s=e.total||Math.max(e.loaded,Math.round(r*a.maxBitrate/8)),y=Math.max(1,e.bwEstimate?e.bwEstimate/8:e.loaded*1e3/m),D=(s-e.loaded)/y,L=n.currentTime,I=(b.BufferHelper.bufferInfo(n,L,d.maxBufferHole).end-L)/l;if(!(I>=2*r/l||D<=I)){var _=Number.POSITIVE_INFINITY,F;for(F=i.level-1;F>h;F--){var B=f[F].maxBitrate;if(_=r*B/(8*.8*y),_<I)break}if(!(_>=D)){var U=this.bwEstimator.getEstimate();x.logger.warn("Fragment "+i.sn+(t?" part "+t.index:"")+" of level "+i.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+F+`
      Current BW estimate: `+(Object(C.isFiniteNumber)(U)?(U/1024).toFixed(3):"Unknown")+` Kb/s
      Estimated load time for current fragment: `+D.toFixed(3)+` s
      Estimated load time for the next fragment: `+_.toFixed(3)+` s
      Time to underbuffer: `+I.toFixed(3)+" s"),o.nextLoadLevel=F,this.bwEstimator.sample(m,e.loaded),this.clearTimer(),i.loader&&(this.fragCurrent=this.partCurrent=null,i.loader.abort()),o.trigger(A.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:t,stats:e})}}}}}},c.onFragLoaded=function(i,t){var o=t.frag,u=t.part;if(o.type===R.PlaylistLevelType.MAIN&&Object(C.isFiniteNumber)(o.sn)){var d=u?u.stats:o.stats,n=u?u.duration:o.duration;if(this.clearTimer(),this.lastLoadedFragLevel=o.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var e=this.hls.levels[o.level],r=(e.loaded?e.loaded.bytes:0)+d.loaded,m=(e.loaded?e.loaded.duration:0)+n;e.loaded={bytes:r,duration:m},e.realBitrate=Math.round(8*r/m)}if(o.bitrateTest){var l={stats:d,frag:o,part:u,id:o.type};this.onFragBuffered(A.Events.FRAG_BUFFERED,l),o.bitrateTest=!1}}},c.onFragBuffered=function(i,t){var o=t.frag,u=t.part,d=u?u.stats:o.stats;if(!d.aborted&&!(o.type!==R.PlaylistLevelType.MAIN||o.sn==="initSegment")){var n=d.parsing.end-d.loading.start;this.bwEstimator.sample(n,d.loaded),d.bwEstimate=this.bwEstimator.getEstimate(),o.bitrateTest?this.bitrateTestDelay=n/1e3:this.bitrateTestDelay=0}},c.onError=function(i,t){switch(t.details){case P.ErrorDetails.FRAG_LOAD_ERROR:case P.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer();break}},c.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},c.getNextABRAutoLevel=function(){var i=this.fragCurrent,t=this.partCurrent,o=this.hls,u=o.maxAutoLevel,d=o.config,n=o.minAutoLevel,e=o.media,r=t?t.duration:i?i.duration:0,m=e?e.currentTime:0,l=e&&e.playbackRate!==0?Math.abs(e.playbackRate):1,f=this.bwEstimator?this.bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,h=(b.BufferHelper.bufferInfo(e,m,d.maxBufferHole).end-m)/l,a=this.findBestLevel(f,n,u,h,d.abrBandWidthFactor,d.abrBandWidthUpFactor);if(a>=0)return a;x.logger.trace((h?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var s=r?Math.min(r,d.maxStarvationDelay):d.maxStarvationDelay,y=d.abrBandWidthFactor,D=d.abrBandWidthUpFactor;if(!h){var L=this.bitrateTestDelay;if(L){var I=r?Math.min(r,d.maxLoadingDelay):d.maxLoadingDelay;s=I-L,x.logger.trace("bitrate test took "+Math.round(1e3*L)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*s)+" ms"),y=D=1}}return a=this.findBestLevel(f,n,u,h+s,y,D),Math.max(a,0)},c.findBestLevel=function(i,t,o,u,d,n){for(var e,r=this.fragCurrent,m=this.partCurrent,l=this.lastLoadedFragLevel,f=this.hls.levels,h=f[l],a=!!(h!=null&&(e=h.details)!==null&&e!==void 0&&e.live),s=h==null?void 0:h.codecSet,y=m?m.duration:r?r.duration:0,D=o;D>=t;D--){var L=f[D];if(!(!L||s&&L.codecSet!==s)){var I=L.details,_=(m?I==null?void 0:I.partTarget:I==null?void 0:I.averagetargetduration)||y,F=void 0;D<=l?F=d*i:F=n*i;var B=f[D].maxBitrate,U=B*_/F;if(x.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+D+"/"+Math.round(F)+"/"+B+"/"+_+"/"+u+"/"+U),F>B&&(!U||a&&!this.bitrateTestDelay||U<u))return D}}return-1},T(E,[{key:"nextAutoLevel",get:function(){var i=this._nextAutoLevel,t=this.bwEstimator;if(i!==-1&&(!t||!t.canEstimate()))return i;var o=this.getNextABRAutoLevel();return i!==-1&&(o=Math.min(i,o)),o},set:function(i){this._nextAutoLevel=i}}]),E}();M.default=p},"./src/controller/audio-stream-controller.ts":function(K,M,S){S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/controller/base-stream-controller.ts"),A=S("./src/events.ts"),b=S("./src/utils/buffer-helper.ts"),P=S("./src/controller/fragment-tracker.ts"),R=S("./src/types/level.ts"),x=S("./src/types/loader.ts"),g=S("./src/loader/fragment.ts"),T=S("./src/demux/chunk-cache.ts"),p=S("./src/demux/transmuxer-interface.ts"),E=S("./src/types/transmuxer.ts"),c=S("./src/controller/fragment-finders.ts"),v=S("./src/utils/discontinuities.ts"),i=S("./src/errors.ts");function t(){return t=Object.assign?Object.assign.bind():function(e){for(var r=1;r<arguments.length;r++){var m=arguments[r];for(var l in m)Object.prototype.hasOwnProperty.call(m,l)&&(e[l]=m[l])}return e},t.apply(this,arguments)}function o(e,r){e.prototype=Object.create(r.prototype),e.prototype.constructor=e,u(e,r)}function u(e,r){return u=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(l,f){return l.__proto__=f,l},u(e,r)}var d=100,n=function(e){o(r,e);function r(l,f){var h;return h=e.call(this,l,f,"[audio-stream-controller]")||this,h.videoBuffer=null,h.videoTrackCC=-1,h.waitingVideoCC=-1,h.audioSwitch=!1,h.trackId=-1,h.waitingData=null,h.mainDetails=null,h.bufferFlushed=!1,h.cachedTrackLoadedData=null,h._registerListeners(),h}var m=r.prototype;return m.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},m._registerListeners=function(){var f=this.hls;f.on(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.on(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.on(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.on(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.on(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),f.on(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.on(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),f.on(A.Events.ERROR,this.onError,this),f.on(A.Events.BUFFER_RESET,this.onBufferReset,this),f.on(A.Events.BUFFER_CREATED,this.onBufferCreated,this),f.on(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.on(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.on(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m._unregisterListeners=function(){var f=this.hls;f.off(A.Events.MEDIA_ATTACHED,this.onMediaAttached,this),f.off(A.Events.MEDIA_DETACHING,this.onMediaDetaching,this),f.off(A.Events.MANIFEST_LOADING,this.onManifestLoading,this),f.off(A.Events.LEVEL_LOADED,this.onLevelLoaded,this),f.off(A.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),f.off(A.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),f.off(A.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),f.off(A.Events.ERROR,this.onError,this),f.off(A.Events.BUFFER_RESET,this.onBufferReset,this),f.off(A.Events.BUFFER_CREATED,this.onBufferCreated,this),f.off(A.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),f.off(A.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),f.off(A.Events.FRAG_BUFFERED,this.onFragBuffered,this)},m.onInitPtsFound=function(f,h){var a=h.frag,s=h.id,y=h.initPTS;if(s==="main"){var D=a.cc;this.initPTS[a.cc]=y,this.log("InitPTS for cc: "+D+" found from main: "+y),this.videoTrackCC=D,this.state===O.State.WAITING_INIT_PTS&&this.tick()}},m.startLoad=function(f){if(!this.levels){this.startPosition=f,this.state=O.State.STOPPED;return}var h=this.lastCurrentTime;this.stopLoad(),this.setInterval(d),this.fragLoadError=0,h>0&&f===-1?(this.log("Override startPosition with lastCurrentTime @"+h.toFixed(3)),f=h,this.state=O.State.IDLE):(this.loadedmetadata=!1,this.state=O.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=f,this.tick()},m.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_TRACK:{var f,h=this.levels,a=this.trackId,s=h==null||(f=h[a])===null||f===void 0?void 0:f.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=O.State.WAITING_INIT_PTS}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var y,D=performance.now(),L=this.retryDate;(!L||D>=L||(y=this.media)!==null&&y!==void 0&&y.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=O.State.IDLE);break}case O.State.WAITING_INIT_PTS:{var I=this.waitingData;if(I){var _=I.frag,F=I.part,B=I.cache,U=I.complete;if(this.initPTS[_.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.FRAG_LOADING;var N=B.flush(),k={frag:_,part:F,payload:N,networkDetails:null};this._handleFragmentLoadProgress(k),U&&e.prototype._handleFragmentLoadComplete.call(this,k)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log("Waiting fragment cc ("+_.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var w=this.getLoadPosition(),W=b.BufferHelper.bufferInfo(this.mediaBuffer,w,this.config.maxBufferHole),j=Object(c.fragmentWithinToleranceTest)(W.end,this.config.maxFragLookUpTolerance,_);j<0&&(this.log("Waiting fragment cc ("+_.cc+") @ "+_.start+" cancelled because another fragment at "+W.end+" is needed"),this.clearWaitingFragment())}}else this.state=O.State.IDLE}}this.onTickEnd()},m.clearWaitingFragment=function(){var f=this.waitingData;f&&(this.fragmentTracker.removeFragment(f.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=O.State.IDLE)},m.resetLoadingState=function(){this.clearWaitingFragment(),e.prototype.resetLoadingState.call(this)},m.onTickEnd=function(){var f=this.media;if(!(!f||!f.readyState)){var h=this.mediaBuffer?this.mediaBuffer:f,a=h.buffered;!this.loadedmetadata&&a.length&&(this.loadedmetadata=!0),this.lastCurrentTime=f.currentTime}},m.doTickIdle=function(){var f,h,a=this.hls,s=this.levels,y=this.media,D=this.trackId,L=a.config;if(!(!s||!s[D])&&!(!y&&(this.startFragRequested||!L.startFragPrefetch))){var I=s[D],_=I.details;if(!_||_.live&&this.levelLastLoaded!==D||this.waitForCdnTuneIn(_)){this.state=O.State.WAITING_TRACK;return}this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,g.ElementaryStreamTypes.AUDIO,x.PlaylistLevelType.AUDIO));var F=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,x.PlaylistLevelType.AUDIO);if(F!==null){var B=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,x.PlaylistLevelType.MAIN),U=F.len,N=this.getMaxBufferLength(B==null?void 0:B.len),k=this.audioSwitch;if(!(U>=N&&!k)){if(!k&&this._streamEnded(F,_)){a.trigger(A.Events.BUFFER_EOS,{type:"audio"}),this.state=O.State.ENDED;return}var w=_.fragments,W=w[0].start,j=F.end;if(k){var H=this.getLoadPosition();j=H,_.PTSKnown&&H<W&&(F.end>W||F.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),y.currentTime=W+.05)}if(!(B&&j>B.end+_.targetduration)&&!((!B||!B.len)&&F.len)){var G=this.getNextFragment(j,_);if(!G){this.bufferFlushed=!0;return}((f=G.decryptdata)===null||f===void 0?void 0:f.keyFormat)==="identity"&&!((h=G.decryptdata)!==null&&h!==void 0&&h.key)?this.loadKey(G,_):this.loadFragment(G,_,j)}}}}},m.getMaxBufferLength=function(f){var h=e.prototype.getMaxBufferLength.call(this);return f?Math.max(h,f):h},m.onMediaDetaching=function(){this.videoBuffer=null,e.prototype.onMediaDetaching.call(this)},m.onAudioTracksUpdated=function(f,h){var a=h.audioTracks;this.resetTransmuxer(),this.levels=a.map(function(s){return new R.Level(s)})},m.onAudioTrackSwitching=function(f,h){var a=!!h.url;this.trackId=h.id;var s=this.fragCurrent;s!=null&&s.loader&&s.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),a?this.setInterval(d):this.resetTransmuxer(),a?(this.audioSwitch=!0,this.state=O.State.IDLE):this.state=O.State.STOPPED,this.tick()},m.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},m.onLevelLoaded=function(f,h){this.mainDetails=h.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(A.Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)},m.onAudioTrackLoaded=function(f,h){var a;if(this.mainDetails==null){this.cachedTrackLoadedData=h;return}var s=this.levels,y=h.details,D=h.id;if(!s){this.warn("Audio tracks were reset while loading level "+D);return}this.log("Track "+D+" loaded ["+y.startSN+","+y.endSN+"],duration:"+y.totalduration);var L=s[D],I=0;if(y.live||(a=L.details)!==null&&a!==void 0&&a.live){var _=this.mainDetails;if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed||!_)return;!L.details&&y.hasProgramDateTime&&_.hasProgramDateTime?(Object(v.alignMediaPlaylistByPDT)(y,_),I=y.fragments[0].start):I=this.alignPlaylists(y,L.details)}L.details=y,this.levelLastLoaded=D,!this.startFragRequested&&(this.mainDetails||!y.live)&&this.setStartPosition(L.details,I),this.state===O.State.WAITING_TRACK&&!this.waitForCdnTuneIn(y)&&(this.state=O.State.IDLE),this.tick()},m._handleFragmentLoadProgress=function(f){var h,a=f.frag,s=f.part,y=f.payload,D=this.config,L=this.trackId,I=this.levels;if(!I){this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+a.sn+" of level "+a.level+" will not be buffered");return}var _=I[L];console.assert(_,"Audio track is defined on fragment load progress");var F=_.details;console.assert(F,"Audio track details are defined on fragment load progress");var B=D.defaultAudioCodec||_.audioCodec||"mp4a.40.2",U=this.transmuxer;U||(U=this.transmuxer=new p.default(this.hls,x.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var N=this.initPTS[a.cc],k=(h=a.initSegment)===null||h===void 0?void 0:h.data;if(N!==void 0){var w=!1,W=s?s.index:-1,j=W!==-1,H=new E.ChunkMetadata(a.level,a.sn,a.stats.chunkCount,y.byteLength,W,j);U.push(y,k,B,"",a,s,F.totalduration,w,H,N)}else{this.log("Unknown video PTS for cc "+a.cc+", waiting for video PTS before demuxing audio frag "+a.sn+" of ["+F.startSN+" ,"+F.endSN+"],track "+L);var G=this.waitingData=this.waitingData||{frag:a,part:s,cache:new T.default,complete:!1},$=G.cache;$.push(new Uint8Array(y)),this.waitingVideoCC=this.videoTrackCC,this.state=O.State.WAITING_INIT_PTS}},m._handleFragmentLoadComplete=function(f){if(this.waitingData){this.waitingData.complete=!0;return}e.prototype._handleFragmentLoadComplete.call(this,f)},m.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},m.onBufferCreated=function(f,h){var a=h.tracks.audio;a&&(this.mediaBuffer=a.buffer),h.tracks.video&&(this.videoBuffer=h.tracks.video.buffer)},m.onFragBuffered=function(f,h){var a=h.frag,s=h.part;if(a.type===x.PlaylistLevelType.AUDIO){if(this.fragContextChanged(a)){this.warn("Fragment "+a.sn+(s?" p: "+s.index:"")+" of level "+a.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch);return}a.sn!=="initSegment"&&(this.fragPrevious=a,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(a,s)}},m.onError=function(f,h){switch(h.details){case i.ErrorDetails.FRAG_LOAD_ERROR:case i.ErrorDetails.FRAG_LOAD_TIMEOUT:case i.ErrorDetails.KEY_LOAD_ERROR:case i.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(x.PlaylistLevelType.AUDIO,h);break;case i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case i.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==O.State.ERROR&&this.state!==O.State.STOPPED&&(this.state=h.fatal?O.State.ERROR:O.State.IDLE,this.warn(h.details+" while loading frag, switching to "+this.state+" state"));break;case i.ErrorDetails.BUFFER_FULL_ERROR:if(h.parent==="audio"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var a=!0,s=this.getFwdBufferInfo(this.mediaBuffer,x.PlaylistLevelType.AUDIO);s&&s.len>.5&&(a=!this.reduceMaxBufferLength(s.len)),a&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}break}},m.onBufferFlushed=function(f,h){var a=h.type;a===g.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},m._handleTransmuxComplete=function(f){var h,a="audio",s=this.hls,y=f.remuxResult,D=f.chunkMeta,L=this.getCurrentContext(D);if(!L){this.warn("The loading context changed while buffering fragment "+D.sn+" of level "+D.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(D.level);return}var I=L.frag,_=L.part,F=L.level.details,B=y.audio,U=y.text,N=y.id3,k=y.initSegment;if(!(this.fragContextChanged(I)||!F)){if(this.state=O.State.PARSING,this.audioSwitch&&B&&this.completeAudioSwitch(),k!=null&&k.tracks&&(this._bufferInitSegment(k.tracks,I,D),s.trigger(A.Events.FRAG_PARSING_INIT_SEGMENT,{frag:I,id:a,tracks:k.tracks})),B){var w=B.startPTS,W=B.endPTS,j=B.startDTS,H=B.endDTS;_&&(_.elementaryStreams[g.ElementaryStreamTypes.AUDIO]={startPTS:w,endPTS:W,startDTS:j,endDTS:H}),I.setElementaryStreamInfo(g.ElementaryStreamTypes.AUDIO,w,W,j,H),this.bufferFragmentData(B,I,_,D)}if(N!=null&&(h=N.samples)!==null&&h!==void 0&&h.length){var G=t({id:a,frag:I,details:F},N);s.trigger(A.Events.FRAG_PARSING_METADATA,G)}if(U){var $=t({id:a,frag:I,details:F},U);s.trigger(A.Events.FRAG_PARSING_USERDATA,$)}}},m._bufferInitSegment=function(f,h,a){if(this.state===O.State.PARSING){f.video&&delete f.video;var s=f.audio;if(!!s){s.levelCodec=s.codec,s.id="audio",this.log("Init audio buffer, container:"+s.container+", codecs[parsed]=["+s.codec+"]"),this.hls.trigger(A.Events.BUFFER_CODECS,f);var y=s.initSegment;if(y!=null&&y.byteLength){var D={type:"audio",frag:h,part:null,chunkMeta:a,parent:h.type,data:y};this.hls.trigger(A.Events.BUFFER_APPENDING,D)}this.tick()}}},m.loadFragment=function(f,h,a){var s=this.fragmentTracker.getState(f);this.fragCurrent=f,(this.audioSwitch||s===P.FragmentState.NOT_LOADED||s===P.FragmentState.PARTIAL)&&(f.sn==="initSegment"?this._loadInitSegment(f):h.live&&!Object(C.isFiniteNumber)(this.initPTS[f.cc])?(this.log("Waiting for video PTS in continuity counter "+f.cc+" of live stream before loading audio fragment "+f.sn+" of level "+this.trackId),this.state=O.State.WAITING_INIT_PTS):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,f,h,a)))},m.completeAudioSwitch=function(){var f=this.hls,h=this.media,a=this.trackId;h&&(this.log("Switching audio track : flushing all audio"),e.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,f.trigger(A.Events.AUDIO_TRACK_SWITCHED,{id:a})},r}(O.default);M.default=n},"./src/controller/audio-track-controller.ts":function(K,M,S){S.r(M);var C=S("./src/events.ts"),O=S("./src/errors.ts"),A=S("./src/controller/base-playlist-controller.ts"),b=S("./src/types/loader.ts");function P(p,E){for(var c=0;c<E.length;c++){var v=E[c];v.enumerable=v.enumerable||!1,v.configurable=!0,"value"in v&&(v.writable=!0),Object.defineProperty(p,v.key,v)}}function R(p,E,c){return E&&P(p.prototype,E),c&&P(p,c),Object.defineProperty(p,"prototype",{writable:!1}),p}function x(p,E){p.prototype=Object.create(E.prototype),p.prototype.constructor=p,g(p,E)}function g(p,E){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(v,i){return v.__proto__=i,v},g(p,E)}var T=function(p){x(E,p);function E(v){var i;return i=p.call(this,v,"[audio-track-controller]")||this,i.tracks=[],i.groupId=null,i.tracksInGroup=[],i.trackId=-1,i.trackName="",i.selectDefaultTrack=!0,i.registerListeners(),i}var c=E.prototype;return c.registerListeners=function(){var i=this.hls;i.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(C.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(C.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var i=this.hls;i.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(C.Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(C.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(C.Events.ERROR,this.onError,this)},c.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,p.prototype.destroy.call(this)},c.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},c.onManifestParsed=function(i,t){this.tracks=t.audioTracks||[]},c.onAudioTrackLoaded=function(i,t){var o=t.id,u=t.details,d=this.tracksInGroup[o];if(!d){this.warn("Invalid audio track id "+o);return}var n=d.details;d.details=t.details,this.log("audioTrack "+o+" loaded ["+u.startSN+"-"+u.endSN+"]"),o===this.trackId&&(this.retryCount=0,this.playlistLoaded(o,t,n))},c.onLevelLoading=function(i,t){this.switchLevel(t.level)},c.onLevelSwitching=function(i,t){this.switchLevel(t.level)},c.switchLevel=function(i){var t=this.hls.levels[i];if(!!(t!=null&&t.audioGroupIds)){var o=t.audioGroupIds[t.urlId];if(this.groupId!==o){this.groupId=o;var u=this.tracks.filter(function(n){return!o||n.groupId===o});this.selectDefaultTrack&&!u.some(function(n){return n.default})&&(this.selectDefaultTrack=!1),this.tracksInGroup=u;var d={audioTracks:u};this.log("Updating audio tracks, "+u.length+' track(s) found in "'+o+'" group-id'),this.hls.trigger(C.Events.AUDIO_TRACKS_UPDATED,d),this.selectInitialTrack()}}},c.onError=function(i,t){p.prototype.onError.call(this,i,t),!(t.fatal||!t.context)&&t.context.type===b.PlaylistContextType.AUDIO_TRACK&&t.context.id===this.trackId&&t.context.groupId===this.groupId&&this.retryLoadingOrFail(t)},c.setAudioTrack=function(i){var t=this.tracksInGroup;if(i<0||i>=t.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();var o=t[this.trackId];this.log("Now switching to audio-track index "+i);var u=t[i],d=u.id,n=u.groupId,e=n===void 0?"":n,r=u.name,m=u.type,l=u.url;if(this.trackId=i,this.trackName=r,this.selectDefaultTrack=!1,this.hls.trigger(C.Events.AUDIO_TRACK_SWITCHING,{id:d,groupId:e,name:r,type:m,url:l}),!(u.details&&!u.details.live)){var f=this.switchParams(u.url,o==null?void 0:o.details);this.loadPlaylist(f)}},c.selectInitialTrack=function(){var i=this.tracksInGroup;console.assert(i.length,"Initial audio track should be selected when tracks are known");var t=this.trackName,o=this.findTrackId(t)||this.findTrackId();o!==-1?this.setAudioTrack(o):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},c.findTrackId=function(i){for(var t=this.tracksInGroup,o=0;o<t.length;o++){var u=t[o];if((!this.selectDefaultTrack||u.default)&&(!i||i===u.name))return u.id}return-1},c.loadPlaylist=function(i){var t=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(t)){var o=t.id,u=t.groupId,d=t.url;if(i)try{d=i.addDirectives(d)}catch(n){this.warn("Could not construct new URL with HLS Delivery Directives: "+n)}this.log("loading audio-track playlist for id: "+o),this.clearTimer(),this.hls.trigger(C.Events.AUDIO_TRACK_LOADING,{url:d,id:o,groupId:u,deliveryDirectives:i||null})}},R(E,[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}}]),E}(A.default);M.default=T},"./src/controller/base-playlist-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return R});var C=S("./src/polyfills/number.ts"),O=S("./src/types/level.ts"),A=S("./src/controller/level-helper.ts"),b=S("./src/utils/logger.ts"),P=S("./src/errors.ts"),R=function(){function x(T,p){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=b.logger.log.bind(b.logger,p+":"),this.warn=b.logger.warn.bind(b.logger,p+":"),this.hls=T}var g=x.prototype;return g.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},g.onError=function(p,E){E.fatal&&E.type===P.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},g.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},g.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},g.stopLoad=function(){this.canLoad=!1,this.clearTimer()},g.switchParams=function(p,E){var c=E==null?void 0:E.renditionReports;if(c)for(var v=0;v<c.length;v++){var i=c[v],t=""+i.URI;if(t===p.slice(-t.length)){var o=parseInt(i["LAST-MSN"]),u=parseInt(i["LAST-PART"]);if(E&&this.hls.config.lowLatencyMode){var d=Math.min(E.age-E.partTarget,E.targetduration);u!==void 0&&d>E.partTarget&&(u+=1)}if(Object(C.isFiniteNumber)(o))return new O.HlsUrlParameters(o,Object(C.isFiniteNumber)(u)?u:void 0,O.HlsSkip.No)}}},g.loadPlaylist=function(p){},g.shouldLoadTrack=function(p){return this.canLoad&&p&&!!p.url&&(!p.details||p.details.live)},g.playlistLoaded=function(p,E,c){var v=this,i=E.details,t=E.stats,o=t.loading.end?Math.max(0,self.performance.now()-t.loading.end):0;if(i.advancedDateTime=Date.now()-o,i.live||c!=null&&c.live){if(i.reloaded(c),c&&this.log("live playlist "+p+" "+(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:"MISSED")),c&&i.fragments.length>0&&Object(A.mergeDetails)(c,i),!this.canLoad||!i.live)return;var u,d=void 0,n=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){var e=this.hls.config.lowLatencyMode,r=i.lastPartSn,m=i.endSN,l=i.lastPartIndex,f=l!==-1,h=r===m,a=e?0:l;f?(d=h?m+1:r,n=h?a:l+1):d=m+1;var s=i.age,y=s+i.ageHeader,D=Math.min(y-i.partTarget,i.targetduration*1.5);if(D>0){if(c&&D>c.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+c.tuneInGoal+" to: "+D+" with playlist age: "+i.age),D=0;else{var L=Math.floor(D/i.targetduration);if(d+=L,n!==void 0){var I=Math.round(D%i.targetduration/i.partTarget);n+=I}this.log("CDN Tune-in age: "+i.ageHeader+"s last advanced "+s.toFixed(2)+"s goal: "+D+" skip sn "+L+" to part "+n)}i.tuneInGoal=D}if(u=this.getDeliveryDirectives(i,E.deliveryDirectives,d,n),e||!h){this.loadPlaylist(u);return}}else u=this.getDeliveryDirectives(i,E.deliveryDirectives,d,n);var _=Object(A.computeReloadInterval)(i,t);d!==void 0&&i.canBlockReload&&(_-=i.partTarget||1),this.log("reload live playlist "+p+" in "+Math.round(_)+" ms"),this.timer=self.setTimeout(function(){return v.loadPlaylist(u)},_)}else this.clearTimer()},g.getDeliveryDirectives=function(p,E,c,v){var i=Object(O.getSkipValue)(p,c);return E!=null&&E.skip&&p.deltaUpdateFailed&&(c=E.msn,v=E.part,i=O.HlsSkip.No),new O.HlsUrlParameters(c,v,i)},g.retryLoadingOrFail=function(p){var E=this,c=this.hls.config,v=this.retryCount<c.levelLoadingMaxRetry;if(v){var i;if(this.retryCount++,p.details.indexOf("LoadTimeOut")>-1&&(i=p.context)!==null&&i!==void 0&&i.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+p.details+'"'),this.loadPlaylist();else{var t=Math.min(Math.pow(2,this.retryCount)*c.levelLoadingRetryDelay,c.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout(function(){return E.loadPlaylist()},t),this.warn("retry playlist loading #"+this.retryCount+" in "+t+' ms after "'+p.details+'"')}}else this.warn('cannot recover from error "'+p.details+'"'),this.clearTimer(),p.fatal=!0;return v},x}()},"./src/controller/base-stream-controller.ts":function(K,M,S){S.r(M),S.d(M,"State",function(){return m}),S.d(M,"default",function(){return l});var C=S("./src/polyfills/number.ts"),O=S("./src/task-loop.ts"),A=S("./src/controller/fragment-tracker.ts"),b=S("./src/utils/buffer-helper.ts"),P=S("./src/utils/logger.ts"),R=S("./src/events.ts"),x=S("./src/errors.ts"),g=S("./src/types/transmuxer.ts"),T=S("./src/utils/mp4-tools.ts"),p=S("./src/utils/discontinuities.ts"),E=S("./src/controller/fragment-finders.ts"),c=S("./src/controller/level-helper.ts"),v=S("./src/loader/fragment-loader.ts"),i=S("./src/crypt/decrypter.ts"),t=S("./src/utils/time-ranges.ts"),o=S("./src/types/loader.ts");function u(f,h){for(var a=0;a<h.length;a++){var s=h[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(f,s.key,s)}}function d(f,h,a){return h&&u(f.prototype,h),a&&u(f,a),Object.defineProperty(f,"prototype",{writable:!1}),f}function n(f){if(f===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return f}function e(f,h){f.prototype=Object.create(h.prototype),f.prototype.constructor=f,r(f,h)}function r(f,h){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(s,y){return s.__proto__=y,s},r(f,h)}var m={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},l=function(f){e(h,f);function h(s,y,D){var L;return L=f.call(this)||this,L.hls=void 0,L.fragPrevious=null,L.fragCurrent=null,L.fragmentTracker=void 0,L.transmuxer=null,L._state=m.STOPPED,L.media=void 0,L.mediaBuffer=void 0,L.config=void 0,L.bitrateTest=!1,L.lastCurrentTime=0,L.nextLoadPosition=0,L.startPosition=0,L.loadedmetadata=!1,L.fragLoadError=0,L.retryDate=0,L.levels=null,L.fragmentLoader=void 0,L.levelLastLoaded=null,L.startFragRequested=!1,L.decrypter=void 0,L.initPTS=[],L.onvseeking=null,L.onvended=null,L.logPrefix="",L.log=void 0,L.warn=void 0,L.logPrefix=D,L.log=P.logger.log.bind(P.logger,D+":"),L.warn=P.logger.warn.bind(P.logger,D+":"),L.hls=s,L.fragmentLoader=new v.default(s.config),L.fragmentTracker=y,L.config=s.config,L.decrypter=new i.default(s,s.config),s.on(R.Events.KEY_LOADED,L.onKeyLoaded,n(L)),L}var a=h.prototype;return a.doTick=function(){this.onTickEnd()},a.onTickEnd=function(){},a.startLoad=function(y){},a.stopLoad=function(){this.fragmentLoader.abort();var y=this.fragCurrent;y&&this.fragmentTracker.removeFragment(y),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=m.STOPPED},a._streamEnded=function(y,D){var L=this.fragCurrent,I=this.fragmentTracker;if(!D.live&&L&&L.sn>=D.endSN&&!y.nextStart){var _=D.partList;if(_!=null&&_.length){var F=_[_.length-1],B=b.BufferHelper.isBuffered(this.media,F.start+F.duration/2);return B}var U=I.getState(L);return U===A.FragmentState.PARTIAL||U===A.FragmentState.OK}return!1},a.onMediaAttached=function(y,D){var L=this.media=this.mediaBuffer=D.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),L.addEventListener("seeking",this.onvseeking),L.addEventListener("ended",this.onvended);var I=this.config;this.levels&&I.autoStartLoad&&this.state===m.STOPPED&&this.startLoad(I.startPosition)},a.onMediaDetaching=function(){var y=this.media;y!=null&&y.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),y&&(y.removeEventListener("seeking",this.onvseeking),y.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},a.onMediaSeeking=function(){var y=this.config,D=this.fragCurrent,L=this.media,I=this.mediaBuffer,_=this.state,F=L?L.currentTime:0,B=b.BufferHelper.bufferInfo(I||L,F,y.maxBufferHole);if(this.log("media seeking to "+(Object(C.isFiniteNumber)(F)?F.toFixed(3):F)+", state: "+_),_===m.ENDED)this.resetLoadingState();else if(D&&!B.len){var U=y.maxFragLookUpTolerance,N=D.start-U,k=D.start+D.duration+U,w=F>k;(F<N||w)&&(w&&D.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),D.loader.abort()),this.resetLoadingState())}L&&(this.lastCurrentTime=F),!this.loadedmetadata&&!B.len&&(this.nextLoadPosition=this.startPosition=F),this.tickImmediate()},a.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},a.onKeyLoaded=function(y,D){if(!(this.state!==m.KEY_LOADING||D.frag!==this.fragCurrent||!this.levels)){this.state=m.IDLE;var L=this.levels[D.frag.level].details;L&&this.loadFragment(D.frag,L,D.frag.start)}},a.onHandlerDestroying=function(){this.stopLoad(),f.prototype.onHandlerDestroying.call(this)},a.onHandlerDestroyed=function(){this.state=m.STOPPED,this.hls.off(R.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,f.prototype.onHandlerDestroyed.call(this)},a.loadKey=function(y,D){this.log("Loading key for "+y.sn+" of ["+D.startSN+"-"+D.endSN+"], "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level),this.state=m.KEY_LOADING,this.fragCurrent=y,this.hls.trigger(R.Events.KEY_LOADING,{frag:y})},a.loadFragment=function(y,D,L){this._loadFragForPlayback(y,D,L)},a._loadFragForPlayback=function(y,D,L){var I=this,_=function(B){if(I.fragContextChanged(y)){I.warn("Fragment "+y.sn+(B.part?" p: "+B.part.index:"")+" of level "+y.level+" was dropped during download."),I.fragmentTracker.removeFragment(y);return}y.stats.chunkCount++,I._handleFragmentLoadProgress(B)};this._doFragLoad(y,D,L,_).then(function(F){if(!!F){I.fragLoadError=0;var B=I.state;if(I.fragContextChanged(y)){(B===m.FRAG_LOADING||!I.fragCurrent&&B===m.PARSING)&&(I.fragmentTracker.removeFragment(y),I.state=m.IDLE);return}"payload"in F&&(I.log("Loaded fragment "+y.sn+" of level "+y.level),I.hls.trigger(R.Events.FRAG_LOADED,F)),I._handleFragmentLoadComplete(F)}}).catch(function(F){I.state!==m.STOPPED&&(I.warn(F),I.resetFragmentLoading(y))})},a.flushMainBuffer=function(y,D,L){if(L===void 0&&(L=null),!!(y-D)){var I={startOffset:y,endOffset:D,type:L};this.fragLoadError=0,this.hls.trigger(R.Events.BUFFER_FLUSHING,I)}},a._loadInitSegment=function(y){var D=this;this._doFragLoad(y).then(function(L){if(!L||D.fragContextChanged(y)||!D.levels)throw new Error("init load aborted");return L}).then(function(L){var I=D.hls,_=L.payload,F=y.decryptdata;if(_&&_.byteLength>0&&F&&F.key&&F.iv&&F.method==="AES-128"){var B=self.performance.now();return D.decrypter.webCryptoDecrypt(new Uint8Array(_),F.key.buffer,F.iv.buffer).then(function(U){var N=self.performance.now();return I.trigger(R.Events.FRAG_DECRYPTED,{frag:y,payload:U,stats:{tstart:B,tdecrypt:N}}),L.payload=U,L})}return L}).then(function(L){var I=D.fragCurrent,_=D.hls,F=D.levels;if(!F)throw new Error("init load aborted, missing levels");var B=F[y.level].details;console.assert(B,"Level details are defined when init segment is loaded");var U=y.stats;D.state=m.IDLE,D.fragLoadError=0,y.data=new Uint8Array(L.payload),U.parsing.start=U.buffering.start=self.performance.now(),U.parsing.end=U.buffering.end=self.performance.now(),L.frag===I&&_.trigger(R.Events.FRAG_BUFFERED,{stats:U,frag:I,part:null,id:y.type}),D.tick()}).catch(function(L){D.warn(L),D.resetFragmentLoading(y)})},a.fragContextChanged=function(y){var D=this.fragCurrent;return!y||!D||y.level!==D.level||y.sn!==D.sn||y.urlId!==D.urlId},a.fragBufferedComplete=function(y,D){var L=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+y.type+" sn: "+y.sn+(D?" part: "+D.index:"")+" of "+(this.logPrefix==="[stream-controller]"?"level":"track")+" "+y.level+" "+t.default.toString(b.BufferHelper.getBuffered(L))),this.state=m.IDLE,this.tick()},a._handleFragmentLoadComplete=function(y){var D=this.transmuxer;if(!!D){var L=y.frag,I=y.part,_=y.partsLoaded,F=!_||_.length===0||_.some(function(U){return!U}),B=new g.ChunkMetadata(L.level,L.sn,L.stats.chunkCount+1,0,I?I.index:-1,!F);D.flush(B)}},a._handleFragmentLoadProgress=function(y){},a._doFragLoad=function(y,D,L,I){var _=this;if(L===void 0&&(L=null),!this.levels)throw new Error("frag load aborted, missing levels");if(L=Math.max(y.start,L||0),this.config.lowLatencyMode&&D){var F=D.partList;if(F&&I){L>y.end&&D.fragmentHint&&(y=D.fragmentHint);var B=this.getNextPart(F,y,L);if(B>-1){var U=F[B];return this.log("Loading part sn: "+y.sn+" p: "+U.index+" cc: "+y.cc+" of playlist ["+D.startSN+"-"+D.endSN+"] parts [0-"+B+"-"+(F.length-1)+"] "+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(L.toFixed(3))),this.nextLoadPosition=U.start+U.duration,this.state=m.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:y,part:F[B],targetBufferTime:L}),this.doFragPartsLoad(y,F,B,I).catch(function(N){return _.handleFragLoadError(N)})}else if(!y.url||this.loadedEndOfParts(F,L))return Promise.resolve(null)}}return this.log("Loading fragment "+y.sn+" cc: "+y.cc+" "+(D?"of ["+D.startSN+"-"+D.endSN+"] ":"")+(this.logPrefix==="[stream-controller]"?"level":"track")+": "+y.level+", target: "+parseFloat(L.toFixed(3))),Object(C.isFiniteNumber)(y.sn)&&!this.bitrateTest&&(this.nextLoadPosition=y.start+y.duration),this.state=m.FRAG_LOADING,this.hls.trigger(R.Events.FRAG_LOADING,{frag:y,targetBufferTime:L}),this.fragmentLoader.load(y,I).catch(function(N){return _.handleFragLoadError(N)})},a.doFragPartsLoad=function(y,D,L,I){var _=this;return new Promise(function(F,B){var U=[],N=function k(w){var W=D[w];_.fragmentLoader.loadPart(y,W,I).then(function(j){U[W.index]=j;var H=j.part;_.hls.trigger(R.Events.FRAG_LOADED,j);var G=D[w+1];if(G&&G.fragment===y)k(w+1);else return F({frag:y,part:H,partsLoaded:U})}).catch(B)};N(L)})},a.handleFragLoadError=function(y){var D=y.data;return D&&D.details===x.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(D.frag,D.part):this.hls.trigger(R.Events.ERROR,D),null},a._handleTransmuxerFlush=function(y){var D=this.getCurrentContext(y);if(!D||this.state!==m.PARSING){this.fragCurrent||(this.state=m.IDLE);return}var L=D.frag,I=D.part,_=D.level,F=self.performance.now();L.stats.parsing.end=F,I&&(I.stats.parsing.end=F),this.updateLevelTiming(L,I,_,y.partial)},a.getCurrentContext=function(y){var D=this.levels,L=y.level,I=y.sn,_=y.part;if(!D||!D[L])return this.warn("Levels object was unset while buffering fragment "+I+" of level "+L+". The current chunk will not be buffered."),null;var F=D[L],B=_>-1?Object(c.getPartWith)(F,I,_):null,U=B?B.fragment:Object(c.getFragmentWithSN)(F,I,this.fragCurrent);return U?{frag:U,part:B,level:F}:null},a.bufferFragmentData=function(y,D,L,I){if(!(!y||this.state!==m.PARSING)){var _=y.data1,F=y.data2,B=_;if(_&&F&&(B=Object(T.appendUint8Array)(_,F)),!(!B||!B.length)){var U={type:y.type,frag:D,part:L,chunkMeta:I,parent:D.type,data:B};this.hls.trigger(R.Events.BUFFER_APPENDING,U),y.dropped&&y.independent&&!L&&this.flushBufferGap(D)}}},a.flushBufferGap=function(y){var D=this.media;if(!!D){if(!b.BufferHelper.isBuffered(D,D.currentTime)){this.flushMainBuffer(0,y.start);return}var L=D.currentTime,I=b.BufferHelper.bufferInfo(D,L,0),_=y.duration,F=Math.min(this.config.maxFragLookUpTolerance*2,_*.25),B=Math.max(Math.min(y.start-F,I.end-F),L+F);y.start-B>F&&this.flushMainBuffer(B,y.start)}},a.getFwdBufferInfo=function(y,D){var L=this.config,I=this.getLoadPosition();if(!Object(C.isFiniteNumber)(I))return null;var _=b.BufferHelper.bufferInfo(y,I,L.maxBufferHole);if(_.len===0&&_.nextStart!==void 0){var F=this.fragmentTracker.getBufferedFrag(I,D);if(F&&_.nextStart<F.end)return b.BufferHelper.bufferInfo(y,I,Math.max(_.nextStart,L.maxBufferHole))}return _},a.getMaxBufferLength=function(y){var D=this.config,L;return y?L=Math.max(8*D.maxBufferSize/y,D.maxBufferLength):L=D.maxBufferLength,Math.min(L,D.maxMaxBufferLength)},a.reduceMaxBufferLength=function(y){var D=this.config,L=y||D.maxBufferLength;return D.maxMaxBufferLength>=L?(D.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+D.maxMaxBufferLength+"s"),!0):!1},a.getNextFragment=function(y,D){var L=D.fragments,I=L.length;if(!I)return null;var _=this.config,F=L[0].start,B;if(D.live){var U=_.initialLiveManifestSize;if(I<U)return this.warn("Not enough fragments to start playback (have: "+I+", need: "+U+")"),null;!D.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(B=this.getInitialLiveFragment(D,L),this.startPosition=B?this.hls.liveSyncPosition||B.start:y)}else y<=F&&(B=L[0]);if(!B){var N=_.lowLatencyMode?D.partEnd:D.fragmentEnd;B=this.getFragmentAtPosition(y,N,D)}return this.mapToInitFragWhenRequired(B)},a.mapToInitFragWhenRequired=function(y){return y!=null&&y.initSegment&&!(y!=null&&y.initSegment.data)&&!this.bitrateTest?y.initSegment:y},a.getNextPart=function(y,D,L){for(var I=-1,_=!1,F=!0,B=0,U=y.length;B<U;B++){var N=y[B];if(F=F&&!N.independent,I>-1&&L<N.start)break;var k=N.loaded;!k&&(_||N.independent||F)&&N.fragment===D&&(I=B),_=k}return I},a.loadedEndOfParts=function(y,D){var L=y[y.length-1];return L&&D>L.start&&L.loaded},a.getInitialLiveFragment=function(y,D){var L=this.fragPrevious,I=null;if(L){if(y.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+L.programDateTime),I=Object(E.findFragmentByPDT)(D,L.endProgramDateTime,this.config.maxFragLookUpTolerance)),!I){var _=L.sn+1;if(_>=y.startSN&&_<=y.endSN){var F=D[_-y.startSN];L.cc===F.cc&&(I=F,this.log("Live playlist, switching playlist, load frag with next SN: "+I.sn))}I||(I=Object(E.findFragWithCC)(D,L.cc),I&&this.log("Live playlist, switching playlist, load frag with same CC: "+I.sn))}}else{var B=this.hls.liveSyncPosition;B!==null&&(I=this.getFragmentAtPosition(B,this.bitrateTest?y.fragmentEnd:y.edge,y))}return I},a.getFragmentAtPosition=function(y,D,L){var I=this.config,_=this.fragPrevious,F=L.fragments,B=L.endSN,U=L.fragmentHint,N=I.maxFragLookUpTolerance,k=!!(I.lowLatencyMode&&L.partList&&U);k&&U&&!this.bitrateTest&&(F=F.concat(U),B=U.sn);var w;if(y<D){var W=y>D-N?0:N;w=Object(E.findFragmentByPTS)(_,F,y,W)}else w=F[F.length-1];if(w){var j=w.sn-L.startSN,H=_&&w.level===_.level,G=F[j+1];_&&w.sn===_.sn&&!k&&H&&(w.sn<B&&this.fragmentTracker.getState(G)!==A.FragmentState.OK?(this.log("SN "+w.sn+" just loaded, load next one: "+G.sn),w=G):w=null)}return w},a.synchronizeToLiveEdge=function(y){var D=this.config,L=this.media;if(!!L){var I=this.hls.liveSyncPosition,_=L.currentTime,F=y.fragments[0].start,B=y.edge,U=_>=F-D.maxFragLookUpTolerance&&_<=B;if(I!==null&&L.duration>I&&(_<I||!U)){var N=D.liveMaxLatencyDuration!==void 0?D.liveMaxLatencyDuration:D.liveMaxLatencyDurationCount*y.targetduration;(!U&&L.readyState<4||_<B-N)&&(this.loadedmetadata||(this.nextLoadPosition=I),L.readyState&&(this.warn("Playback: "+_.toFixed(3)+" is located too far from the end of live sliding playlist: "+B+", reset currentTime to : "+I.toFixed(3)),L.currentTime=I))}}},a.alignPlaylists=function(y,D){var L=this.levels,I=this.levelLastLoaded,_=this.fragPrevious,F=I!==null?L[I]:null,B=y.fragments.length;if(!B)return this.warn("No fragments in live playlist"),0;var U=y.fragments[0].start,N=!D,k=y.alignedSliding&&Object(C.isFiniteNumber)(U);if(N||!k&&!U){Object(p.alignStream)(_,F,y);var w=y.fragments[0].start;return this.log("Live playlist sliding: "+w.toFixed(2)+" start-sn: "+(D?D.startSN:"na")+"->"+y.startSN+" prev-sn: "+(_?_.sn:"na")+" fragments: "+B),w}return U},a.waitForCdnTuneIn=function(y){var D=3;return y.live&&y.canBlockReload&&y.partTarget&&y.tuneInGoal>Math.max(y.partHoldBack,y.partTarget*D)},a.setStartPosition=function(y,D){var L=this.startPosition;if(L<D&&(L=-1),L===-1||this.lastCurrentTime===-1){var I=y.startTimeOffset;Object(C.isFiniteNumber)(I)?(L=D+I,I<0&&(L+=y.totalduration),L=Math.min(Math.max(D,L),D+y.totalduration),this.log("Start time offset "+I+" found in playlist, adjust startPosition to "+L),this.startPosition=L):y.live?L=this.hls.liveSyncPosition||D:this.startPosition=L=0,this.lastCurrentTime=L}this.nextLoadPosition=L},a.getLoadPosition=function(){var y=this.media,D=0;return this.loadedmetadata&&y?D=y.currentTime:this.nextLoadPosition&&(D=this.nextLoadPosition),D},a.handleFragLoadAborted=function(y,D){this.transmuxer&&y.sn!=="initSegment"&&y.stats.aborted&&(this.warn("Fragment "+y.sn+(D?" part"+D.index:"")+" of level "+y.level+" was aborted"),this.resetFragmentLoading(y))},a.resetFragmentLoading=function(y){(!this.fragCurrent||!this.fragContextChanged(y))&&(this.state=m.IDLE)},a.onFragmentOrKeyLoadError=function(y,D){if(!D.fatal){var L=D.frag;if(!(!L||L.type!==y)){var I=this.fragCurrent;console.assert(I&&L.sn===I.sn&&L.level===I.level&&L.urlId===I.urlId,"Frag load error must match current frag to retry");var _=this.config;if(this.fragLoadError+1<=_.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(L.level))return;var F=Math.min(Math.pow(2,this.fragLoadError)*_.fragLoadingRetryDelay,_.fragLoadingMaxRetryTimeout);this.warn("Fragment "+L.sn+" of "+y+" "+L.level+" failed to load, retrying in "+F+"ms"),this.retryDate=self.performance.now()+F,this.fragLoadError++,this.state=m.FRAG_LOADING_WAITING_RETRY}else D.levelRetry?(y===o.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=m.IDLE):(P.logger.error(D.details+" reaches max retry, redispatch as fatal ..."),D.fatal=!0,this.hls.stopLoad(),this.state=m.ERROR)}}},a.afterBufferFlushed=function(y,D,L){if(!!y){var I=b.BufferHelper.getBuffered(y);this.fragmentTracker.detectEvictedFragments(D,I,L),this.state===m.ENDED&&this.resetLoadingState()}},a.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=m.IDLE},a.resetLiveStartWhenNotLoaded=function(y){if(!this.loadedmetadata){this.startFragRequested=!1;var D=this.levels?this.levels[y].details:null;if(D!=null&&D.live)return this.startPosition=-1,this.setStartPosition(D,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},a.updateLevelTiming=function(y,D,L,I){var _=this,F=L.details;console.assert(!!F,"level.details must be defined");var B=Object.keys(y.elementaryStreams).reduce(function(U,N){var k=y.elementaryStreams[N];if(k){var w=k.endPTS-k.startPTS;if(w<=0)return _.warn("Could not parse fragment "+y.sn+" "+N+" duration reliably ("+w+")"),U||!1;var W=I?0:Object(c.updateFragPTSDTS)(F,y,k.startPTS,k.endPTS,k.startDTS,k.endDTS);return _.hls.trigger(R.Events.LEVEL_PTS_UPDATED,{details:F,level:L,drift:W,type:N,frag:y,start:k.startPTS,end:k.endPTS}),!0}return U},!1);B||(this.warn("Found no media in fragment "+y.sn+" of level "+L.id+" resetting transmuxer to fallback to playlist timing"),this.resetTransmuxer()),this.state=m.PARSED,this.hls.trigger(R.Events.FRAG_PARSED,{frag:y,part:D})},a.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},d(h,[{key:"state",get:function(){return this._state},set:function(y){var D=this._state;D!==y&&(this._state=y,this.log(D+"->"+y))}}]),h}(O.default)},"./src/controller/buffer-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return E});var C=S("./src/polyfills/number.ts"),O=S("./src/events.ts"),A=S("./src/utils/logger.ts"),b=S("./src/errors.ts"),P=S("./src/utils/buffer-helper.ts"),R=S("./src/utils/mediasource-helper.ts"),x=S("./src/loader/fragment.ts"),g=S("./src/controller/buffer-operation-queue.ts"),T=Object(R.getMediaSource)(),p=/([ha]vc.)(?:\.[^.,]+)+/,E=function(){function c(i){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var o=t.hls,u=t.media,d=t.mediaSource;A.logger.log("[buffer-controller]: Media source opened"),u&&(t.updateMediaElementDuration(),o.trigger(O.Events.MEDIA_ATTACHED,{media:u})),d&&d.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){A.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){A.logger.log("[buffer-controller]: Media source ended")},this.hls=i,this._initSourceBuffer(),this.registerListeners()}var v=c.prototype;return v.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},v.destroy=function(){this.unregisterListeners(),this.details=null},v.registerListeners=function(){var t=this.hls;t.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(O.Events.BUFFER_RESET,this.onBufferReset,this),t.on(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(O.Events.BUFFER_EOS,this.onBufferEos,this),t.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(O.Events.FRAG_PARSED,this.onFragParsed,this),t.on(O.Events.FRAG_CHANGED,this.onFragChanged,this)},v.unregisterListeners=function(){var t=this.hls;t.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(O.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(O.Events.BUFFER_RESET,this.onBufferReset,this),t.off(O.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(O.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(O.Events.BUFFER_EOS,this.onBufferEos,this),t.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(O.Events.FRAG_PARSED,this.onFragParsed,this),t.off(O.Events.FRAG_CHANGED,this.onFragChanged,this)},v._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new g.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},v.onManifestParsed=function(t,o){var u=2;(o.audio&&!o.video||!o.altAudio)&&(u=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=u,this.details=null,A.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},v.onMediaAttaching=function(t,o){var u=this.media=o.media;if(u&&T){var d=this.mediaSource=new T;d.addEventListener("sourceopen",this._onMediaSourceOpen),d.addEventListener("sourceended",this._onMediaSourceEnded),d.addEventListener("sourceclose",this._onMediaSourceClose),u.src=self.URL.createObjectURL(d),this._objectUrl=u.src}},v.onMediaDetaching=function(){var t=this.media,o=this.mediaSource,u=this._objectUrl;if(o){if(A.logger.log("[buffer-controller]: media source detaching"),o.readyState==="open")try{o.endOfStream()}catch(d){A.logger.warn("[buffer-controller]: onMediaDetaching: "+d.message+" while calling endOfStream")}this.onBufferReset(),o.removeEventListener("sourceopen",this._onMediaSourceOpen),o.removeEventListener("sourceended",this._onMediaSourceEnded),o.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(u&&self.URL.revokeObjectURL(u),t.src===u?(t.removeAttribute("src"),t.load()):A.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(O.Events.MEDIA_DETACHED,void 0)},v.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach(function(o){var u=t.sourceBuffer[o];try{u&&(t.removeBufferListeners(o),t.mediaSource&&t.mediaSource.removeSourceBuffer(u),t.sourceBuffer[o]=void 0)}catch(d){A.logger.warn("[buffer-controller]: Failed to reset the "+o+" buffer",d)}}),this._initSourceBuffer()},v.onBufferCodecs=function(t,o){var u=this,d=this.getSourceBufferTypes().length;Object.keys(o).forEach(function(n){if(d){var e=u.tracks[n];if(e&&typeof e.buffer.changeType=="function"){var r=o[n],m=r.id,l=r.codec,f=r.levelCodec,h=r.container,a=r.metadata,s=(e.levelCodec||e.codec).replace(p,"$1"),y=(f||l).replace(p,"$1");if(s!==y){var D=h+";codecs="+(f||l);u.appendChangeType(n,D),A.logger.log("[buffer-controller]: switching codec "+s+" to "+y),u.tracks[n]={buffer:e.buffer,codec:l,container:h,levelCodec:f,metadata:a,id:m}}}}else u.pendingTracks[n]=o[n]}),!d&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())},v.appendChangeType=function(t,o){var u=this,d=this.operationQueue,n={execute:function(){var r=u.sourceBuffer[t];r&&(A.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+o),r.changeType(o)),d.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(r){A.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",r)}};d.append(n,t)},v.onBufferAppending=function(t,o){var u=this,d=this.hls,n=this.operationQueue,e=this.tracks,r=o.data,m=o.type,l=o.frag,f=o.part,h=o.chunkMeta,a=h.buffering[m],s=self.performance.now();a.start=s;var y=l.stats.buffering,D=f?f.stats.buffering:null;y.start===0&&(y.start=s),D&&D.start===0&&(D.start=s);var L=e.audio,I=m==="audio"&&h.id===1&&(L==null?void 0:L.container)==="audio/mpeg",_={execute:function(){if(a.executeStart=self.performance.now(),I){var B=u.sourceBuffer[m];if(B){var U=l.start-B.timestampOffset;Math.abs(U)>=.1&&(A.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+l.start+" (delta: "+U+") sn: "+l.sn+")"),B.timestampOffset=l.start)}}u.appendExecutor(r,m)},onStart:function(){},onComplete:function(){var B=self.performance.now();a.executeEnd=a.end=B,y.first===0&&(y.first=B),D&&D.first===0&&(D.first=B);var U=u.sourceBuffer,N={};for(var k in U)N[k]=P.BufferHelper.getBuffered(U[k]);u.appendError=0,u.hls.trigger(O.Events.BUFFER_APPENDED,{type:m,frag:l,part:f,chunkMeta:h,parent:l.type,timeRanges:N})},onError:function(B){A.logger.error("[buffer-controller]: Error encountered while trying to append to the "+m+" SourceBuffer",B);var U={type:b.ErrorTypes.MEDIA_ERROR,parent:l.type,details:b.ErrorDetails.BUFFER_APPEND_ERROR,err:B,fatal:!1};B.code===DOMException.QUOTA_EXCEEDED_ERR?U.details=b.ErrorDetails.BUFFER_FULL_ERROR:(u.appendError++,U.details=b.ErrorDetails.BUFFER_APPEND_ERROR,u.appendError>d.config.appendErrorMaxRetry&&(A.logger.error("[buffer-controller]: Failed "+d.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),U.fatal=!0)),d.trigger(O.Events.ERROR,U)}};n.append(_,m)},v.onBufferFlushing=function(t,o){var u=this,d=this.operationQueue,n=function(r){return{execute:u.removeExecutor.bind(u,r,o.startOffset,o.endOffset),onStart:function(){},onComplete:function(){u.hls.trigger(O.Events.BUFFER_FLUSHED,{type:r})},onError:function(l){A.logger.warn("[buffer-controller]: Failed to remove from "+r+" SourceBuffer",l)}}};o.type?d.append(n(o.type),o.type):this.getSourceBufferTypes().forEach(function(e){d.append(n(e),e)})},v.onFragParsed=function(t,o){var u=this,d=o.frag,n=o.part,e=[],r=n?n.elementaryStreams:d.elementaryStreams;r[x.ElementaryStreamTypes.AUDIOVIDEO]?e.push("audiovideo"):(r[x.ElementaryStreamTypes.AUDIO]&&e.push("audio"),r[x.ElementaryStreamTypes.VIDEO]&&e.push("video"));var m=function(){var f=self.performance.now();d.stats.buffering.end=f,n&&(n.stats.buffering.end=f);var h=n?n.stats:d.stats;u.hls.trigger(O.Events.FRAG_BUFFERED,{frag:d,part:n,stats:h,id:d.type})};e.length===0&&A.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+d.type+" level: "+d.level+" sn: "+d.sn),this.blockBuffers(m,e)},v.onFragChanged=function(t,o){this.flushBackBuffer()},v.onBufferEos=function(t,o){var u=this,d=this.getSourceBufferTypes().reduce(function(n,e){var r=u.sourceBuffer[e];return(!o.type||o.type===e)&&r&&!r.ended&&(r.ended=!0,A.logger.log("[buffer-controller]: "+e+" sourceBuffer now EOS")),n&&!!(!r||r.ended)},!0);d&&this.blockBuffers(function(){var n=u.mediaSource;!n||n.readyState!=="open"||n.endOfStream()})},v.onLevelUpdated=function(t,o){var u=o.details;!u.fragments.length||(this.details=u,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},v.flushBackBuffer=function(){var t=this.hls,o=this.details,u=this.media,d=this.sourceBuffer;if(!(!u||o===null)){var n=this.getSourceBufferTypes();if(!!n.length){var e=o.live&&t.config.liveBackBufferLength!==null?t.config.liveBackBufferLength:t.config.backBufferLength;if(!(!Object(C.isFiniteNumber)(e)||e<0)){var r=u.currentTime,m=o.levelTargetDuration,l=Math.max(e,m),f=Math.floor(r/m)*m-l;n.forEach(function(h){var a=d[h];if(a){var s=P.BufferHelper.getBuffered(a);s.length>0&&f>s.start(0)&&(t.trigger(O.Events.BACK_BUFFER_REACHED,{bufferEnd:f}),o.live&&t.trigger(O.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:f}),t.trigger(O.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:f,type:h}))}})}}}},v.updateMediaElementDuration=function(){if(!(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")){var t=this.details,o=this.hls,u=this.media,d=this.mediaSource,n=t.fragments[0].start+t.totalduration,e=u.duration,r=Object(C.isFiniteNumber)(d.duration)?d.duration:0;t.live&&o.config.liveDurationInfinity?(A.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),d.duration=1/0,this.updateSeekableRange(t)):(n>r&&n>e||!Object(C.isFiniteNumber)(e))&&(A.logger.log("[buffer-controller]: Updating Media Source duration to "+n.toFixed(3)),d.duration=n)}},v.updateSeekableRange=function(t){var o=this.mediaSource,u=t.fragments,d=u.length;if(d&&t.live&&o!==null&&o!==void 0&&o.setLiveSeekableRange){var n=Math.max(0,u[0].start),e=Math.max(n,n+t.totalduration);o.setLiveSeekableRange(n,e)}},v.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,o=this.operationQueue,u=this.pendingTracks,d=Object.keys(u).length;if(d&&!t||d===2){this.createSourceBuffers(u),this.pendingTracks={};var n=this.getSourceBufferTypes();if(n.length===0){this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});return}n.forEach(function(e){o.executeNext(e)})}},v.createSourceBuffers=function(t){var o=this.sourceBuffer,u=this.mediaSource;if(!u)throw Error("createSourceBuffers called when mediaSource was null");var d=0;for(var n in t)if(!o[n]){var e=t[n];if(!e)throw Error("source buffer exists for track "+n+", however track does not");var r=e.levelCodec||e.codec,m=e.container+";codecs="+r;A.logger.log("[buffer-controller]: creating sourceBuffer("+m+")");try{var l=o[n]=u.addSourceBuffer(m),f=n;this.addBufferListener(f,"updatestart",this._onSBUpdateStart),this.addBufferListener(f,"updateend",this._onSBUpdateEnd),this.addBufferListener(f,"error",this._onSBUpdateError),this.tracks[n]={buffer:l,codec:r,container:e.container,levelCodec:e.levelCodec,metadata:e.metadata,id:e.id},d++}catch(h){A.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+h.message),this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,mimeType:m})}}d&&this.hls.trigger(O.Events.BUFFER_CREATED,{tracks:this.tracks})},v._onSBUpdateStart=function(t){var o=this.operationQueue,u=o.current(t);u.onStart()},v._onSBUpdateEnd=function(t){var o=this.operationQueue,u=o.current(t);u.onComplete(),o.shiftAndExecuteNext(t)},v._onSBUpdateError=function(t,o){A.logger.error("[buffer-controller]: "+t+" SourceBuffer error",o),this.hls.trigger(O.Events.ERROR,{type:b.ErrorTypes.MEDIA_ERROR,details:b.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var u=this.operationQueue.current(t);u&&u.onError(o)},v.removeExecutor=function(t,o,u){var d=this.media,n=this.mediaSource,e=this.operationQueue,r=this.sourceBuffer,m=r[t];if(!d||!n||!m){A.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),e.shiftAndExecuteNext(t);return}var l=Object(C.isFiniteNumber)(d.duration)?d.duration:1/0,f=Object(C.isFiniteNumber)(n.duration)?n.duration:1/0,h=Math.max(0,o),a=Math.min(u,l,f);a>h?(A.logger.log("[buffer-controller]: Removing ["+h+","+a+"] from the "+t+" SourceBuffer"),console.assert(!m.updating,t+" sourceBuffer must not be updating"),m.remove(h,a)):e.shiftAndExecuteNext(t)},v.appendExecutor=function(t,o){var u=this.operationQueue,d=this.sourceBuffer,n=d[o];if(!n){A.logger.warn("[buffer-controller]: Attempting to append to the "+o+" SourceBuffer, but it does not exist"),u.shiftAndExecuteNext(o);return}n.ended=!1,console.assert(!n.updating,o+" sourceBuffer must not be updating"),n.appendBuffer(t)},v.blockBuffers=function(t,o){var u=this;if(o===void 0&&(o=this.getSourceBufferTypes()),!o.length){A.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(t);return}var d=this.operationQueue,n=o.map(function(e){return d.appendBlocker(e)});Promise.all(n).then(function(){t(),o.forEach(function(e){var r=u.sourceBuffer[e];(!r||!r.updating)&&d.shiftAndExecuteNext(e)})})},v.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},v.addBufferListener=function(t,o,u){var d=this.sourceBuffer[t];if(!!d){var n=u.bind(this,t);this.listeners[t].push({event:o,listener:n}),d.addEventListener(o,n)}},v.removeBufferListeners=function(t){var o=this.sourceBuffer[t];!o||this.listeners[t].forEach(function(u){o.removeEventListener(u.event,u.listener)})},c}()},"./src/controller/buffer-operation-queue.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return O});var C=S("./src/utils/logger.ts"),O=function(){function A(P){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=P}var b=A.prototype;return b.append=function(R,x){var g=this.queues[x];g.push(R),g.length===1&&this.buffers[x]&&this.executeNext(x)},b.insertAbort=function(R,x){var g=this.queues[x];g.unshift(R),this.executeNext(x)},b.appendBlocker=function(R){var x,g=new Promise(function(p){x=p}),T={execute:x,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(T,R),g},b.executeNext=function(R){var x=this.buffers,g=this.queues,T=x[R],p=g[R];if(p.length){var E=p[0];try{E.execute()}catch(c){C.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),E.onError(c),(!T||!T.updating)&&(p.shift(),this.executeNext(R))}}},b.shiftAndExecuteNext=function(R){this.queues[R].shift(),this.executeNext(R)},b.current=function(R){return this.queues[R][0]},A}()},"./src/controller/cap-level-controller.ts":function(K,M,S){S.r(M);var C=S("./src/events.ts");function O(P,R){for(var x=0;x<R.length;x++){var g=R[x];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(P,g.key,g)}}function A(P,R,x){return R&&O(P.prototype,R),x&&O(P,x),Object.defineProperty(P,"prototype",{writable:!1}),P}var b=function(){function P(x){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=x,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var R=P.prototype;return R.setStreamController=function(g){this.streamController=g},R.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},R.registerListeners=function(){var g=this.hls;g.on(C.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.on(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.on(C.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.unregisterListener=function(){var g=this.hls;g.off(C.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),g.off(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),g.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),g.off(C.Events.BUFFER_CODECS,this.onBufferCodecs,this),g.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},R.onFpsDropLevelCapping=function(g,T){P.isLevelAllowed(T.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(T.droppedLevel)},R.onMediaAttaching=function(g,T){this.media=T.media instanceof HTMLVideoElement?T.media:null},R.onManifestParsed=function(g,T){var p=this.hls;this.restrictedLevels=[],this.firstLevel=T.firstLevel,p.config.capLevelToPlayerSize&&T.video&&this.startCapping()},R.onBufferCodecs=function(g,T){var p=this.hls;p.config.capLevelToPlayerSize&&T.video&&this.startCapping()},R.onMediaDetaching=function(){this.stopCapping()},R.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var g=this.hls.levels;if(g.length){var T=this.hls;T.autoLevelCapping=this.getMaxLevel(g.length-1),T.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=T.autoLevelCapping}}},R.getMaxLevel=function(g){var T=this,p=this.hls.levels;if(!p.length)return-1;var E=p.filter(function(c,v){return P.isLevelAllowed(v,T.restrictedLevels)&&v<=g});return this.clientRect=null,P.getMaxLevelByMediaSize(E,this.mediaWidth,this.mediaHeight)},R.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},R.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},R.getDimensions=function(){if(this.clientRect)return this.clientRect;var g=this.media,T={width:0,height:0};if(g){var p=g.getBoundingClientRect();T.width=p.width,T.height=p.height,!T.width&&!T.height&&(T.width=p.right-p.left||g.width||0,T.height=p.bottom-p.top||g.height||0)}return this.clientRect=T,T},P.isLevelAllowed=function(g,T){return T===void 0&&(T=[]),T.indexOf(g)===-1},P.getMaxLevelByMediaSize=function(g,T,p){if(!g||!g.length)return-1;for(var E=function(o,u){return u?o.width!==u.width||o.height!==u.height:!0},c=g.length-1,v=0;v<g.length;v+=1){var i=g[v];if((i.width>=T||i.height>=p)&&E(i,g[v+1])){c=v;break}}return c},A(P,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var g=1;if(!this.hls.config.ignoreDevicePixelRatio)try{g=self.devicePixelRatio}catch{}return g}}]),P}();M.default=b},"./src/controller/cmcd-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return E});var C=S("./src/events.ts"),O=S("./src/types/cmcd.ts"),A=S("./src/utils/buffer-helper.ts"),b=S("./src/utils/logger.ts");function P(c,v){for(var i=0;i<v.length;i++){var t=v[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(c,t.key,t)}}function R(c,v,i){return v&&P(c.prototype,v),i&&P(c,i),Object.defineProperty(c,"prototype",{writable:!1}),c}function x(c,v){var i=typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(i)return(i=i.call(c)).next.bind(i);if(Array.isArray(c)||(i=g(c))||v&&c&&typeof c.length=="number"){i&&(c=i);var t=0;return function(){return t>=c.length?{done:!0}:{done:!1,value:c[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function g(c,v){if(!!c){if(typeof c=="string")return T(c,v);var i=Object.prototype.toString.call(c).slice(8,-1);if(i==="Object"&&c.constructor&&(i=c.constructor.name),i==="Map"||i==="Set")return Array.from(c);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return T(c,v)}}function T(c,v){(v==null||v>c.length)&&(v=c.length);for(var i=0,t=new Array(v);i<v;i++)t[i]=c[i];return t}function p(){return p=Object.assign?Object.assign.bind():function(c){for(var v=1;v<arguments.length;v++){var i=arguments[v];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(c[t]=i[t])}return c},p.apply(this,arguments)}var E=function(){function c(i){var t=this;this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=function(){t.initialized&&(t.starved=!0),t.buffering=!0},this.onPlaying=function(){t.initialized||(t.initialized=!0),t.buffering=!1},this.applyPlaylistData=function(d){try{t.apply(d,{ot:O.CMCDObjectType.MANIFEST,su:!t.initialized})}catch(n){b.logger.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=function(d){try{var n=d.frag,e=t.hls.levels[n.level],r=t.getObjectType(n),m={d:n.duration*1e3,ot:r};(r===O.CMCDObjectType.VIDEO||r===O.CMCDObjectType.AUDIO||r==O.CMCDObjectType.MUXED)&&(m.br=e.bitrate/1e3,m.tb=t.getTopBandwidth(r)/1e3,m.bl=t.getBufferLength(r)),t.apply(d,m)}catch(l){b.logger.warn("Could not generate segment CMCD data.",l)}},this.hls=i;var o=this.config=i.config,u=o.cmcd;u!=null&&(o.pLoader=this.createPlaylistLoader(),o.fLoader=this.createFragmentLoader(),this.sid=u.sessionId||c.uuid(),this.cid=u.contentId,this.useHeaders=u.useHeaders===!0,this.registerListeners())}var v=c.prototype;return v.registerListeners=function(){var t=this.hls;t.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.on(C.Events.BUFFER_CREATED,this.onBufferCreated,this)},v.unregisterListeners=function(){var t=this.hls;t.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),t.off(C.Events.BUFFER_CREATED,this.onBufferCreated,this),this.onMediaDetached()},v.destroy=function(){this.unregisterListeners(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null},v.onMediaAttached=function(t,o){this.media=o.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)},v.onMediaDetached=function(){!this.media||(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)},v.onBufferCreated=function(t,o){var u,d;this.audioBuffer=(u=o.tracks.audio)===null||u===void 0?void 0:u.buffer,this.videoBuffer=(d=o.tracks.video)===null||d===void 0?void 0:d.buffer},v.createData=function(){var t;return{v:O.CMCDVersion,sf:O.CMCDStreamingFormat.HLS,sid:this.sid,cid:this.cid,pr:(t=this.media)===null||t===void 0?void 0:t.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}},v.apply=function(t,o){o===void 0&&(o={}),p(o,this.createData());var u=o.ot===O.CMCDObjectType.INIT||o.ot===O.CMCDObjectType.VIDEO||o.ot===O.CMCDObjectType.MUXED;if(this.starved&&u&&(o.bs=!0,o.su=!0,this.starved=!1),o.su==null&&(o.su=this.buffering),this.useHeaders){var d=c.toHeaders(o);if(!Object.keys(d).length)return;t.headers||(t.headers={}),p(t.headers,d)}else{var n=c.toQuery(o);if(!n)return;t.url=c.appendQueryToUri(t.url,n)}},v.getObjectType=function(t){var o=t.type;if(o==="subtitle")return O.CMCDObjectType.TIMED_TEXT;if(t.sn==="initSegment")return O.CMCDObjectType.INIT;if(o==="audio")return O.CMCDObjectType.AUDIO;if(o==="main")return this.hls.audioTracks.length?O.CMCDObjectType.VIDEO:O.CMCDObjectType.MUXED},v.getTopBandwidth=function(t){var o=0,u,d=this.hls;if(t===O.CMCDObjectType.AUDIO)u=d.audioTracks;else{var n=d.maxAutoLevel,e=n>-1?n+1:d.levels.length;u=d.levels.slice(0,e)}for(var r=x(u),m;!(m=r()).done;){var l=m.value;l.bitrate>o&&(o=l.bitrate)}return o>0?o:NaN},v.getBufferLength=function(t){var o=this.hls.media,u=t===O.CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;if(!u||!o)return NaN;var d=A.BufferHelper.bufferInfo(u,o.currentTime,this.config.maxBufferHole);return d.len*1e3},v.createPlaylistLoader=function(){var t=this.config.pLoader,o=this.applyPlaylistData,u=t||this.config.loader;return function(){function d(e){this.loader=void 0,this.loader=new u(e)}var n=d.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(r,m,l){o(r),this.loader.load(r,m,l)},R(d,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),d}()},v.createFragmentLoader=function(){var t=this.config.fLoader,o=this.applyFragmentData,u=t||this.config.loader;return function(){function d(e){this.loader=void 0,this.loader=new u(e)}var n=d.prototype;return n.destroy=function(){this.loader.destroy()},n.abort=function(){this.loader.abort()},n.load=function(r,m,l){o(r),this.loader.load(r,m,l)},R(d,[{key:"stats",get:function(){return this.loader.stats}},{key:"context",get:function(){return this.loader.context}}]),d}()},c.uuid=function(){var t=URL.createObjectURL(new Blob),o=t.toString();return URL.revokeObjectURL(t),o.slice(o.lastIndexOf("/")+1)},c.serialize=function(t){for(var o=[],u=function(I){return!Number.isNaN(I)&&I!=null&&I!==""&&I!==!1},d=function(I){return Math.round(I)},n=function(I){return d(I/100)*100},e=function(I){return encodeURIComponent(I)},r={br:d,d,bl:n,dl:n,mtp:n,nor:e,rtp:n,tb:d},m=Object.keys(t||{}).sort(),l=x(m),f;!(f=l()).done;){var h=f.value,a=t[h];if(!!u(a)&&!(h==="v"&&a===1)&&!(h=="pr"&&a===1)){var s=r[h];s&&(a=s(a));var y=typeof a,D=void 0;h==="ot"||h==="sf"||h==="st"?D=h+"="+a:y==="boolean"?D=h:y==="number"?D=h+"="+a:D=h+"="+JSON.stringify(a),o.push(D)}}return o.join(",")},c.toHeaders=function(t){for(var o=Object.keys(t),u={},d=["Object","Request","Session","Status"],n=[{},{},{},{}],e={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3},r=0,m=o;r<m.length;r++){var l=m[r],f=e[l]!=null?e[l]:1;n[f][l]=t[l]}for(var h=0;h<n.length;h++){var a=c.serialize(n[h]);a&&(u["CMCD-"+d[h]]=a)}return u},c.toQuery=function(t){return"CMCD="+encodeURIComponent(c.serialize(t))},c.appendQueryToUri=function(t,o){if(!o)return t;var u=t.includes("?")?"&":"?";return""+t+u+o},c}()},"./src/controller/eme-controller.ts":function(K,M,S){S.r(M);var C=S("./src/events.ts"),O=S("./src/errors.ts"),A=S("./src/utils/logger.ts"),b=S("./src/utils/mediakeys-helper.ts");function P(E,c){for(var v=0;v<c.length;v++){var i=c[v];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(E,i.key,i)}}function R(E,c,v){return c&&P(E.prototype,c),v&&P(E,v),Object.defineProperty(E,"prototype",{writable:!1}),E}var x=3,g=function(c,v,i){var t={audioCapabilities:[],videoCapabilities:[]};return c.forEach(function(o){t.audioCapabilities.push({contentType:'audio/mp4; codecs="'+o+'"',robustness:i.audioRobustness||""})}),v.forEach(function(o){t.videoCapabilities.push({contentType:'video/mp4; codecs="'+o+'"',robustness:i.videoRobustness||""})}),[t]},T=function(c,v,i,t){switch(c){case b.KeySystems.WIDEVINE:return g(v,i,t);default:throw new Error("Unknown key-system: "+c)}},p=function(){function E(v){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=v,this._config=v.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var c=E.prototype;return c.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},c._registerListeners=function(){this.hls.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this)},c._unregisterListeners=function(){this.hls.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(C.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this)},c.getLicenseServerUrl=function(i){switch(i){case b.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+i+'"')},c._attemptKeySystemAccess=function(i,t,o){var u=this,d=T(i,t,o,this._drmSystemOptions);A.logger.log("Requesting encrypted media key-system access");var n=this.requestMediaKeySystemAccess(i,d);this.mediaKeysPromise=n.then(function(e){return u._onMediaKeySystemAccessObtained(i,e)}),n.catch(function(e){A.logger.error('Failed to obtain key-system "'+i+'" access:',e)})},c._onMediaKeySystemAccessObtained=function(i,t){var o=this;A.logger.log('Access for key-system "'+i+'" obtained');var u={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:t,mediaKeySystemDomain:i};this._mediaKeysList.push(u);var d=Promise.resolve().then(function(){return t.createMediaKeys()}).then(function(n){return u.mediaKeys=n,A.logger.log('Media-keys created for key-system "'+i+'"'),o._onMediaKeysCreated(),n});return d.catch(function(n){A.logger.error("Failed to create media-keys:",n)}),d},c._onMediaKeysCreated=function(){var i=this;this._mediaKeysList.forEach(function(t){t.mediaKeysSession||(t.mediaKeysSession=t.mediaKeys.createSession(),i._onNewMediaKeySession(t.mediaKeysSession))})},c._onNewMediaKeySession=function(i){var t=this;A.logger.log("New key-system session "+i.sessionId),i.addEventListener("message",function(o){t._onKeySessionMessage(i,o.message)},!1)},c._onKeySessionMessage=function(i,t){A.logger.log("Got EME message event, creating license request"),this._requestLicense(t,function(o){A.logger.log("Received license data (length: "+(o&&o.byteLength)+"), updating key-session"),i.update(o).catch(function(u){A.logger.warn("Updating key-session failed: "+u)})})},c.onMediaEncrypted=function(i){var t=this;if(A.logger.log('Media is encrypted using "'+i.initDataType+'" init data type'),!this.mediaKeysPromise){A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}var o=function(d){!t._media||(t._attemptSetMediaKeys(d),t._generateRequestWithPreferredKeySession(i.initDataType,i.initData))};this.mediaKeysPromise.then(o).catch(o)},c._attemptSetMediaKeys=function(i){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var t=this._mediaKeysList[0];if(!t||!t.mediaKeys){A.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});return}A.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(t.mediaKeys),this._hasSetMediaKeys=!0}},c._generateRequestWithPreferredKeySession=function(i,t){var o=this,u=this._mediaKeysList[0];if(!u){A.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}if(u.mediaKeysSessionInitialized){A.logger.warn("Key-Session already initialized but requested again");return}var d=u.mediaKeysSession;if(!d){A.logger.error("Fatal: Media is encrypted but no key-session existing"),this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});return}if(!t){A.logger.warn("Fatal: initData required for generating a key session is null"),this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});return}A.logger.log('Generating key-session request for "'+i+'" init data type'),u.mediaKeysSessionInitialized=!0,d.generateRequest(i,t).then(function(){A.logger.debug("Key-session generation succeeded")}).catch(function(n){A.logger.error("Error generating key-session request:",n),o.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})})},c._createLicenseXhr=function(i,t,o){var u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,u,i,t,o);var d=this._licenseXhrSetup;if(d)try{d.call(this.hls,u,i),d=void 0}catch(n){A.logger.error(n)}try{u.readyState||u.open("POST",i,!0),d&&d.call(this.hls,u,i)}catch(n){throw new Error("issue setting up KeySystem license XHR "+n)}return u},c._onLicenseRequestReadyStageChange=function(i,t,o,u){switch(i.readyState){case 4:if(i.status===200){this._requestLicenseFailureCount=0,A.logger.log("License request succeeded");var d=i.response,n=this._licenseResponseCallback;if(n)try{d=n.call(this.hls,i,t)}catch(r){A.logger.error(r)}u(d)}else{if(A.logger.error("License Request XHR failed ("+t+"). Status: "+i.status+" ("+i.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>x){this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});return}var e=x-this._requestLicenseFailureCount+1;A.logger.warn("Retrying license request, "+e+" attempts left"),this._requestLicense(o,u)}break}},c._generateLicenseRequestChallenge=function(i,t){switch(i.mediaKeySystemDomain){case b.KeySystems.WIDEVINE:return t}throw new Error("unsupported key-system: "+i.mediaKeySystemDomain)},c._requestLicense=function(i,t){A.logger.log("Requesting content license for key-system");var o=this._mediaKeysList[0];if(!o){A.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});return}try{var u=this.getLicenseServerUrl(o.mediaKeySystemDomain),d=this._createLicenseXhr(u,i,t);A.logger.log("Sending license request to URL: "+u);var n=this._generateLicenseRequestChallenge(o,i);d.send(n)}catch(e){A.logger.error("Failure requesting DRM license: "+e),this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.KEY_SYSTEM_ERROR,details:O.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},c.onMediaAttached=function(i,t){if(!!this._emeEnabled){var o=t.media;this._media=o,o.addEventListener("encrypted",this._onMediaEncrypted)}},c.onMediaDetached=function(){var i=this._media,t=this._mediaKeysList;!i||(i.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(t.map(function(o){if(o.mediaKeysSession)return o.mediaKeysSession.close().catch(function(){})})).then(function(){return i.setMediaKeys(null)}).catch(function(){}))},c.onManifestParsed=function(i,t){if(!!this._emeEnabled){var o=t.levels.map(function(d){return d.audioCodec}).filter(function(d){return!!d}),u=t.levels.map(function(d){return d.videoCodec}).filter(function(d){return!!d});this._attemptKeySystemAccess(b.KeySystems.WIDEVINE,o,u)}},R(E,[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}]),E}();M.default=p},"./src/controller/fps-controller.ts":function(K,M,S){S.r(M);var C=S("./src/events.ts"),O=S("./src/utils/logger.ts"),A=function(){function b(R){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=R,this.registerListeners()}var P=b.prototype;return P.setStreamController=function(x){this.streamController=x},P.registerListeners=function(){this.hls.on(C.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},P.unregisterListeners=function(){this.hls.off(C.Events.MEDIA_ATTACHING,this.onMediaAttaching)},P.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},P.onMediaAttaching=function(x,g){var T=this.hls.config;if(T.capLevelOnFPSDrop){var p=g.media instanceof self.HTMLVideoElement?g.media:null;this.media=p,p&&typeof p.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),T.fpsDroppedMonitoringPeriod)}},P.checkFPS=function(x,g,T){var p=performance.now();if(g){if(this.lastTime){var E=p-this.lastTime,c=T-this.lastDroppedFrames,v=g-this.lastDecodedFrames,i=1e3*c/E,t=this.hls;if(t.trigger(C.Events.FPS_DROP,{currentDropped:c,currentDecoded:v,totalDroppedFrames:T}),i>0&&c>t.config.fpsDroppedMonitoringThreshold*v){var o=t.currentLevel;O.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+o),o>0&&(t.autoLevelCapping===-1||t.autoLevelCapping>=o)&&(o=o-1,t.trigger(C.Events.FPS_DROP_LEVEL_CAPPING,{level:o,droppedLevel:t.currentLevel}),t.autoLevelCapping=o,this.streamController.nextLevelSwitch())}}this.lastTime=p,this.lastDroppedFrames=T,this.lastDecodedFrames=g}},P.checkFPSInterval=function(){var x=this.media;if(x)if(this.isVideoPlaybackQualityAvailable){var g=x.getVideoPlaybackQuality();this.checkFPS(x,g.totalVideoFrames,g.droppedVideoFrames)}else this.checkFPS(x,x.webkitDecodedFrameCount,x.webkitDroppedFrameCount)},b}();M.default=A},"./src/controller/fragment-finders.ts":function(K,M,S){S.r(M),S.d(M,"findFragmentByPDT",function(){return A}),S.d(M,"findFragmentByPTS",function(){return b}),S.d(M,"fragmentWithinToleranceTest",function(){return P}),S.d(M,"pdtWithinToleranceTest",function(){return R}),S.d(M,"findFragWithCC",function(){return x});var C=S("./src/polyfills/number.ts"),O=S("./src/utils/binary-search.ts");function A(g,T,p){if(T===null||!Array.isArray(g)||!g.length||!Object(C.isFiniteNumber)(T))return null;var E=g[0].programDateTime;if(T<(E||0))return null;var c=g[g.length-1].endProgramDateTime;if(T>=(c||0))return null;p=p||0;for(var v=0;v<g.length;++v){var i=g[v];if(R(T,p,i))return i}return null}function b(g,T,p,E){p===void 0&&(p=0),E===void 0&&(E=0);var c=null;if(g?c=T[g.sn-T[0].sn+1]||null:p===0&&T[0].start===0&&(c=T[0]),c&&P(p,E,c)===0)return c;var v=O.default.search(T,P.bind(null,p,E));return v||c}function P(g,T,p){g===void 0&&(g=0),T===void 0&&(T=0);var E=Math.min(T,p.duration+(p.deltaPTS?p.deltaPTS:0));return p.start+p.duration-E<=g?1:p.start-E>g&&p.start?-1:0}function R(g,T,p){var E=Math.min(T,p.duration+(p.deltaPTS?p.deltaPTS:0))*1e3,c=p.endProgramDateTime||0;return c-E>g}function x(g,T){return O.default.search(g,function(p){return p.cc<T?1:p.cc>T?-1:0})}},"./src/controller/fragment-tracker.ts":function(K,M,S){S.r(M),S.d(M,"FragmentState",function(){return A}),S.d(M,"FragmentTracker",function(){return b});var C=S("./src/events.ts"),O=S("./src/types/loader.ts"),A;(function(x){x.NOT_LOADED="NOT_LOADED",x.APPENDING="APPENDING",x.PARTIAL="PARTIAL",x.OK="OK"})(A||(A={}));var b=function(){function x(T){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=T,this._registerListeners()}var g=x.prototype;return g._registerListeners=function(){var p=this.hls;p.on(C.Events.BUFFER_APPENDED,this.onBufferAppended,this),p.on(C.Events.FRAG_BUFFERED,this.onFragBuffered,this),p.on(C.Events.FRAG_LOADED,this.onFragLoaded,this)},g._unregisterListeners=function(){var p=this.hls;p.off(C.Events.BUFFER_APPENDED,this.onBufferAppended,this),p.off(C.Events.FRAG_BUFFERED,this.onFragBuffered,this),p.off(C.Events.FRAG_LOADED,this.onFragLoaded,this)},g.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},g.getAppendedFrag=function(p,E){if(E===O.PlaylistLevelType.MAIN){var c=this.activeFragment,v=this.activeParts;if(!c)return null;if(v)for(var i=v.length;i--;){var t=v[i],o=t?t.end:c.appendedPTS;if(t.start<=p&&o!==void 0&&p<=o)return i>9&&(this.activeParts=v.slice(i-9)),t}else if(c.start<=p&&c.appendedPTS!==void 0&&p<=c.appendedPTS)return c}return this.getBufferedFrag(p,E)},g.getBufferedFrag=function(p,E){for(var c=this.fragments,v=Object.keys(c),i=v.length;i--;){var t=c[v[i]];if((t==null?void 0:t.body.type)===E&&t.buffered){var o=t.body;if(o.start<=p&&p<=o.end)return o}}return null},g.detectEvictedFragments=function(p,E,c){var v=this;Object.keys(this.fragments).forEach(function(i){var t=v.fragments[i];if(!!t){if(!t.buffered){t.body.type===c&&v.removeFragment(t.body);return}var o=t.range[p];!o||o.time.some(function(u){var d=!v.isTimeBuffered(u.startPTS,u.endPTS,E);return d&&v.removeFragment(t.body),d})}})},g.detectPartialFragments=function(p){var E=this,c=this.timeRanges,v=p.frag,i=p.part;if(!(!c||v.sn==="initSegment")){var t=R(v),o=this.fragments[t];!o||(Object.keys(c).forEach(function(u){var d=v.elementaryStreams[u];if(!!d){var n=c[u],e=i!==null||d.partial===!0;o.range[u]=E.getBufferedTimes(v,i,e,n)}}),o.loaded=null,Object.keys(o.range).length?o.buffered=!0:this.removeFragment(o.body))}},g.fragBuffered=function(p){var E=R(p),c=this.fragments[E];c&&(c.loaded=null,c.buffered=!0)},g.getBufferedTimes=function(p,E,c,v){for(var i={time:[],partial:c},t=E?E.start:p.start,o=E?E.end:p.end,u=p.minEndPTS||o,d=p.maxStartPTS||t,n=0;n<v.length;n++){var e=v.start(n)-this.bufferPadding,r=v.end(n)+this.bufferPadding;if(d>=e&&u<=r){i.time.push({startPTS:Math.max(t,v.start(n)),endPTS:Math.min(o,v.end(n))});break}else if(t<r&&o>e)i.partial=!0,i.time.push({startPTS:Math.max(t,v.start(n)),endPTS:Math.min(o,v.end(n))});else if(o<=e)break}return i},g.getPartialFragment=function(p){var E=null,c,v,i,t=0,o=this.bufferPadding,u=this.fragments;return Object.keys(u).forEach(function(d){var n=u[d];!n||P(n)&&(v=n.body.start-o,i=n.body.end+o,p>=v&&p<=i&&(c=Math.min(p-v,i-p),t<=c&&(E=n.body,t=c)))}),E},g.getState=function(p){var E=R(p),c=this.fragments[E];return c?c.buffered?P(c)?A.PARTIAL:A.OK:A.APPENDING:A.NOT_LOADED},g.isTimeBuffered=function(p,E,c){for(var v,i,t=0;t<c.length;t++){if(v=c.start(t)-this.bufferPadding,i=c.end(t)+this.bufferPadding,p>=v&&E<=i)return!0;if(E<=v)return!1}return!1},g.onFragLoaded=function(p,E){var c=E.frag,v=E.part;if(!(c.sn==="initSegment"||c.bitrateTest||v)){var i=R(c);this.fragments[i]={body:c,loaded:E,buffered:!1,range:Object.create(null)}}},g.onBufferAppended=function(p,E){var c=this,v=E.frag,i=E.part,t=E.timeRanges;if(v.type===O.PlaylistLevelType.MAIN)if(this.activeFragment=v,i){var o=this.activeParts;o||(this.activeParts=o=[]),o.push(i)}else this.activeParts=null;this.timeRanges=t,Object.keys(t).forEach(function(u){var d=t[u];if(c.detectEvictedFragments(u,d),!i)for(var n=0;n<d.length;n++)v.appendedPTS=Math.max(d.end(n),v.appendedPTS||0)})},g.onFragBuffered=function(p,E){this.detectPartialFragments(E)},g.hasFragment=function(p){var E=R(p);return!!this.fragments[E]},g.removeFragmentsInRange=function(p,E,c){var v=this;Object.keys(this.fragments).forEach(function(i){var t=v.fragments[i];if(!!t&&t.buffered){var o=t.body;o.type===c&&o.start<E&&o.end>p&&v.removeFragment(o)}})},g.removeFragment=function(p){var E=R(p);p.stats.loaded=0,p.clearElementaryStreamInfo(),delete this.fragments[E]},g.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},x}();function P(x){var g,T;return x.buffered&&(((g=x.range.video)===null||g===void 0?void 0:g.partial)||((T=x.range.audio)===null||T===void 0?void 0:T.partial))}function R(x){return x.type+"_"+x.level+"_"+x.urlId+"_"+x.sn}},"./src/controller/gap-controller.ts":function(K,M,S){S.r(M),S.d(M,"STALL_MINIMUM_DURATION_MS",function(){return P}),S.d(M,"MAX_START_GAP_JUMP",function(){return R}),S.d(M,"SKIP_BUFFER_HOLE_STEP_SECONDS",function(){return x}),S.d(M,"SKIP_BUFFER_RANGE_START",function(){return g}),S.d(M,"default",function(){return T});var C=S("./src/utils/buffer-helper.ts"),O=S("./src/errors.ts"),A=S("./src/events.ts"),b=S("./src/utils/logger.ts"),P=250,R=2,x=.1,g=.05,T=function(){function p(c,v,i,t){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=c,this.media=v,this.fragmentTracker=i,this.hls=t}var E=p.prototype;return E.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},E.poll=function(v,i){var t=this.config,o=this.media,u=this.stalled;if(o!==null){var d=o.currentTime,n=o.seeking,e=this.seeking&&!n,r=!this.seeking&&n;if(this.seeking=n,d!==v){if(this.moved=!0,u!==null){if(this.stallReported){var m=self.performance.now()-u;b.logger.warn("playback not stuck anymore @"+d+", after "+Math.round(m)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if((r||e)&&(this.stalled=null),!(o.paused&&!n||o.ended||o.playbackRate===0||!C.BufferHelper.getBuffered(o).length)){var l=C.BufferHelper.bufferInfo(o,d,0),f=l.len>0,h=l.nextStart||0;if(!(!f&&!h)){if(n){var a=l.len>R,s=!h||i&&i.start<=d||h-d>R&&!this.fragmentTracker.getPartialFragment(d);if(a||s)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var y,D=Math.max(h,l.start||0)-d,L=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,I=L==null||(y=L.details)===null||y===void 0?void 0:y.live,_=I?L.details.targetduration*2:R;if(D>0&&D<=_){this._trySkipBufferHole(null);return}}var F=self.performance.now();if(u===null){this.stalled=F;return}var B=F-u;if(!(!n&&B>=P&&(this._reportStall(l),!this.media))){var U=C.BufferHelper.bufferInfo(o,d,t.maxBufferHole);this._tryFixBufferStall(U,B)}}}}},E._tryFixBufferStall=function(v,i){var t=this.config,o=this.fragmentTracker,u=this.media;if(u!==null){var d=u.currentTime,n=o.getPartialFragment(d);if(n){var e=this._trySkipBufferHole(n);if(e||!this.media)return}v.len>t.maxBufferHole&&i>t.highBufferWatchdogPeriod*1e3&&(b.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},E._reportStall=function(v){var i=this.hls,t=this.media,o=this.stallReported;!o&&t&&(this.stallReported=!0,b.logger.warn("Playback stalling at @"+t.currentTime+" due to low buffer ("+JSON.stringify(v)+")"),i.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:v.len}))},E._trySkipBufferHole=function(v){var i=this.config,t=this.hls,o=this.media;if(o===null)return 0;for(var u=o.currentTime,d=0,n=C.BufferHelper.getBuffered(o),e=0;e<n.length;e++){var r=n.start(e);if(u+i.maxBufferHole>=d&&u<r){var m=Math.max(r+g,o.currentTime+x);return b.logger.warn("skipping hole, adjusting currentTime from "+u+" to "+m),this.moved=!0,this.stalled=null,o.currentTime=m,v&&t.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+u+" to "+m,frag:v}),m}d=n.end(e)}return 0},E._tryNudgeBuffer=function(){var v=this.config,i=this.hls,t=this.media,o=this.nudgeRetry;if(t!==null){var u=t.currentTime;if(this.nudgeRetry++,o<v.nudgeMaxRetry){var d=u+(o+1)*v.nudgeOffset;b.logger.warn("Nudging 'currentTime' from "+u+" to "+d),t.currentTime=d,i.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else b.logger.error("Playhead still not moving while enough data buffered @"+u+" after "+v.nudgeMaxRetry+" nudges"),i.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}},p}()},"./src/controller/id3-track-controller.ts":function(K,M,S){S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/events.ts"),A=S("./src/utils/texttrack-utils.ts"),b=S("./src/demux/id3.ts"),P=S("./src/loader/date-range.ts"),R=S("./src/types/demuxer.ts"),x=.25;function g(){return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function T(c,v){return c.getTime()/1e3-v}function p(c){return Uint8Array.from(c.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var E=function(){function c(i){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=i,this._registerListeners()}var v=c.prototype;return v.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},v._registerListeners=function(){var t=this.hls;t.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(O.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},v._unregisterListeners=function(){var t=this.hls;t.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(O.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this)},v.onMediaAttached=function(t,o){this.media=o.media},v.onMediaDetaching=function(){!this.id3Track||(Object(A.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},v.onManifestLoading=function(){this.dateRangeCuesAppended={}},v.createTrack=function(t){var o=this.getID3Track(t.textTracks);return o.mode="hidden",o},v.getID3Track=function(t){if(!!this.media){for(var o=0;o<t.length;o++){var u=t[o];if(u.kind==="metadata"&&u.label==="id3")return Object(A.sendAddTrackEvent)(u,this.media),u}return this.media.addTextTrack("metadata","id3")}},v.onFragParsingMetadata=function(t,o){if(!!this.media){var u=this.hls.config,d=u.enableEmsgMetadataCues,n=u.enableID3MetadataCues;if(!(!d&&!n)){var e=o.frag,r=o.samples,m=o.details;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var l=m.edge||e.end,f=g(),h=!1,a={},s=0;s<r.length;s++){var y=r[s].type;if(!(y===R.MetadataSchema.emsg&&!d||!n)){var D=b.getID3Frames(r[s].data);if(D){var L=r[s].pts,I=l,_=I-L;_<=0&&(I=L+x);for(var F=0;F<D.length;F++){var B=D[F];if(!b.isTimeStampFrame(B)){var U=new f(L,I,"");U.value=B,y&&(U.type=y),this.id3Track.addCue(U),a[B.key]=null,h=!0}}}}}h&&this.updateId3CueEnds(a)}}},v.updateId3CueEnds=function(t){var o,u=(o=this.id3Track)===null||o===void 0?void 0:o.cues;if(u)for(var d=u.length;d--;){var n,e=u[d],r=(n=e.value)===null||n===void 0?void 0:n.key;if(r&&r in t){var m=t[r];m&&e.endTime!==m&&(e.endTime=m),t[r]=e.startTime}}},v.onBufferFlushing=function(t,o){var u=o.startOffset,d=o.endOffset,n=o.type,e=this.id3Track,r=this.hls;if(!!r){var m=r.config,l=m.enableEmsgMetadataCues,f=m.enableID3MetadataCues;if(e&&(l||f)){var h;n==="audio"?h=function(s){return s.type===R.MetadataSchema.audioId3&&f}:n==="video"?h=function(s){return s.type===R.MetadataSchema.emsg&&l}:h=function(s){return s.type===R.MetadataSchema.audioId3&&f||s.type===R.MetadataSchema.emsg&&l},Object(A.removeCuesInRange)(e,u,d,h)}}},v.onLevelUpdated=function(t,o){var u=this,d=o.details;if(!(!this.media||!d.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)){var n=this.dateRangeCuesAppended,e=this.id3Track,r=d.dateRanges,m=Object.keys(r);if(e)for(var l=Object.keys(n).filter(function(_){return!m.includes(_)}),f=function(F){var B=l[F];Object.keys(n[B].cues).forEach(function(U){e.removeCue(n[B].cues[U])}),delete n[B]},h=l.length;h--;)f(h);var a=d.fragments[d.fragments.length-1];if(!(m.length===0||!Object(C.isFiniteNumber)(a==null?void 0:a.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var s=a.programDateTime/1e3-a.start,y=d.edge||a.end,D=g(),L=function(F){var B=m[F],U=r[B],N=n[B],k=(N==null?void 0:N.cues)||{},w=(N==null?void 0:N.durationKnown)||!1,W=T(U.startDate,s),j=y,H=U.endDate;if(H)j=T(H,s),w=!0;else if(U.endOnNext&&!w){var G=m.reduce(function(Q,J){var Z=r[J];return Z.class===U.class&&Z.id!==J&&Z.startDate>U.startDate&&Q.push(Z),Q},[]).sort(function(Q,J){return Q.startDate.getTime()-J.startDate.getTime()})[0];G&&(j=T(G.startDate,s),w=!0)}for(var $=Object.keys(U.attr),z=0;z<$.length;z++){var X=$[z];if(!(X===P.DateRangeAttribute.ID||X===P.DateRangeAttribute.CLASS||X===P.DateRangeAttribute.START_DATE||X===P.DateRangeAttribute.DURATION||X===P.DateRangeAttribute.END_DATE||X===P.DateRangeAttribute.END_ON_NEXT)){var V=k[X];if(V)w&&!N.durationKnown&&(V.endTime=j);else{var Y=U.attr[X];V=new D(W,j,""),(X===P.DateRangeAttribute.SCTE35_OUT||X===P.DateRangeAttribute.SCTE35_IN)&&(Y=p(Y)),V.value={key:X,data:Y},V.type=R.MetadataSchema.dateRange,u.id3Track.addCue(V),k[X]=V}}}n[B]={cues:k,dateRange:U,durationKnown:w}},I=0;I<m.length;I++)L(I)}}},c}();M.default=E},"./src/controller/latency-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return R});var C=S("./src/errors.ts"),O=S("./src/events.ts"),A=S("./src/utils/logger.ts");function b(x,g){for(var T=0;T<g.length;T++){var p=g[T];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(x,p.key,p)}}function P(x,g,T){return g&&b(x.prototype,g),T&&b(x,T),Object.defineProperty(x,"prototype",{writable:!1}),x}var R=function(){function x(T){var p=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return p.timeupdate()},this.hls=T,this.config=T.config,this.registerListeners()}var g=x.prototype;return g.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},g.registerListeners=function(){this.hls.on(O.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(O.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(O.Events.ERROR,this.onError,this)},g.unregisterListeners=function(){this.hls.off(O.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(O.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(O.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(O.Events.ERROR,this.onError)},g.onMediaAttached=function(p,E){this.media=E.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},g.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},g.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},g.onLevelUpdated=function(p,E){var c=E.details;this.levelDetails=c,c.advanced&&this.timeupdate(),!c.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},g.onError=function(p,E){E.details===C.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,A.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},g.timeupdate=function(){var p=this.media,E=this.levelDetails;if(!(!p||!E)){this.currentTime=p.currentTime;var c=this.computeLatency();if(c!==null){this._latency=c;var v=this.config,i=v.lowLatencyMode,t=v.maxLiveSyncPlaybackRate;if(!(!i||t===1)){var o=this.targetLatency;if(o!==null){var u=c-o,d=Math.min(this.maxLatency,o+E.targetduration),n=u<d;if(E.live&&n&&u>.05&&this.forwardBufferLength>1){var e=Math.min(2,Math.max(1,t)),r=Math.round(2/(1+Math.exp(-.75*u-this.edgeStalled))*20)/20;p.playbackRate=Math.min(e,Math.max(1,r))}else p.playbackRate!==1&&p.playbackRate!==0&&(p.playbackRate=1)}}}}},g.estimateLiveEdge=function(){var p=this.levelDetails;return p===null?null:p.edge+p.age},g.computeLatency=function(){var p=this.estimateLiveEdge();return p===null?null:p-this.currentTime},P(x,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var p=this.config,E=this.levelDetails;return p.liveMaxLatencyDuration!==void 0?p.liveMaxLatencyDuration:E?p.liveMaxLatencyDurationCount*E.targetduration:0}},{key:"targetLatency",get:function(){var p=this.levelDetails;if(p===null)return null;var E=p.holdBack,c=p.partHoldBack,v=p.targetduration,i=this.config,t=i.liveSyncDuration,o=i.liveSyncDurationCount,u=i.lowLatencyMode,d=this.hls.userConfig,n=u&&c||E;(d.liveSyncDuration||d.liveSyncDurationCount||n===0)&&(n=t!==void 0?t:o*v);var e=v,r=1;return n+Math.min(this.stallCount*r,e)}},{key:"liveSyncPosition",get:function(){var p=this.estimateLiveEdge(),E=this.targetLatency,c=this.levelDetails;if(p===null||E===null||c===null)return null;var v=c.edge,i=p-E-this.edgeStalled,t=v-c.totalduration,o=v-(this.config.lowLatencyMode&&c.partTarget||c.targetduration);return Math.min(Math.max(t,i),o)}},{key:"drift",get:function(){var p=this.levelDetails;return p===null?1:p.drift}},{key:"edgeStalled",get:function(){var p=this.levelDetails;if(p===null)return 0;var E=(this.config.lowLatencyMode&&p.partTarget||p.targetduration)*3;return Math.max(p.age-E,0)}},{key:"forwardBufferLength",get:function(){var p=this.media,E=this.levelDetails;if(!p||!E)return 0;var c=p.buffered.length;return(c?p.buffered.end(c-1):E.edge)-this.currentTime}}]),x}()},"./src/controller/level-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return i});var C=S("./src/types/level.ts"),O=S("./src/events.ts"),A=S("./src/errors.ts"),b=S("./src/utils/codecs.ts"),P=S("./src/controller/level-helper.ts"),R=S("./src/controller/base-playlist-controller.ts"),x=S("./src/types/loader.ts");function g(){return g=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var u=arguments[o];for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(t[d]=u[d])}return t},g.apply(this,arguments)}function T(t,o){for(var u=0;u<o.length;u++){var d=o[u];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(t,d.key,d)}}function p(t,o,u){return o&&T(t.prototype,o),u&&T(t,u),Object.defineProperty(t,"prototype",{writable:!1}),t}function E(t,o){t.prototype=Object.create(o.prototype),t.prototype.constructor=t,c(t,o)}function c(t,o){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(d,n){return d.__proto__=n,d},c(t,o)}var v=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),i=function(t){E(o,t);function o(d){var n;return n=t.call(this,d,"[level-controller]")||this,n._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.onParsedComplete=void 0,n._registerListeners(),n}var u=o.prototype;return u._registerListeners=function(){var n=this.hls;n.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.on(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.on(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),n.on(O.Events.ERROR,this.onError,this)},u._unregisterListeners=function(){var n=this.hls;n.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),n.off(O.Events.LEVEL_LOADED,this.onLevelLoaded,this),n.off(O.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),n.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),n.off(O.Events.ERROR,this.onError,this)},u.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},u.startLoad=function(){var n=this._levels;n.forEach(function(e){e.loadError=0}),t.prototype.startLoad.call(this)},u.onManifestLoaded=function(n,e){var r=[],m=[],l=[],f,h={},a,s=!1,y=!1,D=!1;if(e.levels.forEach(function(F){var B=F.attrs;s=s||!!(F.width&&F.height),y=y||!!F.videoCodec,D=D||!!F.audioCodec,v&&F.audioCodec&&F.audioCodec.indexOf("mp4a.40.34")!==-1&&(F.audioCodec=void 0);var U=F.bitrate+"-"+F.attrs.RESOLUTION+"-"+F.attrs.CODECS;a=h[U],a?a.url.push(F.url):(a=new C.Level(F),h[U]=a,r.push(a)),B&&(B.AUDIO&&Object(P.addGroupId)(a,"audio",B.AUDIO),B.SUBTITLES&&Object(P.addGroupId)(a,"text",B.SUBTITLES))}),(s||y)&&D&&(r=r.filter(function(F){var B=F.videoCodec,U=F.width,N=F.height;return!!B||!!(U&&N)})),r=r.filter(function(F){var B=F.audioCodec,U=F.videoCodec;return(!B||Object(b.isCodecSupportedInMp4)(B,"audio"))&&(!U||Object(b.isCodecSupportedInMp4)(U,"video"))}),e.audioTracks&&(m=e.audioTracks.filter(function(F){return!F.audioCodec||Object(b.isCodecSupportedInMp4)(F.audioCodec,"audio")}),Object(P.assignTrackIdsByGroup)(m)),e.subtitles&&(l=e.subtitles,Object(P.assignTrackIdsByGroup)(l)),r.length>0){f=r[0].bitrate,r.sort(function(F,B){return F.bitrate-B.bitrate}),this._levels=r;for(var L=0;L<r.length;L++)if(r[L].bitrate===f){this._firstLevel=L,this.log("manifest loaded, "+r.length+" level(s) found, first bitrate: "+f);break}var I=D&&!y,_={levels:r,audioTracks:m,subtitleTracks:l,firstLevel:this._firstLevel,stats:e.stats,audio:D,video:y,altAudio:!I&&m.some(function(F){return!!F.url})};this.hls.trigger(O.Events.MANIFEST_PARSED,_),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.MEDIA_ERROR,details:A.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},u.onError=function(n,e){if(t.prototype.onError.call(this,n,e),!e.fatal){var r=e.context,m=this._levels[this.currentLevelIndex];if(r&&(r.type===x.PlaylistContextType.AUDIO_TRACK&&m.audioGroupIds&&r.groupId===m.audioGroupIds[m.urlId]||r.type===x.PlaylistContextType.SUBTITLE_TRACK&&m.textGroupIds&&r.groupId===m.textGroupIds[m.urlId])){this.redundantFailover(this.currentLevelIndex);return}var l=!1,f=!0,h;switch(e.details){case A.ErrorDetails.FRAG_LOAD_ERROR:case A.ErrorDetails.FRAG_LOAD_TIMEOUT:case A.ErrorDetails.KEY_LOAD_ERROR:case A.ErrorDetails.KEY_LOAD_TIMEOUT:if(e.frag){var a=this._levels[e.frag.level];a?(a.fragmentError++,a.fragmentError>this.hls.config.fragLoadingMaxRetry&&(h=e.frag.level)):h=e.frag.level}break;case A.ErrorDetails.LEVEL_LOAD_ERROR:case A.ErrorDetails.LEVEL_LOAD_TIMEOUT:r&&(r.deliveryDirectives&&(f=!1),h=r.level),l=!0;break;case A.ErrorDetails.REMUX_ALLOC_ERROR:h=e.level,l=!0;break}h!==void 0&&this.recoverLevel(e,h,l,f)}},u.recoverLevel=function(n,e,r,m){var l=n.details,f=this._levels[e];if(f.loadError++,r){var h=this.retryLoadingOrFail(n);if(h)n.levelRetry=!0;else{this.currentLevelIndex=-1;return}}if(m){var a=f.url.length;if(a>1&&f.loadError<a)n.levelRetry=!0,this.redundantFailover(e);else if(this.manualLevelIndex===-1){var s=e===0?this._levels.length-1:e-1;this.currentLevelIndex!==s&&this._levels[s].loadError===0&&(this.warn(l+": switch to "+s),n.levelRetry=!0,this.hls.nextAutoLevel=s)}}},u.redundantFailover=function(n){var e=this._levels[n],r=e.url.length;if(r>1){var m=(e.urlId+1)%r;this.warn("Switching to redundant URL-id "+m),this._levels.forEach(function(l){l.urlId=m}),this.level=n}},u.onFragLoaded=function(n,e){var r=e.frag;if(r!==void 0&&r.type===x.PlaylistLevelType.MAIN){var m=this._levels[r.level];m!==void 0&&(m.fragmentError=0,m.loadError=0)}},u.onLevelLoaded=function(n,e){var r,m=e.level,l=e.details,f=this._levels[m];if(!f){var h;this.warn("Invalid level index "+m),(h=e.deliveryDirectives)!==null&&h!==void 0&&h.skip&&(l.deltaUpdateFailed=!0);return}m===this.currentLevelIndex?(f.fragmentError===0&&(f.loadError=0,this.retryCount=0),this.playlistLoaded(m,e,f.details)):(r=e.deliveryDirectives)!==null&&r!==void 0&&r.skip&&(l.deltaUpdateFailed=!0)},u.onAudioTrackSwitched=function(n,e){var r=this.hls.levels[this.currentLevelIndex];if(!!r&&r.audioGroupIds){for(var m=-1,l=this.hls.audioTracks[e.id].groupId,f=0;f<r.audioGroupIds.length;f++)if(r.audioGroupIds[f]===l){m=f;break}m!==r.urlId&&(r.urlId=m,this.startLoad())}},u.loadPlaylist=function(n){var e=this.currentLevelIndex,r=this._levels[e];if(this.canLoad&&r&&r.url.length>0){var m=r.urlId,l=r.url[m];if(n)try{l=n.addDirectives(l)}catch(f){this.warn("Could not construct new URL with HLS Delivery Directives: "+f)}this.log("Attempt loading level index "+e+(n?" at sn "+n.msn+" part "+n.part:"")+" with URL-id "+m+" "+l),this.clearTimer(),this.hls.trigger(O.Events.LEVEL_LOADING,{url:l,level:e,id:m,deliveryDirectives:n||null})}},u.removeLevel=function(n,e){var r=function(f,h){return h!==e},m=this._levels.filter(function(l,f){return f!==n?!0:l.url.length>1&&e!==void 0?(l.url=l.url.filter(r),l.audioGroupIds&&(l.audioGroupIds=l.audioGroupIds.filter(r)),l.textGroupIds&&(l.textGroupIds=l.textGroupIds.filter(r)),l.urlId=0,!0):!1}).map(function(l,f){var h=l.details;return h!=null&&h.fragments&&h.fragments.forEach(function(a){a.level=f}),l});this._levels=m,this.hls.trigger(O.Events.LEVELS_UPDATED,{levels:m})},p(o,[{key:"levels",get:function(){return this._levels.length===0?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(n){var e,r=this._levels;if(r.length!==0&&!(this.currentLevelIndex===n&&(e=r[n])!==null&&e!==void 0&&e.details)){if(n<0||n>=r.length){var m=n<0;if(this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.OTHER_ERROR,details:A.ErrorDetails.LEVEL_SWITCH_ERROR,level:n,fatal:m,reason:"invalid level idx"}),m)return;n=Math.min(n,r.length-1)}this.clearTimer();var l=this.currentLevelIndex,f=r[l],h=r[n];this.log("switching to level "+n+" from "+l),this.currentLevelIndex=n;var a=g({},h,{level:n,maxBitrate:h.maxBitrate,uri:h.uri,urlId:h.urlId});delete a._urlId,this.hls.trigger(O.Events.LEVEL_SWITCHING,a);var s=h.details;if(!s||s.live){var y=this.switchParams(h.uri,f==null?void 0:f.details);this.loadPlaylist(y)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(n){this.manualLevelIndex=n,this._startLevel===void 0&&(this._startLevel=n),n!==-1&&(this.level=n)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(n){this._firstLevel=n}},{key:"startLevel",get:function(){if(this._startLevel===void 0){var n=this.hls.config.startLevel;return n!==void 0?n:this._firstLevel}else return this._startLevel},set:function(n){this._startLevel=n}},{key:"nextLoadLevel",get:function(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(n){this.level=n,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=n)}}]),o}(R.default)},"./src/controller/level-helper.ts":function(K,M,S){S.r(M),S.d(M,"addGroupId",function(){return P}),S.d(M,"assignTrackIdsByGroup",function(){return R}),S.d(M,"updatePTS",function(){return x}),S.d(M,"updateFragPTSDTS",function(){return T}),S.d(M,"mergeDetails",function(){return p}),S.d(M,"mapPartIntersection",function(){return c}),S.d(M,"mapFragmentIntersection",function(){return v}),S.d(M,"adjustSliding",function(){return i}),S.d(M,"addSliding",function(){return t}),S.d(M,"computeReloadInterval",function(){return o}),S.d(M,"getFragmentWithSN",function(){return u}),S.d(M,"getPartWith",function(){return d});var C=S("./src/polyfills/number.ts"),O=S("./src/utils/logger.ts"),A=S("./src/loader/date-range.ts");function b(){return b=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var m in r)Object.prototype.hasOwnProperty.call(r,m)&&(n[m]=r[m])}return n},b.apply(this,arguments)}function P(n,e,r){switch(e){case"audio":n.audioGroupIds||(n.audioGroupIds=[]),n.audioGroupIds.push(r);break;case"text":n.textGroupIds||(n.textGroupIds=[]),n.textGroupIds.push(r);break}}function R(n){var e={};n.forEach(function(r){var m=r.groupId||"";r.id=e[m]=e[m]||0,e[m]++})}function x(n,e,r){var m=n[e],l=n[r];g(m,l)}function g(n,e){var r=e.startPTS;if(Object(C.isFiniteNumber)(r)){var m=0,l;e.sn>n.sn?(m=r-n.start,l=n):(m=n.start-r,l=e),l.duration!==m&&(l.duration=m)}else if(e.sn>n.sn){var f=n.cc===e.cc;f&&n.minEndPTS?e.start=n.start+(n.minEndPTS-n.start):e.start=n.start+n.duration}else e.start=Math.max(n.start-e.duration,0)}function T(n,e,r,m,l,f){var h=m-r;h<=0&&(O.logger.warn("Fragment should have a positive duration",e),m=r+e.duration,f=l+e.duration);var a=r,s=m,y=e.startPTS,D=e.endPTS;if(Object(C.isFiniteNumber)(y)){var L=Math.abs(y-r);Object(C.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(L,e.deltaPTS):e.deltaPTS=L,a=Math.max(r,y),r=Math.min(r,y),l=Math.min(l,e.startDTS),s=Math.min(m,D),m=Math.max(m,D),f=Math.max(f,e.endDTS)}e.duration=m-r;var I=r-e.start;e.appendedPTS=m,e.start=e.startPTS=r,e.maxStartPTS=a,e.startDTS=l,e.endPTS=m,e.minEndPTS=s,e.endDTS=f;var _=e.sn;if(!n||_<n.startSN||_>n.endSN)return 0;var F,B=_-n.startSN,U=n.fragments;for(U[B]=e,F=B;F>0;F--)g(U[F],U[F-1]);for(F=B;F<U.length-1;F++)g(U[F],U[F+1]);return n.fragmentHint&&g(U[U.length-1],n.fragmentHint),n.PTSKnown=n.alignedSliding=!0,I}function p(n,e){for(var r=null,m=n.fragments,l=m.length-1;l>=0;l--){var f=m[l].initSegment;if(f){r=f;break}}n.fragmentHint&&delete n.fragmentHint.endPTS;var h=0,a;if(v(n,e,function(F,B){F.relurl&&(h=F.cc-B.cc),Object(C.isFiniteNumber)(F.startPTS)&&Object(C.isFiniteNumber)(F.endPTS)&&(B.start=B.startPTS=F.startPTS,B.startDTS=F.startDTS,B.appendedPTS=F.appendedPTS,B.maxStartPTS=F.maxStartPTS,B.endPTS=F.endPTS,B.endDTS=F.endDTS,B.minEndPTS=F.minEndPTS,B.duration=F.endPTS-F.startPTS,B.duration&&(a=B),e.PTSKnown=e.alignedSliding=!0),B.elementaryStreams=F.elementaryStreams,B.loader=F.loader,B.stats=F.stats,B.urlId=F.urlId,F.initSegment&&(B.initSegment=F.initSegment,r=F.initSegment)}),r){var s=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments;s.forEach(function(F){var B;(!F.initSegment||F.initSegment.relurl===((B=r)===null||B===void 0?void 0:B.relurl))&&(F.initSegment=r)})}if(e.skippedSegments)if(e.deltaUpdateFailed=e.fragments.some(function(F){return!F}),e.deltaUpdateFailed){O.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var y=e.skippedSegments;y--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}else e.canSkipDateRanges&&(e.dateRanges=E(n.dateRanges,e.dateRanges,e.recentlyRemovedDateranges));var D=e.fragments;if(h){O.logger.warn("discontinuity sliding from playlist, take drift into account");for(var L=0;L<D.length;L++)D[L].cc+=h}e.skippedSegments&&(e.startCC=e.fragments[0].cc),c(n.partList,e.partList,function(F,B){B.elementaryStreams=F.elementaryStreams,B.stats=F.stats}),a?T(e,a,a.startPTS,a.endPTS,a.startDTS,a.endDTS):i(n,e),D.length&&(e.totalduration=e.edge-D[0].start),e.driftStartTime=n.driftStartTime,e.driftStart=n.driftStart;var I=e.advancedDateTime;if(e.advanced&&I){var _=e.edge;e.driftStart||(e.driftStartTime=I,e.driftStart=_),e.driftEndTime=I,e.driftEnd=_}else e.driftEndTime=n.driftEndTime,e.driftEnd=n.driftEnd,e.advancedDateTime=n.advancedDateTime}function E(n,e,r){var m=b({},n);return r&&r.forEach(function(l){delete m[l]}),Object.keys(e).forEach(function(l){var f=new A.DateRange(e[l].attr,m[l]);f.isValid?m[l]=f:O.logger.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(e[l].attr)+'"')}),m}function c(n,e,r){if(n&&e)for(var m=0,l=0,f=n.length;l<=f;l++){var h=n[l],a=e[l+m];h&&a&&h.index===a.index&&h.fragment.sn===a.fragment.sn?r(h,a):m--}}function v(n,e,r){for(var m=e.skippedSegments,l=Math.max(n.startSN,e.startSN)-e.startSN,f=(n.fragmentHint?1:0)+(m?e.endSN:Math.min(n.endSN,e.endSN))-e.startSN,h=e.startSN-n.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,s=n.fragmentHint?n.fragments.concat(n.fragmentHint):n.fragments,y=l;y<=f;y++){var D=s[h+y],L=a[y];m&&!L&&y<m&&(L=e.fragments[y]=D),D&&L&&r(D,L)}}function i(n,e){var r=e.startSN+e.skippedSegments-n.startSN,m=n.fragments;r<0||r>=m.length||t(e,m[r].start)}function t(n,e){if(e){for(var r=n.fragments,m=n.skippedSegments;m<r.length;m++)r[m].start+=e;n.fragmentHint&&(n.fragmentHint.start+=e)}}function o(n,e){var r=1e3*n.levelTargetDuration,m=r/2,l=n.age,f=l>0&&l<r*3,h=e.loading.end-e.loading.start,a,s=n.availabilityDelay;if(n.updated===!1)if(f){var y=333*n.misses;a=Math.max(Math.min(m,h*2),y),n.availabilityDelay=(n.availabilityDelay||0)+a}else a=m;else f?(s=Math.min(s||r/2,l),n.availabilityDelay=s,a=s+r-l):a=r-h;return Math.round(a)}function u(n,e,r){if(!n||!n.details)return null;var m=n.details,l=m.fragments[e-m.startSN];return l||(l=m.fragmentHint,l&&l.sn===e)?l:e<m.startSN&&r&&r.sn===e?r:null}function d(n,e,r){if(!n||!n.details)return null;var m=n.details.partList;if(m)for(var l=m.length;l--;){var f=m[l];if(f.index===r&&f.fragment.sn===e)return f}return null}},"./src/controller/stream-controller.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return d});var C=S("./src/polyfills/number.ts"),O=S("./src/controller/base-stream-controller.ts"),A=S("./src/is-supported.ts"),b=S("./src/events.ts"),P=S("./src/utils/buffer-helper.ts"),R=S("./src/controller/fragment-tracker.ts"),x=S("./src/types/loader.ts"),g=S("./src/loader/fragment.ts"),T=S("./src/demux/transmuxer-interface.ts"),p=S("./src/types/transmuxer.ts"),E=S("./src/controller/gap-controller.ts"),c=S("./src/errors.ts");function v(n,e){for(var r=0;r<e.length;r++){var m=e[r];m.enumerable=m.enumerable||!1,m.configurable=!0,"value"in m&&(m.writable=!0),Object.defineProperty(n,m.key,m)}}function i(n,e,r){return e&&v(n.prototype,e),r&&v(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function t(n,e){n.prototype=Object.create(e.prototype),n.prototype.constructor=n,o(n,e)}function o(n,e){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(m,l){return m.__proto__=l,m},o(n,e)}var u=100,d=function(n){t(e,n);function e(m,l){var f;return f=n.call(this,m,l,"[stream-controller]")||this,f.audioCodecSwap=!1,f.gapController=null,f.level=-1,f._forceStartLoad=!1,f.altAudio=!1,f.audioOnly=!1,f.fragPlaying=null,f.onvplaying=null,f.onvseeked=null,f.fragLastKbps=0,f.couldBacktrack=!1,f.backtrackFragment=null,f.audioCodecSwitch=!1,f.videoBuffer=null,f._registerListeners(),f}var r=e.prototype;return r._registerListeners=function(){var l=this.hls;l.on(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.on(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.on(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.on(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.on(b.Events.LEVEL_LOADING,this.onLevelLoading,this),l.on(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.on(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),l.on(b.Events.ERROR,this.onError,this),l.on(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),l.on(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.on(b.Events.BUFFER_CREATED,this.onBufferCreated,this),l.on(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),l.on(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),l.on(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r._unregisterListeners=function(){var l=this.hls;l.off(b.Events.MEDIA_ATTACHED,this.onMediaAttached,this),l.off(b.Events.MEDIA_DETACHING,this.onMediaDetaching,this),l.off(b.Events.MANIFEST_LOADING,this.onManifestLoading,this),l.off(b.Events.MANIFEST_PARSED,this.onManifestParsed,this),l.off(b.Events.LEVEL_LOADED,this.onLevelLoaded,this),l.off(b.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),l.off(b.Events.ERROR,this.onError,this),l.off(b.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),l.off(b.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),l.off(b.Events.BUFFER_CREATED,this.onBufferCreated,this),l.off(b.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),l.off(b.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),l.off(b.Events.FRAG_BUFFERED,this.onFragBuffered,this)},r.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},r.startLoad=function(l){if(this.levels){var f=this.lastCurrentTime,h=this.hls;if(this.stopLoad(),this.setInterval(u),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var a=h.startLevel;a===-1&&(h.config.testBandwidth?(a=0,this.bitrateTest=!0):a=h.nextAutoLevel),this.level=h.nextLoadLevel=a,this.loadedmetadata=!1}f>0&&l===-1&&(this.log("Override startPosition with lastCurrentTime @"+f.toFixed(3)),l=f),this.state=O.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=l,this.tick()}else this._forceStartLoad=!0,this.state=O.State.STOPPED},r.stopLoad=function(){this._forceStartLoad=!1,n.prototype.stopLoad.call(this)},r.doTick=function(){switch(this.state){case O.State.IDLE:this.doTickIdle();break;case O.State.WAITING_LEVEL:{var l,f=this.levels,h=this.level,a=f==null||(l=f[h])===null||l===void 0?void 0:l.details;if(a&&(!a.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(a))break;this.state=O.State.IDLE;break}break}case O.State.FRAG_LOADING_WAITING_RETRY:{var s,y=self.performance.now(),D=this.retryDate;(!D||y>=D||(s=this.media)!==null&&s!==void 0&&s.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=O.State.IDLE)}break}this.onTickEnd()},r.onTickEnd=function(){n.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},r.doTickIdle=function(){var l,f,h=this.hls,a=this.levelLastLoaded,s=this.levels,y=this.media,D=h.config,L=h.nextLoadLevel;if(!(a===null||!y&&(this.startFragRequested||!D.startFragPrefetch))&&!(this.altAudio&&this.audioOnly)&&!(!s||!s[L])){var I=s[L];this.level=h.nextLoadLevel=L;var _=I.details;if(!_||this.state===O.State.WAITING_LEVEL||_.live&&this.levelLastLoaded!==L){this.state=O.State.WAITING_LEVEL;return}var F=this.getMainFwdBufferInfo();if(F!==null){var B=F.len,U=this.getMaxBufferLength(I.maxBitrate);if(!(B>=U)){if(this._streamEnded(F,_)){var N={};this.altAudio&&(N.type="video"),this.hls.trigger(b.Events.BUFFER_EOS,N),this.state=O.State.ENDED;return}this.backtrackFragment&&this.backtrackFragment.start>F.end&&(this.backtrackFragment=null);var k=this.backtrackFragment?this.backtrackFragment.start:F.end,w=this.getNextFragment(k,_);if(this.couldBacktrack&&!this.fragPrevious&&w&&w.sn!=="initSegment"&&this.fragmentTracker.getState(w)!==R.FragmentState.OK){var W,j=((W=this.backtrackFragment)!=null?W:w).sn,H=j-_.startSN,G=_.fragments[H-1];G&&w.cc===G.cc&&(w=G,this.fragmentTracker.removeFragment(G))}else this.backtrackFragment&&F.len&&(this.backtrackFragment=null);if(w&&this.fragmentTracker.getState(w)===R.FragmentState.OK&&this.nextLoadPosition>k){var $=this.audioOnly&&!this.altAudio?g.ElementaryStreamTypes.AUDIO:g.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(y,$,x.PlaylistLevelType.MAIN),w=this.getNextFragment(this.nextLoadPosition,_)}!w||(w.initSegment&&!w.initSegment.data&&!this.bitrateTest&&(w=w.initSegment),((l=w.decryptdata)===null||l===void 0?void 0:l.keyFormat)==="identity"&&!((f=w.decryptdata)!==null&&f!==void 0&&f.key)?this.loadKey(w,_):this.loadFragment(w,_,k))}}}},r.loadFragment=function(l,f,h){var a,s=this.fragmentTracker.getState(l);this.fragCurrent=l,s===R.FragmentState.NOT_LOADED||s===R.FragmentState.PARTIAL?l.sn==="initSegment"?this._loadInitSegment(l):this.bitrateTest?(l.bitrateTest=!0,this.log("Fragment "+l.sn+" of level "+l.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(l)):(this.startFragRequested=!0,n.prototype.loadFragment.call(this,l,f,h)):s===R.FragmentState.APPENDING?this.reduceMaxBufferLength(l.duration)&&this.fragmentTracker.removeFragment(l):((a=this.media)===null||a===void 0?void 0:a.buffered.length)===0&&this.fragmentTracker.removeAllFragments()},r.getAppendedFrag=function(l){var f=this.fragmentTracker.getAppendedFrag(l,x.PlaylistLevelType.MAIN);return f&&"fragment"in f?f.fragment:f},r.getBufferedFrag=function(l){return this.fragmentTracker.getBufferedFrag(l,x.PlaylistLevelType.MAIN)},r.followingBufferedFrag=function(l){return l?this.getBufferedFrag(l.end+.5):null},r.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},r.nextLevelSwitch=function(){var l=this.levels,f=this.media;if(f!=null&&f.readyState){var h,a=this.getAppendedFrag(f.currentTime);if(a&&a.start>1&&this.flushMainBuffer(0,a.start-1),!f.paused&&l){var s=this.hls.nextLoadLevel,y=l[s],D=this.fragLastKbps;D&&this.fragCurrent?h=this.fragCurrent.duration*y.maxBitrate/(1e3*D)+1:h=0}else h=0;var L=this.getBufferedFrag(f.currentTime+h);if(L){var I=this.followingBufferedFrag(L);if(I){this.abortCurrentFrag();var _=I.maxStartPTS?I.maxStartPTS:I.start,F=I.duration,B=Math.max(L.end,_+Math.min(Math.max(F-this.config.maxFragLookUpTolerance,F*.5),F*.75));this.flushMainBuffer(B,Number.POSITIVE_INFINITY)}}}},r.abortCurrentFrag=function(){var l=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,l!=null&&l.loader&&l.loader.abort(),this.state){case O.State.KEY_LOADING:case O.State.FRAG_LOADING:case O.State.FRAG_LOADING_WAITING_RETRY:case O.State.PARSING:case O.State.PARSED:this.state=O.State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},r.flushMainBuffer=function(l,f){n.prototype.flushMainBuffer.call(this,l,f,this.altAudio?"video":null)},r.onMediaAttached=function(l,f){n.prototype.onMediaAttached.call(this,l,f);var h=f.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),h.addEventListener("playing",this.onvplaying),h.addEventListener("seeked",this.onvseeked),this.gapController=new E.default(this.config,h,this.fragmentTracker,this.hls)},r.onMediaDetaching=function(){var l=this.media;l&&(l.removeEventListener("playing",this.onvplaying),l.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),n.prototype.onMediaDetaching.call(this)},r.onMediaPlaying=function(){this.tick()},r.onMediaSeeked=function(){var l=this.media,f=l?l.currentTime:null;Object(C.isFiniteNumber)(f)&&this.log("Media seeked to "+f.toFixed(3)),this.tick()},r.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(b.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null,this.backtrackFragment=null},r.onManifestParsed=function(l,f){var h=!1,a=!1,s;f.levels.forEach(function(y){s=y.audioCodec,s&&(s.indexOf("mp4a.40.2")!==-1&&(h=!0),s.indexOf("mp4a.40.5")!==-1&&(a=!0))}),this.audioCodecSwitch=h&&a&&!Object(A.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=f.levels,this.startFragRequested=!1},r.onLevelLoading=function(l,f){var h=this.levels;if(!(!h||this.state!==O.State.IDLE)){var a=h[f.level];(!a.details||a.details.live&&this.levelLastLoaded!==f.level||this.waitForCdnTuneIn(a.details))&&(this.state=O.State.WAITING_LEVEL)}},r.onLevelLoaded=function(l,f){var h,a=this.levels,s=f.level,y=f.details,D=y.totalduration;if(!a){this.warn("Levels were reset while loading level "+s);return}this.log("Level "+s+" loaded ["+y.startSN+","+y.endSN+"], cc ["+y.startCC+", "+y.endCC+"] duration:"+D);var L=this.fragCurrent;L&&(this.state===O.State.FRAG_LOADING||this.state===O.State.FRAG_LOADING_WAITING_RETRY)&&L.level!==f.level&&L.loader&&(this.state=O.State.IDLE,this.backtrackFragment=null,L.loader.abort());var I=a[s],_=0;if(y.live||(h=I.details)!==null&&h!==void 0&&h.live){if(y.fragments[0]||(y.deltaUpdateFailed=!0),y.deltaUpdateFailed)return;_=this.alignPlaylists(y,I.details)}if(I.details=y,this.levelLastLoaded=s,this.hls.trigger(b.Events.LEVEL_UPDATED,{details:y,level:s}),this.state===O.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(y))return;this.state=O.State.IDLE}this.startFragRequested?y.live&&this.synchronizeToLiveEdge(y):this.setStartPosition(y,_),this.tick()},r._handleFragmentLoadProgress=function(l){var f,h=l.frag,a=l.part,s=l.payload,y=this.levels;if(!y){this.warn("Levels were reset while fragment load was in progress. Fragment "+h.sn+" of level "+h.level+" will not be buffered");return}var D=y[h.level],L=D.details;if(!L){this.warn("Dropping fragment "+h.sn+" of level "+h.level+" after level details were reset");return}var I=D.videoCodec,_=L.PTSKnown||!L.live,F=(f=h.initSegment)===null||f===void 0?void 0:f.data,B=this._getAudioCodec(D),U=this.transmuxer=this.transmuxer||new T.default(this.hls,x.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),N=a?a.index:-1,k=N!==-1,w=new p.ChunkMetadata(h.level,h.sn,h.stats.chunkCount,s.byteLength,N,k),W=this.initPTS[h.cc];U.push(s,F,B,I,h,a,L.totalduration,_,w,W)},r.onAudioTrackSwitching=function(l,f){var h=this.altAudio,a=!!f.url,s=f.id;if(!a){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var y=this.fragCurrent;y!=null&&y.loader&&(this.log("Switching to main audio track, cancel main fragment load"),y.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var D=this.hls;h&&D.trigger(b.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),D.trigger(b.Events.AUDIO_TRACK_SWITCHED,{id:s})}},r.onAudioTrackSwitched=function(l,f){var h=f.id,a=!!this.hls.audioTracks[h].url;if(a){var s=this.videoBuffer;s&&this.mediaBuffer!==s&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=s)}this.altAudio=a,this.tick()},r.onBufferCreated=function(l,f){var h=f.tracks,a,s,y=!1;for(var D in h){var L=h[D];if(L.id==="main"){if(s=D,a=L,D==="video"){var I=h[D];I&&(this.videoBuffer=I.buffer)}}else y=!0}y&&a?(this.log("Alternate track found, use "+s+".buffered to schedule main fragment loading"),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media},r.onFragBuffered=function(l,f){var h=f.frag,a=f.part;if(!(h&&h.type!==x.PlaylistLevelType.MAIN)){if(this.fragContextChanged(h)){this.warn("Fragment "+h.sn+(a?" p: "+a.index:"")+" of level "+h.level+" finished buffering, but was aborted. state: "+this.state),this.state===O.State.PARSED&&(this.state=O.State.IDLE);return}var s=a?a.stats:h.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),h.sn!=="initSegment"&&(this.fragPrevious=h),this.fragBufferedComplete(h,a)}},r.onError=function(l,f){switch(f.details){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(x.PlaylistLevelType.MAIN,f);break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==O.State.ERROR&&(f.fatal?(this.warn(""+f.details),this.state=O.State.ERROR):!f.levelRetry&&this.state===O.State.WAITING_LEVEL&&(this.state=O.State.IDLE));break;case c.ErrorDetails.BUFFER_FULL_ERROR:if(f.parent==="main"&&(this.state===O.State.PARSING||this.state===O.State.PARSED)){var h=!0,a=this.getFwdBufferInfo(this.media,x.PlaylistLevelType.MAIN);a&&a.len>.5&&(h=!this.reduceMaxBufferLength(a.len)),h&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}break}},r.checkBuffer=function(){var l=this.media,f=this.gapController;if(!(!l||!f||!l.readyState)){var h=P.BufferHelper.getBuffered(l);if(!this.loadedmetadata&&h.length)this.loadedmetadata=!0,this.seekToStartPos();else{var a=this.state!==O.State.IDLE?this.fragCurrent:null;f.poll(this.lastCurrentTime,a)}this.lastCurrentTime=l.currentTime}},r.onFragLoadEmergencyAborted=function(){this.state=O.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},r.onBufferFlushed=function(l,f){var h=f.type;if(h!==g.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var a=(h===g.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(a,h,x.PlaylistLevelType.MAIN)}},r.onLevelsUpdated=function(l,f){this.levels=f.levels},r.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},r.seekToStartPos=function(){var l=this.media,f=l.currentTime,h=this.startPosition;if(h>=0&&f<h){if(l.seeking){this.log("could not seek to "+h+", already seeking at "+f);return}var a=P.BufferHelper.getBuffered(l),s=a.length?a.start(0):0,y=s-h;y>0&&(y<this.config.maxBufferHole||y<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+y+" to match buffer start"),h+=y,this.startPosition=h),this.log("seek to target start position "+h+" from current time "+f),l.currentTime=h}},r._getAudioCodec=function(l){var f=this.config.defaultAudioCodec||l.audioCodec;return this.audioCodecSwap&&f&&(this.log("Swapping audio codec"),f.indexOf("mp4a.40.5")!==-1?f="mp4a.40.2":f="mp4a.40.5"),f},r._loadBitrateTestFrag=function(l){var f=this;this._doFragLoad(l).then(function(h){var a=f.hls;if(!(!h||a.nextLoadLevel||f.fragContextChanged(l))){f.fragLoadError=0,f.state=O.State.IDLE,f.startFragRequested=!1,f.bitrateTest=!1;var s=l.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),a.trigger(b.Events.FRAG_LOADED,h)}})},r._handleTransmuxComplete=function(l){var f,h="main",a=this.hls,s=l.remuxResult,y=l.chunkMeta,D=this.getCurrentContext(y);if(!D){this.warn("The loading context changed while buffering fragment "+y.sn+" of level "+y.level+". This chunk will not be buffered."),this.resetLiveStartWhenNotLoaded(y.level);return}var L=D.frag,I=D.part,_=D.level,F=s.video,B=s.text,U=s.id3,N=s.initSegment,k=_.details,w=this.altAudio?void 0:s.audio;if(!this.fragContextChanged(L)){if(this.state=O.State.PARSING,N){N.tracks&&(this._bufferInitSegment(_,N.tracks,L,y),a.trigger(b.Events.FRAG_PARSING_INIT_SEGMENT,{frag:L,id:h,tracks:N.tracks}));var W=N.initPTS,j=N.timescale;Object(C.isFiniteNumber)(W)&&(this.initPTS[L.cc]=W,a.trigger(b.Events.INIT_PTS_FOUND,{frag:L,id:h,initPTS:W,timescale:j}))}if(F&&s.independent!==!1){if(k){var H=F.startPTS,G=F.endPTS,$=F.startDTS,z=F.endDTS;if(I)I.elementaryStreams[F.type]={startPTS:H,endPTS:G,startDTS:$,endDTS:z};else if(F.firstKeyFrame&&F.independent&&(this.couldBacktrack=!0),F.dropped&&F.independent){var X=this.getMainFwdBufferInfo(),V=(X?X.end:this.getLoadPosition())+this.config.maxBufferHole,Y=F.firstKeyFramePTS?F.firstKeyFramePTS:H;if(V<Y-this.config.maxBufferHole){this.backtrack(L);return}L.setElementaryStreamInfo(F.type,L.start,G,L.start,z,!0)}L.setElementaryStreamInfo(F.type,H,G,$,z),this.backtrackFragment&&(this.backtrackFragment=L),this.bufferFragmentData(F,L,I,y)}}else if(s.independent===!1){this.backtrack(L);return}if(w){var Q=w.startPTS,J=w.endPTS,Z=w.startDTS,q=w.endDTS;I&&(I.elementaryStreams[g.ElementaryStreamTypes.AUDIO]={startPTS:Q,endPTS:J,startDTS:Z,endDTS:q}),L.setElementaryStreamInfo(g.ElementaryStreamTypes.AUDIO,Q,J,Z,q),this.bufferFragmentData(w,L,I,y)}if(k&&U!==null&&U!==void 0&&(f=U.samples)!==null&&f!==void 0&&f.length){var tt={id:h,frag:L,details:k,samples:U.samples};a.trigger(b.Events.FRAG_PARSING_METADATA,tt)}if(k&&B){var et={id:h,frag:L,details:k,samples:B.samples};a.trigger(b.Events.FRAG_PARSING_USERDATA,et)}}},r._bufferInitSegment=function(l,f,h,a){var s=this;if(this.state===O.State.PARSING){this.audioOnly=!!f.audio&&!f.video,this.altAudio&&!this.audioOnly&&delete f.audio;var y=f.audio,D=f.video,L=f.audiovideo;if(y){var I=l.audioCodec,_=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(I&&(I.indexOf("mp4a.40.5")!==-1?I="mp4a.40.2":I="mp4a.40.5"),y.metadata.channelCount!==1&&_.indexOf("firefox")===-1&&(I="mp4a.40.5")),_.indexOf("android")!==-1&&y.container!=="audio/mpeg"&&(I="mp4a.40.2",this.log("Android: force audio codec to "+I)),l.audioCodec&&l.audioCodec!==I&&this.log('Swapping manifest audio codec "'+l.audioCodec+'" for "'+I+'"'),y.levelCodec=I,y.id="main",this.log("Init audio buffer, container:"+y.container+", codecs[selected/level/parsed]=["+(I||"")+"/"+(l.audioCodec||"")+"/"+y.codec+"]")}D&&(D.levelCodec=l.videoCodec,D.id="main",this.log("Init video buffer, container:"+D.container+", codecs[level/parsed]=["+(l.videoCodec||"")+"/"+D.codec+"]")),L&&this.log("Init audiovideo buffer, container:"+L.container+", codecs[level/parsed]=["+(l.attrs.CODECS||"")+"/"+L.codec+"]"),this.hls.trigger(b.Events.BUFFER_CODECS,f),Object.keys(f).forEach(function(F){var B=f[F],U=B.initSegment;U!=null&&U.byteLength&&s.hls.trigger(b.Events.BUFFER_APPENDING,{type:F,data:U,frag:h,part:null,chunkMeta:a,parent:h.type})}),this.tick()}},r.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,x.PlaylistLevelType.MAIN)},r.backtrack=function(l){this.couldBacktrack=!0,this.backtrackFragment=l,this.resetTransmuxer(),this.flushBufferGap(l),this.fragmentTracker.removeFragment(l),this.fragPrevious=null,this.nextLoadPosition=l.start,this.state=O.State.IDLE},r.checkFragmentChanged=function(){var l=this.media,f=null;if(l&&l.readyState>1&&l.seeking===!1){var h=l.currentTime;if(P.BufferHelper.isBuffered(l,h)?f=this.getAppendedFrag(h):P.BufferHelper.isBuffered(l,h+.1)&&(f=this.getAppendedFrag(h+.1)),f){this.backtrackFragment=null;var a=this.fragPlaying,s=f.level;(!a||f.sn!==a.sn||a.level!==s||f.urlId!==a.urlId)&&(this.hls.trigger(b.Events.FRAG_CHANGED,{frag:f}),(!a||a.level!==s)&&this.hls.trigger(b.Events.LEVEL_SWITCHED,{level:s}),this.fragPlaying=f)}}},i(e,[{key:"nextLevel",get:function(){var l=this.nextBufferedFrag;return l?l.level:-1}},{key:"currentFrag",get:function(){var l=this.media;return l?this.fragPlaying||this.getAppendedFrag(l.currentTime):null}},{key:"currentProgramDateTime",get:function(){var l=this.media;if(l){var f=l.currentTime,h=this.currentFrag;if(h&&Object(C.isFiniteNumber)(f)&&Object(C.isFiniteNumber)(h.programDateTime)){var a=h.programDateTime+(f-h.start)*1e3;return new Date(a)}}return null}},{key:"currentLevel",get:function(){var l=this.currentFrag;return l?l.level:-1}},{key:"nextBufferedFrag",get:function(){var l=this.currentFrag;return l?this.followingBufferedFrag(l):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),e}(O.default)},"./src/controller/subtitle-stream-controller.ts":function(K,M,S){S.r(M),S.d(M,"SubtitleStreamController",function(){return t});var C=S("./src/events.ts"),O=S("./src/utils/buffer-helper.ts"),A=S("./src/controller/fragment-finders.ts"),b=S("./src/utils/discontinuities.ts"),P=S("./src/controller/level-helper.ts"),R=S("./src/controller/fragment-tracker.ts"),x=S("./src/controller/base-stream-controller.ts"),g=S("./src/types/loader.ts"),T=S("./src/types/level.ts");function p(o,u){for(var d=0;d<u.length;d++){var n=u[d];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}function E(o,u,d){return u&&p(o.prototype,u),d&&p(o,d),Object.defineProperty(o,"prototype",{writable:!1}),o}function c(o,u){o.prototype=Object.create(u.prototype),o.prototype.constructor=o,v(o,u)}function v(o,u){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,e){return n.__proto__=e,n},v(o,u)}var i=500,t=function(o){c(u,o);function u(n,e){var r;return r=o.call(this,n,e,"[subtitle-stream-controller]")||this,r.levels=[],r.currentTrackId=-1,r.tracksBuffered=[],r.mainDetails=null,r._registerListeners(),r}var d=u.prototype;return d.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},d._registerListeners=function(){var e=this.hls;e.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.on(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.on(C.Events.ERROR,this.onError,this),e.on(C.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(C.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(C.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(C.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},d._unregisterListeners=function(){var e=this.hls;e.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),e.off(C.Events.LEVEL_LOADED,this.onLevelLoaded,this),e.off(C.Events.ERROR,this.onError,this),e.off(C.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(C.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(C.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(C.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},d.startLoad=function(){this.stopLoad(),this.state=x.State.IDLE,this.setInterval(i),this.tick()},d.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},d.onLevelLoaded=function(e,r){this.mainDetails=r.details},d.onSubtitleFragProcessed=function(e,r){var m=r.frag,l=r.success;if(this.fragPrevious=m,this.state=x.State.IDLE,!!l){var f=this.tracksBuffered[this.currentTrackId];if(!!f){for(var h,a=m.start,s=0;s<f.length;s++)if(a>=f[s].start&&a<=f[s].end){h=f[s];break}var y=m.start+m.duration;h?h.end=y:(h={start:a,end:y},f.push(h)),this.fragmentTracker.fragBuffered(m)}}},d.onBufferFlushing=function(e,r){var m=r.startOffset,l=r.endOffset;if(m===0&&l!==Number.POSITIVE_INFINITY){var f=this.currentTrackId,h=this.levels;if(!h.length||!h[f]||!h[f].details)return;var a=h[f].details,s=a.targetduration,y=l-s;if(y<=0)return;r.endOffsetSubtitles=Math.max(0,y),this.tracksBuffered.forEach(function(D){for(var L=0;L<D.length;){if(D[L].end<=y){D.shift();continue}else if(D[L].start<y)D[L].start=y;else break;L++}}),this.fragmentTracker.removeFragmentsInRange(m,y,g.PlaylistLevelType.SUBTITLE)}},d.onError=function(e,r){var m,l=r.frag;!l||l.type!==g.PlaylistLevelType.SUBTITLE||((m=this.fragCurrent)!==null&&m!==void 0&&m.loader&&this.fragCurrent.loader.abort(),this.state=x.State.IDLE)},d.onSubtitleTracksUpdated=function(e,r){var m=this,l=r.subtitleTracks;this.tracksBuffered=[],this.levels=l.map(function(f){return new T.Level(f)}),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach(function(f){m.tracksBuffered[f.id]=[]}),this.mediaBuffer=null},d.onSubtitleTrackSwitch=function(e,r){if(this.currentTrackId=r.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}var m=this.levels[this.currentTrackId];m!=null&&m.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,m&&this.setInterval(i)},d.onSubtitleTrackLoaded=function(e,r){var m,l=r.details,f=r.id,h=this.currentTrackId,a=this.levels;if(!!a.length){var s=a[h];if(!(f>=a.length||f!==h||!s)){if(this.mediaBuffer=this.mediaBufferTimeRanges,l.live||(m=s.details)!==null&&m!==void 0&&m.live){var y=this.mainDetails;if(l.deltaUpdateFailed||!y)return;var D=y.fragments[0];if(!s.details)l.hasProgramDateTime&&y.hasProgramDateTime?Object(b.alignMediaPlaylistByPDT)(l,y):D&&Object(P.addSliding)(l,D.start);else{var L=this.alignPlaylists(l,s.details);L===0&&D&&Object(P.addSliding)(l,D.start)}}if(s.details=l,this.levelLastLoaded=f,this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===x.State.IDLE){var I=Object(A.findFragmentByPTS)(null,l.fragments,this.media.currentTime,0);I||(this.warn("Subtitle playlist not aligned with playback"),s.details=void 0)}}}},d._handleFragmentLoadComplete=function(e){var r=e.frag,m=e.payload,l=r.decryptdata,f=this.hls;if(!this.fragContextChanged(r)&&m&&m.byteLength>0&&l&&l.key&&l.iv&&l.method==="AES-128"){var h=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(m),l.key.buffer,l.iv.buffer).then(function(a){var s=performance.now();f.trigger(C.Events.FRAG_DECRYPTED,{frag:r,payload:a,stats:{tstart:h,tdecrypt:s}})})}},d.doTick=function(){if(!this.media){this.state=x.State.IDLE;return}if(this.state===x.State.IDLE){var e=this.currentTrackId,r=this.levels;if(!r.length||!r[e]||!r[e].details)return;var m=r[e].details,l=m.targetduration,f=this.config,h=this.media,a=O.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,h.currentTime-l,f.maxBufferHole),s=a.end,y=a.len,D=this.getMaxBufferLength()+l;if(y>D)return;console.assert(m,"Subtitle track details are defined on idle subtitle stream controller tick");var L=m.fragments,I=L.length,_=m.edge,F,B=this.fragPrevious;if(s<_){var U=f.maxFragLookUpTolerance;F=Object(A.findFragmentByPTS)(B,L,Math.max(L[0].start,s),U),!F&&B&&B.start<L[0].start&&(F=L[0])}else F=L[I-1];if(F=this.mapToInitFragWhenRequired(F),!F)return;F.encrypted?this.loadKey(F,m):this.fragmentTracker.getState(F)===R.FragmentState.NOT_LOADED&&this.loadFragment(F,m,s)}},d.loadFragment=function(e,r,m){this.fragCurrent=e,e.sn==="initSegment"?this._loadInitSegment(e):o.prototype.loadFragment.call(this,e,r,m)},E(u,[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}]),u}(x.default)},"./src/controller/subtitle-track-controller.ts":function(K,M,S){S.r(M);var C=S("./src/events.ts"),O=S("./src/utils/texttrack-utils.ts"),A=S("./src/controller/base-playlist-controller.ts"),b=S("./src/types/loader.ts");function P(E,c){for(var v=0;v<c.length;v++){var i=c[v];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(E,i.key,i)}}function R(E,c,v){return c&&P(E.prototype,c),v&&P(E,v),Object.defineProperty(E,"prototype",{writable:!1}),E}function x(E,c){E.prototype=Object.create(c.prototype),E.prototype.constructor=E,g(E,c)}function g(E,c){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,t){return i.__proto__=t,i},g(E,c)}var T=function(E){x(c,E);function c(i){var t;return t=E.call(this,i,"[subtitle-track-controller]")||this,t.media=null,t.tracks=[],t.groupId=null,t.tracksInGroup=[],t.trackId=-1,t.selectDefaultTrack=!0,t.queuedDefaultTrack=-1,t.trackChangeListener=function(){return t.onTextTracksChanged()},t.asyncPollTrackChange=function(){return t.pollTrackChange(0)},t.useTextTrackPolling=!1,t.subtitlePollingInterval=-1,t._subtitleDisplay=!0,t.registerListeners(),t}var v=c.prototype;return v.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,E.prototype.destroy.call(this)},v.registerListeners=function(){var t=this.hls;t.on(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(C.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(C.Events.ERROR,this.onError,this)},v.unregisterListeners=function(){var t=this.hls;t.off(C.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(C.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(C.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(C.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(C.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(C.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(C.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(C.Events.ERROR,this.onError,this)},v.onMediaAttached=function(t,o){this.media=o.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},v.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},v.onMediaDetaching=function(){if(!!this.media){self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId);var t=p(this.media.textTracks);t.forEach(function(o){Object(O.clearCurrentCues)(o)}),this.subtitleTrack=-1,this.media=null}},v.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},v.onManifestParsed=function(t,o){this.tracks=o.subtitleTracks},v.onSubtitleTrackLoaded=function(t,o){var u=o.id,d=o.details,n=this.trackId,e=this.tracksInGroup[n];if(!e){this.warn("Invalid subtitle track id "+u);return}var r=e.details;e.details=o.details,this.log("subtitle track "+u+" loaded ["+d.startSN+"-"+d.endSN+"]"),u===this.trackId&&(this.retryCount=0,this.playlistLoaded(u,o,r))},v.onLevelLoading=function(t,o){this.switchLevel(o.level)},v.onLevelSwitching=function(t,o){this.switchLevel(o.level)},v.switchLevel=function(t){var o=this.hls.levels[t];if(!!(o!=null&&o.textGroupIds)){var u=o.textGroupIds[o.urlId];if(this.groupId!==u){var d=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,n=this.tracks.filter(function(m){return!u||m.groupId===u});this.tracksInGroup=n;var e=this.findTrackId(d==null?void 0:d.name)||this.findTrackId();this.groupId=u;var r={subtitleTracks:n};this.log("Updating subtitle tracks, "+n.length+' track(s) found in "'+u+'" group-id'),this.hls.trigger(C.Events.SUBTITLE_TRACKS_UPDATED,r),e!==-1&&this.setSubtitleTrack(e,d)}}},v.findTrackId=function(t){for(var o=this.tracksInGroup,u=0;u<o.length;u++){var d=o[u];if((!this.selectDefaultTrack||d.default)&&(!t||t===d.name))return d.id}return-1},v.onError=function(t,o){E.prototype.onError.call(this,t,o),!(o.fatal||!o.context)&&o.context.type===b.PlaylistContextType.SUBTITLE_TRACK&&o.context.id===this.trackId&&o.context.groupId===this.groupId&&this.retryLoadingOrFail(o)},v.loadPlaylist=function(t){var o=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(o)){var u=o.id,d=o.groupId,n=o.url;if(t)try{n=t.addDirectives(n)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}this.log("Loading subtitle playlist for id "+u),this.hls.trigger(C.Events.SUBTITLE_TRACK_LOADING,{url:n,id:u,groupId:d,deliveryDirectives:t||null})}},v.toggleTrackModes=function(t){var o=this,u=this.media,d=this.trackId;if(!!u){var n=p(u.textTracks),e=n.filter(function(l){return l.groupId===o.groupId});if(t===-1)[].slice.call(n).forEach(function(l){l.mode="disabled"});else{var r=e[d];r&&(r.mode="disabled")}var m=e[t];m&&(m.mode=this.subtitleDisplay?"showing":"hidden")}},v.setSubtitleTrack=function(t,o){var u,d=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=t;return}if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(t===-1||(u=d[t])!==null&&u!==void 0&&u.details)||t<-1||t>=d.length)){this.clearTimer();var n=d[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,n){var e=n.id,r=n.groupId,m=r===void 0?"":r,l=n.name,f=n.type,h=n.url;this.hls.trigger(C.Events.SUBTITLE_TRACK_SWITCH,{id:e,groupId:m,name:l,type:f,url:h});var a=this.switchParams(n.url,o==null?void 0:o.details);this.loadPlaylist(a)}else this.hls.trigger(C.Events.SUBTITLE_TRACK_SWITCH,{id:t})}},v.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!(!this.media||!this.hls.config.renderTextTracksNatively)){for(var t=-1,o=p(this.media.textTracks),u=0;u<o.length;u++)if(o[u].mode==="hidden")t=u;else if(o[u].mode==="showing"){t=u;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},R(c,[{key:"subtitleDisplay",get:function(){return this._subtitleDisplay},set:function(t){this._subtitleDisplay=t,this.trackId>-1&&this.toggleTrackModes(this.trackId)}},{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var o=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,o)}}]),c}(A.default);function p(E){for(var c=[],v=0;v<E.length;v++){var i=E[v];i.kind==="subtitles"&&i.label&&c.push(E[v])}return c}M.default=T},"./src/controller/timeline-controller.ts":function(K,M,S){S.r(M),S.d(M,"TimelineController",function(){return E});var C=S("./src/polyfills/number.ts"),O=S("./src/events.ts"),A=S("./src/utils/cea-608-parser.ts"),b=S("./src/utils/output-filter.ts"),P=S("./src/utils/webvtt-parser.ts"),R=S("./src/utils/texttrack-utils.ts"),x=S("./src/utils/imsc1-ttml-parser.ts"),g=S("./src/utils/mp4-tools.ts"),T=S("./src/types/loader.ts"),p=S("./src/utils/logger.ts"),E=function(){function t(u){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=i(),this.captionsProperties=void 0,this.hls=u,this.config=u.config,this.Cues=u.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var d=new b.default(this,"textTrack1"),n=new b.default(this,"textTrack2"),e=new b.default(this,"textTrack3"),r=new b.default(this,"textTrack4");this.cea608Parser1=new A.default(1,d,n),this.cea608Parser2=new A.default(3,e,r)}u.on(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),u.on(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),u.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),u.on(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),u.on(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),u.on(O.Events.FRAG_LOADING,this.onFragLoading,this),u.on(O.Events.FRAG_LOADED,this.onFragLoaded,this),u.on(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),u.on(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),u.on(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),u.on(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),u.on(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var o=t.prototype;return o.destroy=function(){var d=this.hls;d.off(O.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),d.off(O.Events.MEDIA_DETACHING,this.onMediaDetaching,this),d.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),d.off(O.Events.MANIFEST_LOADED,this.onManifestLoaded,this),d.off(O.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),d.off(O.Events.FRAG_LOADING,this.onFragLoading,this),d.off(O.Events.FRAG_LOADED,this.onFragLoaded,this),d.off(O.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),d.off(O.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),d.off(O.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),d.off(O.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),d.off(O.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},o.addCues=function(d,n,e,r,m){for(var l=!1,f=m.length;f--;){var h=m[f],a=v(h[0],h[1],n,e);if(a>=0&&(h[0]=Math.min(h[0],n),h[1]=Math.max(h[1],e),l=!0,a/(e-n)>.5))return}if(l||m.push([n,e]),this.config.renderTextTracksNatively){var s=this.captionsTracks[d];this.Cues.newCue(s,n,e,r)}else{var y=this.Cues.newCue(null,n,e,r);this.hls.trigger(O.Events.CUES_PARSED,{type:"captions",cues:y,track:d})}},o.onInitPtsFound=function(d,n){var e=this,r=n.frag,m=n.id,l=n.initPTS,f=n.timescale,h=this.unparsedVttFrags;m==="main"&&(this.initPTS[r.cc]=l,this.timescale[r.cc]=f),h.length&&(this.unparsedVttFrags=[],h.forEach(function(a){e.onFragLoaded(O.Events.FRAG_LOADED,a)}))},o.getExistingTrack=function(d){var n=this.media;if(n)for(var e=0;e<n.textTracks.length;e++){var r=n.textTracks[e];if(r[d])return r}return null},o.createCaptionsTrack=function(d){this.config.renderTextTracksNatively?this.createNativeTrack(d):this.createNonNativeTrack(d)},o.createNativeTrack=function(d){if(!this.captionsTracks[d]){var n=this.captionsProperties,e=this.captionsTracks,r=this.media,m=n[d],l=m.label,f=m.languageCode,h=this.getExistingTrack(d);if(h)e[d]=h,Object(R.clearCurrentCues)(e[d]),Object(R.sendAddTrackEvent)(e[d],r);else{var a=this.createTextTrack("captions",l,f);a&&(a[d]=!0,e[d]=a)}}},o.createNonNativeTrack=function(d){if(!this.nonNativeCaptionsTracks[d]){var n=this.captionsProperties[d];if(!!n){var e=n.label,r={_id:d,label:e,kind:"captions",default:n.media?!!n.media.default:!1,closedCaptions:n.media};this.nonNativeCaptionsTracks[d]=r,this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}}},o.createTextTrack=function(d,n,e){var r=this.media;if(!!r)return r.addTextTrack(d,n,e)},o.onMediaAttaching=function(d,n){this.media=n.media,this._cleanTracks()},o.onMediaDetaching=function(){var d=this.captionsTracks;Object.keys(d).forEach(function(n){Object(R.clearCurrentCues)(d[n]),delete d[n]}),this.nonNativeCaptionsTracks={}},o.onManifestLoading=function(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=i(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},o._cleanTracks=function(){var d=this.media;if(!!d){var n=d.textTracks;if(n)for(var e=0;e<n.length;e++)Object(R.clearCurrentCues)(n[e])}},o.onSubtitleTracksUpdated=function(d,n){var e=this;this.textTracks=[];var r=n.subtitleTracks||[],m=r.some(function(a){return a.textCodec===x.IMSC1_CODEC});if(this.config.enableWebVTT||m&&this.config.enableIMSC1){var l=this.tracks&&r&&this.tracks.length===r.length;if(this.tracks=r||[],this.config.renderTextTracksNatively){var f=this.media?this.media.textTracks:[];this.tracks.forEach(function(a,s){var y;if(s<f.length){for(var D=null,L=0;L<f.length;L++)if(c(f[L],a)){D=f[L];break}D&&(y=D)}if(y)Object(R.clearCurrentCues)(y);else{var I=e._captionsOrSubtitlesFromCharacteristics(a);y=e.createTextTrack(I,a.name,a.lang),y&&(y.mode="disabled")}y&&(y.groupId=a.groupId,e.textTracks.push(y))})}else if(!l&&this.tracks&&this.tracks.length){var h=this.tracks.map(function(a){return{label:a.name,kind:a.type.toLowerCase(),default:a.default,subtitleTrack:a}});this.hls.trigger(O.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:h})}}},o._captionsOrSubtitlesFromCharacteristics=function(d){var n;if((n=d.attrs)!==null&&n!==void 0&&n.CHARACTERISTICS){var e=/transcribes-spoken-dialog/gi.test(d.attrs.CHARACTERISTICS),r=/describes-music-and-sound/gi.test(d.attrs.CHARACTERISTICS);if(e&&r)return"captions"}return"subtitles"},o.onManifestLoaded=function(d,n){var e=this;this.config.enableCEA708Captions&&n.captions&&n.captions.forEach(function(r){var m=/(?:CC|SERVICE)([1-4])/.exec(r.instreamId);if(!!m){var l="textTrack"+m[1],f=e.captionsProperties[l];!f||(f.label=r.name,r.lang&&(f.languageCode=r.lang),f.media=r)}})},o.onFragLoading=function(d,n){var e=this.cea608Parser1,r=this.cea608Parser2,m=this.lastSn,l=this.lastPartIndex;if(!(!this.enabled||!(e&&r))&&n.frag.type===T.PlaylistLevelType.MAIN){var f,h,a=n.frag.sn,s=(f=n==null||(h=n.part)===null||h===void 0?void 0:h.index)!=null?f:-1;a===m+1||a===m&&s===l+1||(e.reset(),r.reset()),this.lastSn=a,this.lastPartIndex=s}},o.onFragLoaded=function(d,n){var e=n.frag,r=n.payload,m=this.initPTS,l=this.unparsedVttFrags;if(e.type===T.PlaylistLevelType.SUBTITLE)if(r.byteLength){if(!Object(C.isFiniteNumber)(m[e.cc])){l.push(n),m.length&&this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Missing initial subtitle PTS")});return}var f=e.decryptdata,h="stats"in n;if(f==null||f.key==null||f.method!=="AES-128"||h){var a=this.tracks[e.level],s=this.vttCCs;s[e.cc]||(s[e.cc]={start:e.start,prevCC:this.prevCC,new:!0},this.prevCC=e.cc),a&&a.textCodec===x.IMSC1_CODEC?this._parseIMSC1(e,r):this._parseVTTs(e,r,s)}}else this.hls.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:new Error("Empty subtitle payload")})},o._parseIMSC1=function(d,n){var e=this,r=this.hls;Object(x.parseIMSC1)(n,this.initPTS[d.cc],this.timescale[d.cc],function(m){e._appendCues(m,d.level),r.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:d})},function(m){p.logger.log("Failed to parse IMSC1: "+m),r.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d,error:m})})},o._parseVTTs=function(d,n,e){var r,m=this,l=this.hls,f=(r=d.initSegment)!==null&&r!==void 0&&r.data?Object(g.appendUint8Array)(d.initSegment.data,new Uint8Array(n)):n;Object(P.parseWebVTT)(f,this.initPTS[d.cc],this.timescale[d.cc],e,d.cc,d.start,function(h){m._appendCues(h,d.level),l.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:d})},function(h){m._fallbackToIMSC1(d,n),p.logger.log("Failed to parse VTT cue: "+h),l.trigger(O.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:d,error:h})})},o._fallbackToIMSC1=function(d,n){var e=this,r=this.tracks[d.level];r.textCodec||Object(x.parseIMSC1)(n,this.initPTS[d.cc],this.timescale[d.cc],function(){r.textCodec=x.IMSC1_CODEC,e._parseIMSC1(d,n)},function(){r.textCodec="wvtt"})},o._appendCues=function(d,n){var e=this.hls;if(this.config.renderTextTracksNatively){var r=this.textTracks[n];if(!r||r.mode==="disabled")return;d.forEach(function(f){return Object(R.addCueToTrack)(r,f)})}else{var m=this.tracks[n];if(!m)return;var l=m.default?"default":"subtitles"+n;e.trigger(O.Events.CUES_PARSED,{type:"subtitles",cues:d,track:l})}},o.onFragDecrypted=function(d,n){var e=n.frag;if(e.type===T.PlaylistLevelType.SUBTITLE){if(!Object(C.isFiniteNumber)(this.initPTS[e.cc])){this.unparsedVttFrags.push(n);return}this.onFragLoaded(O.Events.FRAG_LOADED,n)}},o.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},o.onFragParsingUserdata=function(d,n){var e=this.cea608Parser1,r=this.cea608Parser2;if(!(!this.enabled||!(e&&r)))for(var m=0;m<n.samples.length;m++){var l=n.samples[m].bytes;if(l){var f=this.extractCea608Data(l);e.addData(n.samples[m].pts,f[0]),r.addData(n.samples[m].pts,f[1])}}},o.onBufferFlushing=function(d,n){var e=n.startOffset,r=n.endOffset,m=n.endOffsetSubtitles,l=n.type,f=this.media;if(!(!f||f.currentTime<r)){if(!l||l==="video"){var h=this.captionsTracks;Object.keys(h).forEach(function(s){return Object(R.removeCuesInRange)(h[s],e,r)})}if(this.config.renderTextTracksNatively&&e===0&&m!==void 0){var a=this.textTracks;Object.keys(a).forEach(function(s){return Object(R.removeCuesInRange)(a[s],e,m)})}}},o.extractCea608Data=function(d){for(var n=[[],[]],e=d[0]&31,r=2,m=0;m<e;m++){var l=d[r++],f=127&d[r++],h=127&d[r++];if(!(f===0&&h===0)){var a=(4&l)!==0;if(a){var s=3&l;(s===0||s===1)&&(n[s].push(f),n[s].push(h))}}}return n},t}();function c(t,o){return t&&t.label===o.name&&!(t.textTrack1||t.textTrack2)}function v(t,o,u,d){return Math.min(o,d)-Math.max(t,u)}function i(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}}}},"./src/crypt/aes-crypto.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return C});var C=function(){function O(b,P){this.subtle=void 0,this.aesIV=void 0,this.subtle=b,this.aesIV=P}var A=O.prototype;return A.decrypt=function(P,R){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},R,P)},O}()},"./src/crypt/aes-decryptor.ts":function(K,M,S){S.r(M),S.d(M,"removePadding",function(){return O}),S.d(M,"default",function(){return A});var C=S("./src/utils/typed-array.ts");function O(b){var P=b.byteLength,R=P&&new DataView(b.buffer).getUint8(P-1);return R?Object(C.sliceUint8)(b,0,P-R):b}var A=function(){function b(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var P=b.prototype;return P.uint8ArrayToUint32Array_=function(x){for(var g=new DataView(x),T=new Uint32Array(4),p=0;p<4;p++)T[p]=g.getUint32(p*4);return T},P.initTable=function(){var x=this.sBox,g=this.invSBox,T=this.subMix,p=T[0],E=T[1],c=T[2],v=T[3],i=this.invSubMix,t=i[0],o=i[1],u=i[2],d=i[3],n=new Uint32Array(256),e=0,r=0,m=0;for(m=0;m<256;m++)m<128?n[m]=m<<1:n[m]=m<<1^283;for(m=0;m<256;m++){var l=r^r<<1^r<<2^r<<3^r<<4;l=l>>>8^l&255^99,x[e]=l,g[l]=e;var f=n[e],h=n[f],a=n[h],s=n[l]*257^l*16843008;p[e]=s<<24|s>>>8,E[e]=s<<16|s>>>16,c[e]=s<<8|s>>>24,v[e]=s,s=a*16843009^h*65537^f*257^e*16843008,t[l]=s<<24|s>>>8,o[l]=s<<16|s>>>16,u[l]=s<<8|s>>>24,d[l]=s,e?(e=f^n[n[n[a^f]]],r^=n[n[r]]):e=r=1}},P.expandKey=function(x){for(var g=this.uint8ArrayToUint32Array_(x),T=!0,p=0;p<g.length&&T;)T=g[p]===this.key[p],p++;if(!T){this.key=g;var E=this.keySize=g.length;if(E!==4&&E!==6&&E!==8)throw new Error("Invalid aes key size="+E);var c=this.ksRows=(E+6+1)*4,v,i,t=this.keySchedule=new Uint32Array(c),o=this.invKeySchedule=new Uint32Array(c),u=this.sBox,d=this.rcon,n=this.invSubMix,e=n[0],r=n[1],m=n[2],l=n[3],f,h;for(v=0;v<c;v++){if(v<E){f=t[v]=g[v];continue}h=f,v%E===0?(h=h<<8|h>>>24,h=u[h>>>24]<<24|u[h>>>16&255]<<16|u[h>>>8&255]<<8|u[h&255],h^=d[v/E|0]<<24):E>6&&v%E===4&&(h=u[h>>>24]<<24|u[h>>>16&255]<<16|u[h>>>8&255]<<8|u[h&255]),t[v]=f=(t[v-E]^h)>>>0}for(i=0;i<c;i++)v=c-i,i&3?h=t[v]:h=t[v-4],i<4||v<=4?o[i]=h:o[i]=e[u[h>>>24]]^r[u[h>>>16&255]]^m[u[h>>>8&255]]^l[u[h&255]],o[i]=o[i]>>>0}},P.networkToHostOrderSwap=function(x){return x<<24|(x&65280)<<8|(x&16711680)>>8|x>>>24},P.decrypt=function(x,g,T){for(var p=this.keySize+6,E=this.invKeySchedule,c=this.invSBox,v=this.invSubMix,i=v[0],t=v[1],o=v[2],u=v[3],d=this.uint8ArrayToUint32Array_(T),n=d[0],e=d[1],r=d[2],m=d[3],l=new Int32Array(x),f=new Int32Array(l.length),h,a,s,y,D,L,I,_,F,B,U,N,k,w,W=this.networkToHostOrderSwap;g<l.length;){for(F=W(l[g]),B=W(l[g+1]),U=W(l[g+2]),N=W(l[g+3]),D=F^E[0],L=N^E[1],I=U^E[2],_=B^E[3],k=4,w=1;w<p;w++)h=i[D>>>24]^t[L>>16&255]^o[I>>8&255]^u[_&255]^E[k],a=i[L>>>24]^t[I>>16&255]^o[_>>8&255]^u[D&255]^E[k+1],s=i[I>>>24]^t[_>>16&255]^o[D>>8&255]^u[L&255]^E[k+2],y=i[_>>>24]^t[D>>16&255]^o[L>>8&255]^u[I&255]^E[k+3],D=h,L=a,I=s,_=y,k=k+4;h=c[D>>>24]<<24^c[L>>16&255]<<16^c[I>>8&255]<<8^c[_&255]^E[k],a=c[L>>>24]<<24^c[I>>16&255]<<16^c[_>>8&255]<<8^c[D&255]^E[k+1],s=c[I>>>24]<<24^c[_>>16&255]<<16^c[D>>8&255]<<8^c[L&255]^E[k+2],y=c[_>>>24]<<24^c[D>>16&255]<<16^c[L>>8&255]<<8^c[I&255]^E[k+3],f[g]=W(h^n),f[g+1]=W(y^e),f[g+2]=W(s^r),f[g+3]=W(a^m),n=F,e=B,r=U,m=N,g=g+4}return f.buffer},b}()},"./src/crypt/decrypter.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return g});var C=S("./src/crypt/aes-crypto.ts"),O=S("./src/crypt/fast-aes-key.ts"),A=S("./src/crypt/aes-decryptor.ts"),b=S("./src/utils/logger.ts"),P=S("./src/utils/mp4-tools.ts"),R=S("./src/utils/typed-array.ts"),x=16,g=function(){function T(E,c,v){var i=v===void 0?{}:v,t=i.removePKCS7Padding,o=t===void 0?!0:t;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=E,this.config=c,this.removePKCS7Padding=o,o)try{var u=self.crypto;u&&(this.subtle=u.subtle||u.webkitSubtle)}catch{}this.subtle===null&&(this.config.enableSoftwareAES=!0)}var p=T.prototype;return p.destroy=function(){this.observer=null},p.isSync=function(){return this.config.enableSoftwareAES},p.flush=function(){var c=this.currentResult;if(!c){this.reset();return}var v=new Uint8Array(c);return this.reset(),this.removePKCS7Padding?Object(A.removePadding)(v):v},p.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},p.decrypt=function(c,v,i,t){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(c),v,i);var o=this.flush();o&&t(o.buffer)}else this.webCryptoDecrypt(new Uint8Array(c),v,i).then(t)},p.softwareDecrypt=function(c,v,i){var t=this.currentIV,o=this.currentResult,u=this.remainderData;this.logOnce("JS AES decrypt"),u&&(c=Object(P.appendUint8Array)(u,c),this.remainderData=null);var d=this.getValidChunk(c);if(!d.length)return null;t&&(i=t);var n=this.softwareDecrypter;n||(n=this.softwareDecrypter=new A.default),n.expandKey(v);var e=o;return this.currentResult=n.decrypt(d.buffer,0,i),this.currentIV=Object(R.sliceUint8)(d,-16).buffer,e||null},p.webCryptoDecrypt=function(c,v,i){var t=this,o=this.subtle;return(this.key!==v||!this.fastAesKey)&&(this.key=v,this.fastAesKey=new O.default(o,v)),this.fastAesKey.expandKey().then(function(u){if(!o)return Promise.reject(new Error("web crypto not initialized"));var d=new C.default(o,i);return d.decrypt(c.buffer,u)}).catch(function(u){return t.onWebCryptoError(u,c,v,i)})},p.onWebCryptoError=function(c,v,i,t){return b.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",c),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(v,i,t)},p.getValidChunk=function(c){var v=c,i=c.length-c.length%x;return i!==c.length&&(v=Object(R.sliceUint8)(c,0,i),this.remainderData=Object(R.sliceUint8)(c,i)),v},p.logOnce=function(c){!this.logEnabled||(b.logger.log("[decrypter.ts]: "+c),this.logEnabled=!1)},T}()},"./src/crypt/fast-aes-key.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return C});var C=function(){function O(b,P){this.subtle=void 0,this.key=void 0,this.subtle=b,this.key=P}var A=O.prototype;return A.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},O}()},"./src/demux/aacdemuxer.ts":function(K,M,S){S.r(M);var C=S("./src/demux/base-audio-demuxer.ts"),O=S("./src/demux/adts.ts"),A=S("./src/utils/logger.ts"),b=S("./src/demux/id3.ts");function P(g,T){g.prototype=Object.create(T.prototype),g.prototype.constructor=g,R(g,T)}function R(g,T){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,c){return E.__proto__=c,E},R(g,T)}var x=function(g){P(T,g);function T(E,c){var v;return v=g.call(this)||this,v.observer=void 0,v.config=void 0,v.observer=E,v.config=c,v}var p=T.prototype;return p.resetInitSegment=function(c,v,i,t){g.prototype.resetInitSegment.call(this,c,v,i,t),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:v,duration:t,inputTimeScale:9e4,dropped:0}},T.probe=function(c){if(!c)return!1;for(var v=b.getID3Data(c,0)||[],i=v.length,t=c.length;i<t;i++)if(O.probe(c,i))return A.logger.log("ADTS sync word found !"),!0;return!1},p.canParse=function(c,v){return O.canParse(c,v)},p.appendFrame=function(c,v,i){O.initTrackConfig(c,this.observer,v,i,c.manifestCodec);var t=O.appendFrame(c,v,i,this.basePTS,this.frameIndex);if(t&&t.missing===0)return t},T}(C.default);x.minProbeByteLength=9,M.default=x},"./src/demux/adts.ts":function(K,M,S){S.r(M),S.d(M,"getAudioConfig",function(){return b}),S.d(M,"isHeaderPattern",function(){return P}),S.d(M,"getHeaderLength",function(){return R}),S.d(M,"getFullFrameLength",function(){return x}),S.d(M,"canGetFrameLength",function(){return g}),S.d(M,"isHeader",function(){return T}),S.d(M,"canParse",function(){return p}),S.d(M,"probe",function(){return E}),S.d(M,"initTrackConfig",function(){return c}),S.d(M,"getFrameDuration",function(){return v}),S.d(M,"parseFrameHeader",function(){return i}),S.d(M,"appendFrame",function(){return t});var C=S("./src/utils/logger.ts"),O=S("./src/errors.ts"),A=S("./src/events.ts");function b(o,u,d,n){var e,r,m,l,f=navigator.userAgent.toLowerCase(),h=n,a=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];e=((u[d+2]&192)>>>6)+1;var s=(u[d+2]&60)>>>2;if(s>a.length-1){o.trigger(A.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+s});return}return m=(u[d+2]&1)<<2,m|=(u[d+3]&192)>>>6,C.logger.log("manifest codec:"+n+", ADTS type:"+e+", samplingIndex:"+s),/firefox/i.test(f)?s>=6?(e=5,l=new Array(4),r=s-3):(e=2,l=new Array(2),r=s):f.indexOf("android")!==-1?(e=2,l=new Array(2),r=s):(e=5,l=new Array(4),n&&(n.indexOf("mp4a.40.29")!==-1||n.indexOf("mp4a.40.5")!==-1)||!n&&s>=6?r=s-3:((n&&n.indexOf("mp4a.40.2")!==-1&&(s>=6&&m===1||/vivaldi/i.test(f))||!n&&m===1)&&(e=2,l=new Array(2)),r=s)),l[0]=e<<3,l[0]|=(s&14)>>1,l[1]|=(s&1)<<7,l[1]|=m<<3,e===5&&(l[1]|=(r&14)>>1,l[2]=(r&1)<<7,l[2]|=2<<2,l[3]=0),{config:l,samplerate:a[s],channelCount:m,codec:"mp4a.40."+e,manifestCodec:h}}function P(o,u){return o[u]===255&&(o[u+1]&246)===240}function R(o,u){return o[u+1]&1?7:9}function x(o,u){return(o[u+3]&3)<<11|o[u+4]<<3|(o[u+5]&224)>>>5}function g(o,u){return u+5<o.length}function T(o,u){return u+1<o.length&&P(o,u)}function p(o,u){return g(o,u)&&P(o,u)&&x(o,u)<=o.length-u}function E(o,u){if(T(o,u)){var d=R(o,u);if(u+d>=o.length)return!1;var n=x(o,u);if(n<=d)return!1;var e=u+n;return e===o.length||T(o,e)}return!1}function c(o,u,d,n,e){if(!o.samplerate){var r=b(u,d,n,e);if(!r)return;o.config=r.config,o.samplerate=r.samplerate,o.channelCount=r.channelCount,o.codec=r.codec,o.manifestCodec=r.manifestCodec,C.logger.log("parsed codec:"+o.codec+", rate:"+r.samplerate+", channels:"+r.channelCount)}}function v(o){return 1024*9e4/o}function i(o,u){var d=R(o,u);if(u+d<=o.length){var n=x(o,u)-d;if(n>0)return{headerLength:d,frameLength:n}}}function t(o,u,d,n,e){var r=v(o.samplerate),m=n+e*r,l=i(u,d),f;if(l){var h=l.frameLength,a=l.headerLength,s=a+h,y=Math.max(0,d+s-u.length);y?(f=new Uint8Array(s-a),f.set(u.subarray(d+a,u.length),0)):f=u.subarray(d+a,d+s);var D={unit:f,pts:m};return y||o.samples.push(D),{sample:D,length:s,missing:y}}var L=u.length-d;f=new Uint8Array(L),f.set(u.subarray(d,u.length),0);var I={unit:f,pts:m};return{sample:I,length:L,missing:-1}}},"./src/demux/base-audio-demuxer.ts":function(K,M,S){S.r(M),S.d(M,"initPTSFn",function(){return g});var C=S("./src/polyfills/number.ts"),O=S("./src/demux/id3.ts"),A=S("./src/types/demuxer.ts"),b=S("./src/demux/dummy-demuxed-track.ts"),P=S("./src/utils/mp4-tools.ts"),R=S("./src/utils/typed-array.ts"),x=function(){function T(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null}var p=T.prototype;return p.resetInitSegment=function(c,v,i,t){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},p.resetTimeStamp=function(c){this.initPTS=c,this.resetContiguity()},p.resetContiguity=function(){this.basePTS=null,this.frameIndex=0},p.canParse=function(c,v){return!1},p.appendFrame=function(c,v,i){},p.demux=function(c,v){this.cachedData&&(c=Object(P.appendUint8Array)(this.cachedData,c),this.cachedData=null);var i=O.getID3Data(c,0),t=i?i.length:0,o,u,d=this._audioTrack,n=this._id3Track,e=i?O.getTimeStamp(i):void 0,r=c.length;for((this.basePTS===null||this.frameIndex===0&&Object(C.isFiniteNumber)(e))&&(this.basePTS=g(e,v,this.initPTS)),i&&i.length>0&&n.samples.push({pts:this.basePTS,dts:this.basePTS,data:i,type:A.MetadataSchema.audioId3}),u=this.basePTS;t<r;){if(this.canParse(c,t)){var m=this.appendFrame(d,c,t);m?(this.frameIndex++,u=m.sample.pts,t+=m.length,o=t):t=r}else O.canParse(c,t)?(i=O.getID3Data(c,t),n.samples.push({pts:u,dts:u,data:i,type:A.MetadataSchema.audioId3}),t+=i.length,o=t):t++;if(t===r&&o!==r){var l=Object(R.sliceUint8)(c,o);this.cachedData?this.cachedData=Object(P.appendUint8Array)(this.cachedData,l):this.cachedData=l}}return{audioTrack:d,videoTrack:Object(b.dummyTrack)(),id3Track:n,textTrack:Object(b.dummyTrack)()}},p.demuxSampleAes=function(c,v,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},p.flush=function(c){var v=this.cachedData;return v&&(this.cachedData=null,this.demux(v,0)),{audioTrack:this._audioTrack,videoTrack:Object(b.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(b.dummyTrack)()}},p.destroy=function(){},T}(),g=function(p,E,c){return Object(C.isFiniteNumber)(p)?p*90:E*9e4+(c||0)};M.default=x},"./src/demux/chunk-cache.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return C});var C=function(){function A(){this.chunks=[],this.dataLength=0}var b=A.prototype;return b.push=function(R){this.chunks.push(R),this.dataLength+=R.length},b.flush=function(){var R=this.chunks,x=this.dataLength,g;if(R.length)R.length===1?g=R[0]:g=O(R,x);else return new Uint8Array(0);return this.reset(),g},b.reset=function(){this.chunks.length=0,this.dataLength=0},A}();function O(A,b){for(var P=new Uint8Array(b),R=0,x=0;x<A.length;x++){var g=A[x];P.set(g,R),R+=g.length}return P}},"./src/demux/dummy-demuxed-track.ts":function(K,M,S){S.r(M),S.d(M,"dummyTrack",function(){return C});function C(O,A){return O===void 0&&(O=""),A===void 0&&(A=9e4),{type:O,id:-1,pid:-1,inputTimeScale:A,sequenceNumber:-1,samples:[],dropped:0}}},"./src/demux/exp-golomb.ts":function(K,M,S){S.r(M);var C=S("./src/utils/logger.ts"),O=function(){function A(P){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=P,this.bytesAvailable=P.byteLength,this.word=0,this.bitsAvailable=0}var b=A.prototype;return b.loadWord=function(){var R=this.data,x=this.bytesAvailable,g=R.byteLength-x,T=new Uint8Array(4),p=Math.min(4,x);if(p===0)throw new Error("no bytes available");T.set(R.subarray(g,g+p)),this.word=new DataView(T.buffer).getUint32(0),this.bitsAvailable=p*8,this.bytesAvailable-=p},b.skipBits=function(R){var x;this.bitsAvailable>R?(this.word<<=R,this.bitsAvailable-=R):(R-=this.bitsAvailable,x=R>>3,R-=x>>3,this.bytesAvailable-=x,this.loadWord(),this.word<<=R,this.bitsAvailable-=R)},b.readBits=function(R){var x=Math.min(this.bitsAvailable,R),g=this.word>>>32-x;return R>32&&C.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=x,this.bitsAvailable>0?this.word<<=x:this.bytesAvailable>0&&this.loadWord(),x=R-x,x>0&&this.bitsAvailable?g<<x|this.readBits(x):g},b.skipLZ=function(){var R;for(R=0;R<this.bitsAvailable;++R)if((this.word&2147483648>>>R)!==0)return this.word<<=R,this.bitsAvailable-=R,R;return this.loadWord(),R+this.skipLZ()},b.skipUEG=function(){this.skipBits(1+this.skipLZ())},b.skipEG=function(){this.skipBits(1+this.skipLZ())},b.readUEG=function(){var R=this.skipLZ();return this.readBits(R+1)-1},b.readEG=function(){var R=this.readUEG();return 1&R?1+R>>>1:-1*(R>>>1)},b.readBoolean=function(){return this.readBits(1)===1},b.readUByte=function(){return this.readBits(8)},b.readUShort=function(){return this.readBits(16)},b.readUInt=function(){return this.readBits(32)},b.skipScalingList=function(R){for(var x=8,g=8,T,p=0;p<R;p++)g!==0&&(T=this.readEG(),g=(x+T+256)%256),x=g===0?x:g},b.readSPS=function(){var R=0,x=0,g=0,T=0,p,E,c,v=this.readUByte.bind(this),i=this.readBits.bind(this),t=this.readUEG.bind(this),o=this.readBoolean.bind(this),u=this.skipBits.bind(this),d=this.skipEG.bind(this),n=this.skipUEG.bind(this),e=this.skipScalingList.bind(this);v();var r=v();if(i(5),u(3),v(),n(),r===100||r===110||r===122||r===244||r===44||r===83||r===86||r===118||r===128){var m=t();if(m===3&&u(1),n(),n(),u(1),o())for(E=m!==3?8:12,c=0;c<E;c++)o()&&(c<6?e(16):e(64))}n();var l=t();if(l===0)t();else if(l===1)for(u(1),d(),d(),p=t(),c=0;c<p;c++)d();n(),u(1);var f=t(),h=t(),a=i(1);a===0&&u(1),u(1),o()&&(R=t(),x=t(),g=t(),T=t());var s=[1,1];if(o()&&o()){var y=v();switch(y){case 1:s=[1,1];break;case 2:s=[12,11];break;case 3:s=[10,11];break;case 4:s=[16,11];break;case 5:s=[40,33];break;case 6:s=[24,11];break;case 7:s=[20,11];break;case 8:s=[32,11];break;case 9:s=[80,33];break;case 10:s=[18,11];break;case 11:s=[15,11];break;case 12:s=[64,33];break;case 13:s=[160,99];break;case 14:s=[4,3];break;case 15:s=[3,2];break;case 16:s=[2,1];break;case 255:{s=[v()<<8|v(),v()<<8|v()];break}}}return{width:Math.ceil((f+1)*16-R*2-x*2),height:(2-a)*(h+1)*16-(a?2:4)*(g+T),pixelRatio:s}},b.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},A}();M.default=O},"./src/demux/id3.ts":function(K,M,S){S.r(M),S.d(M,"isHeader",function(){return C}),S.d(M,"isFooter",function(){return O}),S.d(M,"getID3Data",function(){return A}),S.d(M,"canParse",function(){return P}),S.d(M,"getTimeStamp",function(){return R}),S.d(M,"isTimeStampFrame",function(){return x}),S.d(M,"getID3Frames",function(){return T}),S.d(M,"decodeFrame",function(){return p}),S.d(M,"utf8ArrayToStr",function(){return t}),S.d(M,"testables",function(){return o});var C=function(e,r){return r+10<=e.length&&e[r]===73&&e[r+1]===68&&e[r+2]===51&&e[r+3]<255&&e[r+4]<255&&e[r+6]<128&&e[r+7]<128&&e[r+8]<128&&e[r+9]<128},O=function(e,r){return r+10<=e.length&&e[r]===51&&e[r+1]===68&&e[r+2]===73&&e[r+3]<255&&e[r+4]<255&&e[r+6]<128&&e[r+7]<128&&e[r+8]<128&&e[r+9]<128},A=function(e,r){for(var m=r,l=0;C(e,r);){l+=10;var f=b(e,r+6);l+=f,O(e,r+10)&&(l+=10),r+=l}if(l>0)return e.subarray(m,m+l)},b=function(e,r){var m=0;return m=(e[r]&127)<<21,m|=(e[r+1]&127)<<14,m|=(e[r+2]&127)<<7,m|=e[r+3]&127,m},P=function(e,r){return C(e,r)&&b(e,r+6)+10<=e.length-r},R=function(e){for(var r=T(e),m=0;m<r.length;m++){var l=r[m];if(x(l))return i(l)}},x=function(e){return e&&e.key==="PRIV"&&e.info==="com.apple.streaming.transportStreamTimestamp"},g=function(e){var r=String.fromCharCode(e[0],e[1],e[2],e[3]),m=b(e,4),l=10;return{type:r,size:m,data:e.subarray(l,l+m)}},T=function(e){for(var r=0,m=[];C(e,r);){var l=b(e,r+6);r+=10;for(var f=r+l;r+8<f;){var h=g(e.subarray(r)),a=p(h);a&&m.push(a),r+=h.size+10}O(e,r)&&(r+=10)}return m},p=function(e){return e.type==="PRIV"?E(e):e.type[0]==="W"?v(e):c(e)},E=function(e){if(!(e.size<2)){var r=t(e.data,!0),m=new Uint8Array(e.data.subarray(r.length+1));return{key:e.type,info:r,data:m.buffer}}},c=function(e){if(!(e.size<2)){if(e.type==="TXXX"){var r=1,m=t(e.data.subarray(r),!0);r+=m.length+1;var l=t(e.data.subarray(r));return{key:e.type,info:m,data:l}}var f=t(e.data.subarray(1));return{key:e.type,data:f}}},v=function(e){if(e.type==="WXXX"){if(e.size<2)return;var r=1,m=t(e.data.subarray(r),!0);r+=m.length+1;var l=t(e.data.subarray(r));return{key:e.type,info:m,data:l}}var f=t(e.data);return{key:e.type,data:f}},i=function(e){if(e.data.byteLength===8){var r=new Uint8Array(e.data),m=r[3]&1,l=(r[4]<<23)+(r[5]<<15)+(r[6]<<7)+r[7];return l/=45,m&&(l+=4772185884e-2),Math.round(l)}},t=function(e,r){r===void 0&&(r=!1);var m=d();if(m){var l=m.decode(e);if(r){var f=l.indexOf("\0");return f!==-1?l.substring(0,f):l}return l.replace(/\0/g,"")}for(var h=e.length,a,s,y,D="",L=0;L<h;){if(a=e[L++],a===0&&r)return D;if(a===0||a===3)continue;switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:D+=String.fromCharCode(a);break;case 12:case 13:s=e[L++],D+=String.fromCharCode((a&31)<<6|s&63);break;case 14:s=e[L++],y=e[L++],D+=String.fromCharCode((a&15)<<12|(s&63)<<6|(y&63)<<0);break}}return D},o={decodeTextFrame:c},u;function d(){return!u&&typeof self.TextDecoder<"u"&&(u=new self.TextDecoder("utf-8")),u}},"./src/demux/mp3demuxer.ts":function(K,M,S){S.r(M);var C=S("./src/demux/base-audio-demuxer.ts"),O=S("./src/demux/id3.ts"),A=S("./src/utils/logger.ts"),b=S("./src/demux/mpegaudio.ts");function P(g,T){g.prototype=Object.create(T.prototype),g.prototype.constructor=g,R(g,T)}function R(g,T){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(E,c){return E.__proto__=c,E},R(g,T)}var x=function(g){P(T,g);function T(){return g.apply(this,arguments)||this}var p=T.prototype;return p.resetInitSegment=function(c,v,i,t){g.prototype.resetInitSegment.call(this,c,v,i,t),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:v,duration:t,inputTimeScale:9e4,dropped:0}},T.probe=function(c){if(!c)return!1;for(var v=O.getID3Data(c,0)||[],i=v.length,t=c.length;i<t;i++)if(b.probe(c,i))return A.logger.log("MPEG Audio sync word found !"),!0;return!1},p.canParse=function(c,v){return b.canParse(c,v)},p.appendFrame=function(c,v,i){if(this.basePTS!==null)return b.appendFrame(c,v,i,this.basePTS,this.frameIndex)},T}(C.default);x.minProbeByteLength=4,M.default=x},"./src/demux/mp4demuxer.ts":function(K,M,S){S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/types/demuxer.ts"),A=S("./src/utils/mp4-tools.ts"),b=S("./src/demux/dummy-demuxed-track.ts"),P=/\/emsg[-/]ID3/i,R=function(){function x(T,p){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=p}var g=x.prototype;return g.resetTimeStamp=function(){},g.resetInitSegment=function(p,E,c,v){var i=Object(A.parseInitSegment)(p),t=this.videoTrack=Object(b.dummyTrack)("video",1),o=this.audioTrack=Object(b.dummyTrack)("audio",1),u=this.txtTrack=Object(b.dummyTrack)("text",1);if(this.id3Track=Object(b.dummyTrack)("id3",1),this.timeOffset=0,i.video){var d=i.video,n=d.id,e=d.timescale,r=d.codec;t.id=n,t.timescale=u.timescale=e,t.codec=r}if(i.audio){var m=i.audio,l=m.id,f=m.timescale,h=m.codec;o.id=l,o.timescale=f,o.codec=h}u.id=A.RemuxerTrackIdConfig.text,t.sampleDuration=0,t.duration=o.duration=v},g.resetContiguity=function(){},x.probe=function(p){return p=p.length>16384?p.subarray(0,16384):p,Object(A.findBox)(p,["moof"]).length>0},g.demux=function(p,E){this.timeOffset=E;var c=p,v=this.videoTrack,i=this.txtTrack;if(this.config.progressive){this.remainderData&&(c=Object(A.appendUint8Array)(this.remainderData,p));var t=Object(A.segmentValidRange)(c);this.remainderData=t.remainder,v.samples=t.valid||new Uint8Array}else v.samples=c;var o=this.extractID3Track(v,E);return i.samples=Object(A.parseSamples)(E,v),{videoTrack:v,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}},g.flush=function(){var p=this.timeOffset,E=this.videoTrack,c=this.txtTrack;E.samples=this.remainderData||new Uint8Array,this.remainderData=null;var v=this.extractID3Track(E,this.timeOffset);return c.samples=Object(A.parseSamples)(p,E),{videoTrack:E,audioTrack:Object(b.dummyTrack)(),id3Track:v,textTrack:Object(b.dummyTrack)()}},g.extractID3Track=function(p,E){var c=this.id3Track;if(p.samples.length){var v=Object(A.findBox)(p.samples,["emsg"]);v&&v.forEach(function(i){var t=Object(A.parseEmsg)(i);if(P.test(t.schemeIdUri)){var o=Object(C.isFiniteNumber)(t.presentationTime)?t.presentationTime/t.timeScale:E+t.presentationTimeDelta/t.timeScale,u=t.payload;c.samples.push({data:u,len:u.byteLength,dts:o,pts:o,type:O.MetadataSchema.emsg})}})}return c},g.demuxSampleAes=function(p,E,c){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},g.destroy=function(){},x}();R.minProbeByteLength=1024,M.default=R},"./src/demux/mpegaudio.ts":function(K,M,S){S.r(M),S.d(M,"appendFrame",function(){return R}),S.d(M,"parseHeader",function(){return x}),S.d(M,"isHeaderPattern",function(){return g}),S.d(M,"isHeader",function(){return T}),S.d(M,"canParse",function(){return p}),S.d(M,"probe",function(){return E});var C=null,O=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],A=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],b=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],P=[0,1,1,4];function R(c,v,i,t,o){if(!(i+24>v.length)){var u=x(v,i);if(u&&i+u.frameLength<=v.length){var d=u.samplesPerFrame*9e4/u.sampleRate,n=t+o*d,e={unit:v.subarray(i,i+u.frameLength),pts:n,dts:n};return c.config=[],c.channelCount=u.channelCount,c.samplerate=u.sampleRate,c.samples.push(e),{sample:e,length:u.frameLength,missing:0}}}}function x(c,v){var i=c[v+1]>>3&3,t=c[v+1]>>1&3,o=c[v+2]>>4&15,u=c[v+2]>>2&3;if(i!==1&&o!==0&&o!==15&&u!==3){var d=c[v+2]>>1&1,n=c[v+3]>>6,e=i===3?3-t:t===3?3:4,r=O[e*14+o-1]*1e3,m=i===3?0:i===2?1:2,l=A[m*3+u],f=n===3?1:2,h=b[i][t],a=P[t],s=h*8*a,y=Math.floor(h*r/l+d)*a;if(C===null){var D=navigator.userAgent||"",L=D.match(/Chrome\/(\d+)/i);C=L?parseInt(L[1]):0}var I=!!C&&C<=87;return I&&t===2&&r>=224e3&&n===0&&(c[v+3]=c[v+3]|128),{sampleRate:l,channelCount:f,frameLength:y,samplesPerFrame:s}}}function g(c,v){return c[v]===255&&(c[v+1]&224)===224&&(c[v+1]&6)!==0}function T(c,v){return v+1<c.length&&g(c,v)}function p(c,v){var i=4;return g(c,v)&&i<=c.length-v}function E(c,v){if(v+1<c.length&&g(c,v)){var i=4,t=x(c,v),o=i;t!=null&&t.frameLength&&(o=t.frameLength);var u=v+o;return u===c.length||T(c,u)}return!1}},"./src/demux/sample-aes.ts":function(K,M,S){S.r(M);var C=S("./src/crypt/decrypter.ts"),O=S("./src/demux/tsdemuxer.ts"),A=function(){function b(R,x,g){this.keyData=void 0,this.decrypter=void 0,this.keyData=g,this.decrypter=new C.default(R,x,{removePKCS7Padding:!1})}var P=b.prototype;return P.decryptBuffer=function(x,g){this.decrypter.decrypt(x,this.keyData.key.buffer,this.keyData.iv.buffer,g)},P.decryptAacSample=function(x,g,T,p){var E=x[g].unit;if(!(E.length<=16)){var c=E.subarray(16,E.length-E.length%16),v=c.buffer.slice(c.byteOffset,c.byteOffset+c.length),i=this;this.decryptBuffer(v,function(t){var o=new Uint8Array(t);E.set(o,16),p||i.decryptAacSamples(x,g+1,T)})}},P.decryptAacSamples=function(x,g,T){for(;;g++){if(g>=x.length){T();return}if(!(x[g].unit.length<32)){var p=this.decrypter.isSync();if(this.decryptAacSample(x,g,T,p),!p)return}}},P.getAvcEncryptedData=function(x){for(var g=Math.floor((x.length-48)/160)*16+16,T=new Int8Array(g),p=0,E=32;E<x.length-16;E+=160,p+=16)T.set(x.subarray(E,E+16),p);return T},P.getAvcDecryptedUnit=function(x,g){for(var T=new Uint8Array(g),p=0,E=32;E<x.length-16;E+=160,p+=16)x.set(T.subarray(p,p+16),E);return x},P.decryptAvcSample=function(x,g,T,p,E,c){var v=Object(O.discardEPB)(E.data),i=this.getAvcEncryptedData(v),t=this;this.decryptBuffer(i.buffer,function(o){E.data=t.getAvcDecryptedUnit(v,o),c||t.decryptAvcSamples(x,g,T+1,p)})},P.decryptAvcSamples=function(x,g,T,p){if(x instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;g++,T=0){if(g>=x.length){p();return}for(var E=x[g].units;!(T>=E.length);T++){var c=E[T];if(!(c.data.length<=48||c.type!==1&&c.type!==5)){var v=this.decrypter.isSync();if(this.decryptAvcSample(x,g,T,p,c,v),!v)return}}}},b}();M.default=A},"./src/demux/transmuxer-interface.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return T});var C=S("./node_modules/webworkify-webpack/index.js"),O=S("./src/events.ts"),A=S("./src/demux/transmuxer.ts"),b=S("./src/utils/logger.ts"),P=S("./src/errors.ts"),R=S("./src/utils/mediasource-helper.ts"),x=S("./node_modules/eventemitter3/index.js"),g=Object(R.getMediaSource)()||{isTypeSupported:function(){return!1}},T=function(){function p(c,v,i,t){var o=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=c,this.id=v,this.onTransmuxComplete=i,this.onFlush=t;var u=c.config,d=function(l,f){f=f||{},f.frag=o.frag,f.id=o.id,c.trigger(l,f)};this.observer=new x.EventEmitter,this.observer.on(O.Events.FRAG_DECRYPTED,d),this.observer.on(O.Events.ERROR,d);var n={mp4:g.isTypeSupported("video/mp4"),mpeg:g.isTypeSupported("audio/mpeg"),mp3:g.isTypeSupported('audio/mp4; codecs="mp3"')},e=navigator.vendor;if(u.enableWorker&&typeof Worker<"u"){b.logger.log("demuxing in webworker");var r;try{r=this.worker=C("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),r.addEventListener("message",this.onwmsg),r.onerror=function(m){c.trigger(O.Events.ERROR,{type:P.ErrorTypes.OTHER_ERROR,details:P.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(m.message+"  ("+m.filename+":"+m.lineno+")")})},r.postMessage({cmd:"init",typeSupported:n,vendor:e,id:v,config:JSON.stringify(u)})}catch(m){b.logger.warn("Error in worker:",m),b.logger.error("Error while initializing DemuxerWorker, fallback to inline"),r&&self.URL.revokeObjectURL(r.objectURL),this.transmuxer=new A.default(this.observer,n,u,e,v),this.worker=null}}else this.transmuxer=new A.default(this.observer,n,u,e,v)}var E=p.prototype;return E.destroy=function(){var v=this.worker;if(v)v.removeEventListener("message",this.onwmsg),v.terminate(),this.worker=null,this.onwmsg=void 0;else{var i=this.transmuxer;i&&(i.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},E.push=function(v,i,t,o,u,d,n,e,r,m){var l,f,h=this;r.transmuxing.start=self.performance.now();var a=this.transmuxer,s=this.worker,y=d?d.start:u.start,D=u.decryptdata,L=this.frag,I=!(L&&u.cc===L.cc),_=!(L&&r.level===L.level),F=L?r.sn-L.sn:-1,B=this.part?r.part-this.part.index:-1,U=F===0&&r.id>1&&r.id===(L==null?void 0:L.stats.chunkCount),N=!_&&(F===1||F===0&&(B===1||U&&B<=0)),k=self.performance.now();(_||F||u.stats.parsing.start===0)&&(u.stats.parsing.start=k),d&&(B||!N)&&(d.stats.parsing.start=k);var w=!(L&&((l=u.initSegment)===null||l===void 0?void 0:l.url)===((f=L.initSegment)===null||f===void 0?void 0:f.url)),W=new A.TransmuxState(I,N,e,_,y,w);if(!N||I||w){b.logger.log("[transmuxer-interface, "+u.type+"]: Starting new transmux session for sn: "+r.sn+" p: "+r.part+" level: "+r.level+" id: "+r.id+`
        discontinuity: `+I+`
        trackSwitch: `+_+`
        contiguous: `+N+`
        accurateTimeOffset: `+e+`
        timeOffset: `+y+`
        initSegmentChange: `+w);var j=new A.TransmuxConfig(t,o,i,n,m);this.configureTransmuxer(j)}if(this.frag=u,this.part=d,s)s.postMessage({cmd:"demux",data:v,decryptdata:D,chunkMeta:r,state:W},v instanceof ArrayBuffer?[v]:[]);else if(a){var H=a.push(v,D,r,W);Object(A.isPromise)(H)?H.then(function(G){h.handleTransmuxComplete(G)}):this.handleTransmuxComplete(H)}},E.flush=function(v){var i=this;v.transmuxing.start=self.performance.now();var t=this.transmuxer,o=this.worker;if(o)o.postMessage({cmd:"flush",chunkMeta:v});else if(t){var u=t.flush(v);Object(A.isPromise)(u)?u.then(function(d){i.handleFlushResult(d,v)}):this.handleFlushResult(u,v)}},E.handleFlushResult=function(v,i){var t=this;v.forEach(function(o){t.handleTransmuxComplete(o)}),this.onFlush(i)},E.onWorkerMessage=function(v){var i=v.data,t=this.hls;switch(i.event){case"init":{self.URL.revokeObjectURL(this.worker.objectURL);break}case"transmuxComplete":{this.handleTransmuxComplete(i.data);break}case"flush":{this.onFlush(i.data);break}case"workerLog":b.logger[i.data.logType]&&b.logger[i.data.logType](i.data.message);break;default:{i.data=i.data||{},i.data.frag=this.frag,i.data.id=this.id,t.trigger(i.event,i.data);break}}},E.configureTransmuxer=function(v){var i=this.worker,t=this.transmuxer;i?i.postMessage({cmd:"configure",config:v}):t&&t.configure(v)},E.handleTransmuxComplete=function(v){v.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(v)},p}()},"./src/demux/transmuxer-worker.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return P});var C=S("./src/demux/transmuxer.ts"),O=S("./src/events.ts"),A=S("./src/utils/logger.ts"),b=S("./node_modules/eventemitter3/index.js");function P(p){var E=new b.EventEmitter,c=function(t,o){p.postMessage({event:t,data:o})};E.on(O.Events.FRAG_DECRYPTED,c),E.on(O.Events.ERROR,c);var v=function(){var t=function(d){var n=function(r){c("workerLog",{logType:d,message:r})};A.logger[d]=n};for(var o in A.logger)t(o)};p.addEventListener("message",function(i){var t=i.data;switch(t.cmd){case"init":{var o=JSON.parse(t.config);p.transmuxer=new C.default(E,t.typeSupported,o,t.vendor,t.id),Object(A.enableLogs)(o.debug),v(),c("init",null);break}case"configure":{p.transmuxer.configure(t.config);break}case"demux":{var u=p.transmuxer.push(t.data,t.decryptdata,t.chunkMeta,t.state);Object(C.isPromise)(u)?u.then(function(e){R(p,e)}):R(p,u);break}case"flush":{var d=t.chunkMeta,n=p.transmuxer.flush(d);Object(C.isPromise)(n)?n.then(function(e){g(p,e,d)}):g(p,n,d);break}}})}function R(p,E){if(T(E.remuxResult))return!1;var c=[],v=E.remuxResult,i=v.audio,t=v.video;return i&&x(c,i),t&&x(c,t),p.postMessage({event:"transmuxComplete",data:E},c),!0}function x(p,E){E.data1&&p.push(E.data1.buffer),E.data2&&p.push(E.data2.buffer)}function g(p,E,c){var v=E.reduce(function(i,t){return R(p,t)||i},!1);v||p.postMessage({event:"transmuxComplete",data:E[0]}),p.postMessage({event:"flush",data:c})}function T(p){return!p.audio&&!p.video&&!p.text&&!p.id3&&!p.initSegment}},"./src/demux/transmuxer.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return o}),S.d(M,"isPromise",function(){return n}),S.d(M,"TransmuxConfig",function(){return e}),S.d(M,"TransmuxState",function(){return r});var C=S("./src/events.ts"),O=S("./src/errors.ts"),A=S("./src/crypt/decrypter.ts"),b=S("./src/demux/aacdemuxer.ts"),P=S("./src/demux/mp4demuxer.ts"),R=S("./src/demux/tsdemuxer.ts"),x=S("./src/demux/mp3demuxer.ts"),g=S("./src/remux/mp4-remuxer.ts"),T=S("./src/remux/passthrough-remuxer.ts"),p=S("./src/demux/chunk-cache.ts"),E=S("./src/utils/mp4-tools.ts"),c=S("./src/utils/logger.ts"),v;try{v=self.performance.now.bind(self.performance)}catch{c.logger.debug("Unable to use Performance API on this environment"),v=self.Date.now}var i=[{demux:R.default,remux:g.default},{demux:P.default,remux:T.default},{demux:b.default,remux:g.default},{demux:x.default,remux:g.default}],t=1024;i.forEach(function(m){var l=m.demux;t=Math.max(t,l.minProbeByteLength)});var o=function(){function m(f,h,a,s,y){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new p.default,this.observer=f,this.typeSupported=h,this.config=a,this.vendor=s,this.id=y}var l=m.prototype;return l.configure=function(h){this.transmuxConfig=h,this.decrypter&&this.decrypter.reset()},l.push=function(h,a,s,y){var D=this,L=s.transmuxing;L.executeStart=v();var I=new Uint8Array(h),_=this.cache,F=this.config,B=this.currentTransmuxState,U=this.transmuxConfig;y&&(this.currentTransmuxState=y);var N=u(I,a);if(N&&N.method==="AES-128"){var k=this.getDecrypter();if(F.enableSoftwareAES){var w=k.softwareDecrypt(I,N.key.buffer,N.iv.buffer);if(!w)return L.executeEnd=v(),d(s);I=new Uint8Array(w)}else return this.decryptionPromise=k.webCryptoDecrypt(I,N.key.buffer,N.iv.buffer).then(function(rt){var st=D.push(rt,null,s);return D.decryptionPromise=null,st}),this.decryptionPromise}var W=y||B,j=W.contiguous,H=W.discontinuity,G=W.trackSwitch,$=W.accurateTimeOffset,z=W.timeOffset,X=W.initSegmentChange,V=U.audioCodec,Y=U.videoCodec,Q=U.defaultInitPts,J=U.duration,Z=U.initSegmentData;if((H||G||X)&&this.resetInitSegment(Z,V,Y,J),(H||X)&&this.resetInitialTimestamp(Q),j||this.resetContiguity(),this.needsProbing(I,H,G)){if(_.dataLength){var q=_.flush();I=Object(E.appendUint8Array)(q,I)}this.configureTransmuxer(I,U)}var tt=this.transmux(I,N,z,$,s),et=this.currentTransmuxState;return et.contiguous=!0,et.discontinuity=!1,et.trackSwitch=!1,L.executeEnd=v(),tt},l.flush=function(h){var a=this,s=h.transmuxing;s.executeStart=v();var y=this.decrypter,D=this.cache,L=this.currentTransmuxState,I=this.decryptionPromise;if(I)return I.then(function(){return a.flush(h)});var _=[],F=L.timeOffset;if(y){var B=y.flush();B&&_.push(this.push(B,null,h))}var U=D.dataLength;D.reset();var N=this.demuxer,k=this.remuxer;if(!N||!k)return U>=t&&this.observer.emit(C.Events.ERROR,C.Events.ERROR,{type:O.ErrorTypes.MEDIA_ERROR,details:O.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),s.executeEnd=v(),[d(h)];var w=N.flush(F);return n(w)?w.then(function(W){return a.flushRemux(_,W,h),_}):(this.flushRemux(_,w,h),_)},l.flushRemux=function(h,a,s){var y=a.audioTrack,D=a.videoTrack,L=a.id3Track,I=a.textTrack,_=this.currentTransmuxState,F=_.accurateTimeOffset,B=_.timeOffset;c.logger.log("[transmuxer.ts]: Flushed fragment "+s.sn+(s.part>-1?" p: "+s.part:"")+" of level "+s.level);var U=this.remuxer.remux(y,D,L,I,B,F,!0,this.id);h.push({remuxResult:U,chunkMeta:s}),s.transmuxing.executeEnd=v()},l.resetInitialTimestamp=function(h){var a=this.demuxer,s=this.remuxer;!a||!s||(a.resetTimeStamp(h),s.resetTimeStamp(h))},l.resetContiguity=function(){var h=this.demuxer,a=this.remuxer;!h||!a||(h.resetContiguity(),a.resetNextTimestamp())},l.resetInitSegment=function(h,a,s,y){var D=this.demuxer,L=this.remuxer;!D||!L||(D.resetInitSegment(h,a,s,y),L.resetInitSegment(h,a,s))},l.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},l.transmux=function(h,a,s,y,D){var L;return a&&a.method==="SAMPLE-AES"?L=this.transmuxSampleAes(h,a,s,y,D):L=this.transmuxUnencrypted(h,s,y,D),L},l.transmuxUnencrypted=function(h,a,s,y){var D=this.demuxer.demux(h,a,!1,!this.config.progressive),L=D.audioTrack,I=D.videoTrack,_=D.id3Track,F=D.textTrack,B=this.remuxer.remux(L,I,_,F,a,s,!1,this.id);return{remuxResult:B,chunkMeta:y}},l.transmuxSampleAes=function(h,a,s,y,D){var L=this;return this.demuxer.demuxSampleAes(h,a,s).then(function(I){var _=L.remuxer.remux(I.audioTrack,I.videoTrack,I.id3Track,I.textTrack,s,y,!1,L.id);return{remuxResult:_,chunkMeta:D}})},l.configureTransmuxer=function(h,a){for(var s=this.config,y=this.observer,D=this.typeSupported,L=this.vendor,I=a.audioCodec,_=a.defaultInitPts,F=a.duration,B=a.initSegmentData,U=a.videoCodec,N,k=0,w=i.length;k<w;k++)if(i[k].demux.probe(h)){N=i[k];break}N||(c.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),N={demux:P.default,remux:T.default});var W=this.demuxer,j=this.remuxer,H=N.remux,G=N.demux;(!j||!(j instanceof H))&&(this.remuxer=new H(y,s,D,L)),(!W||!(W instanceof G))&&(this.demuxer=new G(y,s,D),this.probe=G.probe),this.resetInitSegment(B,I,U,F),this.resetInitialTimestamp(_)},l.needsProbing=function(h,a,s){return!this.demuxer||!this.remuxer||a||s},l.getDecrypter=function(){var h=this.decrypter;return h||(h=this.decrypter=new A.default(this.observer,this.config)),h},m}();function u(m,l){var f=null;return m.byteLength>0&&l!=null&&l.key!=null&&l.iv!==null&&l.method!=null&&(f=l),f}var d=function(l){return{remuxResult:{},chunkMeta:l}};function n(m){return"then"in m&&m.then instanceof Function}var e=function(l,f,h,a,s){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=l,this.videoCodec=f,this.initSegmentData=h,this.duration=a,this.defaultInitPts=s},r=function(l,f,h,a,s,y){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=l,this.contiguous=f,this.accurateTimeOffset=h,this.trackSwitch=a,this.timeOffset=s,this.initSegmentChange=y}},"./src/demux/tsdemuxer.ts":function(K,M,S){S.r(M),S.d(M,"discardEPB",function(){return u});var C=S("./src/demux/adts.ts"),O=S("./src/demux/mpegaudio.ts"),A=S("./src/demux/exp-golomb.ts"),b=S("./src/demux/sample-aes.ts"),P=S("./src/events.ts"),R=S("./src/utils/mp4-tools.ts"),x=S("./src/utils/logger.ts"),g=S("./src/errors.ts"),T=S("./src/types/demuxer.ts");function p(){return p=Object.assign?Object.assign.bind():function(d){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(d[r]=e[r])}return d},p.apply(this,arguments)}var E=function(){function d(e,r,m){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=r,this.typeSupported=m}d.probe=function(r){var m=d.syncOffset(r);return m<0?!1:(m&&x.logger.warn("MPEG2-TS detected but first sync word found @ offset "+m+", junk ahead ?"),!0)},d.syncOffset=function(r){for(var m=Math.min(1e3,r.length-564),l=0;l<m;){if(r[l]===71&&r[l+188]===71&&r[l+2*188]===71)return l;l++}return-1},d.createTrack=function(r,m){return{container:r==="video"||r==="audio"?"video/mp2t":void 0,type:r,id:R.RemuxerTrackIdConfig[r],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:r==="audio"?m:void 0}};var n=d.prototype;return n.resetInitSegment=function(r,m,l,f){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=d.createTrack("video"),this._audioTrack=d.createTrack("audio",f),this._id3Track=d.createTrack("id3"),this._txtTrack=d.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.audioCodec=m,this.videoCodec=l,this._duration=f},n.resetTimeStamp=function(){},n.resetContiguity=function(){var r=this._audioTrack,m=this._avcTrack,l=this._id3Track;r&&(r.pesData=null),m&&(m.pesData=null),l&&(l.pesData=null),this.aacOverFlow=null},n.demux=function(r,m,l,f){l===void 0&&(l=!1),f===void 0&&(f=!1),l||(this.sampleAes=null);var h,a=this._avcTrack,s=this._audioTrack,y=this._id3Track,D=this._txtTrack,L=a.pid,I=a.pesData,_=s.pid,F=y.pid,B=s.pesData,U=y.pesData,N=!1,k=this.pmtParsed,w=this._pmtId,W=r.length;if(this.remainderData&&(r=Object(R.appendUint8Array)(this.remainderData,r),W=r.length,this.remainderData=null),W<188&&!f)return this.remainderData=r,{audioTrack:s,videoTrack:a,id3Track:y,textTrack:D};var j=Math.max(0,d.syncOffset(r));W-=(W+j)%188,W<r.byteLength&&!f&&(this.remainderData=new Uint8Array(r.buffer,W,r.buffer.byteLength-W));for(var H=0,G=j;G<W;G+=188)if(r[G]===71){var $=!!(r[G+1]&64),z=((r[G+1]&31)<<8)+r[G+2],X=(r[G+3]&48)>>4,V=void 0;if(X>1){if(V=G+5+r[G+4],V===G+188)continue}else V=G+4;switch(z){case L:$&&(I&&(h=t(I))&&this.parseAVCPES(a,D,h,!1),I={data:[],size:0}),I&&(I.data.push(r.subarray(V,G+188)),I.size+=G+188-V);break;case _:if($){if(B&&(h=t(B)))switch(s.segmentCodec){case"aac":this.parseAACPES(s,h);break;case"mp3":this.parseMPEGPES(s,h);break}B={data:[],size:0}}B&&(B.data.push(r.subarray(V,G+188)),B.size+=G+188-V);break;case F:$&&(U&&(h=t(U))&&this.parseID3PES(y,h),U={data:[],size:0}),U&&(U.data.push(r.subarray(V,G+188)),U.size+=G+188-V);break;case 0:$&&(V+=r[V]+1),w=this._pmtId=v(r,V);break;case w:{$&&(V+=r[V]+1);var Y=i(r,V,this.typeSupported,l);L=Y.avc,L>0&&(a.pid=L),_=Y.audio,_>0&&(s.pid=_,s.segmentCodec=Y.segmentCodec),F=Y.id3,F>0&&(y.pid=F),N&&!k&&(x.logger.log("reparse from beginning"),N=!1,G=j-188),k=this.pmtParsed=!0;break}case 17:case 8191:break;default:N=!0;break}}else H++;H>0&&this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"Found "+H+" TS packet/s that do not start with 0x47"}),a.pesData=I,s.pesData=B,y.pesData=U;var Q={audioTrack:s,videoTrack:a,id3Track:y,textTrack:D};return f&&this.extractRemainingSamples(Q),Q},n.flush=function(){var r=this.remainderData;this.remainderData=null;var m;return r?m=this.demux(r,-1,!1,!0):m={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(m),this.sampleAes?this.decrypt(m,this.sampleAes):m},n.extractRemainingSamples=function(r){var m=r.audioTrack,l=r.videoTrack,f=r.id3Track,h=r.textTrack,a=l.pesData,s=m.pesData,y=f.pesData,D;if(a&&(D=t(a))?(this.parseAVCPES(l,h,D,!0),l.pesData=null):l.pesData=a,s&&(D=t(s))){switch(m.segmentCodec){case"aac":this.parseAACPES(m,D);break;case"mp3":this.parseMPEGPES(m,D);break}m.pesData=null}else s!=null&&s.size&&x.logger.log("last AAC PES packet truncated,might overlap between fragments"),m.pesData=s;y&&(D=t(y))?(this.parseID3PES(f,D),f.pesData=null):f.pesData=y},n.demuxSampleAes=function(r,m,l){var f=this.demux(r,l,!0,!this.config.progressive),h=this.sampleAes=new b.default(this.observer,this.config,m);return this.decrypt(f,h)},n.decrypt=function(r,m){return new Promise(function(l){var f=r.audioTrack,h=r.videoTrack;f.samples&&f.segmentCodec==="aac"?m.decryptAacSamples(f.samples,0,function(){h.samples?m.decryptAvcSamples(h.samples,0,0,function(){l(r)}):l(r)}):h.samples&&m.decryptAvcSamples(h.samples,0,0,function(){l(r)})})},n.destroy=function(){this._duration=0},n.parseAVCPES=function(r,m,l,f){var h=this,a=this.parseAVCNALu(r,l.data),s=this.avcSample,y,D=!1;l.data=null,s&&a.length&&!r.audFound&&(o(s,r),s=this.avcSample=c(!1,l.pts,l.dts,"")),a.forEach(function(L){switch(L.type){case 1:{y=!0,s||(s=h.avcSample=c(!0,l.pts,l.dts,"")),s.frame=!0;var I=L.data;if(D&&I.length>4){var _=new A.default(I).readSliceType();(_===2||_===4||_===7||_===9)&&(s.key=!0)}break}case 5:y=!0,s||(s=h.avcSample=c(!0,l.pts,l.dts,"")),s.key=!0,s.frame=!0;break;case 6:{y=!0,Object(R.parseSEIMessageFromNALu)(u(L.data),l.pts,m.samples);break}case 7:if(y=!0,D=!0,!r.sps){var F=new A.default(L.data),B=F.readSPS();r.width=B.width,r.height=B.height,r.pixelRatio=B.pixelRatio,r.sps=[L.data],r.duration=h._duration;for(var U=L.data.subarray(1,4),N="avc1.",k=0;k<3;k++){var w=U[k].toString(16);w.length<2&&(w="0"+w),N+=w}r.codec=N}break;case 8:y=!0,r.pps||(r.pps=[L.data]);break;case 9:y=!1,r.audFound=!0,s&&o(s,r),s=h.avcSample=c(!1,l.pts,l.dts,"");break;case 12:y=!0;break;default:y=!1,s&&(s.debug+="unknown NAL "+L.type+" ");break}if(s&&y){var W=s.units;W.push(L)}}),f&&s&&(o(s,r),this.avcSample=null)},n.getLastNalUnit=function(r){var m,l=this.avcSample,f;if((!l||l.units.length===0)&&(l=r[r.length-1]),(m=l)!==null&&m!==void 0&&m.units){var h=l.units;f=h[h.length-1]}return f},n.parseAVCNALu=function(r,m){var l=m.byteLength,f=r.naluState||0,h=f,a=[],s=0,y,D,L,I=-1,_=0;for(f===-1&&(I=0,_=m[0]&31,f=0,s=1);s<l;){if(y=m[s++],!f){f=y?0:1;continue}if(f===1){f=y?0:2;continue}if(!y)f=3;else if(y===1){if(I>=0){var F={data:m.subarray(I,s-f-1),type:_};a.push(F)}else{var B=this.getLastNalUnit(r.samples);if(B&&(h&&s<=4-h&&B.state&&(B.data=B.data.subarray(0,B.data.byteLength-h)),D=s-f-1,D>0)){var U=new Uint8Array(B.data.byteLength+D);U.set(B.data,0),U.set(m.subarray(0,D),B.data.byteLength),B.data=U,B.state=0}}s<l?(L=m[s]&31,I=s,_=L,f=0):f=-1}else f=0}if(I>=0&&f>=0){var N={data:m.subarray(I,l),type:_,state:f};a.push(N)}if(a.length===0){var k=this.getLastNalUnit(r.samples);if(k){var w=new Uint8Array(k.data.byteLength+m.byteLength);w.set(k.data,0),w.set(m,k.data.byteLength),k.data=w}}return r.naluState=f,a},n.parseAACPES=function(r,m){var l=0,f=this.aacOverFlow,h=m.data;if(f){this.aacOverFlow=null;var a=f.missing,s=f.sample.unit.byteLength;if(a===-1){var y=new Uint8Array(s+h.byteLength);y.set(f.sample.unit,0),y.set(h,s),h=y}else{var D=s-a;f.sample.unit.set(h.subarray(0,a),D),r.samples.push(f.sample),l=f.missing}}var L,I;for(L=l,I=h.length;L<I-1&&!C.isHeader(h,L);L++);if(L!==l){var _,F;if(L<I-1?(_="AAC PES did not start with ADTS header,offset:"+L,F=!1):(_="no ADTS header found in AAC PES",F=!0),x.logger.warn("parsing error:"+_),this.observer.emit(P.Events.ERROR,P.Events.ERROR,{type:g.ErrorTypes.MEDIA_ERROR,details:g.ErrorDetails.FRAG_PARSING_ERROR,fatal:F,reason:_}),F)return}C.initTrackConfig(r,this.observer,h,L,this.audioCodec);var B;if(m.pts!==void 0)B=m.pts;else if(f){var U=C.getFrameDuration(r.samplerate);B=f.sample.pts+U}else{x.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}for(var N=0,k;L<I;)if(k=C.appendFrame(r,h,L,B,N),L+=k.length,k.missing){this.aacOverFlow=k;break}else for(N++;L<I-1&&!C.isHeader(h,L);L++);},n.parseMPEGPES=function(r,m){var l=m.data,f=l.length,h=0,a=0,s=m.pts;if(s===void 0){x.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<f;)if(O.isHeader(l,a)){var y=O.appendFrame(r,l,a,s,h);if(y)a+=y.length,h++;else break}else a++},n.parseID3PES=function(r,m){if(m.pts===void 0){x.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}var l=p({},m,{type:this._avcTrack?T.MetadataSchema.emsg:T.MetadataSchema.audioId3});r.samples.push(l)},d}();E.minProbeByteLength=188;function c(d,n,e,r){return{key:d,frame:!1,pts:n,dts:e,units:[],debug:r,length:0}}function v(d,n){return(d[n+10]&31)<<8|d[n+11]}function i(d,n,e,r){var m={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},l=(d[n+1]&15)<<8|d[n+2],f=n+3+l-4,h=(d[n+10]&15)<<8|d[n+11];for(n+=12+h;n<f;){var a=(d[n+1]&31)<<8|d[n+2];switch(d[n]){case 207:if(!r){x.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:m.audio===-1&&(m.audio=a);break;case 21:m.id3===-1&&(m.id3=a);break;case 219:if(!r){x.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:m.avc===-1&&(m.avc=a);break;case 3:case 4:e.mpeg!==!0&&e.mp3!==!0?x.logger.log("MPEG audio found, not supported in this browser"):m.audio===-1&&(m.audio=a,m.segmentCodec="mp3");break;case 36:x.logger.warn("Unsupported HEVC stream type found");break}n+=((d[n+3]&15)<<8|d[n+4])+5}return m}function t(d){var n=0,e,r,m,l,f,h=d.data;if(!d||d.size===0)return null;for(;h[0].length<19&&h.length>1;){var a=new Uint8Array(h[0].length+h[1].length);a.set(h[0]),a.set(h[1],h[0].length),h[0]=a,h.splice(1,1)}e=h[0];var s=(e[0]<<16)+(e[1]<<8)+e[2];if(s===1){if(r=(e[4]<<8)+e[5],r&&r>d.size-6)return null;var y=e[7];y&192&&(l=(e[9]&14)*536870912+(e[10]&255)*4194304+(e[11]&254)*16384+(e[12]&255)*128+(e[13]&254)/2,y&64?(f=(e[14]&14)*536870912+(e[15]&255)*4194304+(e[16]&254)*16384+(e[17]&255)*128+(e[18]&254)/2,l-f>60*9e4&&(x.logger.warn(Math.round((l-f)/9e4)+"s delta between PTS and DTS, align them"),l=f)):f=l),m=e[8];var D=m+9;if(d.size<=D)return null;d.size-=D;for(var L=new Uint8Array(d.size),I=0,_=h.length;I<_;I++){e=h[I];var F=e.byteLength;if(D)if(D>F){D-=F;continue}else e=e.subarray(D),F-=D,D=0;L.set(e,n),n+=F}return r&&(r-=m+3),{data:L,pts:l,dts:f,len:r}}return null}function o(d,n){if(d.units.length&&d.frame){if(d.pts===void 0){var e=n.samples,r=e.length;if(r){var m=e[r-1];d.pts=m.pts,d.dts=m.dts}else{n.dropped++;return}}n.samples.push(d)}d.debug.length&&x.logger.log(d.pts+"/"+d.dts+":"+d.debug)}function u(d){for(var n=d.byteLength,e=[],r=1;r<n-2;)d[r]===0&&d[r+1]===0&&d[r+2]===3?(e.push(r+2),r+=2):r++;if(e.length===0)return d;var m=n-e.length,l=new Uint8Array(m),f=0;for(r=0;r<m;f++,r++)f===e[0]&&(f++,e.shift()),l[r]=d[f];return l}M.default=E},"./src/errors.ts":function(K,M,S){S.r(M),S.d(M,"ErrorTypes",function(){return C}),S.d(M,"ErrorDetails",function(){return O});var C;(function(A){A.NETWORK_ERROR="networkError",A.MEDIA_ERROR="mediaError",A.KEY_SYSTEM_ERROR="keySystemError",A.MUX_ERROR="muxError",A.OTHER_ERROR="otherError"})(C||(C={}));var O;(function(A){A.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",A.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",A.KEY_SYSTEM_NO_SESSION="keySystemNoSession",A.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",A.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",A.MANIFEST_LOAD_ERROR="manifestLoadError",A.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",A.MANIFEST_PARSING_ERROR="manifestParsingError",A.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",A.LEVEL_EMPTY_ERROR="levelEmptyError",A.LEVEL_LOAD_ERROR="levelLoadError",A.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",A.LEVEL_SWITCH_ERROR="levelSwitchError",A.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",A.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",A.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",A.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",A.FRAG_LOAD_ERROR="fragLoadError",A.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",A.FRAG_DECRYPT_ERROR="fragDecryptError",A.FRAG_PARSING_ERROR="fragParsingError",A.REMUX_ALLOC_ERROR="remuxAllocError",A.KEY_LOAD_ERROR="keyLoadError",A.KEY_LOAD_TIMEOUT="keyLoadTimeOut",A.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",A.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",A.BUFFER_APPEND_ERROR="bufferAppendError",A.BUFFER_APPENDING_ERROR="bufferAppendingError",A.BUFFER_STALLED_ERROR="bufferStalledError",A.BUFFER_FULL_ERROR="bufferFullError",A.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",A.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",A.INTERNAL_EXCEPTION="internalException",A.INTERNAL_ABORTED="aborted",A.UNKNOWN="unknown"})(O||(O={}))},"./src/events.ts":function(K,M,S){S.r(M),S.d(M,"Events",function(){return C});var C;(function(O){O.MEDIA_ATTACHING="hlsMediaAttaching",O.MEDIA_ATTACHED="hlsMediaAttached",O.MEDIA_DETACHING="hlsMediaDetaching",O.MEDIA_DETACHED="hlsMediaDetached",O.BUFFER_RESET="hlsBufferReset",O.BUFFER_CODECS="hlsBufferCodecs",O.BUFFER_CREATED="hlsBufferCreated",O.BUFFER_APPENDING="hlsBufferAppending",O.BUFFER_APPENDED="hlsBufferAppended",O.BUFFER_EOS="hlsBufferEos",O.BUFFER_FLUSHING="hlsBufferFlushing",O.BUFFER_FLUSHED="hlsBufferFlushed",O.MANIFEST_LOADING="hlsManifestLoading",O.MANIFEST_LOADED="hlsManifestLoaded",O.MANIFEST_PARSED="hlsManifestParsed",O.LEVEL_SWITCHING="hlsLevelSwitching",O.LEVEL_SWITCHED="hlsLevelSwitched",O.LEVEL_LOADING="hlsLevelLoading",O.LEVEL_LOADED="hlsLevelLoaded",O.LEVEL_UPDATED="hlsLevelUpdated",O.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",O.LEVELS_UPDATED="hlsLevelsUpdated",O.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",O.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",O.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",O.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",O.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",O.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",O.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",O.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",O.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",O.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",O.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",O.CUES_PARSED="hlsCuesParsed",O.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",O.INIT_PTS_FOUND="hlsInitPtsFound",O.FRAG_LOADING="hlsFragLoading",O.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",O.FRAG_LOADED="hlsFragLoaded",O.FRAG_DECRYPTED="hlsFragDecrypted",O.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",O.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",O.FRAG_PARSING_METADATA="hlsFragParsingMetadata",O.FRAG_PARSED="hlsFragParsed",O.FRAG_BUFFERED="hlsFragBuffered",O.FRAG_CHANGED="hlsFragChanged",O.FPS_DROP="hlsFpsDrop",O.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",O.ERROR="hlsError",O.DESTROYING="hlsDestroying",O.KEY_LOADING="hlsKeyLoading",O.KEY_LOADED="hlsKeyLoaded",O.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",O.BACK_BUFFER_REACHED="hlsBackBufferReached"})(C||(C={}))},"./src/hls.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return u});var C=S("./node_modules/url-toolkit/src/url-toolkit.js"),O=S("./src/loader/playlist-loader.ts"),A=S("./src/loader/key-loader.ts"),b=S("./src/controller/id3-track-controller.ts"),P=S("./src/controller/latency-controller.ts"),R=S("./src/controller/level-controller.ts"),x=S("./src/controller/fragment-tracker.ts"),g=S("./src/controller/stream-controller.ts"),T=S("./src/is-supported.ts"),p=S("./src/utils/logger.ts"),E=S("./src/config.ts"),c=S("./node_modules/eventemitter3/index.js"),v=S("./src/events.ts"),i=S("./src/errors.ts");function t(d,n){for(var e=0;e<n.length;e++){var r=n[e];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(d,r.key,r)}}function o(d,n,e){return n&&t(d.prototype,n),e&&t(d,e),Object.defineProperty(d,"prototype",{writable:!1}),d}var u=function(){d.isSupported=function(){return Object(T.isSupported)()};function d(e){e===void 0&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new c.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null;var r=this.config=Object(E.mergeConfig)(d.DefaultConfig,e);this.userConfig=e,Object(p.enableLogs)(r.debug),this._autoLevelCapping=-1,r.progressive&&Object(E.enableStreamingMode)(r);var m=r.abrController,l=r.bufferController,f=r.capLevelController,h=r.fpsController,a=this.abrController=new m(this),s=this.bufferController=new l(this),y=this.capLevelController=new f(this),D=new h(this),L=new O.default(this),I=new A.default(this),_=new b.default(this),F=this.levelController=new R.default(this),B=new x.FragmentTracker(this),U=this.streamController=new g.default(this,B);y.setStreamController(U),D.setStreamController(U);var N=[F,U];this.networkControllers=N;var k=[L,I,a,s,y,D,_,B];this.audioTrackController=this.createController(r.audioTrackController,null,N),this.createController(r.audioStreamController,B,N),this.subtitleTrackController=this.createController(r.subtitleTrackController,null,N),this.createController(r.subtitleStreamController,B,N),this.createController(r.timelineController,null,k),this.emeController=this.createController(r.emeController,null,k),this.cmcdController=this.createController(r.cmcdController,null,k),this.latencyController=this.createController(P.default,null,k),this.coreComponents=k}var n=d.prototype;return n.createController=function(r,m,l){if(r){var f=m?new r(this,m):new r(this);return l&&l.push(f),f}return null},n.on=function(r,m,l){l===void 0&&(l=this),this._emitter.on(r,m,l)},n.once=function(r,m,l){l===void 0&&(l=this),this._emitter.once(r,m,l)},n.removeAllListeners=function(r){this._emitter.removeAllListeners(r)},n.off=function(r,m,l,f){l===void 0&&(l=this),this._emitter.off(r,m,l,f)},n.listeners=function(r){return this._emitter.listeners(r)},n.emit=function(r,m,l){return this._emitter.emit(r,m,l)},n.trigger=function(r,m){if(this.config.debug)return this.emit(r,r,m);try{return this.emit(r,r,m)}catch(l){p.logger.error("An internal error happened while handling event "+r+'. Error message: "'+l.message+'". Here is a stacktrace:',l),this.trigger(v.Events.ERROR,{type:i.ErrorTypes.OTHER_ERROR,details:i.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:r,error:l})}return!1},n.listenerCount=function(r){return this._emitter.listenerCount(r)},n.destroy=function(){p.logger.log("destroy"),this.trigger(v.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(r){return r.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(r){return r.destroy()}),this.coreComponents.length=0},n.attachMedia=function(r){p.logger.log("attachMedia"),this._media=r,this.trigger(v.Events.MEDIA_ATTACHING,{media:r})},n.detachMedia=function(){p.logger.log("detachMedia"),this.trigger(v.Events.MEDIA_DETACHING,void 0),this._media=null},n.loadSource=function(r){this.stopLoad();var m=this.media,l=this.url,f=this.url=C.buildAbsoluteURL(self.location.href,r,{alwaysNormalize:!0});p.logger.log("loadSource:"+f),m&&l&&l!==f&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(m)),this.trigger(v.Events.MANIFEST_LOADING,{url:r})},n.startLoad=function(r){r===void 0&&(r=-1),p.logger.log("startLoad("+r+")"),this.networkControllers.forEach(function(m){m.startLoad(r)})},n.stopLoad=function(){p.logger.log("stopLoad"),this.networkControllers.forEach(function(r){r.stopLoad()})},n.swapAudioCodec=function(){p.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},n.recoverMediaError=function(){p.logger.log("recoverMediaError");var r=this._media;this.detachMedia(),r&&this.attachMedia(r)},n.removeLevel=function(r,m){m===void 0&&(m=0),this.levelController.removeLevel(r,m)},o(d,[{key:"levels",get:function(){var r=this.levelController.levels;return r||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(r){p.logger.log("set currentLevel:"+r),this.loadLevel=r,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(r){p.logger.log("set nextLevel:"+r),this.levelController.manualLevel=r,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(r){p.logger.log("set loadLevel:"+r),this.levelController.manualLevel=r}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(r){this.levelController.nextLoadLevel=r}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(r){p.logger.log("set firstLevel:"+r),this.levelController.firstLevel=r}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(r){p.logger.log("set startLevel:"+r),r!==-1&&(r=Math.max(r,this.minAutoLevel)),this.levelController.startLevel=r}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(r){var m=!!r;m!==this.config.capLevelToPlayerSize&&(m?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=m)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(r){this._autoLevelCapping!==r&&(p.logger.log("set autoLevelCapping:"+r),this._autoLevelCapping=r)}},{key:"bandwidthEstimate",get:function(){var r=this.abrController.bwEstimator;return r?r.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return this.levelController.manualLevel===-1}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var r=this.levels,m=this.config.minAutoBitrate;if(!r)return 0;for(var l=r.length,f=0;f<l;f++)if(r[f].maxBitrate>=m)return f;return 0}},{key:"maxAutoLevel",get:function(){var r=this.levels,m=this.autoLevelCapping,l;return m===-1&&r&&r.length?l=r.length-1:l=m,l}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(r){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,r)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"audioTracks",get:function(){var r=this.audioTrackController;return r?r.audioTracks:[]}},{key:"audioTrack",get:function(){var r=this.audioTrackController;return r?r.audioTrack:-1},set:function(r){var m=this.audioTrackController;m&&(m.audioTrack=r)}},{key:"subtitleTracks",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var r=this.subtitleTrackController;return r?r.subtitleTrack:-1},set:function(r){var m=this.subtitleTrackController;m&&(m.subtitleTrack=r)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var r=this.subtitleTrackController;return r?r.subtitleDisplay:!1},set:function(r){var m=this.subtitleTrackController;m&&(m.subtitleDisplay=r)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(r){this.config.lowLatencyMode=r}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.2.1"}},{key:"Events",get:function(){return v.Events}},{key:"ErrorTypes",get:function(){return i.ErrorTypes}},{key:"ErrorDetails",get:function(){return i.ErrorDetails}},{key:"DefaultConfig",get:function(){return d.defaultConfig?d.defaultConfig:E.hlsDefaultConfig},set:function(r){d.defaultConfig=r}}]),d}();u.defaultConfig=void 0},"./src/is-supported.ts":function(K,M,S){S.r(M),S.d(M,"isSupported",function(){return A}),S.d(M,"changeTypeSupported",function(){return b});var C=S("./src/utils/mediasource-helper.ts");function O(){return self.SourceBuffer||self.WebKitSourceBuffer}function A(){var P=Object(C.getMediaSource)();if(!P)return!1;var R=O(),x=P&&typeof P.isTypeSupported=="function"&&P.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),g=!R||R.prototype&&typeof R.prototype.appendBuffer=="function"&&typeof R.prototype.remove=="function";return!!x&&!!g}function b(){var P,R=O();return typeof(R==null||(P=R.prototype)===null||P===void 0?void 0:P.changeType)=="function"}},"./src/loader/date-range.ts":function(K,M,S){S.r(M),S.d(M,"DateRangeAttribute",function(){return x}),S.d(M,"DateRange",function(){return g});var C=S("./src/polyfills/number.ts"),O=S("./src/utils/attr-list.ts"),A=S("./src/utils/logger.ts");function b(){return b=Object.assign?Object.assign.bind():function(T){for(var p=1;p<arguments.length;p++){var E=arguments[p];for(var c in E)Object.prototype.hasOwnProperty.call(E,c)&&(T[c]=E[c])}return T},b.apply(this,arguments)}function P(T,p){for(var E=0;E<p.length;E++){var c=p[E];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(T,c.key,c)}}function R(T,p,E){return p&&P(T.prototype,p),E&&P(T,E),Object.defineProperty(T,"prototype",{writable:!1}),T}var x;(function(T){T.ID="ID",T.CLASS="CLASS",T.START_DATE="START-DATE",T.DURATION="DURATION",T.END_DATE="END-DATE",T.END_ON_NEXT="END-ON-NEXT",T.PLANNED_DURATION="PLANNED-DURATION",T.SCTE35_OUT="SCTE35-OUT",T.SCTE35_IN="SCTE35-IN"})(x||(x={}));var g=function(){function T(p,E){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,E){var c=E.attr;for(var v in c)if(Object.prototype.hasOwnProperty.call(p,v)&&p[v]!==c[v]){A.logger.warn('DATERANGE tag attribute: "'+v+'" does not match for tags with ID: "'+p.ID+'"'),this._badValueForSameId=v;break}p=b(new O.AttrList({}),c,p)}if(this.attr=p,this._startDate=new Date(p[x.START_DATE]),x.END_DATE in this.attr){var i=new Date(this.attr[x.END_DATE]);Object(C.isFiniteNumber)(i.getTime())&&(this._endDate=i)}}return R(T,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var E=this.duration;return E!==null?new Date(this._startDate.getTime()+E*1e3):null}},{key:"duration",get:function(){if(x.DURATION in this.attr){var E=this.attr.decimalFloatingPoint(x.DURATION);if(Object(C.isFiniteNumber)(E))return E}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return x.PLANNED_DURATION in this.attr?this.attr.decimalFloatingPoint(x.PLANNED_DURATION):null}},{key:"endOnNext",get:function(){return this.attr.bool(x.END_ON_NEXT)}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&Object(C.isFiniteNumber)(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),T}()},"./src/loader/fragment-loader.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return E}),S.d(M,"LoadError",function(){return v});var C=S("./src/polyfills/number.ts"),O=S("./src/errors.ts");function A(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,g(i,t)}function b(i){var t=typeof Map=="function"?new Map:void 0;return b=function(u){if(u===null||!x(u))return u;if(typeof u!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(u))return t.get(u);t.set(u,d)}function d(){return P(u,arguments,T(this).constructor)}return d.prototype=Object.create(u.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),g(d,u)},b(i)}function P(i,t,o){return R()?P=Reflect.construct.bind():P=function(d,n,e){var r=[null];r.push.apply(r,n);var m=Function.bind.apply(d,r),l=new m;return e&&g(l,e.prototype),l},P.apply(null,arguments)}function R(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function x(i){return Function.toString.call(i).indexOf("[native code]")!==-1}function g(i,t){return g=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,d){return u.__proto__=d,u},g(i,t)}function T(i){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},T(i)}var p=Math.pow(2,17),E=function(){function i(o){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=o}var t=i.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(u,d){var n=this,e=u.url;if(!e)return Promise.reject(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:u,networkDetails:null},"Fragment does not have a "+(e?"part list":"url")));this.abort();var r=this.config,m=r.fLoader,l=r.loader;return new Promise(function(f,h){n.loader&&n.loader.destroy();var a=n.loader=u.loader=m?new m(r):new l(r),s=c(u),y={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:u.sn==="initSegment"?1/0:p};u.stats=a.stats,a.load(s,y,{onSuccess:function(L,I,_,F){n.resetLoader(u,a),f({frag:u,part:null,payload:L.data,networkDetails:F})},onError:function(L,I,_){n.resetLoader(u,a),h(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:u,response:L,networkDetails:_}))},onAbort:function(L,I,_){n.resetLoader(u,a),h(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:u,networkDetails:_}))},onTimeout:function(L,I,_){n.resetLoader(u,a),h(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:u,networkDetails:_}))},onProgress:function(L,I,_,F){d&&d({frag:u,part:null,payload:_,networkDetails:F})}})})},t.loadPart=function(u,d,n){var e=this;this.abort();var r=this.config,m=r.fLoader,l=r.loader;return new Promise(function(f,h){e.loader&&e.loader.destroy();var a=e.loader=u.loader=m?new m(r):new l(r),s=c(u,d),y={timeout:r.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:r.fragLoadingMaxRetryTimeout,highWaterMark:p};d.stats=a.stats,a.load(s,y,{onSuccess:function(L,I,_,F){e.resetLoader(u,a),e.updateStatsFromPart(u,d);var B={frag:u,part:d,payload:L.data,networkDetails:F};n(B),f(B)},onError:function(L,I,_){e.resetLoader(u,a),h(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:u,part:d,response:L,networkDetails:_}))},onAbort:function(L,I,_){u.stats.aborted=d.stats.aborted,e.resetLoader(u,a),h(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:u,part:d,networkDetails:_}))},onTimeout:function(L,I,_){e.resetLoader(u,a),h(new v({type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:u,part:d,networkDetails:_}))}})})},t.updateStatsFromPart=function(u,d){var n=u.stats,e=d.stats,r=e.total;if(n.loaded+=e.loaded,r){var m=Math.round(u.duration/d.duration),l=Math.min(Math.round(n.loaded/r),m),f=m-l,h=f*Math.round(n.loaded/l);n.total=n.loaded+h}else n.total=Math.max(n.loaded,n.total);var a=n.loading,s=e.loading;a.start?a.first+=s.first-s.start:(a.start=s.start,a.first=s.first),a.end=s.end},t.resetLoader=function(u,d){u.loader=null,this.loader===d&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),d.destroy()},i}();function c(i,t){t===void 0&&(t=null);var o=t||i,u={frag:i,part:t,responseType:"arraybuffer",url:o.url,headers:{},rangeStart:0,rangeEnd:0},d=o.byteRangeStartOffset,n=o.byteRangeEndOffset;return Object(C.isFiniteNumber)(d)&&Object(C.isFiniteNumber)(n)&&(u.rangeStart=d,u.rangeEnd=n),u}var v=function(i){A(t,i);function t(o){for(var u,d=arguments.length,n=new Array(d>1?d-1:0),e=1;e<d;e++)n[e-1]=arguments[e];return u=i.call.apply(i,[this].concat(n))||this,u.data=void 0,u.data=o,u}return t}(b(Error))},"./src/loader/fragment.ts":function(K,M,S){S.r(M),S.d(M,"ElementaryStreamTypes",function(){return p}),S.d(M,"BaseSegment",function(){return E}),S.d(M,"Fragment",function(){return c}),S.d(M,"Part",function(){return v});var C=S("./src/polyfills/number.ts"),O=S("./node_modules/url-toolkit/src/url-toolkit.js"),A=S("./src/utils/logger.ts"),b=S("./src/loader/level-key.ts"),P=S("./src/loader/load-stats.ts");function R(i,t){i.prototype=Object.create(t.prototype),i.prototype.constructor=i,x(i,t)}function x(i,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(u,d){return u.__proto__=d,u},x(i,t)}function g(i,t){for(var o=0;o<t.length;o++){var u=t[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(i,u.key,u)}}function T(i,t,o){return t&&g(i.prototype,t),o&&g(i,o),Object.defineProperty(i,"prototype",{writable:!1}),i}var p;(function(i){i.AUDIO="audio",i.VIDEO="video",i.AUDIOVIDEO="audiovideo"})(p||(p={}));var E=function(){function i(o){var u;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(u={},u[p.AUDIO]=null,u[p.VIDEO]=null,u[p.AUDIOVIDEO]=null,u),this.baseurl=o}var t=i.prototype;return t.setByteRange=function(u,d){var n=u.split("@",2),e=[];n.length===1?e[0]=d?d.byteRangeEndOffset:0:e[0]=parseInt(n[1]),e[1]=parseInt(n[0])+e[0],this._byteRange=e},T(i,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(O.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(u){this._url=u}}]),i}(),c=function(i){R(t,i);function t(u,d){var n;return n=i.call(this,d)||this,n._decryptdata=null,n.rawProgramDateTime=null,n.programDateTime=null,n.tagList=[],n.duration=0,n.sn=0,n.levelkey=void 0,n.type=void 0,n.loader=null,n.level=-1,n.cc=0,n.startPTS=void 0,n.endPTS=void 0,n.appendedPTS=void 0,n.startDTS=void 0,n.endDTS=void 0,n.start=0,n.deltaPTS=void 0,n.maxStartPTS=void 0,n.minEndPTS=void 0,n.stats=new P.LoadStats,n.urlId=0,n.data=void 0,n.bitrateTest=!1,n.title=null,n.initSegment=null,n.type=u,n}var o=t.prototype;return o.createInitializationVector=function(d){for(var n=new Uint8Array(16),e=12;e<16;e++)n[e]=d>>8*(15-e)&255;return n},o.setDecryptDataFromLevelKey=function(d,n){var e=d;return(d==null?void 0:d.method)==="AES-128"&&d.uri&&!d.iv&&(e=b.LevelKey.fromURI(d.uri),e.method=d.method,e.iv=this.createInitializationVector(n),e.keyFormat="identity"),e},o.setElementaryStreamInfo=function(d,n,e,r,m,l){l===void 0&&(l=!1);var f=this.elementaryStreams,h=f[d];if(!h){f[d]={startPTS:n,endPTS:e,startDTS:r,endDTS:m,partial:l};return}h.startPTS=Math.min(h.startPTS,n),h.endPTS=Math.max(h.endPTS,e),h.startDTS=Math.min(h.startDTS,r),h.endDTS=Math.max(h.endDTS,m)},o.clearElementaryStreamInfo=function(){var d=this.elementaryStreams;d[p.AUDIO]=null,d[p.VIDEO]=null,d[p.AUDIOVIDEO]=null},T(t,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var d=this.sn;typeof d!="number"&&(this.levelkey&&this.levelkey.method==="AES-128"&&!this.levelkey.iv&&A.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),d=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,d)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(this.programDateTime===null||!Object(C.isFiniteNumber)(this.programDateTime))return null;var d=Object(C.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+d*1e3}},{key:"encrypted",get:function(){var d;return!!((d=this.decryptdata)!==null&&d!==void 0&&d.keyFormat&&this.decryptdata.uri)}}]),t}(E),v=function(i){R(t,i);function t(o,u,d,n,e){var r;r=i.call(this,d)||this,r.fragOffset=0,r.duration=0,r.gap=!1,r.independent=!1,r.relurl=void 0,r.fragment=void 0,r.index=void 0,r.stats=new P.LoadStats,r.duration=o.decimalFloatingPoint("DURATION"),r.gap=o.bool("GAP"),r.independent=o.bool("INDEPENDENT"),r.relurl=o.enumeratedString("URI"),r.fragment=u,r.index=n;var m=o.enumeratedString("BYTERANGE");return m&&r.setByteRange(m,e),e&&(r.fragOffset=e.fragOffset+e.duration),r}return T(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var u=this.elementaryStreams;return!!(u.audio||u.video||u.audiovideo)}}]),t}(E)},"./src/loader/key-loader.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return b});var C=S("./src/events.ts"),O=S("./src/errors.ts"),A=S("./src/utils/logger.ts"),b=function(){function P(x){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=x,this._registerListeners()}var R=P.prototype;return R._registerListeners=function(){this.hls.on(C.Events.KEY_LOADING,this.onKeyLoading,this)},R._unregisterListeners=function(){this.hls.off(C.Events.KEY_LOADING,this.onKeyLoading)},R.destroy=function(){this._unregisterListeners();for(var g in this.loaders){var T=this.loaders[g];T&&T.destroy()}this.loaders={}},R.onKeyLoading=function(g,T){var p=T.frag,E=p.type,c=this.loaders[E];if(!p.decryptdata){A.logger.warn("Missing decryption data on fragment in onKeyLoading");return}var v=p.decryptdata.uri;if(v!==this.decrypturl||this.decryptkey===null){var i=this.hls.config;if(c&&(A.logger.warn("abort previous key loader for type:"+E),c.abort()),!v){A.logger.warn("key uri is falsy");return}var t=i.loader,o=p.loader=this.loaders[E]=new t(i);this.decrypturl=v,this.decryptkey=null;var u={url:v,frag:p,responseType:"arraybuffer"},d={timeout:i.fragLoadingTimeOut,maxRetry:0,retryDelay:i.fragLoadingRetryDelay,maxRetryDelay:i.fragLoadingMaxRetryTimeout,highWaterMark:0},n={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};o.load(u,d,n)}else this.decryptkey&&(p.decryptdata.key=this.decryptkey,this.hls.trigger(C.Events.KEY_LOADED,{frag:p}))},R.loadsuccess=function(g,T,p){var E=p.frag;if(!E.decryptdata){A.logger.error("after key load, decryptdata unset");return}this.decryptkey=E.decryptdata.key=new Uint8Array(g.data),E.loader=null,delete this.loaders[E.type],this.hls.trigger(C.Events.KEY_LOADED,{frag:E})},R.loaderror=function(g,T){var p=T.frag,E=p.loader;E&&E.abort(),delete this.loaders[p.type],this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:p,response:g})},R.loadtimeout=function(g,T){var p=T.frag,E=p.loader;E&&E.abort(),delete this.loaders[p.type],this.hls.trigger(C.Events.ERROR,{type:O.ErrorTypes.NETWORK_ERROR,details:O.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:p})},P}()},"./src/loader/level-details.ts":function(K,M,S){S.r(M),S.d(M,"LevelDetails",function(){return P});var C=S("./src/polyfills/number.ts");function O(R,x){for(var g=0;g<x.length;g++){var T=x[g];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(R,T.key,T)}}function A(R,x,g){return x&&O(R.prototype,x),g&&O(R,g),Object.defineProperty(R,"prototype",{writable:!1}),R}var b=10,P=function(){function R(g){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.dateRanges={},this.url=g}var x=R.prototype;return x.reloaded=function(T){if(!T){this.advanced=!0,this.updated=!0;return}var p=this.lastPartSn-T.lastPartSn,E=this.lastPartIndex-T.lastPartIndex;this.updated=this.endSN!==T.endSN||!!E||!!p,this.advanced=this.endSN>T.endSN||p>0||p===0&&E>0,this.updated||this.advanced?this.misses=Math.floor(T.misses*.6):this.misses=T.misses+1,this.availabilityDelay=T.availabilityDelay},A(R,[{key:"hasProgramDateTime",get:function(){return this.fragments.length?Object(C.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime):!1}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||b}},{key:"drift",get:function(){var T=this.driftEndTime-this.driftStartTime;if(T>0){var p=this.driftEnd-this.driftStart;return p*1e3/T}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var T;return(T=this.fragments)!==null&&T!==void 0&&T.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var T;return(T=this.partList)!==null&&T!==void 0&&T.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),R}()},"./src/loader/level-key.ts":function(K,M,S){S.r(M),S.d(M,"LevelKey",function(){return b});var C=S("./node_modules/url-toolkit/src/url-toolkit.js");function O(P,R){for(var x=0;x<R.length;x++){var g=R[x];g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(P,g.key,g)}}function A(P,R,x){return R&&O(P.prototype,R),x&&O(P,x),Object.defineProperty(P,"prototype",{writable:!1}),P}var b=function(){P.fromURL=function(x,g){return new P(x,g)},P.fromURI=function(x){return new P(x)};function P(R,x){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,x?this._uri=Object(C.buildAbsoluteURL)(R,x,{alwaysNormalize:!0}):this._uri=R}return A(P,[{key:"uri",get:function(){return this._uri}}]),P}()},"./src/loader/load-stats.ts":function(K,M,S){S.r(M),S.d(M,"LoadStats",function(){return C});var C=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return o});var C=S("./src/polyfills/number.ts"),O=S("./node_modules/url-toolkit/src/url-toolkit.js"),A=S("./src/loader/date-range.ts"),b=S("./src/loader/fragment.ts"),P=S("./src/loader/level-details.ts"),R=S("./src/loader/level-key.ts"),x=S("./src/utils/attr-list.ts"),g=S("./src/utils/logger.ts"),T=S("./src/utils/codecs.ts"),p=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,E=/#EXT-X-MEDIA:(.*)/g,c=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),v=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),i=/\.(mp4|m4s|m4v|m4a)$/i;function t(m){var l,f;return i.test((l=(f=O.parseURL(m))===null||f===void 0?void 0:f.path)!=null?l:"")}var o=function(){function m(){}return m.findGroup=function(f,h){for(var a=0;a<f.length;a++){var s=f[a];if(s.id===h)return s}},m.convertAVC1ToAVCOTI=function(f){var h=f.split(".");if(h.length>2){var a=h.shift()+".";return a+=parseInt(h.shift()).toString(16),a+=("000"+parseInt(h.shift()).toString(16)).slice(-4),a}return f},m.resolve=function(f,h){return O.buildAbsoluteURL(h,f,{alwaysNormalize:!0})},m.parseMasterPlaylist=function(f,h){var a=[],s={},y=!1;p.lastIndex=0;for(var D;(D=p.exec(f))!=null;)if(D[1]){var L=new x.AttrList(D[1]),I={attrs:L,bitrate:L.decimalInteger("AVERAGE-BANDWIDTH")||L.decimalInteger("BANDWIDTH"),name:L.NAME,url:m.resolve(D[2],h)},_=L.decimalResolution("RESOLUTION");_&&(I.width=_.width,I.height=_.height),u((L.CODECS||"").split(/[ ,]+/).filter(function(B){return B}),I),I.videoCodec&&I.videoCodec.indexOf("avc1")!==-1&&(I.videoCodec=m.convertAVC1ToAVCOTI(I.videoCodec)),a.push(I)}else if(D[3]){var F=new x.AttrList(D[3]);F["DATA-ID"]&&(y=!0,s[F["DATA-ID"]]=F)}return{levels:a,sessionData:y?s:null}},m.parseMasterPlaylistMedia=function(f,h,a,s){s===void 0&&(s=[]);var y,D=[],L=0;for(E.lastIndex=0;(y=E.exec(f))!==null;){var I=new x.AttrList(y[1]);if(I.TYPE===a){var _={attrs:I,bitrate:0,id:L++,groupId:I["GROUP-ID"],instreamId:I["INSTREAM-ID"],name:I.NAME||I.LANGUAGE||"",type:a,default:I.bool("DEFAULT"),autoselect:I.bool("AUTOSELECT"),forced:I.bool("FORCED"),lang:I.LANGUAGE,url:I.URI?m.resolve(I.URI,h):""};if(s.length){var F=m.findGroup(s,_.groupId)||s[0];d(_,F,"audioCodec"),d(_,F,"textCodec")}D.push(_)}}return D},m.parseLevelPlaylist=function(f,h,a,s,y){var D=new P.LevelDetails(h),L=D.fragments,I=null,_=0,F=0,B=0,U=0,N=null,k=new b.Fragment(s,h),w,W,j,H=-1,G=!1;for(c.lastIndex=0,D.m3u8=f;(w=c.exec(f))!==null;){G&&(G=!1,k=new b.Fragment(s,h),k.start=B,k.sn=_,k.cc=U,k.level=a,I&&(k.initSegment=I,k.rawProgramDateTime=I.rawProgramDateTime,I.rawProgramDateTime=null));var $=w[1];if($){k.duration=parseFloat($);var z=(" "+w[2]).slice(1);k.title=z||null,k.tagList.push(z?["INF",$,z]:["INF",$])}else if(w[3])Object(C.isFiniteNumber)(k.duration)&&(k.start=B,j&&(k.levelkey=j),k.sn=_,k.level=a,k.cc=U,k.urlId=y,L.push(k),k.relurl=(" "+w[3]).slice(1),e(k,N),N=k,B+=k.duration,_++,F=0,G=!0);else if(w[4]){var X=(" "+w[4]).slice(1);N?k.setByteRange(X,N):k.setByteRange(X)}else if(w[5])k.rawProgramDateTime=(" "+w[5]).slice(1),k.tagList.push(["PROGRAM-DATE-TIME",k.rawProgramDateTime]),H===-1&&(H=L.length);else{if(w=w[0].match(v),!w){g.logger.warn("No matches on slow regex match for level playlist!");continue}for(W=1;W<w.length&&!(typeof w[W]<"u");W++);var V=(" "+w[W]).slice(1),Y=(" "+w[W+1]).slice(1),Q=w[W+2]?(" "+w[W+2]).slice(1):"";switch(V){case"PLAYLIST-TYPE":D.type=Y.toUpperCase();break;case"MEDIA-SEQUENCE":_=D.startSN=parseInt(Y);break;case"SKIP":{var J=new x.AttrList(Y),Z=J.decimalInteger("SKIPPED-SEGMENTS");if(Object(C.isFiniteNumber)(Z)){D.skippedSegments=Z;for(var q=Z;q--;)L.unshift(null);_+=Z}var tt=J.enumeratedString("RECENTLY-REMOVED-DATERANGES");tt&&(D.recentlyRemovedDateranges=tt.split("	"));break}case"TARGETDURATION":D.targetduration=parseFloat(Y);break;case"VERSION":D.version=parseInt(Y);break;case"EXTM3U":break;case"ENDLIST":D.live=!1;break;case"#":(Y||Q)&&k.tagList.push(Q?[Y,Q]:[Y]);break;case"DISCONTINUITY":U++,k.tagList.push(["DIS"]);break;case"GAP":k.tagList.push([V]);break;case"BITRATE":k.tagList.push([V,Y]);break;case"DATERANGE":{var et=new x.AttrList(Y),rt=new A.DateRange(et,D.dateRanges[et.ID]);rt.isValid||D.skippedSegments?D.dateRanges[rt.id]=rt:g.logger.warn('Ignoring invalid DATERANGE tag: "'+Y+'"'),k.tagList.push(["EXT-X-DATERANGE",Y]);break}case"DISCONTINUITY-SEQUENCE":U=parseInt(Y);break;case"KEY":{var st,ut=new x.AttrList(Y),ft=ut.enumeratedString("METHOD"),nt=ut.URI,yt=ut.hexadecimalInteger("IV"),dt=ut.enumeratedString("KEYFORMATVERSIONS"),ot=ut.enumeratedString("KEYID"),gt=(st=ut.enumeratedString("KEYFORMAT"))!=null?st:"identity",pt=["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"];if(pt.indexOf(gt)>-1){g.logger.warn("Keyformat "+gt+" is not supported from the manifest");continue}else if(gt!=="identity")continue;ft&&(j=R.LevelKey.fromURL(h,nt),nt&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(ft)>=0&&(j.method=ft,j.keyFormat=gt,ot&&(j.keyID=ot),dt&&(j.keyFormatVersions=dt),j.iv=yt));break}case"START":{var mt=new x.AttrList(Y),it=mt.decimalFloatingPoint("TIME-OFFSET");Object(C.isFiniteNumber)(it)&&(D.startTimeOffset=it);break}case"MAP":{var lt=new x.AttrList(Y);if(k.duration){var ht=new b.Fragment(s,h);r(ht,lt,a,j),I=ht,k.initSegment=I,I.rawProgramDateTime&&!k.rawProgramDateTime&&(k.rawProgramDateTime=I.rawProgramDateTime)}else r(k,lt,a,j),I=k,G=!0;break}case"SERVER-CONTROL":{var ct=new x.AttrList(Y);D.canBlockReload=ct.bool("CAN-BLOCK-RELOAD"),D.canSkipUntil=ct.optionalFloat("CAN-SKIP-UNTIL",0),D.canSkipDateRanges=D.canSkipUntil>0&&ct.bool("CAN-SKIP-DATERANGES"),D.partHoldBack=ct.optionalFloat("PART-HOLD-BACK",0),D.holdBack=ct.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var Et=new x.AttrList(Y);D.partTarget=Et.decimalFloatingPoint("PART-TARGET");break}case"PART":{var at=D.partList;at||(at=D.partList=[]);var vt=F>0?at[at.length-1]:void 0,xt=F++,St=new b.Part(new x.AttrList(Y),k,h,xt,vt);at.push(St),k.duration+=St.duration;break}case"PRELOAD-HINT":{var Dt=new x.AttrList(Y);D.preloadHint=Dt;break}case"RENDITION-REPORT":{var Tt=new x.AttrList(Y);D.renditionReports=D.renditionReports||[],D.renditionReports.push(Tt);break}default:g.logger.warn("line parsed but not handled: "+w);break}}}N&&!N.relurl?(L.pop(),B-=N.duration,D.partList&&(D.fragmentHint=N)):D.partList&&(e(k,N),k.cc=U,D.fragmentHint=k);var Ot=L.length,Rt=L[0],Lt=L[Ot-1];if(B+=D.skippedSegments*D.targetduration,B>0&&Ot&&Lt){D.averagetargetduration=B/Ot;var It=Lt.sn;D.endSN=It!=="initSegment"?It:0,Rt&&(D.startCC=Rt.cc,Rt.initSegment||D.fragments.every(function(At){return At.relurl&&t(At.relurl)})&&(g.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),k=new b.Fragment(s,h),k.relurl=Lt.relurl,k.level=a,k.sn="initSegment",Rt.initSegment=k,D.needSidxRanges=!0))}else D.endSN=0,D.startCC=0;return D.fragmentHint&&(B+=D.fragmentHint.duration),D.totalduration=B,D.endCC=U,H>0&&n(L,H),D},m}();function u(m,l){["video","audio","text"].forEach(function(f){var h=m.filter(function(s){return Object(T.isCodecType)(s,f)});if(h.length){var a=h.filter(function(s){return s.lastIndexOf("avc1",0)===0||s.lastIndexOf("mp4a",0)===0});l[f+"Codec"]=a.length>0?a[0]:h[0],m=m.filter(function(s){return h.indexOf(s)===-1})}}),l.unknownCodecs=m}function d(m,l,f){var h=l[f];h&&(m[f]=h)}function n(m,l){for(var f=m[l],h=l;h--;){var a=m[h];if(!a)return;a.programDateTime=f.programDateTime-a.duration*1e3,f=a}}function e(m,l){m.rawProgramDateTime?m.programDateTime=Date.parse(m.rawProgramDateTime):l!=null&&l.programDateTime&&(m.programDateTime=l.endProgramDateTime),Object(C.isFiniteNumber)(m.programDateTime)||(m.programDateTime=null,m.rawProgramDateTime=null)}function r(m,l,f,h){m.relurl=l.URI,l.BYTERANGE&&m.setByteRange(l.BYTERANGE),m.level=f,m.sn="initSegment",h&&(m.levelkey=h),m.initSegment=null}},"./src/loader/playlist-loader.ts":function(K,M,S){S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/events.ts"),A=S("./src/errors.ts"),b=S("./src/utils/logger.ts"),P=S("./src/utils/mp4-tools.ts"),R=S("./src/loader/m3u8-parser.ts"),x=S("./src/types/loader.ts"),g=S("./src/utils/attr-list.ts");function T(c){var v=c.type;switch(v){case x.PlaylistContextType.AUDIO_TRACK:return x.PlaylistLevelType.AUDIO;case x.PlaylistContextType.SUBTITLE_TRACK:return x.PlaylistLevelType.SUBTITLE;default:return x.PlaylistLevelType.MAIN}}function p(c,v){var i=c.url;return(i===void 0||i.indexOf("data:")===0)&&(i=v.url),i}var E=function(){function c(i){this.hls=void 0,this.loaders=Object.create(null),this.hls=i,this.registerListeners()}var v=c.prototype;return v.registerListeners=function(){var t=this.hls;t.on(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(O.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},v.unregisterListeners=function(){var t=this.hls;t.off(O.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(O.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(O.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(O.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},v.createInternalLoader=function(t){var o=this.hls.config,u=o.pLoader,d=o.loader,n=u||d,e=new n(o);return t.loader=e,this.loaders[t.type]=e,e},v.getInternalLoader=function(t){return this.loaders[t.type]},v.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},v.destroyInternalLoaders=function(){for(var t in this.loaders){var o=this.loaders[t];o&&o.destroy(),this.resetInternalLoader(t)}},v.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},v.onManifestLoading=function(t,o){var u=o.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:x.PlaylistContextType.MANIFEST,url:u,deliveryDirectives:null})},v.onLevelLoading=function(t,o){var u=o.id,d=o.level,n=o.url,e=o.deliveryDirectives;this.load({id:u,groupId:null,level:d,responseType:"text",type:x.PlaylistContextType.LEVEL,url:n,deliveryDirectives:e})},v.onAudioTrackLoading=function(t,o){var u=o.id,d=o.groupId,n=o.url,e=o.deliveryDirectives;this.load({id:u,groupId:d,level:null,responseType:"text",type:x.PlaylistContextType.AUDIO_TRACK,url:n,deliveryDirectives:e})},v.onSubtitleTrackLoading=function(t,o){var u=o.id,d=o.groupId,n=o.url,e=o.deliveryDirectives;this.load({id:u,groupId:d,level:null,responseType:"text",type:x.PlaylistContextType.SUBTITLE_TRACK,url:n,deliveryDirectives:e})},v.load=function(t){var o,u=this.hls.config,d=this.getInternalLoader(t);if(d){var n=d.context;if(n&&n.url===t.url){b.logger.trace("[playlist-loader]: playlist request ongoing");return}b.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),d.abort()}var e,r,m,l;switch(t.type){case x.PlaylistContextType.MANIFEST:e=u.manifestLoadingMaxRetry,r=u.manifestLoadingTimeOut,m=u.manifestLoadingRetryDelay,l=u.manifestLoadingMaxRetryTimeout;break;case x.PlaylistContextType.LEVEL:case x.PlaylistContextType.AUDIO_TRACK:case x.PlaylistContextType.SUBTITLE_TRACK:e=0,r=u.levelLoadingTimeOut;break;default:e=u.levelLoadingMaxRetry,r=u.levelLoadingTimeOut,m=u.levelLoadingRetryDelay,l=u.levelLoadingMaxRetryTimeout;break}if(d=this.createInternalLoader(t),(o=t.deliveryDirectives)!==null&&o!==void 0&&o.part){var f;if(t.type===x.PlaylistContextType.LEVEL&&t.level!==null?f=this.hls.levels[t.level].details:t.type===x.PlaylistContextType.AUDIO_TRACK&&t.id!==null?f=this.hls.audioTracks[t.id].details:t.type===x.PlaylistContextType.SUBTITLE_TRACK&&t.id!==null&&(f=this.hls.subtitleTracks[t.id].details),f){var h=f.partTarget,a=f.targetduration;h&&a&&(r=Math.min(Math.max(h*3,a*.8)*1e3,r))}}var s={timeout:r,maxRetry:e,retryDelay:m,maxRetryDelay:l,highWaterMark:0},y={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};d.load(t,s,y)},v.loadsuccess=function(t,o,u,d){if(d===void 0&&(d=null),u.isSidxRequest){this.handleSidxRequest(t,u),this.handlePlaylistLoaded(t,o,u,d);return}this.resetInternalLoader(u.type);var n=t.data;if(n.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(t,u,"no EXTM3U delimiter",d);return}o.parsing.start=performance.now(),n.indexOf("#EXTINF:")>0||n.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,o,u,d):this.handleMasterPlaylist(t,o,u,d)},v.loaderror=function(t,o,u){u===void 0&&(u=null),this.handleNetworkError(o,u,!1,t)},v.loadtimeout=function(t,o,u){u===void 0&&(u=null),this.handleNetworkError(o,u,!0)},v.handleMasterPlaylist=function(t,o,u,d){var n=this.hls,e=t.data,r=p(t,u),m=R.default.parseMasterPlaylist(e,r),l=m.levels,f=m.sessionData;if(!l.length){this.handleManifestParsingError(t,u,"no level found in manifest",d);return}var h=l.map(function(I){return{id:I.attrs.AUDIO,audioCodec:I.audioCodec}}),a=l.map(function(I){return{id:I.attrs.SUBTITLES,textCodec:I.textCodec}}),s=R.default.parseMasterPlaylistMedia(e,r,"AUDIO",h),y=R.default.parseMasterPlaylistMedia(e,r,"SUBTITLES",a),D=R.default.parseMasterPlaylistMedia(e,r,"CLOSED-CAPTIONS");if(s.length){var L=s.some(function(I){return!I.url});!L&&l[0].audioCodec&&!l[0].attrs.AUDIO&&(b.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),s.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new g.AttrList({}),bitrate:0,url:""}))}n.trigger(O.Events.MANIFEST_LOADED,{levels:l,audioTracks:s,subtitles:y,captions:D,url:r,stats:o,networkDetails:d,sessionData:f})},v.handleTrackOrLevelPlaylist=function(t,o,u,d){var n=this.hls,e=u.id,r=u.level,m=u.type,l=p(t,u),f=Object(C.isFiniteNumber)(e)?e:0,h=Object(C.isFiniteNumber)(r)?r:f,a=T(u),s=R.default.parseLevelPlaylist(t.data,l,h,a,f);if(!s.fragments.length){n.trigger(O.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:l,reason:"no fragments found in level",level:typeof u.level=="number"?u.level:void 0});return}if(m===x.PlaylistContextType.MANIFEST){var y={attrs:new g.AttrList({}),bitrate:0,details:s,name:"",url:l};n.trigger(O.Events.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:l,stats:o,networkDetails:d,sessionData:null})}if(o.parsing.end=performance.now(),s.needSidxRanges){var D,L=(D=s.fragments[0].initSegment)===null||D===void 0?void 0:D.url;this.load({url:L,isSidxRequest:!0,type:m,level:r,levelDetails:s,id:e,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null});return}u.levelDetails=s,this.handlePlaylistLoaded(t,o,u,d)},v.handleSidxRequest=function(t,o){var u=new Uint8Array(t.data),d=Object(P.findBox)(u,["sidx"])[0];if(!!d){var n=Object(P.parseSegmentIndex)(d);if(!!n){var e=n.references,r=o.levelDetails;e.forEach(function(m,l){var f=m.info,h=r.fragments[l];if(h.byteRange.length===0&&h.setByteRange(String(1+f.end-f.start)+"@"+String(f.start)),h.initSegment){var a=Object(P.findBox)(u,["moov"])[0],s=a?a.length:null;h.initSegment.setByteRange(String(s)+"@0")}})}}},v.handleManifestParsingError=function(t,o,u,d){this.hls.trigger(O.Events.ERROR,{type:A.ErrorTypes.NETWORK_ERROR,details:A.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:o.type===x.PlaylistContextType.MANIFEST,url:t.url,reason:u,response:t,context:o,networkDetails:d})},v.handleNetworkError=function(t,o,u,d){u===void 0&&(u=!1),b.logger.warn("[playlist-loader]: A network "+(u?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var n=A.ErrorDetails.UNKNOWN,e=!1,r=this.getInternalLoader(t);switch(t.type){case x.PlaylistContextType.MANIFEST:n=u?A.ErrorDetails.MANIFEST_LOAD_TIMEOUT:A.ErrorDetails.MANIFEST_LOAD_ERROR,e=!0;break;case x.PlaylistContextType.LEVEL:n=u?A.ErrorDetails.LEVEL_LOAD_TIMEOUT:A.ErrorDetails.LEVEL_LOAD_ERROR,e=!1;break;case x.PlaylistContextType.AUDIO_TRACK:n=u?A.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:A.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,e=!1;break;case x.PlaylistContextType.SUBTITLE_TRACK:n=u?A.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:A.ErrorDetails.SUBTITLE_LOAD_ERROR,e=!1;break}r&&this.resetInternalLoader(t.type);var m={type:A.ErrorTypes.NETWORK_ERROR,details:n,fatal:e,url:t.url,loader:r,context:t,networkDetails:o};d&&(m.response=d),this.hls.trigger(O.Events.ERROR,m)},v.handlePlaylistLoaded=function(t,o,u,d){var n=u.type,e=u.level,r=u.id,m=u.groupId,l=u.loader,f=u.levelDetails,h=u.deliveryDirectives;if(!(f!=null&&f.targetduration)){this.handleManifestParsingError(t,u,"invalid target duration",d);return}if(!!l)switch(f.live&&(l.getCacheAge&&(f.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(f.ageHeader))&&(f.ageHeader=0)),n){case x.PlaylistContextType.MANIFEST:case x.PlaylistContextType.LEVEL:this.hls.trigger(O.Events.LEVEL_LOADED,{details:f,level:e||0,id:r||0,stats:o,networkDetails:d,deliveryDirectives:h});break;case x.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(O.Events.AUDIO_TRACK_LOADED,{details:f,id:r||0,groupId:m||"",stats:o,networkDetails:d,deliveryDirectives:h});break;case x.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(O.Events.SUBTITLE_TRACK_LOADED,{details:f,id:r||0,groupId:m||"",stats:o,networkDetails:d,deliveryDirectives:h});break}},c}();M.default=E},"./src/polyfills/number.ts":function(K,M,S){S.r(M),S.d(M,"isFiniteNumber",function(){return C}),S.d(M,"MAX_SAFE_INTEGER",function(){return O});var C=Number.isFinite||function(A){return typeof A=="number"&&isFinite(A)},O=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(K,M,S){S.r(M);var C=function(){function O(){}return O.getSilentFrame=function(b,P){switch(b){case"mp4a.40.2":if(P===1)return new Uint8Array([0,200,0,128,35,128]);if(P===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(P===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(P===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(P===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(P===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(P===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(P===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(P===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},O}();M.default=C},"./src/remux/mp4-generator.ts":function(K,M,S){S.r(M);var C=Math.pow(2,32)-1,O=function(){function A(){}return A.init=function(){A.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var P;for(P in A.types)A.types.hasOwnProperty(P)&&(A.types[P]=[P.charCodeAt(0),P.charCodeAt(1),P.charCodeAt(2),P.charCodeAt(3)]);var R=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),x=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);A.HDLR_TYPES={video:R,audio:x};var g=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),T=new Uint8Array([0,0,0,0,0,0,0,0]);A.STTS=A.STSC=A.STCO=T,A.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),A.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),A.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),A.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var p=new Uint8Array([105,115,111,109]),E=new Uint8Array([97,118,99,49]),c=new Uint8Array([0,0,0,1]);A.FTYP=A.box(A.types.ftyp,p,c,p,E),A.DINF=A.box(A.types.dinf,A.box(A.types.dref,g))},A.box=function(P){for(var R=8,x=arguments.length,g=new Array(x>1?x-1:0),T=1;T<x;T++)g[T-1]=arguments[T];for(var p=g.length,E=p;p--;)R+=g[p].byteLength;var c=new Uint8Array(R);for(c[0]=R>>24&255,c[1]=R>>16&255,c[2]=R>>8&255,c[3]=R&255,c.set(P,4),p=0,R=8;p<E;p++)c.set(g[p],R),R+=g[p].byteLength;return c},A.hdlr=function(P){return A.box(A.types.hdlr,A.HDLR_TYPES[P])},A.mdat=function(P){return A.box(A.types.mdat,P)},A.mdhd=function(P,R){R*=P;var x=Math.floor(R/(C+1)),g=Math.floor(R%(C+1));return A.box(A.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,P&255,x>>24,x>>16&255,x>>8&255,x&255,g>>24,g>>16&255,g>>8&255,g&255,85,196,0,0]))},A.mdia=function(P){return A.box(A.types.mdia,A.mdhd(P.timescale,P.duration),A.hdlr(P.type),A.minf(P))},A.mfhd=function(P){return A.box(A.types.mfhd,new Uint8Array([0,0,0,0,P>>24,P>>16&255,P>>8&255,P&255]))},A.minf=function(P){return P.type==="audio"?A.box(A.types.minf,A.box(A.types.smhd,A.SMHD),A.DINF,A.stbl(P)):A.box(A.types.minf,A.box(A.types.vmhd,A.VMHD),A.DINF,A.stbl(P))},A.moof=function(P,R,x){return A.box(A.types.moof,A.mfhd(P),A.traf(x,R))},A.moov=function(P){for(var R=P.length,x=[];R--;)x[R]=A.trak(P[R]);return A.box.apply(null,[A.types.moov,A.mvhd(P[0].timescale,P[0].duration)].concat(x).concat(A.mvex(P)))},A.mvex=function(P){for(var R=P.length,x=[];R--;)x[R]=A.trex(P[R]);return A.box.apply(null,[A.types.mvex].concat(x))},A.mvhd=function(P,R){R*=P;var x=Math.floor(R/(C+1)),g=Math.floor(R%(C+1)),T=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,P>>24&255,P>>16&255,P>>8&255,P&255,x>>24,x>>16&255,x>>8&255,x&255,g>>24,g>>16&255,g>>8&255,g&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return A.box(A.types.mvhd,T)},A.sdtp=function(P){var R=P.samples||[],x=new Uint8Array(4+R.length),g,T;for(g=0;g<R.length;g++)T=R[g].flags,x[g+4]=T.dependsOn<<4|T.isDependedOn<<2|T.hasRedundancy;return A.box(A.types.sdtp,x)},A.stbl=function(P){return A.box(A.types.stbl,A.stsd(P),A.box(A.types.stts,A.STTS),A.box(A.types.stsc,A.STSC),A.box(A.types.stsz,A.STSZ),A.box(A.types.stco,A.STCO))},A.avc1=function(P){var R=[],x=[],g,T,p;for(g=0;g<P.sps.length;g++)T=P.sps[g],p=T.byteLength,R.push(p>>>8&255),R.push(p&255),R=R.concat(Array.prototype.slice.call(T));for(g=0;g<P.pps.length;g++)T=P.pps[g],p=T.byteLength,x.push(p>>>8&255),x.push(p&255),x=x.concat(Array.prototype.slice.call(T));var E=A.box(A.types.avcC,new Uint8Array([1,R[3],R[4],R[5],255,224|P.sps.length].concat(R).concat([P.pps.length]).concat(x))),c=P.width,v=P.height,i=P.pixelRatio[0],t=P.pixelRatio[1];return A.box(A.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,c>>8&255,c&255,v>>8&255,v&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),E,A.box(A.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),A.box(A.types.pasp,new Uint8Array([i>>24,i>>16&255,i>>8&255,i&255,t>>24,t>>16&255,t>>8&255,t&255])))},A.esds=function(P){var R=P.config.length;return new Uint8Array([0,0,0,0,3,23+R,0,1,0,4,15+R,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([R]).concat(P.config).concat([6,1,2]))},A.mp4a=function(P){var R=P.samplerate;return A.box(A.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,R>>8&255,R&255,0,0]),A.box(A.types.esds,A.esds(P)))},A.mp3=function(P){var R=P.samplerate;return A.box(A.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,P.channelCount,0,16,0,0,0,0,R>>8&255,R&255,0,0]))},A.stsd=function(P){return P.type==="audio"?P.segmentCodec==="mp3"&&P.codec==="mp3"?A.box(A.types.stsd,A.STSD,A.mp3(P)):A.box(A.types.stsd,A.STSD,A.mp4a(P)):A.box(A.types.stsd,A.STSD,A.avc1(P))},A.tkhd=function(P){var R=P.id,x=P.duration*P.timescale,g=P.width,T=P.height,p=Math.floor(x/(C+1)),E=Math.floor(x%(C+1));return A.box(A.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,R>>24&255,R>>16&255,R>>8&255,R&255,0,0,0,0,p>>24,p>>16&255,p>>8&255,p&255,E>>24,E>>16&255,E>>8&255,E&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,g>>8&255,g&255,0,0,T>>8&255,T&255,0,0]))},A.traf=function(P,R){var x=A.sdtp(P),g=P.id,T=Math.floor(R/(C+1)),p=Math.floor(R%(C+1));return A.box(A.types.traf,A.box(A.types.tfhd,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255])),A.box(A.types.tfdt,new Uint8Array([1,0,0,0,T>>24,T>>16&255,T>>8&255,T&255,p>>24,p>>16&255,p>>8&255,p&255])),A.trun(P,x.length+16+20+8+16+8+8),x)},A.trak=function(P){return P.duration=P.duration||4294967295,A.box(A.types.trak,A.tkhd(P),A.mdia(P))},A.trex=function(P){var R=P.id;return A.box(A.types.trex,new Uint8Array([0,0,0,0,R>>24,R>>16&255,R>>8&255,R&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},A.trun=function(P,R){var x=P.samples||[],g=x.length,T=12+16*g,p=new Uint8Array(T),E,c,v,i,t,o;for(R+=8+T,p.set([0,0,15,1,g>>>24&255,g>>>16&255,g>>>8&255,g&255,R>>>24&255,R>>>16&255,R>>>8&255,R&255],0),E=0;E<g;E++)c=x[E],v=c.duration,i=c.size,t=c.flags,o=c.cts,p.set([v>>>24&255,v>>>16&255,v>>>8&255,v&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,t.isLeading<<2|t.dependsOn,t.isDependedOn<<6|t.hasRedundancy<<4|t.paddingValue<<1|t.isNonSync,t.degradPrio&240<<8,t.degradPrio&15,o>>>24&255,o>>>16&255,o>>>8&255,o&255],12+16*E);return A.box(A.types.trun,p)},A.initSegment=function(P){A.types||A.init();var R=A.moov(P),x=new Uint8Array(A.FTYP.byteLength+R.byteLength);return x.set(A.FTYP),x.set(R,A.FTYP.byteLength),x},A}();O.types=void 0,O.HDLR_TYPES=void 0,O.STTS=void 0,O.STSC=void 0,O.STCO=void 0,O.STSZ=void 0,O.VMHD=void 0,O.SMHD=void 0,O.STSD=void 0,O.FTYP=void 0,O.DINF=void 0,M.default=O},"./src/remux/mp4-remuxer.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return o}),S.d(M,"normalizePts",function(){return u}),S.d(M,"flushTextTrackMetadataCueSamples",function(){return n}),S.d(M,"flushTextTrackUserdataCueSamples",function(){return e});var C=S("./src/polyfills/number.ts"),O=S("./src/remux/aac-helper.ts"),A=S("./src/remux/mp4-generator.ts"),b=S("./src/events.ts"),P=S("./src/errors.ts"),R=S("./src/utils/logger.ts"),x=S("./src/types/loader.ts"),g=S("./src/utils/timescale-conversion.ts");function T(){return T=Object.assign?Object.assign.bind():function(l){for(var f=1;f<arguments.length;f++){var h=arguments[f];for(var a in h)Object.prototype.hasOwnProperty.call(h,a)&&(l[a]=h[a])}return l},T.apply(this,arguments)}var p=10*1e3,E=1024,c=1152,v=null,i=null,t=!1,o=function(){function l(h,a,s,y){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=h,this.config=a,this.typeSupported=s,this.ISGenerated=!1,v===null){var D=navigator.userAgent||"",L=D.match(/Chrome\/(\d+)/i);v=L?parseInt(L[1]):0}if(i===null){var I=navigator.userAgent.match(/Safari\/(\d+)/i);i=I?parseInt(I[1]):0}t=!(!!v&&v>=75||!!i&&i>=600)}var f=l.prototype;return f.destroy=function(){},f.resetTimeStamp=function(a){R.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=a},f.resetNextTimestamp=function(){R.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},f.resetInitSegment=function(){R.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},f.getVideoStartPts=function(a){var s=!1,y=a.reduce(function(D,L){var I=L.pts-D;return I<-4294967296?(s=!0,u(D,L.pts)):I>0?D:L.pts},a[0].pts);return s&&R.logger.debug("PTS rollover detected"),y},f.remux=function(a,s,y,D,L,I,_,F){var B,U,N,k,w,W,j=L,H=L,G=a.pid>-1,$=s.pid>-1,z=s.samples.length,X=a.samples.length>0,V=_&&z>0||z>1,Y=(!G||X)&&(!$||V)||this.ISGenerated||_;if(Y){this.ISGenerated||(N=this.generateIS(a,s,L));var Q=this.isVideoContiguous,J=-1,Z;if(V&&(J=d(s.samples),!Q&&this.config.forceKeyFrameOnDiscontinuity))if(W=!0,J>0){R.logger.warn("[mp4-remuxer]: Dropped "+J+" out of "+z+" video samples due to a missing keyframe");var q=this.getVideoStartPts(s.samples);s.samples=s.samples.slice(J),s.dropped+=J,H+=(s.samples[0].pts-q)/s.inputTimeScale,Z=H}else J===-1&&(R.logger.warn("[mp4-remuxer]: No keyframe found out of "+z+" video samples"),W=!1);if(this.ISGenerated){if(X&&V){var tt=this.getVideoStartPts(s.samples),et=u(a.samples[0].pts,tt)-tt,rt=et/s.inputTimeScale;j+=Math.max(0,rt),H+=Math.max(0,-rt)}if(X){if(a.samplerate||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),N=this.generateIS(a,s,L)),U=this.remuxAudio(a,j,this.isAudioContiguous,I,$||V||F===x.PlaylistLevelType.AUDIO?H:void 0),V){var st=U?U.endPTS-U.startPTS:0;s.inputTimeScale||(R.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),N=this.generateIS(a,s,L)),B=this.remuxVideo(s,H,Q,st)}}else V&&(B=this.remuxVideo(s,H,Q,0));B&&(B.firstKeyFrame=J,B.independent=J!==-1,B.firstKeyFramePTS=Z)}}return this.ISGenerated&&(y.samples.length&&(w=n(y,L,this._initPTS,this._initDTS)),D.samples.length&&(k=e(D,L,this._initPTS))),{audio:U,video:B,initSegment:N,independent:W,text:k,id3:w}},f.generateIS=function(a,s,y){var D=a.samples,L=s.samples,I=this.typeSupported,_={},F=!Object(C.isFiniteNumber)(this._initPTS),B="audio/mp4",U,N,k;if(F&&(U=N=1/0),a.config&&D.length){switch(a.timescale=a.samplerate,a.segmentCodec){case"mp3":I.mpeg?(B="audio/mpeg",a.codec=""):I.mp3&&(a.codec="mp3");break}_.audio={id:"audio",container:B,codec:a.codec,initSegment:a.segmentCodec==="mp3"&&I.mpeg?new Uint8Array(0):A.default.initSegment([a]),metadata:{channelCount:a.channelCount}},F&&(k=a.inputTimeScale,U=N=D[0].pts-Math.round(k*y))}if(s.sps&&s.pps&&L.length&&(s.timescale=s.inputTimeScale,_.video={id:"main",container:"video/mp4",codec:s.codec,initSegment:A.default.initSegment([s]),metadata:{width:s.width,height:s.height}},F)){k=s.inputTimeScale;var w=this.getVideoStartPts(L),W=Math.round(k*y);N=Math.min(N,u(L[0].dts,w)-W),U=Math.min(U,w-W)}if(Object.keys(_).length)return this.ISGenerated=!0,F&&(this._initPTS=U,this._initDTS=N),{tracks:_,initPTS:U,timescale:k}},f.remuxVideo=function(a,s,y,D){var L=a.inputTimeScale,I=a.samples,_=[],F=I.length,B=this._initPTS,U=this.nextAvcDts,N=8,k=this.videoSampleDuration,w,W,j=Number.POSITIVE_INFINITY,H=Number.NEGATIVE_INFINITY,G=0,$=!1;if(!y||U===null){var z=s*L,X=I[0].pts-u(I[0].dts,I[0].pts);U=z-X}for(var V=0;V<F;V++){var Y=I[V];if(Y.pts=u(Y.pts-B,U),Y.dts=u(Y.dts-B,U),Y.dts>Y.pts){var Q=18e3;G=Math.max(Math.min(G,Y.pts-Y.dts),-1*Q)}Y.dts<I[V>0?V-1:V].dts&&($=!0)}$&&I.sort(function(Mt,_t){var Vt=Mt.dts-_t.dts,zt=Mt.pts-_t.pts;return Vt||zt}),w=I[0].dts,W=I[I.length-1].dts;var J=W-w,Z=J?Math.round(J/(F-1)):k||a.inputTimeScale/30;if(G<0){if(G<Z*-2){R.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(g.toMsFromMpegTsClock)(-Z,!0)+" ms");for(var q=G,tt=0;tt<F;tt++)I[tt].dts=q=Math.max(q,I[tt].pts-Z),I[tt].pts=Math.max(q,I[tt].pts)}else{R.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(g.toMsFromMpegTsClock)(G,!0)+" ms to overcome this issue");for(var et=0;et<F;et++)I[et].dts=I[et].dts+G}w=I[0].dts}if(y){var rt=w-U,st=rt>Z,ut=rt<-1;if(st||ut){st?R.logger.warn("AVC: "+Object(g.toMsFromMpegTsClock)(rt,!0)+" ms ("+rt+"dts) hole between fragments detected, filling it"):R.logger.warn("AVC: "+Object(g.toMsFromMpegTsClock)(-rt,!0)+" ms ("+rt+"dts) overlapping between fragments detected"),w=U;var ft=I[0].pts-rt;I[0].dts=w,I[0].pts=ft,R.logger.log("Video: First PTS/DTS adjusted: "+Object(g.toMsFromMpegTsClock)(ft,!0)+"/"+Object(g.toMsFromMpegTsClock)(w,!0)+", delta: "+Object(g.toMsFromMpegTsClock)(rt,!0)+" ms")}}t&&(w=Math.max(0,w));for(var nt=0,yt=0,dt=0;dt<F;dt++){for(var ot=I[dt],gt=ot.units,pt=gt.length,mt=0,it=0;it<pt;it++)mt+=gt[it].data.length;yt+=mt,nt+=pt,ot.length=mt,ot.dts=Math.max(ot.dts,w),ot.pts=Math.max(ot.pts,ot.dts,0),j=Math.min(ot.pts,j),H=Math.max(ot.pts,H)}W=I[F-1].dts;var lt=yt+4*nt+8,ht;try{ht=new Uint8Array(lt)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:P.ErrorTypes.MUX_ERROR,details:P.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:lt,reason:"fail allocating video mdat "+lt});return}var ct=new DataView(ht.buffer);ct.setUint32(0,lt),ht.set(A.default.types.mdat,4);for(var Et=!1,at=0;at<F;at++){for(var vt=I[at],xt=vt.units,St=0,Dt=0,Tt=xt.length;Dt<Tt;Dt++){var Ot=xt[Dt],Rt=Ot.data,Lt=Ot.data.byteLength;ct.setUint32(N,Lt),N+=4,ht.set(Rt,N),N+=Lt,St+=4+Lt}if(at<F-1)k=I[at+1].dts-vt.dts;else{var It=this.config,At=at>0?vt.dts-I[at-1].dts:Z;if(It.stretchShortVideoTrack&&this.nextAudioPts!==null){var Kt=Math.floor(It.maxBufferHole*L),Ct=(D?j+D*L:this.nextAudioPts)-vt.pts;Ct>Kt?(k=Ct-At,k<0?k=At:Et=!0,R.logger.log("[mp4-remuxer]: It is approximately "+Ct/90+" ms to the next segment; using duration "+k/90+" ms for the last video frame.")):k=At}else k=At}var Wt=Math.round(vt.pts-vt.dts);_.push(new r(vt.key,k,St,Wt))}if(_.length&&v&&v<70){var Ft=_[0].flags;Ft.dependsOn=2,Ft.isNonSync=0}console.assert(k!==null,"mp4SampleDuration must be computed"),k=Et||!k?Z:k,this.nextAvcDts=U=W+k,this.videoSampleDuration=k,this.isVideoContiguous=!0;var Gt=A.default.moof(a.sequenceNumber++,w,T({},a,{samples:_})),jt="video",Ht={data1:Gt,data2:ht,startPTS:j/L,endPTS:(H+k)/L,startDTS:w/L,endDTS:U/L,type:jt,hasAudio:!1,hasVideo:!0,nb:_.length,dropped:a.dropped};return a.samples=[],a.dropped=0,console.assert(ht.length,"MDAT length must not be zero"),Ht},f.remuxAudio=function(a,s,y,D,L){var I=a.inputTimeScale,_=a.samplerate?a.samplerate:I,F=I/_,B=a.segmentCodec==="aac"?E:c,U=B*F,N=this._initPTS,k=a.segmentCodec==="mp3"&&this.typeSupported.mpeg,w=[],W=L!==void 0,j=a.samples,H=k?0:8,G=this.nextAudioPts||-1,$=s*I;if(this.isAudioContiguous=y=y||j.length&&G>0&&(D&&Math.abs($-G)<9e3||Math.abs(u(j[0].pts-N,$)-G)<20*U),j.forEach(function(Tt){Tt.pts=u(Tt.pts-N,$)}),!y||G<0){if(j=j.filter(function(Tt){return Tt.pts>=0}),!j.length)return;L===0?G=0:D&&!W?G=Math.max(0,$):G=j[0].pts}if(a.segmentCodec==="aac")for(var z=this.config.maxAudioFramesDrift,X=0,V=G;X<j.length;X++){var Y=j[X],Q=Y.pts,J=Q-V,Z=Math.abs(1e3*J/I);if(J<=-z*U&&W)X===0&&(R.logger.warn("Audio frame @ "+(Q/I).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*J/I)+" ms."),this.nextAudioPts=G=V=Q);else if(J>=z*U&&Z<p&&W){var q=Math.round(J/U);V=Q-q*U,V<0&&(q--,V+=U),X===0&&(this.nextAudioPts=G=V),R.logger.warn("[mp4-remuxer]: Injecting "+q+" audio frame @ "+(V/I).toFixed(3)+"s due to "+Math.round(1e3*J/I)+" ms gap.");for(var tt=0;tt<q;tt++){var et=Math.max(V,0),rt=O.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);rt||(R.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),rt=Y.unit.subarray()),j.splice(X,0,{unit:rt,pts:et}),V+=U,X++}}Y.pts=V,V+=U}for(var st=null,ut=null,ft,nt=0,yt=j.length;yt--;)nt+=j[yt].unit.byteLength;for(var dt=0,ot=j.length;dt<ot;dt++){var gt=j[dt],pt=gt.unit,mt=gt.pts;if(ut!==null){var it=w[dt-1];it.duration=Math.round((mt-ut)/F)}else if(y&&a.segmentCodec==="aac"&&(mt=G),st=mt,nt>0){nt+=H;try{ft=new Uint8Array(nt)}catch{this.observer.emit(b.Events.ERROR,b.Events.ERROR,{type:P.ErrorTypes.MUX_ERROR,details:P.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:nt,reason:"fail allocating audio mdat "+nt});return}if(!k){var lt=new DataView(ft.buffer);lt.setUint32(0,nt),ft.set(A.default.types.mdat,4)}}else return;ft.set(pt,H);var ht=pt.byteLength;H+=ht,w.push(new r(!0,B,ht,0)),ut=mt}var ct=w.length;if(!!ct){var Et=w[w.length-1];this.nextAudioPts=G=ut+F*Et.duration;var at=k?new Uint8Array(0):A.default.moof(a.sequenceNumber++,st/F,T({},a,{samples:w}));a.samples=[];var vt=st/I,xt=G/I,St="audio",Dt={data1:at,data2:ft,startPTS:vt,endPTS:xt,startDTS:vt,endDTS:xt,type:St,hasAudio:!0,hasVideo:!1,nb:ct};return this.isAudioContiguous=!0,console.assert(ft.length,"MDAT length must not be zero"),Dt}},f.remuxEmptyAudio=function(a,s,y,D){var L=a.inputTimeScale,I=a.samplerate?a.samplerate:L,_=L/I,F=this.nextAudioPts,B=(F!==null?F:D.startDTS*L)+this._initDTS,U=D.endDTS*L+this._initDTS,N=_*E,k=Math.ceil((U-B)/N),w=O.default.getSilentFrame(a.manifestCodec||a.codec,a.channelCount);if(R.logger.warn("[mp4-remuxer]: remux empty Audio"),!w){R.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}for(var W=[],j=0;j<k;j++){var H=B+j*N;W.push({unit:w,pts:H,dts:H})}return a.samples=W,this.remuxAudio(a,s,y,!1)},l}();function u(l,f){var h;if(f===null)return l;for(f<l?h=-8589934592:h=8589934592;Math.abs(l-f)>4294967296;)l+=h;return l}function d(l){for(var f=0;f<l.length;f++)if(l[f].key)return f;return-1}function n(l,f,h,a){var s=l.samples.length;if(!!s){for(var y=l.inputTimeScale,D=0;D<s;D++){var L=l.samples[D];L.pts=u(L.pts-h,f*y)/y,L.dts=u(L.dts-a,f*y)/y}var I=l.samples;return l.samples=[],{samples:I}}}function e(l,f,h){var a=l.samples.length;if(!!a){for(var s=l.inputTimeScale,y=0;y<a;y++){var D=l.samples[y];D.pts=u(D.pts-h,f*s)/s}l.samples.sort(function(I,_){return I.pts-_.pts});var L=l.samples;return l.samples=[],{samples:L}}}var r=function(f,h,a,s){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=h,this.size=a,this.cts=s,this.flags=new m(f)},m=function(f){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=f?2:1,this.isNonSync=f?0:1}},"./src/remux/passthrough-remuxer.ts":function(K,M,S){S.r(M);var C=S("./src/polyfills/number.ts"),O=S("./src/remux/mp4-remuxer.ts"),A=S("./src/utils/mp4-tools.ts"),b=S("./src/loader/fragment.ts"),P=S("./src/utils/logger.ts"),R=function(){function T(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var p=T.prototype;return p.destroy=function(){},p.resetTimeStamp=function(c){this.initPTS=c,this.lastEndDTS=null},p.resetNextTimestamp=function(){this.lastEndDTS=null},p.resetInitSegment=function(c,v,i){this.audioCodec=v,this.videoCodec=i,this.generateInitSegment(c),this.emitInitSegment=!0},p.generateInitSegment=function(c){var v=this.audioCodec,i=this.videoCodec;if(!c||!c.byteLength){this.initTracks=void 0,this.initData=void 0;return}var t=this.initData=Object(A.parseInitSegment)(c);v||(v=g(t.audio,b.ElementaryStreamTypes.AUDIO)),i||(i=g(t.video,b.ElementaryStreamTypes.VIDEO));var o={};t.audio&&t.video?o.audiovideo={container:"video/mp4",codec:v+","+i,initSegment:c,id:"main"}:t.audio?o.audio={container:"audio/mp4",codec:v,initSegment:c,id:"audio"}:t.video?o.video={container:"video/mp4",codec:i,initSegment:c,id:"main"}:P.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=o},p.remux=function(c,v,i,t,o){var u,d=this.initPTS,n=this.lastEndDTS,e={audio:void 0,video:void 0,text:t,id3:i,initSegment:void 0};Object(C.isFiniteNumber)(n)||(n=this.lastEndDTS=o||0);var r=v.samples;if(!r||!r.length)return e;var m={initPTS:void 0,timescale:1},l=this.initData;if((!l||!l.length)&&(this.generateInitSegment(r),l=this.initData),!l||!l.length)return P.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),e;this.emitInitSegment&&(m.tracks=this.initTracks,this.emitInitSegment=!1),Object(C.isFiniteNumber)(d)||(this.initPTS=m.initPTS=d=x(l,r,n));var f=Object(A.getDuration)(r,l),h=n,a=f+h;Object(A.offsetStartDTS)(l,r,d),f>0?this.lastEndDTS=a:(P.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var s=!!l.audio,y=!!l.video,D="";s&&(D+="audio"),y&&(D+="video");var L={data1:r,startPTS:h,startDTS:h,endPTS:a,endDTS:a,type:D,hasAudio:s,hasVideo:y,nb:1,dropped:0};e.audio=L.type==="audio"?L:void 0,e.video=L.type!=="audio"?L:void 0,e.initSegment=m;var I=(u=this.initPTS)!=null?u:0;return e.id3=Object(O.flushTextTrackMetadataCueSamples)(i,o,I,I),t.samples.length&&(e.text=Object(O.flushTextTrackUserdataCueSamples)(t,o,I)),e},T}(),x=function(p,E,c){return Object(A.getStartDTS)(p,E)-c};function g(T,p){var E=T==null?void 0:T.codec;return E&&E.length>4?E:E==="hvc1"||E==="hev1"?"hvc1.1.c.L120.90":E==="av01"?"av01.0.04M.08":E==="avc1"||p===b.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}M.default=R},"./src/task-loop.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return C});var C=function(){function O(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var A=O.prototype;return A.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},A.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},A.onHandlerDestroyed=function(){},A.hasInterval=function(){return!!this._tickInterval},A.hasNextTick=function(){return!!this._tickTimer},A.setInterval=function(P){return this._tickInterval?!1:(this._tickInterval=self.setInterval(this._boundTick,P),!0)},A.clearInterval=function(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1},A.clearNextTick=function(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1},A.tick=function(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},A.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},A.doTick=function(){},O}()},"./src/types/cmcd.ts":function(K,M,S){S.r(M),S.d(M,"CMCDVersion",function(){return C}),S.d(M,"CMCDObjectType",function(){return O}),S.d(M,"CMCDStreamingFormat",function(){return A}),S.d(M,"CMCDStreamType",function(){return b});var C=1,O;(function(P){P.MANIFEST="m",P.AUDIO="a",P.VIDEO="v",P.MUXED="av",P.INIT="i",P.CAPTION="c",P.TIMED_TEXT="tt",P.KEY="k",P.OTHER="o"})(O||(O={}));var A;(function(P){P.DASH="d",P.HLS="h",P.SMOOTH="s",P.OTHER="o"})(A||(A={}));var b;(function(P){P.VOD="v",P.LIVE="l"})(b||(b={}))},"./src/types/demuxer.ts":function(K,M,S){S.r(M),S.d(M,"MetadataSchema",function(){return C});var C;(function(O){O.audioId3="org.id3",O.dateRange="com.apple.quicktime.HLS",O.emsg="https://aomedia.org/emsg/ID3"})(C||(C={}))},"./src/types/level.ts":function(K,M,S){S.r(M),S.d(M,"HlsSkip",function(){return A}),S.d(M,"getSkipValue",function(){return b}),S.d(M,"HlsUrlParameters",function(){return P}),S.d(M,"Level",function(){return R});function C(x,g){for(var T=0;T<g.length;T++){var p=g[T];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(x,p.key,p)}}function O(x,g,T){return g&&C(x.prototype,g),T&&C(x,T),Object.defineProperty(x,"prototype",{writable:!1}),x}var A;(function(x){x.No="",x.Yes="YES",x.v2="v2"})(A||(A={}));function b(x,g){var T=x.canSkipUntil,p=x.canSkipDateRanges,E=x.endSN,c=g!==void 0?g-E:0;return T&&c<T?p?A.v2:A.Yes:A.No}var P=function(){function x(T,p,E){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=T,this.part=p,this.skip=E}var g=x.prototype;return g.addDirectives=function(p){var E=new self.URL(p);return this.msn!==void 0&&E.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&E.searchParams.set("_HLS_part",this.part.toString()),this.skip&&E.searchParams.set("_HLS_skip",this.skip),E.toString()},x}(),R=function(){function x(g){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[g.url],this.attrs=g.attrs,this.bitrate=g.bitrate,g.details&&(this.details=g.details),this.id=g.id||0,this.name=g.name,this.width=g.width||0,this.height=g.height||0,this.audioCodec=g.audioCodec,this.videoCodec=g.videoCodec,this.unknownCodecs=g.unknownCodecs,this.codecSet=[g.videoCodec,g.audioCodec].filter(function(T){return T}).join(",").replace(/\.[^.,]+/g,"")}return O(x,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(T){var p=T%this.url.length;this._urlId!==p&&(this.details=void 0,this._urlId=p)}}]),x}()},"./src/types/loader.ts":function(K,M,S){S.r(M),S.d(M,"PlaylistContextType",function(){return C}),S.d(M,"PlaylistLevelType",function(){return O});var C;(function(A){A.MANIFEST="manifest",A.LEVEL="level",A.AUDIO_TRACK="audioTrack",A.SUBTITLE_TRACK="subtitleTrack"})(C||(C={}));var O;(function(A){A.MAIN="main",A.AUDIO="audio",A.SUBTITLE="subtitle"})(O||(O={}))},"./src/types/transmuxer.ts":function(K,M,S){S.r(M),S.d(M,"ChunkMetadata",function(){return C});var C=function(b,P,R,x,g,T){x===void 0&&(x=0),g===void 0&&(g=-1),T===void 0&&(T=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=O(),this.buffering={audio:O(),video:O(),audiovideo:O()},this.level=b,this.sn=P,this.id=R,this.size=x,this.part=g,this.partial=T};function O(){return{start:0,executeStart:0,executeEnd:0,end:0}}},"./src/utils/attr-list.ts":function(K,M,S){S.r(M),S.d(M,"AttrList",function(){return A});var C=/^(\d+)x(\d+)$/,O=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,A=function(){function b(R){typeof R=="string"&&(R=b.parseAttrList(R));for(var x in R)R.hasOwnProperty(x)&&(this[x]=R[x])}var P=b.prototype;return P.decimalInteger=function(x){var g=parseInt(this[x],10);return g>Number.MAX_SAFE_INTEGER?1/0:g},P.hexadecimalInteger=function(x){if(this[x]){var g=(this[x]||"0x").slice(2);g=(g.length&1?"0":"")+g;for(var T=new Uint8Array(g.length/2),p=0;p<g.length/2;p++)T[p]=parseInt(g.slice(p*2,p*2+2),16);return T}else return null},P.hexadecimalIntegerAsNumber=function(x){var g=parseInt(this[x],16);return g>Number.MAX_SAFE_INTEGER?1/0:g},P.decimalFloatingPoint=function(x){return parseFloat(this[x])},P.optionalFloat=function(x,g){var T=this[x];return T?parseFloat(T):g},P.enumeratedString=function(x){return this[x]},P.bool=function(x){return this[x]==="YES"},P.decimalResolution=function(x){var g=C.exec(this[x]);if(g!==null)return{width:parseInt(g[1],10),height:parseInt(g[2],10)}},b.parseAttrList=function(x){var g,T={},p='"';for(O.lastIndex=0;(g=O.exec(x))!==null;){var E=g[2];E.indexOf(p)===0&&E.lastIndexOf(p)===E.length-1&&(E=E.slice(1,-1)),T[g[1]]=E}return T},b}()},"./src/utils/binary-search.ts":function(K,M,S){S.r(M);var C={search:function(A,b){for(var P=0,R=A.length-1,x=null,g=null;P<=R;){x=(P+R)/2|0,g=A[x];var T=b(g);if(T>0)P=x+1;else if(T<0)R=x-1;else return g}return null}};M.default=C},"./src/utils/buffer-helper.ts":function(K,M,S){S.r(M),S.d(M,"BufferHelper",function(){return A});var C=S("./src/utils/logger.ts"),O={length:0,start:function(){return 0},end:function(){return 0}},A=function(){function b(){}return b.isBuffered=function(R,x){try{if(R){for(var g=b.getBuffered(R),T=0;T<g.length;T++)if(x>=g.start(T)&&x<=g.end(T))return!0}}catch{}return!1},b.bufferInfo=function(R,x,g){try{if(R){var T=b.getBuffered(R),p=[],E;for(E=0;E<T.length;E++)p.push({start:T.start(E),end:T.end(E)});return this.bufferedInfo(p,x,g)}}catch{}return{len:0,start:x,end:x,nextStart:void 0}},b.bufferedInfo=function(R,x,g){x=Math.max(0,x),R.sort(function(e,r){var m=e.start-r.start;return m||r.end-e.end});var T=[];if(g)for(var p=0;p<R.length;p++){var E=T.length;if(E){var c=T[E-1].end;R[p].start-c<g?R[p].end>c&&(T[E-1].end=R[p].end):T.push(R[p])}else T.push(R[p])}else T=R;for(var v=0,i,t=x,o=x,u=0;u<T.length;u++){var d=T[u].start,n=T[u].end;if(x+g>=d&&x<n)t=d,o=n,v=o-x;else if(x+g<d){i=d;break}}return{len:v,start:t||0,end:o||0,nextStart:i}},b.getBuffered=function(R){try{return R.buffered}catch(x){return C.logger.log("failed to get media.buffered",x),O}},b}()},"./src/utils/cea-608-parser.ts":function(K,M,S){S.r(M),S.d(M,"Row",function(){return o}),S.d(M,"CaptionScreen",function(){return u});var C=S("./src/utils/logger.ts"),O={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},A=function(f){var h=f;return O.hasOwnProperty(f)&&(h=O[f]),String.fromCharCode(h)},b=15,P=100,R={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},x={17:2,18:4,21:6,22:8,23:10,19:13,20:15},g={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},T={25:2,26:4,29:6,30:8,31:10,27:13,28:15},p=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],E;(function(l){l[l.ERROR=0]="ERROR",l[l.TEXT=1]="TEXT",l[l.WARNING=2]="WARNING",l[l.INFO=2]="INFO",l[l.DEBUG=3]="DEBUG",l[l.DATA=3]="DATA"})(E||(E={}));var c=function(){function l(){this.time=null,this.verboseLevel=E.ERROR}var f=l.prototype;return f.log=function(a,s){this.verboseLevel>=a&&C.logger.log(this.time+" ["+a+"] "+s)},l}(),v=function(f){for(var h=[],a=0;a<f.length;a++)h.push(f[a].toString(16));return h},i=function(){function l(h,a,s,y,D){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=h||"white",this.underline=a||!1,this.italics=s||!1,this.background=y||"black",this.flash=D||!1}var f=l.prototype;return f.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},f.setStyles=function(a){for(var s=["foreground","underline","italics","background","flash"],y=0;y<s.length;y++){var D=s[y];a.hasOwnProperty(D)&&(this[D]=a[D])}},f.isDefault=function(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash},f.equals=function(a){return this.foreground===a.foreground&&this.underline===a.underline&&this.italics===a.italics&&this.background===a.background&&this.flash===a.flash},f.copy=function(a){this.foreground=a.foreground,this.underline=a.underline,this.italics=a.italics,this.background=a.background,this.flash=a.flash},f.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},l}(),t=function(){function l(h,a,s,y,D,L){this.uchar=void 0,this.penState=void 0,this.uchar=h||" ",this.penState=new i(a,s,y,D,L)}var f=l.prototype;return f.reset=function(){this.uchar=" ",this.penState.reset()},f.setChar=function(a,s){this.uchar=a,this.penState.copy(s)},f.setPenState=function(a){this.penState.copy(a)},f.equals=function(a){return this.uchar===a.uchar&&this.penState.equals(a.penState)},f.copy=function(a){this.uchar=a.uchar,this.penState.copy(a.penState)},f.isEmpty=function(){return this.uchar===" "&&this.penState.isDefault()},l}(),o=function(){function l(h){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var a=0;a<P;a++)this.chars.push(new t);this.logger=h,this.pos=0,this.currPenState=new i}var f=l.prototype;return f.equals=function(a){for(var s=!0,y=0;y<P;y++)if(!this.chars[y].equals(a.chars[y])){s=!1;break}return s},f.copy=function(a){for(var s=0;s<P;s++)this.chars[s].copy(a.chars[s])},f.isEmpty=function(){for(var a=!0,s=0;s<P;s++)if(!this.chars[s].isEmpty()){a=!1;break}return a},f.setCursor=function(a){this.pos!==a&&(this.pos=a),this.pos<0?(this.logger.log(E.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>P&&(this.logger.log(E.DEBUG,"Too large cursor position "+this.pos),this.pos=P)},f.moveCursor=function(a){var s=this.pos+a;if(a>1)for(var y=this.pos+1;y<s+1;y++)this.chars[y].setPenState(this.currPenState);this.setCursor(s)},f.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},f.insertChar=function(a){a>=144&&this.backSpace();var s=A(a);if(this.pos>=P){this.logger.log(E.ERROR,"Cannot insert "+a.toString(16)+" ("+s+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(s,this.currPenState),this.moveCursor(1)},f.clearFromPos=function(a){var s;for(s=a;s<P;s++)this.chars[s].reset()},f.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},f.clearToEndOfRow=function(){this.clearFromPos(this.pos)},f.getTextString=function(){for(var a=[],s=!0,y=0;y<P;y++){var D=this.chars[y].uchar;D!==" "&&(s=!1),a.push(D)}return s?"":a.join("")},f.setPenStyles=function(a){this.currPenState.setStyles(a);var s=this.chars[this.pos];s.setPenState(this.currPenState)},l}(),u=function(){function l(h){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var a=0;a<b;a++)this.rows.push(new o(h));this.logger=h,this.currRow=b-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var f=l.prototype;return f.reset=function(){for(var a=0;a<b;a++)this.rows[a].clear();this.currRow=b-1},f.equals=function(a){for(var s=!0,y=0;y<b;y++)if(!this.rows[y].equals(a.rows[y])){s=!1;break}return s},f.copy=function(a){for(var s=0;s<b;s++)this.rows[s].copy(a.rows[s])},f.isEmpty=function(){for(var a=!0,s=0;s<b;s++)if(!this.rows[s].isEmpty()){a=!1;break}return a},f.backSpace=function(){var a=this.rows[this.currRow];a.backSpace()},f.clearToEndOfRow=function(){var a=this.rows[this.currRow];a.clearToEndOfRow()},f.insertChar=function(a){var s=this.rows[this.currRow];s.insertChar(a)},f.setPen=function(a){var s=this.rows[this.currRow];s.setPenStyles(a)},f.moveCursor=function(a){var s=this.rows[this.currRow];s.moveCursor(a)},f.setCursor=function(a){this.logger.log(E.INFO,"setCursor: "+a);var s=this.rows[this.currRow];s.setCursor(a)},f.setPAC=function(a){this.logger.log(E.INFO,"pacData = "+JSON.stringify(a));var s=a.row-1;if(this.nrRollUpRows&&s<this.nrRollUpRows-1&&(s=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==s){for(var y=0;y<b;y++)this.rows[y].clear();var D=this.currRow+1-this.nrRollUpRows,L=this.lastOutputScreen;if(L){var I=L.rows[D].cueStartTime,_=this.logger.time;if(I&&_!==null&&I<_)for(var F=0;F<this.nrRollUpRows;F++)this.rows[s-this.nrRollUpRows+F+1].copy(L.rows[D+F])}}this.currRow=s;var B=this.rows[this.currRow];if(a.indent!==null){var U=a.indent,N=Math.max(U-1,0);B.setCursor(a.indent),a.color=B.chars[N].penState.foreground}var k={foreground:a.color,underline:a.underline,italics:a.italics,background:"black",flash:!1};this.setPen(k)},f.setBkgData=function(a){this.logger.log(E.INFO,"bkgData = "+JSON.stringify(a)),this.backSpace(),this.setPen(a),this.insertChar(32)},f.setRollUpRows=function(a){this.nrRollUpRows=a},f.rollUp=function(){if(this.nrRollUpRows===null){this.logger.log(E.DEBUG,"roll_up but nrRollUpRows not set yet");return}this.logger.log(E.TEXT,this.getDisplayText());var a=this.currRow+1-this.nrRollUpRows,s=this.rows.splice(a,1)[0];s.clear(),this.rows.splice(this.currRow,0,s),this.logger.log(E.INFO,"Rolling up")},f.getDisplayText=function(a){a=a||!1;for(var s=[],y="",D=-1,L=0;L<b;L++){var I=this.rows[L].getTextString();I&&(D=L+1,a?s.push("Row "+D+": '"+I+"'"):s.push(I.trim()))}return s.length>0&&(a?y="["+s.join(" | ")+"]":y=s.join(`
`)),y},f.getTextAndFormat=function(){return this.rows},l}(),d=function(){function l(h,a,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=h,this.outputFilter=a,this.mode=null,this.verbose=0,this.displayedMemory=new u(s),this.nonDisplayedMemory=new u(s),this.lastOutputScreen=new u(s),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}var f=l.prototype;return f.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[b-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},f.getHandler=function(){return this.outputFilter},f.setHandler=function(a){this.outputFilter=a},f.setPAC=function(a){this.writeScreen.setPAC(a)},f.setBkgData=function(a){this.writeScreen.setBkgData(a)},f.setMode=function(a){a!==this.mode&&(this.mode=a,this.logger.log(E.INFO,"MODE="+a),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=a)},f.insertChars=function(a){for(var s=0;s<a.length;s++)this.writeScreen.insertChar(a[s]);var y=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(E.INFO,y+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(E.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},f.ccRCL=function(){this.logger.log(E.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},f.ccBS=function(){this.logger.log(E.INFO,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},f.ccAOF=function(){},f.ccAON=function(){},f.ccDER=function(){this.logger.log(E.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},f.ccRU=function(a){this.logger.log(E.INFO,"RU("+a+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(a)},f.ccFON=function(){this.logger.log(E.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},f.ccRDC=function(){this.logger.log(E.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},f.ccTR=function(){this.logger.log(E.INFO,"TR"),this.setMode("MODE_TEXT")},f.ccRTD=function(){this.logger.log(E.INFO,"RTD"),this.setMode("MODE_TEXT")},f.ccEDM=function(){this.logger.log(E.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},f.ccCR=function(){this.logger.log(E.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},f.ccENM=function(){this.logger.log(E.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},f.ccEOC=function(){if(this.logger.log(E.INFO,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){var a=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=a,this.writeScreen=this.nonDisplayedMemory,this.logger.log(E.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},f.ccTO=function(a){this.logger.log(E.INFO,"TO("+a+") - Tab Offset"),this.writeScreen.moveCursor(a)},f.ccMIDROW=function(a){var s={flash:!1};if(s.underline=a%2===1,s.italics=a>=46,s.italics)s.foreground="white";else{var y=Math.floor(a/2)-16,D=["white","green","blue","cyan","red","yellow","magenta"];s.foreground=D[y]}this.logger.log(E.INFO,"MIDROW: "+JSON.stringify(s)),this.writeScreen.setPen(s)},f.outputDataUpdate=function(a){a===void 0&&(a=!1);var s=this.logger.time;s!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=s:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,s,this.lastOutputScreen),a&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:s),this.lastOutputScreen.copy(this.displayedMemory))},f.cueSplitAtTime=function(a){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,a,this.displayedMemory),this.cueStartTime=a))},l}(),n=function(){function l(h,a,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var y=new c;this.channels=[null,new d(h,a,y),new d(h+1,s,y)],this.cmdHistory=m(),this.logger=y}var f=l.prototype;return f.getHandler=function(a){return this.channels[a].getHandler()},f.setHandler=function(a,s){this.channels[a].setHandler(s)},f.addData=function(a,s){var y,D,L,I=!1;this.logger.time=a;for(var _=0;_<s.length;_+=2)if(D=s[_]&127,L=s[_+1]&127,!(D===0&&L===0)){if(this.logger.log(E.DATA,"["+v([s[_],s[_+1]])+"] -> ("+v([D,L])+")"),y=this.parseCmd(D,L),y||(y=this.parseMidrow(D,L)),y||(y=this.parsePAC(D,L)),y||(y=this.parseBackgroundAttributes(D,L)),!y&&(I=this.parseChars(D,L),I)){var F=this.currentChannel;if(F&&F>0){var B=this.channels[F];B.insertChars(I)}else this.logger.log(E.WARNING,"No channel found yet. TEXT-MODE?")}!y&&!I&&this.logger.log(E.WARNING,"Couldn't parse cleaned data "+v([D,L])+" orig: "+v([s[_],s[_+1]]))}},f.parseCmd=function(a,s){var y=this.cmdHistory,D=(a===20||a===28||a===21||a===29)&&s>=32&&s<=47,L=(a===23||a===31)&&s>=33&&s<=35;if(!(D||L))return!1;if(r(a,s,y))return e(null,null,y),this.logger.log(E.DEBUG,"Repeated command ("+v([a,s])+") is dropped"),!0;var I=a===20||a===21||a===23?1:2,_=this.channels[I];return a===20||a===21||a===28||a===29?s===32?_.ccRCL():s===33?_.ccBS():s===34?_.ccAOF():s===35?_.ccAON():s===36?_.ccDER():s===37?_.ccRU(2):s===38?_.ccRU(3):s===39?_.ccRU(4):s===40?_.ccFON():s===41?_.ccRDC():s===42?_.ccTR():s===43?_.ccRTD():s===44?_.ccEDM():s===45?_.ccCR():s===46?_.ccENM():s===47&&_.ccEOC():_.ccTO(s-32),e(a,s,y),this.currentChannel=I,!0},f.parseMidrow=function(a,s){var y=0;if((a===17||a===25)&&s>=32&&s<=47){if(a===17?y=1:y=2,y!==this.currentChannel)return this.logger.log(E.ERROR,"Mismatch channel in midrow parsing"),!1;var D=this.channels[y];return D?(D.ccMIDROW(s),this.logger.log(E.DEBUG,"MIDROW ("+v([a,s])+")"),!0):!1}return!1},f.parsePAC=function(a,s){var y,D=this.cmdHistory,L=(a>=17&&a<=23||a>=25&&a<=31)&&s>=64&&s<=127,I=(a===16||a===24)&&s>=64&&s<=95;if(!(L||I))return!1;if(r(a,s,D))return e(null,null,D),!0;var _=a<=23?1:2;s>=64&&s<=95?y=_===1?R[a]:g[a]:y=_===1?x[a]:T[a];var F=this.channels[_];return F?(F.setPAC(this.interpretPAC(y,s)),e(a,s,D),this.currentChannel=_,!0):!1},f.interpretPAC=function(a,s){var y,D={color:null,italics:!1,indent:null,underline:!1,row:a};return s>95?y=s-96:y=s-64,D.underline=(y&1)===1,y<=13?D.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(y/2)]:y<=15?(D.italics=!0,D.color="white"):D.indent=Math.floor((y-16)/2)*4,D},f.parseChars=function(a,s){var y,D=null,L=null;if(a>=25?(y=2,L=a-8):(y=1,L=a),L>=17&&L<=19){var I;L===17?I=s+80:L===18?I=s+112:I=s+144,this.logger.log(E.INFO,"Special char '"+A(I)+"' in channel "+y),D=[I]}else a>=32&&a<=127&&(D=s===0?[a]:[a,s]);if(D){var _=v(D);this.logger.log(E.DEBUG,"Char codes =  "+_.join(",")),e(a,s,this.cmdHistory)}return D},f.parseBackgroundAttributes=function(a,s){var y=(a===16||a===24)&&s>=32&&s<=47,D=(a===23||a===31)&&s>=45&&s<=47;if(!(y||D))return!1;var L,I={};a===16||a===24?(L=Math.floor((s-32)/2),I.background=p[L],s%2===1&&(I.background=I.background+"_semi")):s===45?I.background="transparent":(I.foreground="black",s===47&&(I.underline=!0));var _=a<=23?1:2,F=this.channels[_];return F.setBkgData(I),e(a,s,this.cmdHistory),!0},f.reset=function(){for(var a=0;a<Object.keys(this.channels).length;a++){var s=this.channels[a];s&&s.reset()}this.cmdHistory=m()},f.cueSplitAtTime=function(a){for(var s=0;s<this.channels.length;s++){var y=this.channels[s];y&&y.cueSplitAtTime(a)}},l}();function e(l,f,h){h.a=l,h.b=f}function r(l,f,h){return h.a===l&&h.b===f}function m(){return{a:null,b:null}}M.default=n},"./src/utils/codecs.ts":function(K,M,S){S.r(M),S.d(M,"isCodecType",function(){return O}),S.d(M,"isCodecSupportedInMp4",function(){return A});var C={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function O(b,P){var R=C[P];return!!R&&R[b.slice(0,4)]===!0}function A(b,P){return MediaSource.isTypeSupported((P||"video")+'/mp4;codecs="'+b+'"')}},"./src/utils/cues.ts":function(K,M,S){S.r(M);var C=S("./src/utils/vttparser.ts"),O=S("./src/utils/webvtt-parser.ts"),A=S("./src/utils/texttrack-utils.ts"),b=/\s/,P={newCue:function(x,g,T,p){for(var E=[],c,v,i,t,o,u=self.VTTCue||self.TextTrackCue,d=0;d<p.rows.length;d++)if(c=p.rows[d],i=!0,t=0,o="",!c.isEmpty()){for(var n=0;n<c.chars.length;n++)b.test(c.chars[n].uchar)&&i?t++:(o+=c.chars[n].uchar,i=!1);c.cueStartTime=g,g===T&&(T+=1e-4),t>=16?t--:t++;var e=Object(C.fixLineBreaks)(o.trim()),r=Object(O.generateCueId)(g,T,e);(!x||!x.cues||!x.cues.getCueById(r))&&(v=new u(g,T,e),v.id=r,v.line=d+1,v.align="left",v.position=10+Math.min(80,Math.floor(t*8/32)*10),E.push(v))}return x&&E.length&&(E.sort(function(m,l){return m.line==="auto"||l.line==="auto"?0:m.line>8&&l.line>8?l.line-m.line:m.line-l.line}),E.forEach(function(m){return Object(A.addCueToTrack)(x,m)})),E}};M.default=P},"./src/utils/discontinuities.ts":function(K,M,S){S.r(M),S.d(M,"findFirstFragWithCC",function(){return b}),S.d(M,"shouldAlignOnDiscontinuities",function(){return P}),S.d(M,"findDiscontinuousReferenceFrag",function(){return R}),S.d(M,"adjustSlidingStart",function(){return g}),S.d(M,"alignStream",function(){return T}),S.d(M,"alignPDT",function(){return E}),S.d(M,"alignFragmentByPDTDelta",function(){return c}),S.d(M,"alignMediaPlaylistByPDT",function(){return v});var C=S("./src/polyfills/number.ts"),O=S("./src/utils/logger.ts"),A=S("./src/controller/level-helper.ts");function b(i,t){for(var o=null,u=0,d=i.length;u<d;u++){var n=i[u];if(n&&n.cc===t){o=n;break}}return o}function P(i,t,o){return!!(t.details&&(o.endCC>o.startCC||i&&i.cc<o.startCC))}function R(i,t){var o=i.fragments,u=t.fragments;if(!u.length||!o.length){O.logger.log("No fragments to align");return}var d=b(o,u[0].cc);if(!d||d&&!d.startPTS){O.logger.log("No frag in previous level to align on");return}return d}function x(i,t){if(i){var o=i.start+t;i.start=i.startPTS=o,i.endPTS=o+i.duration}}function g(i,t){for(var o=t.fragments,u=0,d=o.length;u<d;u++)x(o[u],i);t.fragmentHint&&x(t.fragmentHint,i),t.alignedSliding=!0}function T(i,t,o){!t||(p(i,o,t),!o.alignedSliding&&t.details&&E(o,t.details),!o.alignedSliding&&t.details&&!o.skippedSegments&&Object(A.adjustSliding)(t.details,o))}function p(i,t,o){if(P(i,o,t)){var u=R(o.details,t);u&&Object(C.isFiniteNumber)(u.start)&&(O.logger.log("Adjusting PTS using last level due to CC increase within current level "+t.url),g(u.start,t))}}function E(i,t){if(!(!t.fragments.length||!i.hasProgramDateTime||!t.hasProgramDateTime)){var o=t.fragments[0].programDateTime,u=i.fragments[0].programDateTime,d=(u-o)/1e3+t.fragments[0].start;d&&Object(C.isFiniteNumber)(d)&&(O.logger.log("Adjusting PTS using programDateTime delta "+(u-o)+"ms, sliding:"+d.toFixed(3)+" "+i.url+" "),g(d,i))}}function c(i,t){var o=i.programDateTime;if(!!o){var u=(o-t)/1e3;i.start=i.startPTS=u,i.endPTS=u+i.duration}}function v(i,t){if(!(!t.fragments.length||!i.hasProgramDateTime||!t.hasProgramDateTime)){var o=t.fragments[0].programDateTime,u=t.fragments[0].start,d=o-u*1e3;i.fragments.forEach(function(n){c(n,d)}),i.fragmentHint&&c(i.fragmentHint,d),i.alignedSliding=!0}}},"./src/utils/ewma-bandwidth-estimator.ts":function(K,M,S){S.r(M);var C=S("./src/utils/ewma.ts"),O=function(){function A(P,R,x){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=x,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new C.default(P),this.fast_=new C.default(R)}var b=A.prototype;return b.update=function(R,x){var g=this.slow_,T=this.fast_;this.slow_.halfLife!==R&&(this.slow_=new C.default(R,g.getEstimate(),g.getTotalWeight())),this.fast_.halfLife!==x&&(this.fast_=new C.default(x,T.getEstimate(),T.getTotalWeight()))},b.sample=function(R,x){R=Math.max(R,this.minDelayMs_);var g=8*x,T=R/1e3,p=g/T;this.fast_.sample(T,p),this.slow_.sample(T,p)},b.canEstimate=function(){var R=this.fast_;return R&&R.getTotalWeight()>=this.minWeight_},b.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},b.destroy=function(){},A}();M.default=O},"./src/utils/ewma.ts":function(K,M,S){S.r(M);var C=function(){function O(b,P,R){P===void 0&&(P=0),R===void 0&&(R=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=b,this.alpha_=b?Math.exp(Math.log(.5)/b):0,this.estimate_=P,this.totalWeight_=R}var A=O.prototype;return A.sample=function(P,R){var x=Math.pow(this.alpha_,P);this.estimate_=R*(1-x)+x*this.estimate_,this.totalWeight_+=P},A.getTotalWeight=function(){return this.totalWeight_},A.getEstimate=function(){if(this.alpha_){var P=1-Math.pow(this.alpha_,this.totalWeight_);if(P)return this.estimate_/P}return this.estimate_},O}();M.default=C},"./src/utils/fetch-loader.ts":function(K,M,S){S.r(M),S.d(M,"fetchSupported",function(){return c});var C=S("./src/polyfills/number.ts"),O=S("./src/loader/load-stats.ts"),A=S("./src/demux/chunk-cache.ts");function b(u,d){u.prototype=Object.create(d.prototype),u.prototype.constructor=u,T(u,d)}function P(u){var d=typeof Map=="function"?new Map:void 0;return P=function(e){if(e===null||!g(e))return e;if(typeof e!="function")throw new TypeError("Super expression must either be null or a function");if(typeof d<"u"){if(d.has(e))return d.get(e);d.set(e,r)}function r(){return R(e,arguments,p(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),T(r,e)},P(u)}function R(u,d,n){return x()?R=Reflect.construct.bind():R=function(r,m,l){var f=[null];f.push.apply(f,m);var h=Function.bind.apply(r,f),a=new h;return l&&T(a,l.prototype),a},R.apply(null,arguments)}function x(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function g(u){return Function.toString.call(u).indexOf("[native code]")!==-1}function T(u,d){return T=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,r){return e.__proto__=r,e},T(u,d)}function p(u){return p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},p(u)}function E(){return E=Object.assign?Object.assign.bind():function(u){for(var d=1;d<arguments.length;d++){var n=arguments[d];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(u[e]=n[e])}return u},E.apply(this,arguments)}function c(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}var v=function(){function u(n){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=n.fetchSetup||t,this.controller=new self.AbortController,this.stats=new O.LoadStats}var d=u.prototype;return d.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},d.abortInternal=function(){var e=this.response;(!e||!e.ok)&&(this.stats.aborted=!0,this.controller.abort())},d.abort=function(){var e;this.abortInternal(),(e=this.callbacks)!==null&&e!==void 0&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},d.load=function(e,r,m){var l=this,f=this.stats;if(f.loading.start)throw new Error("Loader can only be used once.");f.loading.start=self.performance.now();var h=i(e,this.controller.signal),a=m.onProgress,s=e.responseType==="arraybuffer",y=s?"byteLength":"length";this.context=e,this.config=r,this.callbacks=m,this.request=this.fetchSetup(e,h),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(function(){l.abortInternal(),m.onTimeout(f,e,l.response)},r.timeout),self.fetch(this.request).then(function(D){if(l.response=l.loader=D,!D.ok){var L=D.status,I=D.statusText;throw new o(I||"fetch, bad network response",L,D)}return f.loading.first=Math.max(self.performance.now(),f.loading.start),f.total=parseInt(D.headers.get("Content-Length")||"0"),a&&Object(C.isFiniteNumber)(r.highWaterMark)?l.loadProgressively(D,f,e,r.highWaterMark,a):s?D.arrayBuffer():D.text()}).then(function(D){var L=l.response;self.clearTimeout(l.requestTimeout),f.loading.end=Math.max(self.performance.now(),f.loading.first),f.loaded=f.total=D[y];var I={url:L.url,data:D};a&&!Object(C.isFiniteNumber)(r.highWaterMark)&&a(f,e,D,L),m.onSuccess(I,f,e,L)}).catch(function(D){if(self.clearTimeout(l.requestTimeout),!f.aborted){var L=D&&D.code||0,I=D?D.message:null;m.onError({code:L,text:I},e,D?D.details:null)}})},d.getCacheAge=function(){var e=null;if(this.response){var r=this.response.headers.get("age");e=r?parseFloat(r):null}return e},d.loadProgressively=function(e,r,m,l,f){l===void 0&&(l=0);var h=new A.default,a=e.body.getReader(),s=function y(){return a.read().then(function(D){if(D.done)return h.dataLength&&f(r,m,h.flush(),e),Promise.resolve(new ArrayBuffer(0));var L=D.value,I=L.length;return r.loaded+=I,I<l||h.dataLength?(h.push(L),h.dataLength>=l&&f(r,m,h.flush(),e)):f(r,m,L,e),y()}).catch(function(){return Promise.reject()})};return s()},u}();function i(u,d){var n={method:"GET",mode:"cors",credentials:"same-origin",signal:d,headers:new self.Headers(E({},u.headers))};return u.rangeEnd&&n.headers.set("Range","bytes="+u.rangeStart+"-"+String(u.rangeEnd-1)),n}function t(u,d){return new self.Request(u.url,d)}var o=function(u){b(d,u);function d(n,e,r){var m;return m=u.call(this,n)||this,m.code=void 0,m.details=void 0,m.code=e,m.details=r,m}return d}(P(Error));M.default=v},"./src/utils/imsc1-ttml-parser.ts":function(K,M,S){S.r(M),S.d(M,"IMSC1_CODEC",function(){return g}),S.d(M,"parseIMSC1",function(){return c});var C=S("./src/utils/mp4-tools.ts"),O=S("./src/utils/vttparser.ts"),A=S("./src/utils/vttcue.ts"),b=S("./src/demux/id3.ts"),P=S("./src/utils/timescale-conversion.ts"),R=S("./src/utils/webvtt-parser.ts");function x(){return x=Object.assign?Object.assign.bind():function(l){for(var f=1;f<arguments.length;f++){var h=arguments[f];for(var a in h)Object.prototype.hasOwnProperty.call(h,a)&&(l[a]=h[a])}return l},x.apply(this,arguments)}var g="stpp.ttml.im1t",T=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,p=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,E={left:"start",center:"center",right:"end",start:"start",end:"end"};function c(l,f,h,a,s){var y=Object(C.findBox)(new Uint8Array(l),["mdat"]);if(y.length===0){s(new Error("Could not parse IMSC1 mdat"));return}var D=y.map(function(I){return Object(b.utf8ArrayToStr)(I)}),L=Object(P.toTimescaleFromScale)(f,1,h);try{D.forEach(function(I){return a(v(I,L))})}catch(I){s(I)}}function v(l,f){var h=new DOMParser,a=h.parseFromString(l,"text/xml"),s=a.getElementsByTagName("tt")[0];if(!s)throw new Error("Invalid ttml");var y={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},D=Object.keys(y).reduce(function(B,U){return B[U]=s.getAttribute("ttp:"+U)||y[U],B},{}),L=s.getAttribute("xml:space")!=="preserve",I=t(i(s,"styling","style")),_=t(i(s,"layout","region")),F=i(s,"body","[begin]");return[].map.call(F,function(B){var U=o(B,L);if(!U||!B.hasAttribute("begin"))return null;var N=e(B.getAttribute("begin"),D),k=e(B.getAttribute("dur"),D),w=e(B.getAttribute("end"),D);if(N===null)throw n(B);if(w===null){if(k===null)throw n(B);w=N+k}var W=new A.default(N-f,w-f,U);W.id=Object(R.generateCueId)(W.startTime,W.endTime,W.text);var j=_[B.getAttribute("region")],H=I[B.getAttribute("style")];W.position=10,W.size=80;var G=u(j,H,I),$=G.textAlign;if($){var z=E[$];z&&(W.lineAlign=z),W.align=$}return x(W,G),W}).filter(function(B){return B!==null})}function i(l,f,h){var a=l.getElementsByTagName(f)[0];return a?[].slice.call(a.querySelectorAll(h)):[]}function t(l){return l.reduce(function(f,h){var a=h.getAttribute("xml:id");return a&&(f[a]=h),f},{})}function o(l,f){return[].slice.call(l.childNodes).reduce(function(h,a,s){var y;return a.nodeName==="br"&&s?h+`
`:(y=a.childNodes)!==null&&y!==void 0&&y.length?o(a,f):f?h+a.textContent.trim().replace(/\s+/g," "):h+a.textContent},"")}function u(l,f,h){var a="http://www.w3.org/ns/ttml#styling",s=null,y=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],D=l!=null&&l.hasAttribute("style")?l.getAttribute("style"):null;return D&&h.hasOwnProperty(D)&&(s=h[D]),y.reduce(function(L,I){var _=d(f,a,I)||d(l,a,I)||d(s,a,I);return _&&(L[I]=_),L},{})}function d(l,f,h){return l&&l.hasAttributeNS(f,h)?l.getAttributeNS(f,h):null}function n(l){return new Error("Could not parse ttml timestamp "+l)}function e(l,f){if(!l)return null;var h=Object(O.parseTimeStamp)(l);return h===null&&(T.test(l)?h=r(l,f):p.test(l)&&(h=m(l,f))),h}function r(l,f){var h=T.exec(l),a=(h[4]|0)+(h[5]|0)/f.subFrameRate;return(h[1]|0)*3600+(h[2]|0)*60+(h[3]|0)+a/f.frameRate}function m(l,f){var h=p.exec(l),a=Number(h[1]),s=h[2];switch(s){case"h":return a*3600;case"m":return a*60;case"ms":return a*1e3;case"f":return a/f.frameRate;case"t":return a/f.tickRate}return a}},"./src/utils/logger.ts":function(K,M,S){S.r(M),S.d(M,"enableLogs",function(){return R}),S.d(M,"logger",function(){return x});var C=function(){},O={trace:C,debug:C,log:C,warn:C,info:C,error:C},A=O;function b(g){var T=self.console[g];return T?T.bind(self.console,"["+g+"] >"):C}function P(g){for(var T=arguments.length,p=new Array(T>1?T-1:0),E=1;E<T;E++)p[E-1]=arguments[E];p.forEach(function(c){A[c]=g[c]?g[c].bind(g):b(c)})}function R(g){if(self.console&&g===!0||typeof g=="object"){P(g,"debug","log","info","warn","error");try{A.log()}catch{A=O}}else A=O}var x=A},"./src/utils/mediakeys-helper.ts":function(K,M,S){S.r(M),S.d(M,"KeySystems",function(){return C}),S.d(M,"requestMediaKeySystemAccess",function(){return O});var C;(function(A){A.WIDEVINE="com.widevine.alpha",A.PLAYREADY="com.microsoft.playready"})(C||(C={}));var O=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}()},"./src/utils/mediasource-helper.ts":function(K,M,S){S.r(M),S.d(M,"getMediaSource",function(){return C});function C(){return self.MediaSource||self.WebKitMediaSource}},"./src/utils/mp4-tools.ts":function(K,M,S){S.r(M),S.d(M,"RemuxerTrackIdConfig",function(){return R}),S.d(M,"bin2str",function(){return x}),S.d(M,"readUint16",function(){return g}),S.d(M,"readUint32",function(){return T}),S.d(M,"readSint32",function(){return p}),S.d(M,"writeUint32",function(){return E}),S.d(M,"findBox",function(){return c}),S.d(M,"parseSegmentIndex",function(){return v}),S.d(M,"parseInitSegment",function(){return i}),S.d(M,"getStartDTS",function(){return t}),S.d(M,"getDuration",function(){return o}),S.d(M,"computeRawDurationFromSamples",function(){return u}),S.d(M,"offsetStartDTS",function(){return d}),S.d(M,"segmentValidRange",function(){return n}),S.d(M,"appendUint8Array",function(){return e}),S.d(M,"parseSamples",function(){return r}),S.d(M,"parseSEIMessageFromNALu",function(){return f}),S.d(M,"parseEmsg",function(){return a});var C=S("./src/utils/typed-array.ts"),O=S("./src/loader/fragment.ts"),A=S("./src/demux/id3.ts"),b=Math.pow(2,32)-1,P=[].push,R={video:1,audio:2,id3:3,text:4};function x(s){return String.fromCharCode.apply(null,s)}function g(s,y){var D=s[y]<<8|s[y+1];return D<0?65536+D:D}function T(s,y){var D=p(s,y);return D<0?4294967296+D:D}function p(s,y){return s[y]<<24|s[y+1]<<16|s[y+2]<<8|s[y+3]}function E(s,y,D){s[y]=D>>24,s[y+1]=D>>16&255,s[y+2]=D>>8&255,s[y+3]=D&255}function c(s,y){var D=[];if(!y.length)return D;for(var L=s.byteLength,I=0;I<L;){var _=T(s,I),F=x(s.subarray(I+4,I+8)),B=_>1?I+_:L;if(F===y[0])if(y.length===1)D.push(s.subarray(I+8,B));else{var U=c(s.subarray(I+8,B),y.slice(1));U.length&&P.apply(D,U)}I=B}return D}function v(s){var y=[],D=s[0],L=8,I=T(s,L);L+=4;var _=0,F=0;D===0?L+=8:L+=16,L+=2;var B=s.length+F,U=g(s,L);L+=2;for(var N=0;N<U;N++){var k=L,w=T(s,k);k+=4;var W=w&2147483647,j=(w&2147483648)>>>31;if(j===1)return console.warn("SIDX has hierarchical references (not supported)"),null;var H=T(s,k);k+=4,y.push({referenceSize:W,subsegmentDuration:H,info:{duration:H/I,start:B,end:B+W-1}}),B+=W,k+=4,L=k}return{earliestPresentationTime:_,timescale:I,version:D,referencesCount:U,references:y}}function i(s){for(var y=[],D=c(s,["moov","trak"]),L=0;L<D.length;L++){var I=D[L],_=c(I,["tkhd"])[0];if(_){var F=_[0],B=F===0?12:20,U=T(_,B),N=c(I,["mdia","mdhd"])[0];if(N){F=N[0],B=F===0?12:20;var k=T(N,B),w=c(I,["mdia","hdlr"])[0];if(w){var W=x(w.subarray(8,12)),j={soun:O.ElementaryStreamTypes.AUDIO,vide:O.ElementaryStreamTypes.VIDEO}[W];if(j){var H=c(I,["mdia","minf","stbl","stsd"])[0],G=void 0;H&&(G=x(H.subarray(12,16))),y[U]={timescale:k,type:j},y[j]={timescale:k,id:U,codec:G}}}}}}var $=c(s,["moov","mvex","trex"]);return $.forEach(function(z){var X=T(z,4),V=y[X];V&&(V.default={duration:T(z,12),flags:T(z,20)})}),y}function t(s,y){return c(y,["moof","traf"]).reduce(function(D,L){var I=c(L,["tfdt"])[0],_=I[0],F=c(L,["tfhd"]).reduce(function(B,U){var N=T(U,4),k=s[N];if(k){var w=T(I,4);_===1&&(w*=Math.pow(2,32),w+=T(I,8));var W=k.timescale||9e4,j=w/W;if(isFinite(j)&&(B===null||j<B))return j}return B},null);return F!==null&&isFinite(F)&&(D===null||F<D)?F:D},null)||0}function o(s,y){for(var D=0,L=0,I=0,_=c(s,["moof","traf"]),F=0;F<_.length;F++){var B=_[F],U=c(B,["tfhd"])[0],N=T(U,4),k=y[N];if(!!k){var w=k.default,W=T(U,0)|(w==null?void 0:w.flags),j=w==null?void 0:w.duration;W&8&&(W&2?j=T(U,12):j=T(U,8));for(var H=k.timescale||9e4,G=c(B,["trun"]),$=0;$<G.length;$++){if(D=u(G[$]),!D&&j){var z=T(G[$],4);D=j*z}k.type===O.ElementaryStreamTypes.VIDEO?L+=D/H:k.type===O.ElementaryStreamTypes.AUDIO&&(I+=D/H)}}}if(L===0&&I===0){for(var X=0,V=c(s,["sidx"]),Y=0;Y<V.length;Y++){var Q=v(V[Y]);Q!=null&&Q.references&&(X+=Q.references.reduce(function(J,Z){return J+Z.info.duration||0},0))}return X}return L||I}function u(s){var y=T(s,0),D=8;y&1&&(D+=4),y&4&&(D+=4);for(var L=0,I=T(s,4),_=0;_<I;_++){if(y&256){var F=T(s,D);L+=F,D+=4}y&512&&(D+=4),y&1024&&(D+=4),y&2048&&(D+=4)}return L}function d(s,y,D){c(y,["moof","traf"]).forEach(function(L){c(L,["tfhd"]).forEach(function(I){var _=T(I,4),F=s[_];if(!!F){var B=F.timescale||9e4;c(L,["tfdt"]).forEach(function(U){var N=U[0],k=T(U,4);if(N===0)k-=D*B,k=Math.max(k,0),E(U,4,k);else{k*=Math.pow(2,32),k+=T(U,8),k-=D*B,k=Math.max(k,0);var w=Math.floor(k/(b+1)),W=Math.floor(k%(b+1));E(U,4,w),E(U,8,W)}})}})})}function n(s){var y={valid:null,remainder:null},D=c(s,["moof"]);if(D){if(D.length<2)return y.remainder=s,y}else return y;var L=D[D.length-1];return y.valid=Object(C.sliceUint8)(s,0,L.byteOffset-8),y.remainder=Object(C.sliceUint8)(s,L.byteOffset-8),y}function e(s,y){var D=new Uint8Array(s.length+y.length);return D.set(s),D.set(y,s.length),D}function r(s,y){var D=[],L=y.samples,I=y.timescale,_=y.id,F=!1,B=c(L,["moof"]);return B.map(function(U){var N=U.byteOffset-8,k=c(U,["traf"]);k.map(function(w){var W=c(w,["tfdt"]).map(function(j){var H=j[0],G=T(j,4);return H===1&&(G*=Math.pow(2,32),G+=T(j,8)),G/I})[0];return W!==void 0&&(s=W),c(w,["tfhd"]).map(function(j){var H=T(j,4),G=T(j,0)&16777215,$=(G&1)!==0,z=(G&2)!==0,X=(G&8)!==0,V=0,Y=(G&16)!==0,Q=0,J=(G&32)!==0,Z=8;H===_&&($&&(Z+=8),z&&(Z+=4),X&&(V=T(j,Z),Z+=4),Y&&(Q=T(j,Z),Z+=4),J&&(Z+=4),y.type==="video"&&(F=m(y.codec)),c(w,["trun"]).map(function(q){var tt=q[0],et=T(q,0)&16777215,rt=(et&1)!==0,st=0,ut=(et&4)!==0,ft=(et&256)!==0,nt=0,yt=(et&512)!==0,dt=0,ot=(et&1024)!==0,gt=(et&2048)!==0,pt=0,mt=T(q,4),it=8;rt&&(st=T(q,it),it+=4),ut&&(it+=4);for(var lt=st+N,ht=0;ht<mt;ht++){if(ft?(nt=T(q,it),it+=4):nt=V,yt?(dt=T(q,it),it+=4):dt=Q,ot&&(it+=4),gt&&(tt===0?pt=T(q,it):pt=p(q,it),it+=4),y.type===O.ElementaryStreamTypes.VIDEO)for(var ct=0;ct<dt;){var Et=T(L,lt);lt+=4;var at=L[lt]&31;if(l(F,at)){var vt=L.subarray(lt,lt+Et);f(vt,s+pt/I,D)}lt+=Et,ct+=Et+4}s+=nt/I}}))})})}),D}function m(s){if(!s)return!1;var y=s.indexOf("."),D=y<0?s:s.substring(0,y);return D==="hvc1"||D==="hev1"||D==="dvh1"||D==="dvhe"}function l(s,y){return s?y===39||y===40:y===6}function f(s,y,D){var L=h(s),I=0;I++;for(var _=0,F=0,B=!1,U=0;I<L.length;){_=0;do{if(I>=L.length)break;U=L[I++],_+=U}while(U===255);F=0;do{if(I>=L.length)break;U=L[I++],F+=U}while(U===255);var N=L.length-I;if(!B&&_===4&&I<L.length){B=!0;var k=L[I++];if(k===181){var w=g(L,I);if(I+=2,w===49){var W=T(L,I);if(I+=4,W===1195456820){var j=L[I++];if(j===3){var H=L[I++],G=31&H,$=64&H,z=$?2+G*3:0,X=new Uint8Array(z);if($){X[0]=H;for(var V=1;V<z;V++)X[V]=L[I++]}D.push({type:j,payloadType:_,pts:y,bytes:X})}}}}}else if(_===5&&F<N){if(B=!0,F>16){for(var Y=[],Q=0;Q<16;Q++){var J=L[I++].toString(16);Y.push(J.length==1?"0"+J:J),(Q===3||Q===5||Q===7||Q===9)&&Y.push("-")}for(var Z=F-16,q=new Uint8Array(Z),tt=0;tt<Z;tt++)q[tt]=L[I++];D.push({payloadType:_,pts:y,uuid:Y.join(""),userData:Object(A.utf8ArrayToStr)(q),userDataBytes:q})}}else if(F<N)I+=F;else if(F>N)break}}function h(s){for(var y=s.byteLength,D=[],L=1;L<y-2;)s[L]===0&&s[L+1]===0&&s[L+2]===3?(D.push(L+2),L+=2):L++;if(D.length===0)return s;var I=y-D.length,_=new Uint8Array(I),F=0;for(L=0;L<I;F++,L++)F===D[0]&&(F++,D.shift()),_[L]=s[F];return _}function a(s){var y=s[0],D="",L="",I=0,_=0,F=0,B=0,U=0,N=0;if(y===0){for(;x(s.subarray(N,N+1))!=="\0";)D+=x(s.subarray(N,N+1)),N+=1;for(D+=x(s.subarray(N,N+1)),N+=1;x(s.subarray(N,N+1))!=="\0";)L+=x(s.subarray(N,N+1)),N+=1;L+=x(s.subarray(N,N+1)),N+=1,I=T(s,12),_=T(s,16),B=T(s,20),U=T(s,24),N=28}else if(y===1){N+=4,I=T(s,N),N+=4;var k=T(s,N);N+=4;var w=T(s,N);for(N+=4,F=Math.pow(2,32)*k+w,Number.isSafeInteger(F)||(F=Number.MAX_SAFE_INTEGER,console.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),B=T(s,N),N+=4,U=T(s,N),N+=4;x(s.subarray(N,N+1))!=="\0";)D+=x(s.subarray(N,N+1)),N+=1;for(D+=x(s.subarray(N,N+1)),N+=1;x(s.subarray(N,N+1))!=="\0";)L+=x(s.subarray(N,N+1)),N+=1;L+=x(s.subarray(N,N+1)),N+=1}var W=s.subarray(N,s.byteLength);return{schemeIdUri:D,value:L,timeScale:I,presentationTime:F,presentationTimeDelta:_,eventDuration:B,id:U,payload:W}}},"./src/utils/output-filter.ts":function(K,M,S){S.r(M),S.d(M,"default",function(){return C});var C=function(){function O(b,P){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=b,this.trackName=P}var A=O.prototype;return A.dispatchCue=function(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},A.newCue=function(P,R,x){(this.startTime===null||this.startTime>P)&&(this.startTime=P),this.endTime=R,this.screen=x,this.timelineController.createCaptionsTrack(this.trackName)},A.reset=function(){this.cueRanges=[],this.startTime=null},O}()},"./src/utils/texttrack-utils.ts":function(K,M,S){S.r(M),S.d(M,"sendAddTrackEvent",function(){return O}),S.d(M,"addCueToTrack",function(){return A}),S.d(M,"clearCurrentCues",function(){return b}),S.d(M,"removeCuesInRange",function(){return P}),S.d(M,"getCuesInRange",function(){return x});var C=S("./src/utils/logger.ts");function O(g,T){var p;try{p=new Event("addtrack")}catch{p=document.createEvent("Event"),p.initEvent("addtrack",!1,!1)}p.track=g,T.dispatchEvent(p)}function A(g,T){var p=g.mode;if(p==="disabled"&&(g.mode="hidden"),g.cues&&!g.cues.getCueById(T.id))try{if(g.addCue(T),!g.cues.getCueById(T.id))throw new Error("addCue is failed for: "+T)}catch(c){C.logger.debug("[texttrack-utils]: "+c);var E=new self.TextTrackCue(T.startTime,T.endTime,T.text);E.id=T.id,g.addCue(E)}p==="disabled"&&(g.mode=p)}function b(g){var T=g.mode;if(T==="disabled"&&(g.mode="hidden"),g.cues)for(var p=g.cues.length;p--;)g.removeCue(g.cues[p]);T==="disabled"&&(g.mode=T)}function P(g,T,p,E){var c=g.mode;if(c==="disabled"&&(g.mode="hidden"),g.cues&&g.cues.length>0)for(var v=x(g.cues,T,p),i=0;i<v.length;i++)(!E||E(v[i]))&&g.removeCue(v[i]);c==="disabled"&&(g.mode=c)}function R(g,T){if(T<g[0].startTime)return 0;var p=g.length-1;if(T>g[p].endTime)return-1;for(var E=0,c=p;E<=c;){var v=Math.floor((c+E)/2);if(T<g[v].startTime)c=v-1;else if(T>g[v].startTime&&E<p)E=v+1;else return v}return g[E].startTime-T<T-g[c].startTime?E:c}function x(g,T,p){var E=[],c=R(g,T);if(c>-1)for(var v=c,i=g.length;v<i;v++){var t=g[v];if(t.startTime>=T&&t.endTime<=p)E.push(t);else if(t.startTime>p)return E}return E}},"./src/utils/time-ranges.ts":function(K,M,S){S.r(M);var C={toString:function(A){for(var b="",P=A.length,R=0;R<P;R++)b+="["+A.start(R).toFixed(3)+","+A.end(R).toFixed(3)+"]";return b}};M.default=C},"./src/utils/timescale-conversion.ts":function(K,M,S){S.r(M),S.d(M,"toTimescaleFromBase",function(){return O}),S.d(M,"toTimescaleFromScale",function(){return A}),S.d(M,"toMsFromMpegTsClock",function(){return b}),S.d(M,"toMpegTsClockFromTimescale",function(){return P});var C=9e4;function O(R,x,g,T){g===void 0&&(g=1),T===void 0&&(T=!1);var p=R*x*g;return T?Math.round(p):p}function A(R,x,g,T){return g===void 0&&(g=1),T===void 0&&(T=!1),O(R,x,1/g,T)}function b(R,x){return x===void 0&&(x=!1),O(R,1e3,1/C,x)}function P(R,x){return x===void 0&&(x=1),O(R,C,1/x)}},"./src/utils/typed-array.ts":function(K,M,S){S.r(M),S.d(M,"sliceUint8",function(){return C});function C(O,A,b){return Uint8Array.prototype.slice?O.slice(A,b):new Uint8Array(Array.prototype.slice.call(O,A,b))}},"./src/utils/vttcue.ts":function(K,M,S){S.r(M),M.default=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;var C=["","lr","rl"],O=["start","middle","end","left","right"];function A(g,T){if(typeof T!="string"||!Array.isArray(g))return!1;var p=T.toLowerCase();return~g.indexOf(p)?p:!1}function b(g){return A(C,g)}function P(g){return A(O,g)}function R(g){for(var T=arguments.length,p=new Array(T>1?T-1:0),E=1;E<T;E++)p[E-1]=arguments[E];for(var c=1;c<arguments.length;c++){var v=arguments[c];for(var i in v)g[i]=v[i]}return g}function x(g,T,p){var E=this,c={enumerable:!0};E.hasBeenReset=!1;var v="",i=!1,t=g,o=T,u=p,d=null,n="",e=!0,r="auto",m="start",l=50,f="middle",h=50,a="middle";Object.defineProperty(E,"id",R({},c,{get:function(){return v},set:function(y){v=""+y}})),Object.defineProperty(E,"pauseOnExit",R({},c,{get:function(){return i},set:function(y){i=!!y}})),Object.defineProperty(E,"startTime",R({},c,{get:function(){return t},set:function(y){if(typeof y!="number")throw new TypeError("Start time must be set to a number.");t=y,this.hasBeenReset=!0}})),Object.defineProperty(E,"endTime",R({},c,{get:function(){return o},set:function(y){if(typeof y!="number")throw new TypeError("End time must be set to a number.");o=y,this.hasBeenReset=!0}})),Object.defineProperty(E,"text",R({},c,{get:function(){return u},set:function(y){u=""+y,this.hasBeenReset=!0}})),Object.defineProperty(E,"region",R({},c,{get:function(){return d},set:function(y){d=y,this.hasBeenReset=!0}})),Object.defineProperty(E,"vertical",R({},c,{get:function(){return n},set:function(y){var D=b(y);if(D===!1)throw new SyntaxError("An invalid or illegal string was specified.");n=D,this.hasBeenReset=!0}})),Object.defineProperty(E,"snapToLines",R({},c,{get:function(){return e},set:function(y){e=!!y,this.hasBeenReset=!0}})),Object.defineProperty(E,"line",R({},c,{get:function(){return r},set:function(y){if(typeof y!="number"&&y!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");r=y,this.hasBeenReset=!0}})),Object.defineProperty(E,"lineAlign",R({},c,{get:function(){return m},set:function(y){var D=P(y);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");m=D,this.hasBeenReset=!0}})),Object.defineProperty(E,"position",R({},c,{get:function(){return l},set:function(y){if(y<0||y>100)throw new Error("Position must be between 0 and 100.");l=y,this.hasBeenReset=!0}})),Object.defineProperty(E,"positionAlign",R({},c,{get:function(){return f},set:function(y){var D=P(y);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");f=D,this.hasBeenReset=!0}})),Object.defineProperty(E,"size",R({},c,{get:function(){return h},set:function(y){if(y<0||y>100)throw new Error("Size must be between 0 and 100.");h=y,this.hasBeenReset=!0}})),Object.defineProperty(E,"align",R({},c,{get:function(){return a},set:function(y){var D=P(y);if(!D)throw new SyntaxError("An invalid or illegal string was specified.");a=D,this.hasBeenReset=!0}})),E.displayState=void 0}return x.prototype.getCueAsHTML=function(){var g=self.WebVTT;return g.convertCueToDOMTree(self,this.text)},x}()},"./src/utils/vttparser.ts":function(K,M,S){S.r(M),S.d(M,"parseTimeStamp",function(){return A}),S.d(M,"fixLineBreaks",function(){return T}),S.d(M,"VTTParser",function(){return p});var C=S("./src/utils/vttcue.ts"),O=function(){function E(){}var c=E.prototype;return c.decode=function(i,t){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))},E}();function A(E){function c(i,t,o,u){return(i|0)*3600+(t|0)*60+(o|0)+parseFloat(u||0)}var v=E.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return v?parseFloat(v[2])>59?c(v[2],v[3],0,v[4]):c(v[1],v[2],v[3],v[4]):null}var b=function(){function E(){this.values=Object.create(null)}var c=E.prototype;return c.set=function(i,t){!this.get(i)&&t!==""&&(this.values[i]=t)},c.get=function(i,t,o){return o?this.has(i)?this.values[i]:t[o]:this.has(i)?this.values[i]:t},c.has=function(i){return i in this.values},c.alt=function(i,t,o){for(var u=0;u<o.length;++u)if(t===o[u]){this.set(i,t);break}},c.integer=function(i,t){/^-?\d+$/.test(t)&&this.set(i,parseInt(t,10))},c.percent=function(i,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){var o=parseFloat(t);if(o>=0&&o<=100)return this.set(i,o),!0}return!1},E}();function P(E,c,v,i){var t=i?E.split(i):[E];for(var o in t)if(typeof t[o]=="string"){var u=t[o].split(v);if(u.length===2){var d=u[0],n=u[1];c(d,n)}}}var R=new C.default(0,0,""),x=R.align==="middle"?"middle":"center";function g(E,c,v){var i=E;function t(){var d=A(E);if(d===null)throw new Error("Malformed timestamp: "+i);return E=E.replace(/^[^\sa-zA-Z-]+/,""),d}function o(d,n){var e=new b;P(d,function(l,f){var h;switch(l){case"region":for(var a=v.length-1;a>=0;a--)if(v[a].id===f){e.set(l,v[a].region);break}break;case"vertical":e.alt(l,f,["rl","lr"]);break;case"line":h=f.split(","),e.integer(l,h[0]),e.percent(l,h[0])&&e.set("snapToLines",!1),e.alt(l,h[0],["auto"]),h.length===2&&e.alt("lineAlign",h[1],["start",x,"end"]);break;case"position":h=f.split(","),e.percent(l,h[0]),h.length===2&&e.alt("positionAlign",h[1],["start",x,"end","line-left","line-right","auto"]);break;case"size":e.percent(l,f);break;case"align":e.alt(l,f,["start",x,"end","left","right"]);break}},/:/,/\s/),n.region=e.get("region",null),n.vertical=e.get("vertical","");var r=e.get("line","auto");r==="auto"&&R.line===-1&&(r=-1),n.line=r,n.lineAlign=e.get("lineAlign","start"),n.snapToLines=e.get("snapToLines",!0),n.size=e.get("size",100),n.align=e.get("align",x);var m=e.get("position","auto");m==="auto"&&R.position===50&&(m=n.align==="start"||n.align==="left"?0:n.align==="end"||n.align==="right"?100:50),n.position=m}function u(){E=E.replace(/^\s+/,"")}if(u(),c.startTime=t(),u(),E.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+i);E=E.slice(3),u(),c.endTime=t(),u(),o(E,c)}function T(E){return E.replace(/<br(?: \/)?>/gi,`
`)}var p=function(){function E(){this.state="INITIAL",this.buffer="",this.decoder=new O,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var c=E.prototype;return c.parse=function(i){var t=this;i&&(t.buffer+=t.decoder.decode(i,{stream:!0}));function o(){var m=t.buffer,l=0;for(m=T(m);l<m.length&&m[l]!=="\r"&&m[l]!==`
`;)++l;var f=m.slice(0,l);return m[l]==="\r"&&++l,m[l]===`
`&&++l,t.buffer=m.slice(l),f}function u(m){P(m,function(l,f){},/:/)}try{var d="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;d=o();var n=d.match(/^()?WEBVTT([ \t].*)?$/);if(!n||!n[0])throw new Error("Malformed WebVTT signature.");t.state="HEADER"}for(var e=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(e?e=!1:d=o(),t.state){case"HEADER":/:/.test(d)?u(d):d||(t.state="ID");continue;case"NOTE":d||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(d)){t.state="NOTE";break}if(!d)continue;if(t.cue=new C.default(0,0,""),t.state="CUE",d.indexOf("-->")===-1){t.cue.id=d;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{g(d,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{var r=d.indexOf("-->")!==-1;if(!d||r&&(e=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=d}continue;case"BADCUE":d||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this},c.flush=function(){var i=this;try{if((i.cue||i.state==="HEADER")&&(i.buffer+=`

`,i.parse()),i.state==="INITIAL"||i.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){i.onparsingerror&&i.onparsingerror(t)}return i.onflush&&i.onflush(),this},E}()},"./src/utils/webvtt-parser.ts":function(K,M,S){S.r(M),S.d(M,"generateCueId",function(){return p}),S.d(M,"parseWebVTT",function(){return c});var C=S("./src/polyfills/number.ts"),O=S("./src/utils/vttparser.ts"),A=S("./src/demux/id3.ts"),b=S("./src/utils/timescale-conversion.ts"),P=S("./src/remux/mp4-remuxer.ts"),R=/\r\n|\n\r|\n|\r/g,x=function(i,t,o){return o===void 0&&(o=0),i.slice(o,o+t.length)===t},g=function(i){var t=parseInt(i.slice(-3)),o=parseInt(i.slice(-6,-4)),u=parseInt(i.slice(-9,-7)),d=i.length>9?parseInt(i.substring(0,i.indexOf(":"))):0;if(!Object(C.isFiniteNumber)(t)||!Object(C.isFiniteNumber)(o)||!Object(C.isFiniteNumber)(u)||!Object(C.isFiniteNumber)(d))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+i);return t+=1e3*o,t+=60*1e3*u,t+=60*60*1e3*d,t},T=function(i){for(var t=5381,o=i.length;o;)t=t*33^i.charCodeAt(--o);return(t>>>0).toString()};function p(v,i,t){return T(v.toString())+T(i.toString())+T(t)}var E=function(i,t,o){var u=i[t],d=i[u.prevCC];if(!d||!d.new&&u.new){i.ccOffset=i.presentationOffset=u.start,u.new=!1;return}for(;(n=d)!==null&&n!==void 0&&n.new;){var n;i.ccOffset+=u.start-d.start,u.new=!1,u=d,d=i[u.prevCC]}i.presentationOffset=o};function c(v,i,t,o,u,d,n,e){var r=new O.VTTParser,m=Object(A.utf8ArrayToStr)(new Uint8Array(v)).trim().replace(R,`
`).split(`
`),l=[],f=Object(b.toMpegTsClockFromTimescale)(i,t),h="00:00.000",a=0,s=0,y,D=!0;r.oncue=function(L){var I=o[u],_=o.ccOffset,F=(a-f)/9e4;I!=null&&I.new&&(s!==void 0?_=o.ccOffset=I.start:E(o,u,F)),F&&(_=F-o.presentationOffset);var B=L.endTime-L.startTime,U=Object(P.normalizePts)((L.startTime+_-s)*9e4,d*9e4)/9e4;L.startTime=Math.max(U,0),L.endTime=Math.max(U+B,0);var N=L.text.trim();L.text=decodeURIComponent(encodeURIComponent(N)),L.id||(L.id=p(L.startTime,L.endTime,N)),L.endTime>0&&l.push(L)},r.onparsingerror=function(L){y=L},r.onflush=function(){if(y){e(y);return}n(l)},m.forEach(function(L){if(D)if(x(L,"X-TIMESTAMP-MAP=")){D=!1,L.slice(16).split(",").forEach(function(I){x(I,"LOCAL:")?h=I.slice(6):x(I,"MPEGTS:")&&(a=parseInt(I.slice(7)))});try{s=g(h)/1e3}catch(I){y=I}return}else L===""&&(D=!1);r.parse(L+`
`)}),r.flush()}},"./src/utils/xhr-loader.ts":function(K,M,S){S.r(M);var C=S("./src/utils/logger.ts"),O=S("./src/loader/load-stats.ts"),A=/^age:\s*[\d.]+\s*$/m,b=function(){function P(x){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=x?x.xhrSetup:null,this.stats=new O.LoadStats,this.retryDelay=0}var R=P.prototype;return R.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},R.abortInternal=function(){var g=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),g&&(g.onreadystatechange=null,g.onprogress=null,g.readyState!==4&&(this.stats.aborted=!0,g.abort()))},R.abort=function(){var g;this.abortInternal(),(g=this.callbacks)!==null&&g!==void 0&&g.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},R.load=function(g,T,p){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=g,this.config=T,this.callbacks=p,this.retryDelay=T.retryDelay,this.loadInternal()},R.loadInternal=function(){var g=this.config,T=this.context;if(!!g){var p=this.loader=new self.XMLHttpRequest,E=this.stats;E.loading.first=0,E.loaded=0;var c=this.xhrSetup;try{if(c)try{c(p,T.url)}catch{p.open("GET",T.url,!0),c(p,T.url)}p.readyState||p.open("GET",T.url,!0);var v=this.context.headers;if(v)for(var i in v)p.setRequestHeader(i,v[i])}catch(t){this.callbacks.onError({code:p.status,text:t.message},T,p);return}T.rangeEnd&&p.setRequestHeader("Range","bytes="+T.rangeStart+"-"+(T.rangeEnd-1)),p.onreadystatechange=this.readystatechange.bind(this),p.onprogress=this.loadprogress.bind(this),p.responseType=T.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),g.timeout),p.send()}},R.readystatechange=function(){var g=this.context,T=this.loader,p=this.stats;if(!(!g||!T)){var E=T.readyState,c=this.config;if(!p.aborted&&E>=2)if(self.clearTimeout(this.requestTimeout),p.loading.first===0&&(p.loading.first=Math.max(self.performance.now(),p.loading.start)),E===4){T.onreadystatechange=null,T.onprogress=null;var v=T.status;if(v>=200&&v<300){p.loading.end=Math.max(self.performance.now(),p.loading.first);var i,t;if(g.responseType==="arraybuffer"?(i=T.response,t=i.byteLength):(i=T.responseText,t=i.length),p.loaded=p.total=t,!this.callbacks)return;var o=this.callbacks.onProgress;if(o&&o(p,g,i,T),!this.callbacks)return;var u={url:T.responseURL,data:i};this.callbacks.onSuccess(u,p,g,T)}else p.retry>=c.maxRetry||v>=400&&v<499?(C.logger.error(v+" while loading "+g.url),this.callbacks.onError({code:v,text:T.statusText},g,T)):(C.logger.warn(v+" while loading "+g.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,c.maxRetryDelay),p.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),c.timeout)}},R.loadtimeout=function(){C.logger.warn("timeout while loading "+this.context.url);var g=this.callbacks;g&&(this.abortInternal(),g.onTimeout(this.stats,this.context,this.loader))},R.loadprogress=function(g){var T=this.stats;T.loaded=g.loaded,g.lengthComputable&&(T.total=g.total)},R.getCacheAge=function(){var g=null;if(this.loader&&A.test(this.loader.getAllResponseHeaders())){var T=this.loader.getResponseHeader("age");g=T?parseFloat(T):null}return g},P}();M.default=b}}).default})})(Nt);const Qt=Ut(Nt.exports);export{Qt as H,Xt as a};
