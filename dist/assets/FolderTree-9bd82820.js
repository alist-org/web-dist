import{a$ as O,b as R,x as e,L as Y,S as i,Q as d,av as x,M as P,I as B,bw as Z,J as H,K as _,O as T,R as V,B as h,ay as w,W as A,ao as L,dA as p,dI as ee,bb as te,l as ne,_ as re,dJ as oe,H as z,D as ae,dK as le,aC as C,aP as I,ah as se,$ as ce,am as E,i as ie,ai as ue,j as M,dL as de,bt as he}from"./index-e047d5a8.js";import{o as ge,j as fe}from"./index-023d1aa9.js";const D=de(),me=(t,a)=>a.some(n=>t===n.path||t.startsWith(n.path+"/")),J=t=>{const[a,n]=h(t.defaultValue??"/"),l=w().permissions||[],s=(w().role||[]).includes(2);return e(L,{class:"folder-tree-box",w:"$full",overflowX:"auto",get children(){return e(D.Provider,{get value(){return{value:a,onChange:r=>{n(r),t.onChange(r)},autoOpen:t.autoOpen??!1,forceRoot:t.forceRoot??!1,showEmptyIcon:t.showEmptyIcon??!1,showHiddenFolder:t.showHiddenFolder??!0,permPaths:l}},get children(){return[e(i,{when:s,get children(){return e(b,{path:"/",isRoot:!0})}}),e(i,{get when(){return!s&&l.length>0},get children(){return e(A,{each:l,children:r=>e(b,{get path(){return r.path},isRoot:!0})})}})]}})}})},b=t=>{const{isHidePath:a}=p(),[n,l]=h(),{value:o,onChange:s,forceRoot:r,autoOpen:W,showEmptyIcon:j,showHiddenFolder:K,permPaths:F=[]}=ee(D),N=()=>{var c;return!!(j&&n()!==void 0&&!((c=n())!=null&&c.length))},[Q,U]=te(()=>ne(t.path,re(),1,0,!1));let k=!1;const S=async()=>{var v;if((v=n())!=null&&v.length)return;const c=await U();he(c,q=>{k=!0;let f=q.content.filter(m=>m.is_dir);!(w().role||[]).includes(2)&&F.length>0&&(f=f.filter(m=>{const G=M(t.path,m.name);return me(G,F)})),l(f)},()=>{u()&&g()})},{isOpen:u,onToggle:g}=O(),$=()=>o()===t.path,y=oe(t.path);z(ae(o,async c=>{W&&y(c)&&(u()||g(),k||S())}));const X=()=>a(t.path)&&!y(o());return e(i,{get when(){return K||!X()},get children(){return e(L,{get children(){return[e(x,{spacing:"$2",get children(){return[e(i,{get when(){return!Q()},get fallback(){return e(le,{size:"sm",get color(){return C()}})},get children(){return e(i,{get when(){return!N()},get fallback(){return e(I,{get color(){return C()},as:ge})},get children(){return e(I,{get color(){return C()},as:fe,get transform(){return u()?"rotate(90deg)":"none"},transition:"transform 0.2s",cursor:"pointer",onClick:()=>{g(),u()&&S()}})}})}}),e(se,{css:{whiteSpace:"nowrap"},fontSize:"$md",cursor:"pointer",px:"$1",rounded:"$md",get bgColor(){return $()?"$info8":"transparent"},get _hover(){return{backgroundColor:$()?"$info8":ce()}},onClick:()=>{s(t.path)},get children(){return E(()=>t.path==="/",!0)()?"root":ie(t.path)}})]}}),e(i,{get when(){return u()},get children(){return e(ue,{mt:"$1",pl:"$4",alignItems:"start",spacing:"$1",get children(){return e(A,{get each(){return n()},children:c=>e(b,{get path(){return M(t.path,c.name)}})})}})}})]}})}})},Se=t=>{const a=R(),[n,l]=h(t.defaultValue??"/"),[o,s]=h();return z(()=>{var r;t.opened&&((r=o())==null||r.setPath(n()))}),e(V,{size:"xl",blockScrollOnMount:!1,get opened(){return t.opened},get onClose(){return t.onClose},get children(){return[e(P,{}),e(B,{get children(){return[e(H,{w:"$full",css:{overflowWrap:"break-word"},get children(){return t.header}}),e(_,{get children(){return[E(()=>t.children),e(J,{onChange:l,handle:r=>s(r),autoOpen:!0,get defaultValue(){return n()}})]}}),e(T,{display:"flex",gap:"$2",get children(){return[e(i,{get when(){return t.footerSlot},get children(){return t.footerSlot}}),e(d,{get onClick(){return t.onClose},colorScheme:"neutral",get children(){return a("global.cancel")}}),e(d,{get loading(){return t.loading},onClick:()=>{var r;return(r=t.onSubmit)==null?void 0:r.call(t,n())},get children(){return a("global.ok")}})]}})]}})]}})},$e=t=>{const{isOpen:a,onOpen:n,onClose:l}=O(),o=R();return[e(x,{w:"$full",spacing:"$2",get children(){return[e(Y,{get id(){return t.id},get value(){return t.value},onInput:s=>t.onChange(s.currentTarget.value),get readOnly(){return t.onlyFolder},get onClick(){return t.onlyFolder?n:()=>{}},get placeholder(){return o(`global.${t.onlyFolder?"choose_folder":"choose_or_input_path"}`)}}),e(i,{get when(){return!t.onlyFolder},get children(){return e(d,{onClick:n,get children(){return o("global.choose")}})}})]}}),e(V,{size:"xl",get opened(){return a()},onClose:l,get children(){return[e(P,{}),e(B,{get children(){return[e(Z,{}),e(H,{get children(){return o("global.choose_folder")}}),e(_,{get children(){return e(J,{forceRoot:!0,get onChange(){return t.onChange}})}}),e(T,{get children(){return e(d,{onClick:l,get children(){return o("global.confirm")}})}})]}})]}})]};export{J as F,Se as M,$e as a};
