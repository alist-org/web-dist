System.register(["./index-legacy.87e1c49a.js","./index-legacy.ddd9c40c.js"],(function(e){"use strict";var t,r,n,a,o,s,l,c,i,d,u,g,p,f,h,m,w,y,k,b,v,$,C,P,D,_,x,z,A,F,R;return{setters:[e=>{t=e.b9,r=e._,n=e.a1,a=e.a,o=e.b,s=e.m,l=e.cj,c=e.h,i=e.S,d=e.ae,u=e.C,g=e.G,p=e.I,f=e.a4,h=e.al,m=e.n,w=e.bP,y=e.a7,k=e.bc,b=e.ak,v=e.ch,$=e.b5,C=e.ck,P=e.az,D=e.cl,_=e.cm,x=e.cn,z=e.d},e=>{A=e.u,F=e.c,R=e.d}],execute:function(){const S={pending:"neutral",uploading:"info",backending:"info",success:"success",error:"danger"},T=async e=>{let t=[];const r=async(e,n)=>{const a=new Promise(((a,o)=>{const s=e=>{console.error(e),o(e)};if(e.isFile)e.file((e=>{const r=new File([e],n+e.name,{type:e.type});t.push(r),console.log(r),a({})}),s);else if(e.isDirectory){const t=e.createReader(),o=()=>{t.readEntries((async t=>{for(let a=0;a<t.length;a++)await r(t[a],n+e.name+"/");a({}),t.length>0&&o()}),s)};o()}}));await a};return await r(e,""),t},O=e=>({name:e.name,path:e.webkitRelativePath?e.webkitRelativePath:e.name,size:e.size,progress:0,speed:0,status:"pending"}),j=[{name:"Stream",upload:async(e,n,a,o=!1)=>{let s=(new Date).valueOf(),l=0;const c=await t.put("/fs/put",n,{headers:{"File-Path":encodeURIComponent(e),"As-Task":o,"Content-Type":n.type||"application/octet-stream","Last-Modified":n.lastModified,Password:r()},onUploadProgress:e=>{if(e.total){const t=e.loaded/e.total*100|0;a("progress",t);const r=(new Date).valueOf(),n=(r-s)/1e3;if(n>1){const t=(e.loaded-l)/n,o=(e.total-e.loaded)/t;a("speed",t),console.log(o),s=r,l=e.loaded}100===t&&a("status","backending")}}});return 200===c.code?void 0:new Error(c.message)},provider:/.*/},{name:"Form",upload:async(e,n,a,o=!1)=>{let s=(new Date).valueOf(),l=0;const c=new FormData;c.append("file",n);const i=await t.put("/fs/form",c,{headers:{"File-Path":encodeURIComponent(e),"As-Task":o,"Content-Type":"multipart/form-data","Last-Modified":n.lastModified,Password:r()},onUploadProgress:e=>{if(e.total){const t=e.loaded/e.total*100|0;a("progress",t);const r=(new Date).valueOf(),n=(r-s)/1e3;if(n>1){const t=(e.loaded-l)/n,o=(e.total-e.loaded)/t;a("speed",t),console.log(o),s=r,l=e.loaded}100===t&&a("status","backending")}}});return 200===i.code?void 0:new Error(i.message)},provider:/.*/}],E=e=>{const t=a();return c(f,{w:"$full",spacing:"$1",rounded:"$lg",border:"1px solid $neutral7",alignItems:"start",p:"$2",get _hover(){return{border:`1px solid ${h()}`}},get children(){return[c($,{css:{wordBreak:"break-all"},get children(){return e.path}}),c(d,{spacing:"$2",get children(){return[c(C,{get colorScheme(){return S[e.status]},get children(){return t(`home.upload.${e.status}`)}}),c($,{get children(){return[P((()=>D(e.speed))),"/s"]}})]}}),c(_,{w:"$full",trackColor:"$info3",rounded:"$full",get value(){return e.progress},size:"sm",get children(){return c(x,{get color(){return h()},rounded:"$md"})}}),c($,{color:"$danger10",get children(){return e.msg}})]}})};e("default",(()=>{const e=a(),{pathname:t}=o(),{refresh:r}=A(),[$,C]=s(!1),[P,D]=s(!1),[_,x]=s(!1),[S,I]=l({uploads:[]});let M,U;const L=async e=>{if(0!==e.length){D(!0);for(const t of e){const e=O(t);I("uploads",(t=>[...t,e]))}for await(const t of async function*(e,t,r){const n=new Set;async function a(){const[e,t]=await Promise.race(n);return n.delete(e),t}for(const o of t){const s=(async()=>await r(o,t))().then((e=>[s,e]));n.add(s),n.size>=e&&(yield await a())}for(;n.size;)yield await a()}(3,e,J))console.log(t);r(void 0,!0)}},G=(e,t,r)=>{I("uploads",(t=>t.path===e),t,r)},B=j.filter((e=>e.provider.test(n.provider))),[q,H]=s(B[0]),J=async e=>{const r=e.webkitRelativePath?e.webkitRelativePath:e.name;G(r,"status","uploading");const n=z(t(),r);try{const t=await q().upload(n,e,((e,t)=>{G(r,e,t)}),_());t?(G(r,"status","error"),G(r,"msg",t.message)):(G(r,"status","success"),G(r,"progress",100))}catch(a){console.error(a),G(r,"status","error"),G(r,"msg",a.message)}};return c(f,{w:"$full",pb:"$2",spacing:"$2",get children(){return c(i,{get when(){return!P()},get fallback(){return[c(d,{spacing:"$2",get children(){return[c(u,{colorScheme:"accent",onClick:()=>{I("uploads",(e=>e.filter((({status:e})=>!["success","error"].includes(e))))),console.log(S.uploads)},get children(){return e("home.upload.clear_done")}}),c(i,{get when(){return S.uploads.every((({status:e})=>["success","error"].includes(e)))},get children(){return c(u,{onClick:()=>{D(!1)},get children(){return e("home.upload.back")}})}})]}}),c(g,{get each(){return S.uploads},children:e=>c(E,e)})]},get children(){return[c(p,{type:"file",multiple:!0,ref(e){"function"==typeof M?M(e):M=e},display:"none",onChange:e=>{L(Array.from(e.target.files??[]))}}),c(p,{type:"file",multiple:!0,webkitdirectory:!0,ref(e){"function"==typeof U?U(e):U=e},display:"none",onChange:e=>{L(Array.from(e.target.files??[]))}}),c(f,{w:"$full",justifyContent:"center",get border(){return`2px dashed ${$()?h():"$neutral8"}`},rounded:"$lg",onDragOver:e=>{e.preventDefault(),C(!0)},onDragLeave:()=>{C(!1)},onDrop:async t=>{t.preventDefault(),t.stopPropagation(),C(!1);const r=[],n=Array.from(t.dataTransfer?.items??[]),a=Array.from(t.dataTransfer?.files??[]);let o=n.length;const s=[];for(let e=0;e<o;e++){const t=n[e].webkitGetAsEntry();t?.isFile?r.push(a[e]):t?.isDirectory&&s.push(t)}for(const e of s){const t=await T(e);r.push(...t)}0===r.length&&m.warning(e("home.upload.no_files_drag")),L(r)},spacing:"$4",h:"$56",get children(){return c(i,{get when(){return!$()},get fallback(){return c(w,{get children(){return e("home.upload.release")}})},get children(){return[c(w,{get children(){return e("home.upload.upload-tips")}}),c(y,{w:"30%",get children(){return c(k,{get value(){return q().name},onChange:e=>{H(B.find((t=>t.name===e)))},get options(){return B.map((e=>({label:e.name,value:e.name})))}})}}),c(d,{spacing:"$4",get children(){return[c(b,{compact:!0,size:"xl",get"aria-label"(){return e("home.upload.upload_folder")},colorScheme:"accent",get icon(){return c(F,{})},onClick:()=>{U.click()}}),c(b,{compact:!0,size:"xl",get"aria-label"(){return e("home.upload.upload_files")},get icon(){return c(R,{})},onClick:()=>{M.click()}})]}}),c(v,{get checked(){return _()},onChange:()=>{x(!_())},get children(){return e("home.upload.add_as_task")}})]}})}})]}})}})}))}}}));
