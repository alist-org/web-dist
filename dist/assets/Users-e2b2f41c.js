import{b as L,d as U,be as F,bv as d,B as m,A as x,q as D,e1 as f,x as e,av as u,Q as l,ao as O,dB as W,dC as H,dD as p,W as g,dE as b,dF as I,dG as o,S as V,cV as $,bw as i,n as w,ai as j,d$ as q}from"./index-e907980e.js";import{b as A}from"./useTitle-ec03961f.js";import{D as E}from"./DeletePopover-be7c2b62.js";import{W as G}from"./Wether-f80e7fba.js";const P=r=>{const a=s=>{switch(s){case 1:return"neutral";case 2:return"success";default:return"info"}};return e(u,{spacing:"$1",get children(){return e(g,{get each(){return r.role},children:s=>e($,{get colorScheme(){return a(s)},get children(){return r.roleMap[s]??s}})})}})},K=()=>{const r=L();A("manage.sidemenu.users");const{to:a}=U(),[s,k]=F(()=>d.get("/admin/user/list")),[y,C]=m([]),c=async()=>{const t=await k();i(t,n=>C(n.content))},[S,T]=m([]),h=x(()=>{const t={};for(const n of S())t[n.id]=n.name;return t}),_=async()=>{const t=await q();i(t,n=>T(n.content))};D(()=>{_(),c()});const[v,B]=f(t=>d.post(`/admin/user/delete?id=${t}`)),[M,R]=f(t=>d.post(`/admin/user/cancel_2fa?id=${t}`));return e(j,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[e(u,{spacing:"$2",get children(){return[e(l,{colorScheme:"accent",get loading(){return s()},onClick:c,get children(){return r("global.refresh")}}),e(l,{onClick:()=>{a("/@manage/users/add")},get children(){return r("global.add")}})]}}),e(O,{w:"$full",overflowX:"auto",get children(){return e(W,{highlightOnHover:!0,dense:!0,get children(){return[e(H,{get children(){return e(p,{get children(){return[e(g,{each:["username","role","available"],children:t=>e(b,{get children(){return r(`users.${t}`)}})}),e(b,{get children(){return r("global.operations")}})]}})}}),e(I,{get children(){return e(g,{get each(){return y()},children:t=>e(p,{get children(){return[e(o,{get children(){return t.username}}),e(o,{get children(){return e(V,{get when(){return Object.keys(h()).length>0},get fallback(){return e($,{children:"..."})},get children(){return e(P,{get role(){return t.role},get roleMap(){return h()}})}})}}),e(o,{get children(){return e(G,{get yes(){return!t.disabled}})}}),e(o,{get children(){return e(u,{spacing:"$2",get children(){return[e(l,{onClick:()=>{a(`/@manage/users/edit/${t.id}`)},get children(){return r("global.edit")}}),e(E,{get name(){return t.username},get loading(){return v()===t.id},onClick:async()=>{const n=await B(t.id);i(n,()=>{w.success(r("global.delete_success")),c()})}}),e(l,{colorScheme:"accent",get loading(){return M()===t.id},onClick:async()=>{const n=await R(t.id);i(n,()=>{w.success(r("users.cancel_2fa_success")),c()})},get children(){return r("users.cancel_2fa")}})]}})}})]}})})}})]}})}})]}})};export{K as default};
