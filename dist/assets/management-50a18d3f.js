import{b as E,d as L,B as a,q as O,x as n,av as _,Q as f,am as o,ao as m,dB as R,dC as U,dD as p,W as l,dE as A,dF as F,dG as H,ai as I,n as s,cp as M,e4 as W,bw as u,e5 as j,e6 as q}from"./index-e907980e.js";import{D as z}from"./DeletePopover-be7c2b62.js";import{g as S}from"./ua-parser-5a8f43f2.js";const Q=()=>{const r=E(),{to:v}=L(),[C,$]=a([]),[w,g]=a(!1),[d,c]=a(null),[k,h]=a(null),[D,y]=a(!1),b=async e=>{h(e);try{const t=await q(e);u(t,()=>{s.success(r("session.kick_out_success")),i()},K=>{s.error(K||r("session.kick_out_failed"))})}catch{s.error(r("session.kick_out_failed"))}finally{h(null)}},T=e=>{const t=localStorage.getItem("device_key");return t&&e.session_id===t},x=async e=>{T(e)?(s.error(r("session.kick_out_current_session")),M(),v(`/@login?redirect=${encodeURIComponent(window.location.pathname)}`)):await b(e.session_id)},i=async()=>{g(!0),c(null);try{const e=await W();u(e,t=>{$(t||[])},t=>{c(t)})}catch(e){c(e instanceof Error?e.message:"Unknown error")}finally{g(!1)}};O(()=>{i()});const B=async()=>{y(!0);try{const e=await j();u(e,()=>{s.success(r("session.clean_success")),i()},t=>{s.error(t||r("session.clean_failed"))})}catch{s.error(r("session.clean_failed"))}finally{y(!1)}};return n(I,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[n(_,{spacing:"$2",get children(){return[n(f,{colorScheme:"accent",get loading(){return w()},onClick:i,get children(){return r("global.refresh")}}),n(f,{colorScheme:"danger",get loading(){return D()},onClick:B,get children(){return r("session.clean")}})]}}),o(()=>o(()=>!!d(),!0)()&&n(m,{color:"red.500",fontSize:"sm",get children(){return d()}})),n(m,{w:"$full",overflowX:"auto",get children(){return n(R,{highlightOnHover:!0,dense:!0,get children(){return[n(U,{get children(){return n(p,{get children(){return n(l,{each:[{key:"device_id",align:"left"},{key:"system_info",align:"left"},{key:"ip",align:"center"},{key:"last_active",align:"center"},{key:"status",align:"center"},{key:"user_id",align:"center"},{key:"username",align:"center"},{key:"operations",align:"center"}],children:e=>n(A,{get textAlign(){return e.align},get children(){return o(()=>e.key==="operations",!0)()?r("global.operations"):r(`session.${e.key}`)}})})}})}}),n(F,{get children(){return n(l,{get each(){return C()},children:e=>n(p,{get children(){return n(l,{get each(){return[{key:"device_id",align:"left",content:e.session_id?`${e.session_id.slice(0,6)}***${e.session_id.slice(-6)}`:"-"},{key:"system_info",align:"left",content:e.ua?S(e.ua):"-"},{key:"ip",align:"center",content:e.ip||"-"},{key:"last_active",align:"center",content:e.last_active?new Date(e.last_active*1e3).toLocaleString():"-"},{key:"status",align:"center",content:e.status===0?r("session.active"):r("session.offline")},{key:"user_id",align:"center",content:e.user_id},{key:"username",align:"center",content:e.username||"-"},{key:"operations",align:"center",content:n(_,{spacing:"$2",justifyContent:"center",get children(){return n(z,{get name(){return`${e.session_id?`${e.session_id.slice(0,6)}***${e.session_id.slice(-6)}`:"-"} (${e.ua?S(e.ua):"-"})`},get loading(){return k()===e.session_id},get disabled(){return k()!==null},onClick:()=>x(e),get buttonText(){return r("session.kick_out")}})}})}]},children:t=>n(H,{get textAlign(){return t.align},get children(){return t.content}})})}})})}})]}})}})]}})};export{Q as default};
