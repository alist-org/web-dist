import{B as a,b as T,d as b,q as x,x as n,av as h,Q as M,ao as E,dD as K,dE as B,dF as _,W as u,dG as H,am as I,dH as O,dI as R,ai as U,n as s,cr as A,e4 as F,bw as y,e5 as L,cw as f}from"./index-13b290a7.js";import{g as p}from"./ua-parser-5a8f43f2.js";import{D as W}from"./DeletePopover-14667228.js";const P=()=>{const[v,m]=a([]),[S,g]=a(!1),[j,c]=a(null),[d,k]=a(null),r=T(),{to:o}=b(),$=async e=>{k(e);try{const t=await L(e);y(t,()=>{s.success(r("session.kick_out_success")),l()},(i,D)=>{if(i!=null&&i.includes("session inactive")||D===403){s.error(r("session.kick_out_current_session")),f(),o("/@login");return}s.error(i||r("session.kick_out_failed"))})}catch(t){const i=t instanceof Error?t.message:String(t);if(i.includes("session inactive")||i.includes("401")){s.error(r("session.kick_out_current_session")),f(),o("/@login");return}s.error(r("session.kick_out_failed"))}finally{k(null)}},w=e=>{const t=localStorage.getItem("device_key");return t&&e.session_id===t},C=async e=>{w(e)?(s.error(r("session.kick_out_current_session")),A(),o(`/@login?redirect=${encodeURIComponent(window.location.pathname)}`)):await $(e.session_id)},l=async()=>{g(!0),c(null);try{const e=await F();y(e,t=>{m(t||[])},t=>{c(t)})}catch(e){c(e instanceof Error?e.message:"Unknown error")}finally{g(!1)}};return x(()=>{l()}),n(U,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[n(h,{spacing:"$2",get children(){return n(M,{colorScheme:"accent",get loading(){return S()},onClick:l,get children(){return r("global.refresh")}})}}),n(E,{w:"$full",overflowX:"auto",get children(){return n(K,{highlightOnHover:!0,dense:!0,get children(){return[n(B,{get children(){return n(_,{get children(){return n(u,{each:[{key:"device_id",align:"left"},{key:"system_info",align:"left"},{key:"ip",align:"center"},{key:"last_active",align:"center"},{key:"status",align:"center"},{key:"operations",align:"center"}],children:e=>n(H,{get textAlign(){return e.align},get children(){return I(()=>e.key==="operations",!0)()?r("global.operations"):r(`session.${e.key}`)}})})}})}}),n(O,{get children(){return n(u,{get each(){return v()},children:e=>n(_,{get children(){return n(u,{get each(){return[{key:"device_id",align:"left",content:e.session_id?`${e.session_id.slice(0,6)}***${e.session_id.slice(-6)}`:"-"},{key:"system_info",align:"left",content:e.ua?p(e.ua):"-"},{key:"ip",align:"center",content:e.ip||"-"},{key:"last_active",align:"center",content:e.last_active?new Date(e.last_active*1e3).toLocaleString():"-"},{key:"status",align:"center",content:e.status===0?r("session.active"):r("session.offline")},{key:"operations",align:"center",content:n(h,{spacing:"$2",justifyContent:"center",get children(){return n(W,{get name(){return`${e.session_id?`${e.session_id.slice(0,6)}***${e.session_id.slice(-6)}`:"-"} (${e.ua?p(e.ua):"-"})`},get loading(){return d()===e.session_id},get disabled(){return d()!==null},onClick:()=>C(e),get buttonText(){return r("session.kick_out")}})}})}]},children:t=>n(R,{get textAlign(){return t.align},get children(){return t.content}})})}})})}})]}})}})]}})};export{P as default};
