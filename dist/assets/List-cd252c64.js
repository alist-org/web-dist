import{al as se,dy as ce,b as E,d as G,U as B,B as S,H as J,x as e,M as ue,I as ge,bw as de,J as he,K as be,ai as N,bT as me,bG as fe,bI as we,bJ as xe,ao as Ce,S as x,bK as $e,W as M,d_ as K,d$ as H,e0 as Se,am as w,bN as je,bP as ye,av as h,bd as ke,bQ as pe,O as ve,Q as z,aP as Q,e8 as V,R as Le,e9 as X,bt as Oe,n as R,dA as _e,q as Ae,aO as p,r as Ie,$ as U,ea as A,E as Y,b1 as Z,aC as T,d3 as Me,cX as q,ah as m,aZ as Pe,cQ as ze,ax as ee,ay as D,aB as Be,cR as te,d5 as Te,au as De,A as Ee,o as We,j as Fe,e as Ke,eb as He,ec as Re,b3 as Ue,V as I,ed as qe,ad as Ge,aY as Je,cV as Ne}from"./index-655773fc.js";import{b as Qe}from"./style-88ea319d.js";import{q as Ve}from"./index-ebf8c4b5.js";import{I as ne,u as re}from"./helper-36e842cb.js";import{g as Xe,A as Ye}from"./AddLabelDialog-55db0501.js";const[Ze,{refetch:et}]=se(ce),tt=()=>({labels:Ze,refetch:et}),nt=t=>{const l=E(),{to:c}=G(),{refresh:b}=B(),[a,s]=S([]),[g,u]=S(!1),d=()=>{var r;t.isOpen&&((r=t.obj.label_list)!=null&&r.length)?s(t.obj.label_list.map(o=>o.id.toString())):s([])};J(()=>{t.isOpen&&d()});const j=async()=>{try{u(!0);const r=a().join(","),o=await X(r,t.obj);Oe(o,()=>{R.success(l("home.tag.bind_success")),t.onSubmit(a()),t.onClose(),b()})}catch(r){R.error(r.message||l("home.tag.bind_failed"))}finally{u(!1)}},v=()=>{t.onClose(),c("/@manage/settings/tag")},y=r=>{const o=a();o.includes(r)?s(o.filter(C=>C!==r)):s([...o,r])},L=r=>{s(a().filter(o=>o!==r))},O=r=>{var o;return((o=t.labels.find(C=>C.id.toString()===r))==null?void 0:o.name)||""};return e(Le,{get opened(){return t.isOpen},get onClose(){return t.onClose},get children(){return[e(ue,{}),e(ge,{get children(){return[e(de,{}),e(he,{get children(){return l("home.tag.tag")}}),e(be,{get children(){return e(N,{spacing:"$3",get children(){return e(me,{required:!0,get children(){return[e(fe,{color:"$neutral11",get children(){return l("home.tag.select")}}),e(we,{multiple:!0,get value(){return a()},onChange:s,get children(){return[e(xe,{get children(){return e(Ce,{display:"flex",flexWrap:"wrap",gap:"$2",p:"$2",minH:"40px",alignItems:"center",get children(){return e(x,{get when(){return a().length>0},get fallback(){return e($e,{get children(){return l("home.tag.select")}})},get children(){return[e(M,{get each(){return a().slice(0,3)},children:r=>e(K,{size:"lg",variant:"subtle",bgColor:"$neutral2",rounded:"$sm",px:"$3",py:"$1",get children(){return[e(H,{get children(){return O(r)}}),e(Se,{onClick:o=>{o.stopPropagation(),L(r)}})]}})}),e(x,{get when(){return a().length>3},get children(){return e(K,{size:"lg",variant:"subtle",bgColor:"$neutral2",rounded:"$sm",px:"$3",py:"$1",get children(){return e(H,{get children(){return["+",w(()=>a().length-3)]}})}})}})]}})}})}}),e(je,{get children(){return e(M,{get each(){return t.labels},children:r=>e(ye,{get value(){return r.id.toString()},onClick:()=>y(r.id.toString()),get children(){return e(h,{spacing:"$2",w:"$full",pl:"$4",fontSize:"$lg",get children(){return[e(ke,{get checked(){return a().includes(r.id.toString())},readOnly:!0}),e(pe,{get children(){return r.name}})]}})}})})}})]}})]}})}})}}),e(ve,{get children(){return e(h,{spacing:"$2",justifyContent:"space-between",w:"$full",get children(){return[e(z,{onClick:v,get leftIcon(){return e(Q,{as:V,boxSize:"$5"})},get children(){return l("home.tag.new")}}),e(h,{spacing:"$2",get children(){return[e(z,{colorScheme:"primary",get onClick(){return t.onClose},get children(){return l("global.cancel")}}),e(z,{onClick:j,get loading(){return g()},get children(){return l("global.confirm")}})]}})]}})}})]}})]}})},i=[{name:"name",textAlign:"left",w:{"@initial":"30%","@md":"30%"}},{name:"tag",textAlign:"right",w:{"@initial":"46%","@md":"25%"}},{name:"size",textAlign:"right",w:{"@initial":"24%","@md":"15%"}},{name:"modified",textAlign:"right",w:{"@initial":0,"@md":"30%"}}],rt=()=>{const t=Ke,l=Ee(()=>t().reduce((b,a)=>b+(a.size||0),0)),c=E();return e(x,{get when(){return t().length>0},get children(){return e(h,{spacing:"$2",position:"fixed",top:"$4",right:"$4",transform:"none",get bgColor(){return T()},color:"white",p:"$2",rounded:"$lg",zIndex:"$banner",shadow:"$md",get children(){return[e(m,{get children(){return[w(()=>c("home.selected"))," ",w(()=>t().length)," ",w(()=>c("home.selected_count"))]}}),e(m,{get children(){return[w(()=>c("home.total_size"))," ",w(()=>te(l()))]}})]}})}})},at=t=>{const{isHide:l}=_e(),{refresh:c}=B();if(l(t.obj))return null;const{setPathAs:b}=B(),{show:a}=Qe({id:1}),{pushHref:s,to:g,pathname:u}=G(),{openWithDoubleClick:d,toggleWithClick:j,restoreSelectionCache:v}=re(),y=()=>We.list_item_filename_overflow,L=()=>(D().permissions,Fe(u(),t.obj.name)),{labels:O,refetch:r}=tt(),[o,C]=S(!1),[ie,W]=S(!1);Ae(()=>{const n=()=>{r()};p.on("refresh_labels",n),Ie(()=>{p.off("refresh_labels",n)})});const le=async(n,f,_)=>{var k;try{const $=await r();if((k=$==null?void 0:$.data)!=null&&k.content){const F=$.data.content.find(P=>P.name===n&&P.description===f&&P.bg_color===_);F&&(await X(F.id.toString(),t.obj),await c(!1,!0))}}catch($){console.error("Failed to bind label to file:",$)}},oe=n=>{p.emit("refresh")};return[e(De.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return e(h,{get classList(){return{selected:!!t.obj.selected}},class:"list-item viselect-item",get"data-index"(){return t.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",backgroundColor:U()}},get bgColor(){return w(()=>!!t.obj.selected,!0)()?U():void 0},get children(){return[e(h,{class:"name-box",spacing:"$1",get w(){return i[0].w},as:Ve,get href(){return t.obj.name},get cursor(){return d()||j()?"default":"pointer"},"on:dblclick":()=>{d()&&(A(t.index,!0,!0),g(L()))},"on:click":n=>{if(n.preventDefault(),!d()&&!(n.ctrlKey||n.metaKey||n.shiftKey)&&v()){if(j())return A(t.index,!t.obj.selected);g(L())}},onMouseEnter:()=>{b(t.obj.name,t.obj.is_dir,!0)},onContextMenu:n=>{Y(()=>{A(t.index,!0,!0)}),a(n,{props:t.obj})},get children(){return[e(x,{get when(){return Z()},get children(){return e(ne,{"on:mousedown":n=>{n.stopPropagation()},"on:click":n=>{n.stopPropagation()},get checked(){return t.obj.selected},onChange:n=>{A(t.index,n.target.checked)}})}}),e(Q,{class:"icon",boxSize:"$6",get color(){return T()},get as(){return Me(t.obj)},mr:"$1",get cursor(){return t.obj.type!==q.IMAGE?"inherit":"pointer"},"on:click":n=>{t.obj.type===q.IMAGE&&(n.ctrlKey||n.metaKey||n.shiftKey||v()&&(p.emit("gallery",t.obj.name),n.preventDefault(),n.stopPropagation()))}}),e(m,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:y()==="multi_line"?"unset":"nowrap","overflow-x":y()==="scrollable"?"auto":"hidden",textOverflow:y()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return t.obj.name},get children(){return t.obj.name}})]}}),e(h,{spacing:"$1",get w(){return i[1].w},get textAlign(){return i[1].textAlign},onClick:n=>{n.preventDefault(),n.stopPropagation()},justifyContent:"space-between",get children(){return[e(h,{spacing:"$1",flex:1,overflow:"hidden",get children(){return e(x,{get when(){var n;return(n=t.obj.label_list)==null?void 0:n.length},get children(){return e(M,{get each(){return t.obj.label_list||[]},children:n=>e(Pe,{get label(){return n.name},placement:"top",get children(){return e(ze,{colorScheme:"primary",get bgColor(){return Xe(n.bg_color)},get color(){return n.bg_color},variant:"solid",mr:"$1",textTransform:"none",maxW:"100px",overflow:"hidden",css:{textOverflow:"ellipsis",whiteSpace:"nowrap"},get children(){return n.name}})}})})}})}}),e(x,{get when(){return ee.is_admin(D())&&!t.obj.is_dir},get children(){return e(Be,{size:"xs",variant:"ghost",get color(){return T()},get icon(){return e(V,{size:20})},"aria-label":"添加标签",onClick:n=>{var _,k;n.preventDefault(),n.stopPropagation();const f=O();(k=(_=f==null?void 0:f.data)==null?void 0:_.content)!=null&&k.length?W(!0):C(!0)},flexShrink:0})}}),e(Ye,{get isOpen(){return o()},onClose:()=>C(!1),onSubmit:le}),e(nt,{get isOpen(){return ie()},onClose:()=>W(!1),onSubmit:oe,get labels(){var n,f;return((f=(n=O())==null?void 0:n.data)==null?void 0:f.content)||[]},get obj(){return t.obj}})]}}),e(m,{class:"size",get w(){return i[2].w},get textAlign(){return i[2].textAlign},get children(){return te(t.obj.size)}}),e(m,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return i[3].w},get textAlign(){return i[3].textAlign},get children(){return Te(t.obj.modified)}})]}})}}),e(rt,{})]},ae=t=>{const l=E(),[c,b]=S(),[a,s]=S(!1);J(()=>{c()&&t.sortCallback(c(),a())});const g=u=>({fontWeight:"bold",fontSize:"$sm",color:"$neutral11",textAlign:u.textAlign,cursor:"pointer",onClick:()=>{u.name===c()?s(!a()):Y(()=>{b(u.name),s(!1)})}});return e(h,{class:"title",w:"$full",p:"$2",get children(){return[e(h,{get w(){return i[0].w},spacing:"$1",get children(){return[e(x,{get when(){return w(()=>!t.disableCheckbox,!0)()&&Z()},get children(){return e(ne,{get checked(){return He()},get indeterminate(){return Re()},onChange:u=>{Ue(u.target.checked)}})}}),e(m,I(()=>g(i[0]),{get children(){return l(`home.obj.${i[0].name}`)}}))]}}),e(m,I({get w(){return i[1].w}},()=>g(i[1]),{get children(){return l(`home.obj.${i[1].name}`)}})),e(m,I({get w(){return i[2].w}},()=>g(i[2]),{get children(){return l(`home.obj.${i[2].name}`)}})),e(m,I({get w(){return i[3].w}},()=>g(i[3]),{display:{"@initial":"none","@md":"inline"},get children(){return l(`home.obj.${i[3].name}`)}}))]}})},it=()=>{const t=a=>{var u;const s=Je.findIndex(d=>d==="write");if(!ee.can(D(),s,Ne()))return;const g=Array.from(((u=a.dataTransfer)==null?void 0:u.items)??[]);for(let d=0;d<g.length;d++)if(g[d].kind==="file"){p.emit("tool","upload"),a.preventDefault();break}},{isMouseSupported:l,registerSelectContainer:c,captureContentMenu:b}=re();return c(),e(N,{onDragOver:t,"oncapture:contextmenu":b,class:"list viselect-container",w:"$full",spacing:"$1",get children(){return[e(ae,{sortCallback:qe}),e(M,{get each(){return Ge.objs},children:(a,s)=>e(at,{obj:a,get index(){return s()}})})]}})},gt=Object.freeze(Object.defineProperty({__proto__:null,ListTitle:ae,default:it},Symbol.toStringTag,{value:"Module"}));export{ae as L,gt as a,i as c};
