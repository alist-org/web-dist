import{b as V,d as A,B as x,cW as E,be as p,e1 as J,bv as w,x as e,c2 as j,ap as G,ai as $,S as h,bW as i,bJ as c,L as u,bL as v,bM as y,bO as K,bQ as _,bR as S,W as f,bS as I,bT as T,bU as X,ao as Y,bN as Z,dp as ee,dq as re,dr as te,av as ne,bg as k,Q as se,n as C,bw as d,ec as le}from"./index-6ba85c96.js";const ie=()=>{const n=V(),{params:L,back:R}=A(),{id:o}=L,[m,D]=x([]),[q,O]=x([]),[t,a]=E({id:0,username:"",password:"",base_path:"",role:[],permission:0,disabled:!1,sso_id:"",role_info:[],permissions:[],max_devices:void 0,session_ttl:void 0}),[F,B]=p(()=>J()),[N,P]=p(()=>w.get(`/admin/user/get?id=${o}`)),W=async()=>{const r=await B();if(d(r,s=>{D(s.content)}),o){const s=await P();d(s,l=>{a(l),z(l.role)})}else a("base_path","/")},z=async r=>{const s=new Set;s.add("/");for(const l of r){const g=await le(l);d(g,Q=>{for(const b of Q.permission_scopes||[])b.path&&s.add(b.path)})}O([...s].map(l=>l.toString()))};W();const[H,U]=p(()=>w.post(`/admin/user/${o?"update":"create"}`,t)),M=()=>!o;return e($,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[e(j,{get children(){return n(o?"global.edit":"global.add")}}),e(G,{get loading(){return N()||F()},get children(){return e($,{spacing:"$2",alignItems:"start",w:"$full",get children(){return[e(h,{get when(){return!o||!(t.role_info||[]).includes(1)},get children(){return[e(i,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{for:"username",display:"flex",alignItems:"center",get children(){return n("users.username")}}),e(u,{id:"username",get value(){return t.username},onInput:r=>a("username",r.currentTarget.value)})]}}),e(i,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{for:"password",display:"flex",alignItems:"center",get children(){return n("users.password")}}),e(u,{id:"password",type:"password",placeholder:"********",get value(){return t.password},onInput:r=>a("password",r.currentTarget.value)})]}})]}}),e(h,{get when(){return!M()},get children(){return e(i,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{for:"base_path",display:"flex",alignItems:"center",get children(){return n("users.base_path")}}),e(v,{get value(){return t.base_path},onChange:r=>a("base_path",r),get children(){return[e(y,{get children(){return e(K,{})}}),e(_,{get children(){return e(S,{get children(){return e(f,{get each(){return q()},children:r=>e(I,{value:r,get children(){return[e(T,{children:r}),e(X,{})]}})})}})}})]}})]}})}}),e(i,{w:"$full",display:"flex",flexDirection:"column",required:!0,get children(){return[e(c,{display:"flex",alignItems:"center",get children(){return n("users.role")}}),e(v,{get value(){return t.role},onChange:r=>a("role",r),get children(){return[e(y,{get children(){return e(Y,{display:"flex",flexWrap:"wrap",gap:"$2",pr:"$6",py:"$2",minH:"40px",alignItems:"center",get children(){return e(h,{get when(){return t.role.length>0},get fallback(){return e(Z,{get children(){return n("home.selected")}})},get children(){return e(f,{get each(){return t.role},children:r=>{const s=m().find(l=>l.id===r);return e(ee,{size:"lg",variant:"subtle",bgColor:"$neutral2",rounded:"$sm",px:"$3",py:"$1",get children(){return[e(re,{get children(){return(s==null?void 0:s.name)||`ID: ${r}`}}),e(te,{onClick:l=>{l.stopPropagation(),a("role",t.role.filter(g=>g!==r))}})]}})}})}})}})}}),e(_,{get children(){return e(S,{get children(){return e(f,{get each(){return m()},children:r=>e(I,{get value(){return r.id},onClick:()=>{const s=t.role.includes(r.id)?t.role.filter(l=>l!==r.id):[r.id];a("role",s)},get children(){return e(ne,{spacing:"$2",w:"$full",pl:"$4",fontSize:"$lg",get children(){return[e(k,{get checked(){return t.role.includes(r.id)},readOnly:!0}),e(T,{get children(){return r.name}})]}})}})})}})}})]}})]}}),e(i,{w:"fit-content",display:"flex",get children(){return e(k,{css:{whiteSpace:"nowrap"},id:"disabled",onChange:r=>a("disabled",r.currentTarget.checked),color:"$neutral10",fontSize:"$sm",get checked(){return t.disabled},get children(){return n("users.disabled")}})}}),e(i,{w:"$full",display:"flex",flexDirection:"column",get children(){return[e(c,{for:"max_devices",display:"flex",alignItems:"center",get children(){return n("users.max_devices")}}),e(u,{id:"max_devices",type:"number",get value(){return t.max_devices??""},onInput:r=>a("max_devices",r.currentTarget.value?Number(r.currentTarget.value):void 0)})]}}),e(i,{w:"$full",display:"flex",flexDirection:"column",get children(){return[e(c,{for:"session_ttl",display:"flex",alignItems:"center",get children(){return n("users.session_ttl")}}),e(u,{id:"session_ttl",type:"number",get value(){return t.session_ttl??""},onInput:r=>a("session_ttl",r.currentTarget.value?Number(r.currentTarget.value):void 0)})]}}),e(se,{get loading(){return H()},onClick:async()=>{if(!t.role||t.role.length===0){C.error(n("users.role")+" "+n("global.required"));return}const r=await U();d(r,()=>{C.success(n("global.save_success")),R()})},get children(){return n("global.save")}})]}})}})]}})};export{ie as default};
